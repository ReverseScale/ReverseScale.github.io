<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Mantle--国外程序员最常用的iOS模型和字典转换框架 | Steven&#39;s Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Steven's Blog">
    <meta name="author" content="Steven">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Steven&#39;s Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/tags/博客，文章" target="_BLANK" class="animsition-link">文章</a></li>
                    
                        <li><a href="/tags/博客，资料" target="_BLANK" class="animsition-link">资料</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/API/" class="animsition-link">API<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Git/" class="animsition-link">Git<small>(1)</small></a></li>
				    
				    <li><a href="/categories/HTML/" class="animsition-link">HTML<small>(1)</small></a></li>
				    
				    <li><a href="/categories/HTML5/" class="animsition-link">HTML5<small>(4)</small></a></li>
				    
				    <li><a href="/categories/Markdown/" class="animsition-link">Markdown<small>(1)</small></a></li>
				    
				    <li><a href="/categories/PHP/" class="animsition-link">PHP<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Tools/" class="animsition-link">Tools<small>(2)</small></a></li>
				    
				    <li><a href="/categories/Unity-3D/" class="animsition-link">Unity 3D<small>(1)</small></a></li>
				    
				    <li><a href="/categories/iOS/" class="animsition-link">iOS<small>(59)</small></a></li>
				    
				    <li><a href="/categories/前沿技术/" class="animsition-link">前沿技术<small>(5)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="https://reversescale.github.io" class="animsition-link">Steven</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Steven's Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2016-11-29T02:29:29.000Z" itemprop="datePublished">
          2016-11-29
      </time>
    
    
    | 
    <a href='/tags/博客，文章/'>博客，文章</a>
    
    
</span>
                <h1>Mantle--国外程序员最常用的iOS模型和字典转换框架</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>#Mantle是iOS和Mac平台下基于Objective-C编写的一个简单高效的模型层框架。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a><!--more--></h2><h4 id="Mantle能做什么"><a href="#Mantle能做什么" class="headerlink" title="Mantle能做什么"></a>Mantle能做什么</h4><p>Mantle可以轻松把JSON数据、字典（Dictionary）和模型（即Objective对象）之间的相互转换，支持自定义映射，并且内置实现了NSCoding和NSCoping，大大简化归档操作。</p>
<hr>
<h4 id="为什么要使用Mantle"><a href="#为什么要使用Mantle" class="headerlink" title="为什么要使用Mantle"></a>为什么要使用Mantle</h4><p><strong>传统的模型层方案遇到的问题</strong></p>
<p>通常我们用Objective－C写的模型层遇到了什么问题？</p>
<p>我们可以用<strong>Github API</strong>来举例。现在假设我们想用Objective-C展现一个<strong>Github Issue</strong>，应该怎么做？</p>
<p>目前我们可以想到</p>
<p>1.直接解析JSON数据字典，然后展现给UI</p>
<p>2.将JSON数据转换为模型，在赋值给UI</p>
<p>关于1，弊端有很多，可以参考我的这篇文章：在iOS开发中使用字典转模型，现在假设我们选择了2，我们大致会定义下面的GHIssue模型：</p>
<p>GHIssue.h<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">#<span class="keyword">import</span> &lt;Foundation/Foundation.h&gt;     </div><div class="line">typedef <span class="class"><span class="keyword">enum</span> : <span class="title">NSUInteger</span> </span>&#123;         </div><div class="line"><span class="type">GHIssueStateOpen</span>,         </div><div class="line"><span class="type">GHIssueStateClosed</span>     </div><div class="line">&#125; <span class="type">GHIssueState</span>;</div><div class="line">@<span class="class"><span class="keyword">class</span> <span class="title">GHUser</span>;     </span></div><div class="line">@<span class="title">interface</span> <span class="title">GHIssue</span> : <span class="title">NSObject</span> &lt;<span class="title">NSCoding</span>, <span class="title">NSCopying</span>&gt;         </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>, <span class="title">readonly</span>) <span class="title">NSURL</span> *<span class="title">URL</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>, <span class="title">readonly</span>) <span class="title">NSURL</span> *<span class="title">HTMLURL</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>, <span class="title">readonly</span>) <span class="title">NSNumber</span> *<span class="title">number</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">assign</span>, <span class="title">readonly</span>) <span class="title">GHIssueState</span> <span class="title">state</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>, <span class="title">readonly</span>) <span class="title">NSString</span> *<span class="title">reporterLogin</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>, <span class="title">readonly</span>) <span class="title">NSDate</span> *<span class="title">updatedAt</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">strong</span>, <span class="title">readonly</span>) <span class="title">GHUser</span> *<span class="title">assignee</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>, <span class="title">readonly</span>) <span class="title">NSDate</span> *<span class="title">retrievedAt</span>;         </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>) <span class="title">NSString</span> *<span class="title">title</span>;     </div><div class="line">@<span class="title">property</span> (<span class="title">nonatomic</span>, <span class="title">copy</span>) <span class="title">NSString</span> *<span class="title">body</span>;         -</div><div class="line">(<span class="title">instancetype</span>)<span class="title">initWithDictionary</span>:(<span class="title">NSDictionary</span> *)<span class="title">dictionary</span>;         </div><div class="line">@<span class="title">end</span></div></pre></td></tr></table></figure></p>
<p>GHIssue.m</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div><div class="line">62</div><div class="line">63</div><div class="line">64</div><div class="line">65</div><div class="line">66</div><div class="line">67</div><div class="line">68</div><div class="line">69</div><div class="line">70</div><div class="line">71</div><div class="line">72</div><div class="line">73</div><div class="line">74</div></pre></td><td class="code"><pre><div class="line">#<span class="keyword">import</span> "GHIssue.h"     </div><div class="line">#<span class="keyword">import</span> "GHUser.h"         </div><div class="line">@implementation <span class="type">GHIssue</span>         </div><div class="line">+ (<span class="type">NSDateFormatter</span> *)dateFormatter &#123;         </div><div class="line"><span class="type">NSDateFormatter</span> *dateFormatter = [[<span class="type">NSDateFormatter</span> alloc] <span class="keyword">init</span>];         </div><div class="line">dateFormatter.locale = [[<span class="type">NSLocale</span> alloc]initWithLocaleIdentifier:@<span class="string">"en_US_POSIX"</span>];         </div><div class="line">dateFormatter.dateFormat = @<span class="string">"yyyy-MM-dd'T'HH:mm:ss'Z'"</span>;         <span class="keyword">return</span> dateFormatter;     </div><div class="line">&#125;         </div><div class="line">- (instancetype)initWithDictionary:(<span class="type">NSDictionary</span> *)dictionary &#123;         </div><div class="line"><span class="keyword">self</span> = [<span class="keyword">self</span> <span class="keyword">init</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span> == <span class="literal">nil</span>) <span class="keyword">return</span> <span class="literal">nil</span>;                 </div><div class="line">_URL = [<span class="type">NSURL</span> <span class="type">URLWithString</span>:dictionary[@<span class="string">"url"</span>]];         </div><div class="line">_HTMLURL = [<span class="type">NSURL</span> <span class="type">URLWithString</span>:dictionary[@<span class="string">"html_url"</span>]];         </div><div class="line">_number = dictionary[@<span class="string">"number"</span>];                 </div><div class="line"><span class="keyword">if</span> ([dictionary[@<span class="string">"state"</span>] isEqualToString:@<span class="string">"open"</span>]) &#123;             </div><div class="line">_state = <span class="type">GHIssueStateOpen</span>;         </div><div class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span> ([dictionary[@<span class="string">"state"</span>] isEqualToString:@<span class="string">"closed"</span>]) &#123;             </div><div class="line">_state = <span class="type">GHIssueStateClosed</span>;         </div><div class="line">&#125;                 </div><div class="line">_title = [dictionary[@<span class="string">"title"</span>] copy];         </div><div class="line">_retrievedAt = [<span class="type">NSDate</span> date];         </div><div class="line">_body = [dictionary[@<span class="string">"body"</span>] copy];         </div><div class="line">_reporterLogin = [dictionary[@<span class="string">"user"</span>][@<span class="string">"login"</span>] copy];         </div><div class="line">_assignee = [[<span class="type">GHUser</span> alloc] initWithDictionary:dictionary[@<span class="string">"assignee"</span>]];                 </div><div class="line">_updatedAt = [<span class="keyword">self</span>.<span class="keyword">class</span>.dateFormatter dateFromString:dictionary[@<span class="string">"updated_at"</span>]];                 </div><div class="line"><span class="keyword">return</span> <span class="keyword">self</span>;     </div><div class="line">&#125;         </div><div class="line">- (instancetype)initWithCoder:(<span class="type">NSCoder</span> *)coder &#123;         </div><div class="line"><span class="keyword">self</span> = [<span class="keyword">self</span> <span class="keyword">init</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span> == <span class="literal">nil</span>) <span class="keyword">return</span> <span class="literal">nil</span>;                 </div><div class="line">_URL = [coder decodeObjectForKey:@<span class="string">"URL"</span>];         </div><div class="line">_HTMLURL = [coder decodeObjectForKey:@<span class="string">"HTMLURL"</span>];         </div><div class="line">_number = [coder decodeObjectForKey:@<span class="string">"number"</span>];         </div><div class="line">_state = [coder decodeIntegerForKey:@<span class="string">"state"</span>];         </div><div class="line">_title = [coder decodeObjectForKey:@<span class="string">"title"</span>];         </div><div class="line">_retrievedAt = [<span class="type">NSDate</span> date];         </div><div class="line">_body = [coder decodeObjectForKey:@<span class="string">"body"</span>];         </div><div class="line">_reporterLogin = [coder decodeObjectForKey:@<span class="string">"reporterLogin"</span>];         </div><div class="line">_assignee = [coder decodeObjectForKey:@<span class="string">"assignee"</span>];         </div><div class="line">_updatedAt = [coder decodeObjectForKey:@<span class="string">"updatedAt"</span>];                 <span class="keyword">return</span> <span class="keyword">self</span>;     </div><div class="line">&#125;         </div><div class="line">- (void)encodeWithCoder:(<span class="type">NSCoder</span> *)coder &#123;         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.<span class="type">URL</span> != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.<span class="type">URL</span> forKey:@<span class="string">"URL"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.<span class="type">HTMLURL</span> != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.<span class="type">HTMLURL</span> forKey:@<span class="string">"HTMLURL"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.number != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.number forKey:@<span class="string">"number"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.title != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.title forKey:@<span class="string">"title"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.body != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.body forKey:@<span class="string">"body"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.reporterLogin != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.reporterLogin forKey:@<span class="string">"reporterLogin"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.assignee != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.assignee forKey:@<span class="string">"assignee"</span>];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span>.updatedAt != <span class="literal">nil</span>) [coder encodeObject:<span class="keyword">self</span>.updatedAt forKey:@<span class="string">"updatedAt"</span>];                 </div><div class="line">[coder encodeInteger:<span class="keyword">self</span>.state forKey:@<span class="string">"state"</span>];     </div><div class="line">&#125;         </div><div class="line">- (instancetype)copyWithZone:(<span class="type">NSZone</span> *)zone &#123;         </div><div class="line"><span class="type">GHIssue</span> *issue = [[<span class="keyword">self</span>.<span class="keyword">class</span> allocWithZone:zone] <span class="keyword">init</span>];         </div><div class="line">issue-&gt;_URL = <span class="keyword">self</span>.<span class="type">URL</span>;         </div><div class="line">issue-&gt;_HTMLURL = <span class="keyword">self</span>.<span class="type">HTMLURL</span>;         </div><div class="line">issue-&gt;_number = <span class="keyword">self</span>.number;         </div><div class="line">issue-&gt;_state = <span class="keyword">self</span>.state;         </div><div class="line">issue-&gt;_reporterLogin = <span class="keyword">self</span>.reporterLogin;         </div><div class="line">issue-&gt;_assignee = <span class="keyword">self</span>.assignee;         </div><div class="line">issue-&gt;_updatedAt = <span class="keyword">self</span>.updatedAt;                 </div><div class="line">issue.title = <span class="keyword">self</span>.title;         </div><div class="line">issue-&gt;_retrievedAt = [<span class="type">NSDate</span> date];         </div><div class="line">issue.body = <span class="keyword">self</span>.body;                 </div><div class="line"><span class="keyword">return</span> issue;     </div><div class="line">&#125;         </div><div class="line">- (<span class="type">NSUInteger</span>)hash &#123;         </div><div class="line"><span class="keyword">return</span> <span class="keyword">self</span>.number.hash;     </div><div class="line">&#125;         </div><div class="line">- (<span class="type">BOOL</span>)isEqual:(<span class="type">GHIssue</span> *)issue &#123;         </div><div class="line"><span class="keyword">if</span> (![issue isKindOfClass:<span class="type">GHIssue</span>.<span class="keyword">class</span>])</div><div class="line"><span class="keyword">return</span> <span class="type">NO</span>;                 </div><div class="line"><span class="keyword">return</span> [<span class="keyword">self</span>.number isEqual:issue.number] &amp;&amp; [<span class="keyword">self</span>.title isEqual:issue.title] &amp;&amp; [<span class="keyword">self</span>.body isEqual:issue.body];     </div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>GHUser.h</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">@interface <span class="type">GHUser</span> : <span class="type">NSObject</span> &lt;<span class="type">NSCoding</span>, <span class="type">NSCopying</span>&gt;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *login;     </div><div class="line">@property (nonatomic, assign) <span class="type">NSUInteger</span> id;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *avatarUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *gravatarId;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *url;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *htmlUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *followersUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *followingUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *gistsUrl;     @property (nonatomic, copy) <span class="type">NSString</span> *starredUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *subscriptionsUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *organizationsUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *reposUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *eventsUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *receivedEventsUrl;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *type;     </div><div class="line">@property (nonatomic, assign) <span class="type">BOOL</span> siteAdmin;         </div><div class="line">- (id)initWithDictionary:(<span class="type">NSDictionary</span> *)dictionary;         </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>你会看到，如此简单的事情却有很多弊端。甚至，还有一些其他问题，这个例子里面没有展示出来。</p>
<p>1.无法使用服务器的新数据来更新这个 GHIssue;</p>
<p>2.无法反过来将 GHIssue 转换成 JSON;</p>
<p>3.对于GHIssueState，如果枚举改编了，现有的归档会崩溃;</p>
<p>4.如果 GHIssue 接口改变了，现有的归档会崩溃。</p>
<hr>
<h4 id="使用MTLModel"><a href="#使用MTLModel" class="headerlink" title="使用MTLModel"></a>使用MTLModel</h4><p>如果使用MTLModel，我们可以这样，声明一个类继承自MTLModel</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div></pre></td><td class="code"><pre><div class="line">typedef <span class="class"><span class="keyword">enum</span> : <span class="title">NSUInteger</span> </span>&#123;         </div><div class="line"><span class="type">GHIssueStateOpen</span>,         </div><div class="line"><span class="type">GHIssueStateClosed</span>     </div><div class="line">&#125; <span class="type">GHIssueState</span>;         </div><div class="line">@interface <span class="type">GHIssue</span> : <span class="type">MTLModel</span> &lt;<span class="type">MTLJSONSerializing</span>&gt;         </div><div class="line">@property (nonatomic, copy, readonly) <span class="type">NSURL</span> *<span class="type">URL</span>;     </div><div class="line">@property (nonatomic, copy, readonly) <span class="type">NSURL</span> *<span class="type">HTMLURL</span>;     </div><div class="line">@property (nonatomic, copy, readonly) <span class="type">NSNumber</span> *number;     </div><div class="line">@property (nonatomic, assign, readonly) <span class="type">GHIssueState</span> state;     </div><div class="line">@property (nonatomic, copy, readonly) <span class="type">NSString</span> *reporterLogin;     </div><div class="line">@property (nonatomic, strong, readonly) <span class="type">GHUser</span> *assignee;     </div><div class="line">@property (nonatomic, copy, readonly) <span class="type">NSDate</span> *updatedAt;         </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *title;     </div><div class="line">@property (nonatomic, copy) <span class="type">NSString</span> *body;         </div><div class="line">@property (nonatomic, copy, readonly) <span class="type">NSDate</span> *retrievedAt;         </div><div class="line">@end     </div><div class="line">@implementation <span class="type">GHIssue</span>         </div><div class="line">+ (<span class="type">NSDateFormatter</span> *)dateFormatter &#123;         </div><div class="line"><span class="type">NSDateFormatter</span> *dateFormatter = [[<span class="type">NSDateFormatter</span> alloc] <span class="keyword">init</span>];         </div><div class="line">dateFormatter.locale = [[<span class="type">NSLocale</span> alloc] initWithLocaleIdentifier:@<span class="string">"en_US_POSIX"</span>];         </div><div class="line">dateFormatter.dateFormat = @<span class="string">"yyyy-MM-dd'T'HH:mm:ss'Z'"</span>;         <span class="keyword">return</span> dateFormatter;     </div><div class="line">&#125;         </div><div class="line">+ (<span class="type">NSDictionary</span> *)<span class="type">JSONKeyPathsByPropertyKey</span> &#123;         </div><div class="line"><span class="keyword">return</span> @&#123;             </div><div class="line">@<span class="string">"URL"</span>: @<span class="string">"url"</span>,             </div><div class="line">@<span class="string">"HTMLURL"</span>: @<span class="string">"html_url"</span>,             </div><div class="line">@<span class="string">"number"</span>: @<span class="string">"number"</span>,             </div><div class="line">@<span class="string">"state"</span>: @<span class="string">"state"</span>,             </div><div class="line">@<span class="string">"reporterLogin"</span>: @<span class="string">"user.login"</span>,             </div><div class="line">@<span class="string">"assignee"</span>: @<span class="string">"assignee"</span>,             </div><div class="line">@<span class="string">"updatedAt"</span>: @<span class="string">"updated_at"</span>         </div><div class="line">&#125;;     </div><div class="line">&#125;         </div><div class="line">+ (<span class="type">NSValueTransformer</span> *)<span class="type">URLJSONTransformer</span> &#123;         </div><div class="line"><span class="keyword">return</span> [<span class="type">NSValueTransformer</span> valueTransformerForName:<span class="type">MTLURLValueTransformerName</span>];     </div><div class="line">&#125;         </div><div class="line">+ (<span class="type">NSValueTransformer</span> *)<span class="type">HTMLURLJSONTransformer</span> &#123;         </div><div class="line"><span class="keyword">return</span> [<span class="type">NSValueTransformer</span> valueTransformerForName:<span class="type">MTLURLValueTransformerName</span>];     &#125;         </div><div class="line">+ (<span class="type">NSValueTransformer</span> *)stateJSONTransformer &#123;         </div><div class="line"><span class="keyword">return</span> [<span class="type">NSValueTransformer</span> mtl_valueMappingTransformerWithDictionary:@&#123;             </div><div class="line">@<span class="string">"open"</span>: @(<span class="type">GHIssueStateOpen</span>),             </div><div class="line">@<span class="string">"closed"</span>: @(<span class="type">GHIssueStateClosed</span>)         </div><div class="line">&#125;];     </div><div class="line">&#125;         </div><div class="line">+ (<span class="type">NSValueTransformer</span> *)assigneeJSONTransformer &#123;         </div><div class="line"><span class="keyword">return</span> [<span class="type">MTLJSONAdapter</span> dictionaryTransformerWithModelClass:<span class="type">GHUser</span>.<span class="keyword">class</span>];     </div><div class="line">&#125;         </div><div class="line">+ (<span class="type">NSValueTransformer</span> *)updatedAtJSONTransformer &#123;         </div><div class="line"><span class="keyword">return</span> [<span class="type">MTLValueTransformer</span> transformerUsingForwardBlock:^id(<span class="type">NSString</span> *dateString, <span class="type">BOOL</span> *success, <span class="type">NSError</span> *__autoreleasing *error) &#123;             </div><div class="line"><span class="keyword">return</span> [<span class="keyword">self</span>.dateFormatter dateFromString:dateString];         &#125; reverseBlock:^id(<span class="type">NSDate</span> *date, <span class="type">BOOL</span> *success, <span class="type">NSError</span> *__autoreleasing *error) &#123;             </div><div class="line"><span class="keyword">return</span> [<span class="keyword">self</span>.dateFormatter stringFromDate:date];         &#125;];     </div><div class="line">&#125;         </div><div class="line">- (instancetype)initWithDictionary:(<span class="type">NSDictionary</span> *)dictionaryValue error:(<span class="type">NSError</span> **)error &#123;         </div><div class="line"><span class="keyword">self</span> = [<span class="keyword">super</span> initWithDictionary:dictionaryValue error:error];         </div><div class="line"><span class="keyword">if</span> (<span class="keyword">self</span> == <span class="literal">nil</span>) <span class="keyword">return</span> <span class="literal">nil</span>;             </div><div class="line"><span class="comment">// Store a value that needs to be determined locally upon initialization.         </span></div><div class="line">_retrievedAt = [<span class="type">NSDate</span> date];             </div><div class="line"><span class="keyword">return</span> <span class="keyword">self</span>;     </div><div class="line">&#125;         </div><div class="line">@end</div></pre></td></tr></table></figure>
<p>很明显，我们不需要再去实现<nscoding>, <nscopying>, -isEqual:和-hash。在你的子类里面生命属性，MTLModel可以提供这些方法的默认实现。</nscopying></nscoding></p>
<p>最初例子里面的问题，在这里都得到了很好的解决。</p>
<ul>
<li><p><strong>MTLModel</strong>提供了一个<strong>- (void)mergeValueForKey:(NSString *)key fromModel:(id<mtlmodel>)model{},</mtlmodel></strong>可以与其他任何实现了<strong>MTLModel</strong>协议的模型对象集成。</p>
</li>
<li><p><strong>+[MTLJSONAdapter JSONDictionaryFromModel:error:]</strong>可以把任何遵循<strong>MTLJSONSerializing&gt;</strong><code>`协议的对象转换成JSON字典，+[MTLJSONAdapter JSONArrayFromModels:error:]</code>类似，不过转换的是一个数组。</p>
</li>
</ul>
<p><strong>MTLJSONAdapter</strong>中的<strong>fromJSONDictionary</strong>和<strong>JSONDictionaryFromModel</strong>可以实现模型和JSON的相互转化。</p>
<p><strong>JSONKeyPathsByPropertyKey</strong>可以实现模型和JSON的自定义映射。</p>
<p><strong>JSONTransformerForKey</strong>可以对JSON和模型不同类型进行映射。</p>
<p><strong>classForParsingJSONDictionary </strong>如果你使用了类簇（关于类簇，请参考：类簇在iOS开发中的应用），<strong>classForParsingJSONDictionary</strong>可以让你选择使用哪一个类进行JSON反序列化。</p>
<ul>
<li>MTLModel可以用归档很好的存储模型而不需要去实现令人厌烦的NSCoding协议。 <strong>-decodeValueForKey:withCoder:modelVersion:</strong>方法在解码时会自动调用，如果重写，可以方便的进行自定义。</li>
</ul>
<hr>
<h4 id="持久化"><a href="#持久化" class="headerlink" title="持久化"></a>持久化</h4><p><strong>Mantle配合归档</strong></p>
<p>MTLModel默认实现了  <strong>NSCoding</strong>协议，可以利用<strong>NSKeyedArchiver</strong>方便的对对象进行归档和解档。</p>
<p><strong>Mantle配合Core Data</strong></p>
<p>除了SQLite、FMDB之外，如果你想在你的数据里面执行复杂的查询，处理很多关系，支持撤销恢复，Core Data非常适合。</p>
<p>然而，这样也带来了一些痛点：</p>
<ul>
<li><p>仍然有很多弊端<strong>Managed objects</strong>解决了上面看到的一些弊端，但是Core Data自生也有他的弊端。正确的配置Core Data和获取数据需要很多行代码。</p>
</li>
<li><p>很难保持正确性。甚至有经验的人在使用Core Data时也会犯错，并且这些问题框架是无法解决的。</p>
</li>
</ul>
<p>如果你想获取JSON对象，Core Data需要做很多工作，但是却只能得到很少的回报。</p>
<p>但是，如果你已经在你的APP里面使用了Core Data，Mantle将仍然会是你的API和你的managed model objects之间一个很方便的转换层。</p>
<p><strong>Mantle配合MagicRecord（一个Core Data框架）</strong></p>
<p>参考 <strong>MagicalRecord配合Mantle</strong></p>
<hr>
<h4 id="Mantle为我们带来的好处"><a href="#Mantle为我们带来的好处" class="headerlink" title="Mantle为我们带来的好处"></a>Mantle为我们带来的好处</h4><p>*实现了NSCopying protocol，子类可以直接copy是多么爽的事情</p>
<p>*实现了NSCoding protocol，跟NSUserDefaults说拜拜</p>
<p>*提供了-isEqual:和-hash的默认实现，model作NSDictionary的key方便了许多</p>
<p>*支持自定义映射，这在接口改变的情况下很有用</p>
<p>*简单且把一件事情做好，不掺杂网络相关的操作</p>
<hr>
<h4 id="合理选择"><a href="#合理选择" class="headerlink" title="合理选择"></a>合理选择</h4><p>虽然上面说了一系列的好处，但如果你的App的代码规模只有几万行，或者API只有十几个，或者没有遇到上面这些问题， 建议还是不要引入了，杀鸡用指甲刀就够了。但是，Mantle的实现和思路是值得每位iOS工程师学习和借鉴的。</p>
<hr>
<h4 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h4><p><a href="https://github.com/terwer/MantleDemo" target="_blank" rel="external">https://github.com/terwer/MantleDemo</a></p>
<h4 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h4><p><a href="https://github.com/mantle/mantle" target="_blank" rel="external">https://github.com/mantle/mantle</a></p>
<p><a href="http://segmentfault.com/a/1190000002431365" target="_blank" rel="external">http://segmentfault.com/a/1190000002431365</a></p>
<p><a href="http://yyny.me/ios/Mantle%E3%80%81JSONModel%E3%80%81MJExtension%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/" target="_blank" rel="external">http://yyny.me/ios/Mantle%E3%80%81JSONModel%E3%80%81MJExtension%E6%80%A7%E8%83%BD%E6%B5%8B%E8%AF%95/</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2016/12/05/Sublime-Swift/" style="float: left;">
        ← 将 Sublime 打造成一个 Swift 编辑器
    </a>
    
    
    <a class="pull-right" href="/2016/11/24/Swift-OC-Tools/">
        在Swift中调用OC库 →
    </a>
    
</nav>

        <div class="duoshuo">
<div class="ds-thread" data-thread-key="2016/11/29/Mantle/" data-title="Mantle--国外程序员最常用的iOS模型和字典转换框架" data-url="http://yoursite.com/2016/11/29/Mantle/"></div>
<script type="text/javascript">
var duoshuoQuery = {short_name:"reversescale"};
(function() {
	var ds = document.createElement('script');
	ds.type = 'text/javascript';ds.async = true;
	ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
	ds.charset = 'UTF-8';
	(document.getElementsByTagName('head')[0] 
	 || document.getElementsByTagName('body')[0]).appendChild(ds);
})();
</script>
</div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Steven. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
