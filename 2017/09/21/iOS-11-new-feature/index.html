<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>iOS 11 新特性汇总 | Steven&#39;s Technology Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Steven's Technology Blog">
    <meta name="author" content="Steven">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Steven&#39;s Technology Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/tags/博客，文章" target="_BLANK" class="animsition-link">文章</a></li>
                    
                        <li><a href="/tags/博客，资料" target="_BLANK" class="animsition-link">资料</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/API/" class="animsition-link">API<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Android/" class="animsition-link">Android<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Git/" class="animsition-link">Git<small>(1)</small></a></li>
				    
				    <li><a href="/categories/HTML5/" class="animsition-link">HTML5<small>(5)</small></a></li>
				    
				    <li><a href="/categories/Markdown/" class="animsition-link">Markdown<small>(1)</small></a></li>
				    
				    <li><a href="/categories/PHP/" class="animsition-link">PHP<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Tools/" class="animsition-link">Tools<small>(2)</small></a></li>
				    
				    <li><a href="/categories/Unity-3D/" class="animsition-link">Unity 3D<small>(1)</small></a></li>
				    
				    <li><a href="/categories/iOS/" class="animsition-link">iOS<small>(125)</small></a></li>
				    
				    <li><a href="/categories/前沿技术/" class="animsition-link">前沿技术<small>(5)</small></a></li>
				    
				    <li><a href="/categories/文章/" class="animsition-link">文章<small>(5)</small></a></li>
				    
				    <li><a href="/categories/设计/" class="animsition-link">设计<small>(4)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="https://www.qtumist.com" class="animsition-link">量子计算</a></li>
                    
                    <li><a href="https://blog.ibeats.top" class="animsition-link">CI_Knight</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Steven's Technology Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2017-09-21T11:45:12.000Z" itemprop="datePublished">
          2017-09-21
      </time>
    
    
    | 
    <a href='/tags/博客，文章/'>博客，文章</a>
    
    
</span>
                <h1>iOS 11 新特性汇总</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>#在我们热烈欢迎 iPhone X 的同时，也有一些面向开发者的难题等待我们去探索。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a><!--more--></h2><h3 id="一-在UIKit’s-Bars中加入的新功能"><a href="#一-在UIKit’s-Bars中加入的新功能" class="headerlink" title="一. 在UIKit’s Bars中加入的新功能"></a>一. 在UIKit’s Bars中加入的新功能</h3><p>WWDC通过iOS新增的文件管理App：Files开始介绍，在Files这个APP中能够看到iOS11中UIKit’s Bars的一些新特性：在浏览功能上的大标题视图（向上滑动后标题会回到原来的UI效果）、横屏状态下tab上的文字和icon会变为左右排列。我用iOS11的模拟器体验了一下Files这个APP，如下图所示：<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/58580286.jpg" alt=""></p>
<p>在iPhone上，tab上的图标较小，tab bar较小，这样垂直空间可多放置内容。如果有人看不清楚tab bar上的图标或文字，可以通过长按tab bar上的任意item，会将该item显示在HUD上，这样可以清楚的看清icon和text。对tool bar 和 navigation bar同理，长按item也会放大显示。如下图显示：<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/53145673.jpg" alt=""></p>
<h4 id="UIBarItem"><a href="#UIBarItem" class="headerlink" title="UIBarItem"></a>UIBarItem</h4><p>UIBarItem是UI tab bar item和UI bar button item的父类，要想实现上面介绍的效果，只需要为UIBarItem 设置landscapeImagePhone属性，在storyboard中也支持这个设置，对于HUD的image需要设置另一个iOS11新增的属性：largeContentSizeImage，关于这部分更详细的讨论，可以参考 “WWDC2017 Session 215：What’s New in Accessibility”</p>
<h4 id="控制大标题的显示"><a href="#控制大标题的显示" class="headerlink" title="控制大标题的显示"></a>控制大标题的显示</h4><p>在UI navigation bar中新增了一个BOOL属性prefersLargeTitles,将该属性设置为ture，navigation bar就会在整个APP中显示大标题，如果想要在控制不同页面大标题的显示，可以通过设置当前页面的navigationItem的largeTitleDisplayMode属性；</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">navigationItem.largeTitleDisplayMode </div><div class="line"></div><div class="line">typedef NS_ENUM(NSInteger, UINavigationItemLargeTitleDisplayMode) &#123;  </div><div class="line">/// 自动模式依赖上一个 item 的特性</div><div class="line">UINavigationItemLargeTitleDisplayModeAutomatic,</div><div class="line">/// 针对当前 item 总是启用大标题特性</div><div class="line">UINavigationItemLargeTitleDisplayModeAlways,</div><div class="line">/// Never </div><div class="line">UINavigationItemLargeTitleDisplayModeNever,</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="Navigation-集成-UISearchController"><a href="#Navigation-集成-UISearchController" class="headerlink" title="Navigation 集成 UISearchController"></a>Navigation 集成 UISearchController</h4><p>把你的UISearchController赋值给navigationItem，就可以实现将UISearchController集成到Navigation。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">navigationItem.searchController  //iOS 11 新增属性</div><div class="line">navigationItem.hidesSearchBarWhenScrolling //决定滑动的时候是否隐藏搜索框；iOS 11 新增属性</div></pre></td></tr></table></figure>
<h4 id="UINavigationController和滚动交互"><a href="#UINavigationController和滚动交互" class="headerlink" title="UINavigationController和滚动交互"></a>UINavigationController和滚动交互</h4><p>滚动的时候，以下交互操作都是由UINavigationController负责调动的：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">UIsearchController搜索框效果更新</div><div class="line">大标题效果的控制</div><div class="line">Rubber banding效果 //当你开始往下拉，大标题会变大来回应那个滚轮</div></pre></td></tr></table></figure>
<p>所以，如果你使用navigation bar，组装一些整个push和pop体验，你不会得到searchController的集成、大标题的控制更新和Rubber banding效果，因为这些都是由UINavigationController控制的。</p>
<h4 id="UIToolbar-and-UINavigationBar-—-Layout"><a href="#UIToolbar-and-UINavigationBar-—-Layout" class="headerlink" title="UIToolbar and UINavigationBar — Layout"></a>UIToolbar and UINavigationBar — Layout</h4><p>在 iOS 11 中，当苹果进行所有这些新特性时，也进行了其他的优化，针对 UIToolbar 和 UINavigaBar 做了新的自动布局扩展支持，自定义的bar button items、自定义的title都可以通过layout来表示尺寸。<br>需要注意的是，你的constraints需要在view内部设置，所以如果你有一个自定义的标题视图，你需要确保任何约束只依赖于标题视图及其任何子视图。当你使用自动布局，系统假设你知道你在做什么。</p>
<h4 id="Avoiding-Zero-Sized-Custom-Views"><a href="#Avoiding-Zero-Sized-Custom-Views" class="headerlink" title="Avoiding Zero-Sized Custom Views"></a>Avoiding Zero-Sized Custom Views</h4><p>自定义视图的size为0是因为你有一些模糊的约束布局。要避免视图尺寸为0，可以从以下方面做：</p>
<ul>
<li><p>UINavigationBar 和 UIToolbar 提供位置</p>
</li>
<li><p>开发者则必须提供视图的size，有三种方式</p>
</li>
<li><p>对宽度和高度的约束</p>
</li>
<li><p>实现 intrinsicContentSize</p>
</li>
<li><p>通过约束关联你的子视图</p>
</li>
</ul>
<hr>
<h3 id="二-管理margins-和-insets"><a href="#二-管理margins-和-insets" class="headerlink" title="二. 管理margins 和 insets"></a>二. 管理margins 和 insets</h3><h4 id="layout-margins"><a href="#layout-margins" class="headerlink" title="layout margins"></a>layout margins</h4><p>基于约束的Auto Layout，使我们搭建能够动态响应内部和外部变化的用户界面。Auto Layout为每一个view都定义了margin。margin指的是控件显示内容部分的边缘和控件边缘的距离。<br>可以用layoutMargins或者layoutMarginsGuide属性获得view的margin,margin是视图内部的一部分。layoutMargins允许获取或者设置UIEdgeInsets结构的margin。layoutMarginsGuide则获取到只读的UILayoutGuide对象。</p>
<p>在iOS11新增了一个属性：directional layout margins，该属性是NSDirectionalEdgeInsets结构体类型的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">typedef struct NSDirectionalEdgeInsets &#123;  </div><div class="line">    CGFloat top, leading, bottom, trailing;</div><div class="line">&#125; NSDirectionalEdgeInsets API_AVAILABLE(ios(11.0),tvos(11.0),watchos(4.0));</div></pre></td></tr></table></figure>
<p>layoutMargins是UIEdgeInsets结构体类型的属性：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">typedef struct UIEdgeInsets &#123;  </div><div class="line">CGFloat top, left, bottom, right;</div><div class="line">&#125; UIEdgeInsets;</div></pre></td></tr></table></figure>
<p>从上面两种结构体的对比可以看出，NSDirectionalEdgeInsets 属性用leading 和 trailing 取代了之前的 left 和 right。</p>
<p>directional layout margins属性的说明如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">directionalLayoutMargins.leading is used on the left when the user interface direction is LTR and on the right for RTL.</div><div class="line">Vice versa for directionalLayoutMargins.trailing.</div></pre></td></tr></table></figure>
<p>例子：当你设置了trailing = 30；当在一个right to left 语言下trailing的值会被设置在view的左边，可以通过layoutMargin的left属性读出该值。如下图所示：</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/34965110.jpg" alt=""></p>
<p>还有其他一些更新。自从引入layout margins，当将一个view添加到viewController时，viewController会修复view的的layoutMargins为UIKit定义的一个值，这些调整对外是封闭的。</p>
<p>从iOS11开始，这些不再是一个固定的值，它们实际是最小值，你可以改变view的layoutMargins为任意一个更大的值。而且，viewController新增了一个属性：viewRespectsSystemMinimumLayoutMargins，如果你设置该属性为”false”，你就可以改变你的layoutMargins为任意你想设置的值，包括0，如下图所示：</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/77361834.jpg" alt=""></p>
<h4 id="安全区域（Safe-Area）"><a href="#安全区域（Safe-Area）" class="headerlink" title="安全区域（Safe Area）"></a>安全区域（Safe Area）</h4><p>如下图：照片应用程序</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/50343026.jpg" alt=""></p>
<p>从iOS 7以来，我们在整个操作系统中都有这些半透明的bars，苹果鼓励我们通过这些bars绘制内容，我们是通过viewController 的edgesForExtendedLayout属性来做这些的。</p>
<p>iOS 7 开始，在 UIViewController中引入的 topLayoutGuide 和 bottomLayoutGuide 在 iOS 11 中被废弃了！取而代之的就是safeArea的概念，safeArea是描述你的视图部分不被任何内容遮挡的方法。 它提供两种方式：safeAreaInsets或safeAreaLayoutGuide来提供给你safeArea的参照值，即 insets 或者 layout guide。 safeArea区域如图所示：</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/65267390.jpg" alt=""></p>
<p>如果有一个自定义的viewController，你可能要添加你自己的bars，增加safeAreaInsets的值，可以通过一个新的属性：addtionalSafeAreaInsets来改变safeAreaInsets的值，当你的viewController改变了它的safeAreaInsets值时，有两种方式获取到回调：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">UIView.safeAreaInsetsDidChange()</div><div class="line">UIViewController.viewSafeAreaInsetsDidChange()</div></pre></td></tr></table></figure>
<hr>
<h3 id="三-UIScrollView-and-UITableView的新特性"><a href="#三-UIScrollView-and-UITableView的新特性" class="headerlink" title="三. UIScrollView and UITableView的新特性"></a>三. UIScrollView and UITableView的新特性</h3><h4 id="Scroll-Views"><a href="#Scroll-Views" class="headerlink" title="Scroll Views"></a>Scroll Views</h4><p>如果有一些文本位于UI滚动视图的内部，并包含在导航控制器中，现在一般navigationContollers会传入一个contentInset给其最顶层的viewController的scrollView，在iOS11中进行了一个很大的改变，不再通过scrollView的contentInset属性了，而是新增了一个属性：adjustedContentInset，通过下面两种图的对比，能够表示adjustContentInset表示的区域：</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/24633299.jpg" alt=""></p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/6556677.jpg" alt=""></p>
<p>新增的contentInsetAdjustmentBehavior属性用来配置adjustedContentInset的行为，该结构体有以下几种类型：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIScrollViewContentInsetAdjustmentBehavior) &#123;  </div><div class="line">    UIScrollViewContentInsetAdjustmentAutomatic, </div><div class="line">    UIScrollViewContentInsetAdjustmentScrollableAxes,</div><div class="line">    UIScrollViewContentInsetAdjustmentNever,</div><div class="line">    UIScrollViewContentInsetAdjustmentAlways,</div><div class="line">&#125;</div><div class="line"></div><div class="line">@property(nonatomic) UIScrollViewContentInsetAdjustmentBehavior contentInsetAdjustmentBehavior;</div><div class="line">@property(nonatomic, readonly) UIEdgeInsets adjustedContentInset；</div><div class="line"></div><div class="line">//adjustedContentInset值被改变的delegate</div><div class="line">- (void)adjustedContentInsetDidChange; </div><div class="line">- (void)scrollViewDidChangeAdjustedContentInset:(UIScrollView *)scrollView;</div></pre></td></tr></table></figure>
<ul>
<li>automatic 和scrollableAxes一样,scrollView会自动计算和适应顶部和底部的内边距并且在scrollView 不可滚动时,也会设置内边距.</li>
<li>scrollableAxes 自动计算内边距.</li>
<li>never不计算内边距</li>
<li>always 根据safeAreaInsets 计算内边距</li>
</ul>
<h4 id="Table-Views-：在iOS-11中默认启用Self-Sizing"><a href="#Table-Views-：在iOS-11中默认启用Self-Sizing" class="headerlink" title="Table Views ：在iOS 11中默认启用Self-Sizing"></a>Table Views ：在iOS 11中默认启用Self-Sizing</h4><p>这个应该是UITableView最大的改变。我们知道在iOS8引入Self-Sizing 之后，我们可以通过实现estimatedRowHeight相关的属性来展示动态的内容，实现了estimatedRowHeight属性后，得到的初始contenSize是个估算值，是通过estimatedRowHeight x cell的个数得到的，并不是最终的contenSize，tableView不会一次性计算所有的cell的高度了，只会计算当前屏幕能够显示的cell个数再加上几个，滑动时，tableView不停地得到新的cell，更新自己的contenSize，在滑到最后的时候，会得到正确的contenSize。创建tableView到显示出来的过程中，contentSize的计算过程如下图:</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/74889822.jpg" alt=""></p>
<p>Self-Sizing在iOS11下是默认开启的，Headers, footers, and cells都默认开启Self-Sizing，所有estimated 高度默认值从iOS11之前的 0 改变为UITableViewAutomaticDimension：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">@property (nonatomic) CGFloat estimatedRowHeight NS_AVAILABLE_IOS(7_0); // default is UITableViewAutomaticDimension, set to 0 to disable</div></pre></td></tr></table></figure>
<p>如果目前项目中没有使用estimateRowHeight属性，在iOS11的环境下就要注意了，因为开启Self-Sizing之后，tableView是使用estimateRowHeight属性的，这样就会造成contentSize和contentOffset值的变化，如果是有动画是观察这两个属性的变化进行的，就会造成动画的异常，因为在估算行高机制下，contentSize的值是一点点地变化更新的，所有cell显示完后才是最终的contentSize值。因为不会缓存正确的行高，tableView reloadData的时候，会重新计算contentSize，就有可能会引起contentOffset的变化。iOS11下不想使用Self-Sizing的话，可以通过以下方式关闭：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">self.tableView.estimatedRowHeight = 0;</div><div class="line">self.tableView.estimatedSectionHeaderHeight = 0;</div><div class="line">self.tableView.estimatedSectionFooterHeight = 0;</div></pre></td></tr></table></figure>
<p>iOS11下，如果没有设置estimateRowHeight的值，也没有设置rowHeight的值，那contentSize计算初始值是 44 * cell的个数，如下图：</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/63532207.jpg" alt=""></p>
<h4 id="Table-Views：separatorInset-扩展"><a href="#Table-Views：separatorInset-扩展" class="headerlink" title="Table Views：separatorInset 扩展"></a>Table Views：separatorInset 扩展</h4><p>iOS 7 引入separatorInset属性，用以设置 cell 的分割线边距，在 iOS 11 中对其进行了扩展。可以通过新增的UITableViewSeparatorInsetReference枚举类型的separatorInsetReference属性来设置separatorInset属性的参照值。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UITableViewSeparatorInsetReference) &#123;  </div><div class="line">    UITableViewSeparatorInsetFromCellEdges,   //默认值，表示separatorInset是从cell的边缘的偏移量</div><div class="line">    UITableViewSeparatorInsetFromAutomaticInsets  //表示separatorInset属性值是从一个insets的偏移量</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>下图清晰的展示了这两种参照值的区别：<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/33875811.jpg" alt=""><br><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/24931587.jpg" alt=""></p>
<h4 id="Table-Views-和-Safe-Area"><a href="#Table-Views-和-Safe-Area" class="headerlink" title="Table Views 和 Safe Area"></a>Table Views 和 Safe Area</h4><p>有以下几点需要注意：</p>
<ul>
<li>separatorInset 被自动地关联到 safe area insets，因此，默认情况下，表视图的整个内容避免了其根视图控制器的安全区域的插入。</li>
<li>UITableviewCell 和 UITableViewHeaderFooterView的 content view 在安全区域内；因此你应该始终在 content view 中使用add-subviews操作。</li>
<li>所有的 headers 和 footers 都应该使用UITableViewHeaderFooterView，包括 table headers 和 footers、section headers 和 footers。</li>
</ul>
<h4 id="滑动操作（Swipe-Actions）"><a href="#滑动操作（Swipe-Actions）" class="headerlink" title="滑动操作（Swipe Actions）"></a>滑动操作（Swipe Actions）</h4><p>在iOS8之后，苹果官方增加了UITableVIew的右滑操作接口，即新增了一个代理方法(tableView: editActionsForRowAtIndexPath:)和一个类(UITableViewRowAction)，代理方法返回的是一个数组，我们可以在这个代理方法中定义所需要的操作按钮(删除、置顶等)，这些按钮的类就是UITableViewRowAction。</p>
<p>这个类只能定义按钮的显示文字、背景色、和按钮事件。并且返回数组的第一个元素在UITableViewCell的最右侧显示，最后一个元素在最左侧显示。从iOS 11开始有了一些改变，首先是可以给这些按钮添加图片了，然后是如果实现了以下两个iOS 11新增的代理方法，将会取代(tableView: editActionsForRowAtIndexPath:)代理方法：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">// Swipe actions</div><div class="line">// These methods supersede -editActionsForRowAtIndexPath: if implemented</div><div class="line">- (nullable UISwipeActionsConfiguration *)tableView:(UITableView *)tableView leadingSwipeActionsConfigurationForRowAtIndexPath:(NSIndexPath *)indexPath</div><div class="line">- (nullable UISwipeActionsConfiguration *)tableView:(UITableView *)tableView trailingSwipeActionsConfigurationForRowAtIndexPath:(NSIndexPath *)indexPath</div></pre></td></tr></table></figure>
<p>这两个代理方法返回的是UISwipeActionsConfiguration类型的对象，创建该对象及赋值可看下面的代码片段：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- ( UISwipeActionsConfiguration *)tableView:(UITableView *)tableView trailingSwipeActionsConfigurationForRowAtIndexPath:(NSIndexPath *)indexPath &#123;</div><div class="line">    //删除</div><div class="line">    UIContextualAction *deleteRowAction = [UIContextualAction contextualActionWithStyle:UIContextualActionStyleDestructive title:@&quot;delete&quot; handler:^(UIContextualAction * _Nonnull action, __kindof UIView * _Nonnull sourceView, void (^ _Nonnull completionHandler)(BOOL)) &#123;</div><div class="line">        [self.titleArr removeObjectAtIndex:indexPath.row];</div><div class="line">        completionHandler (YES);</div><div class="line">    &#125;];</div><div class="line">    deleteRowAction.image = [UIImage imageNamed:@&quot;icon_del&quot;];</div><div class="line">    deleteRowAction.backgroundColor = [UIColor blueColor];</div><div class="line"></div><div class="line">    UISwipeActionsConfiguration *config = [UISwipeActionsConfiguration configurationWithActions:@[deleteRowAction]];</div><div class="line">    return config;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>创建UIContextualAction对象时，UIContextualActionStyle有两种类型，如果是置顶、已读等按钮就使用UIContextualActionStyleNormal类型，delete操作按钮可使用UIContextualActionStyleDestructive类型，当使用该类型时，如果是右滑操作，一直向右滑动某个cell，会直接执行删除操作，不用再点击删除按钮，这也是一个好玩的更新。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">typedef NS_ENUM(NSInteger, UIContextualActionStyle) &#123;</div><div class="line">    UIContextualActionStyleNormal,</div><div class="line">    UIContextualActionStyleDestructive</div><div class="line">&#125; NS_SWIFT_NAME(UIContextualAction.Style)</div></pre></td></tr></table></figure>
<p>滑动操作这里还有一个需要注意的是，当cell高度较小时，会只显示image，不显示title，当cell高度够大时，会同时显示image和title。我写demo测试的时候，因为每个cell的高度都较小，所以只显示image，然后我增加cell的高度后，就可以同时显示image和title了。见下图对比：</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/13778947.jpg" alt=""><br><img src="http://og1yl0w9z.bkt.clouddn.com/17-9-21/27191688.jpg" alt=""></p>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>大概介绍了iOS 11的UI方面的一些更新，大部分内容自己代码测试过了，有些更新确实是很实用，可以适配下iOS 11，有的更新可能会给现有APP造成bug，所以学习下这些内容还是很有必要的。</p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p>-Updating Your App for iOS 11 - WWDC 2017 - Session 204 - iOS<br><a href="https://devstreaming-cdn.apple.com/videos/wwdc/2017/204kty9amomlmk222/204/hls_vod_mvp.m3u8" target="_blank" rel="external">https://devstreaming-cdn.apple.com/videos/wwdc/2017/204kty9amomlmk222/204/hls_vod_mvp.m3u8</a></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2017/11/06/AI-number/" style="float: left;">
        ← 利用神经网络识别手写数字
    </a>
    
    
    <a class="pull-right" href="/2017/09/12/SwiftandKotlin/">
        谈笑间让你理解 Swift 和 Kotlin 的面向协议 -接口篇 →
    </a>
    
</nav>

        <div class="duoshuo"></div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Steven. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
