<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Grand Central Dispatch Tutorial for Swift 3(2) | Steven&#39;s Technology Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Steven's Technology Blog">
    <meta name="author" content="Steven">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Steven&#39;s Technology Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/tags/博客，文章" target="_BLANK" class="animsition-link">文章</a></li>
                    
                        <li><a href="/tags/博客，资料" target="_BLANK" class="animsition-link">资料</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/API/" class="animsition-link">API<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Git/" class="animsition-link">Git<small>(1)</small></a></li>
				    
				    <li><a href="/categories/HTML5/" class="animsition-link">HTML5<small>(5)</small></a></li>
				    
				    <li><a href="/categories/Markdown/" class="animsition-link">Markdown<small>(1)</small></a></li>
				    
				    <li><a href="/categories/PHP/" class="animsition-link">PHP<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Tools/" class="animsition-link">Tools<small>(2)</small></a></li>
				    
				    <li><a href="/categories/Unity-3D/" class="animsition-link">Unity 3D<small>(1)</small></a></li>
				    
				    <li><a href="/categories/iOS/" class="animsition-link">iOS<small>(89)</small></a></li>
				    
				    <li><a href="/categories/前沿技术/" class="animsition-link">前沿技术<small>(5)</small></a></li>
				    
				    <li><a href="/categories/文章/" class="animsition-link">文章<small>(4)</small></a></li>
				    
				    <li><a href="/categories/设计/" class="animsition-link">设计<small>(4)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="https://reversescale.github.io" class="animsition-link">Steven</a></li>
                    
                    <li><a href="https://blog.ibeats.top" class="animsition-link">CI_Knight</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Steven's Technology Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2017-05-07T04:52:30.000Z" itemprop="datePublished">
          2017-05-07
      </time>
    
    
    | 
    <a href='/tags/博客，文章/'>博客，文章</a>
    
    
</span>
                <h1>Grand Central Dispatch Tutorial for Swift 3(2)</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>#在第二部分，您将使用与第一部分相同的 GooglyPuff 应用程序。您将深入了解高级 GCD 概念，包括调度组，取消调度块，异步测试技术和调度源等高级功能。本教程已由 Christine Abernathy 更新为 Swift 3。以前的教程是由 BjornRuud 撰写的</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a><!--more--></h2><h4 id="Note"><a href="#Note" class="headerlink" title="Note"></a>Note</h4><p>Welcome to the second and final part of this Grand Central Dispatch tutorial series!<br>In the first part of this series, you learned about concurrency, threading, and how GCD works. You made a singleton thread safe for reading and writing using a combination of dispatch barriers and synchronous dispatch queues. You also enhanced the app’s UX by using dispatch queues to delay the display of a prompt and to asynchronously offload CPU intensive work when instantiating a view controller.<br>In this second Grand Central Dispatch tutorial, you’ll be working with the same GooglyPuff application you know and love from the first part. You’ll delve into advanced GCD concepts including dispatch groups, cancelling dispatch blocks, asynchronous testing techniques, and dispatch sources.<br>It’s time to explore some more GCD!</p>
<hr>
<h4 id="Getting-Started"><a href="#Getting-Started" class="headerlink" title="Getting Started"></a>Getting Started</h4><p>You can pick up where you left off with the sample project from part one if you followed along. Alternatively, you can download the finished project from the first part of this tutorial here.<br>(<a href="https://koenig-media.raywenderlich.com/uploads/2016/12/GooglyPuff_Swift3_Part1_Final_Part2_Starter.zip" target="_blank" rel="external">https://koenig-media.raywenderlich.com/uploads/2016/12/GooglyPuff_Swift3_Part1_Final_Part2_Starter.zip</a>)<br>Run the app, tap +, and select Le Internet to add internet photos. You may notice that a download completion alert message pops up well before the images have finished downloading:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/51318663-file_1494133018381_17354.png" alt=""><br>That’s the first thing you’ll work on fixing.</p>
<hr>
<h4 id="Dispatch-Groups"><a href="#Dispatch-Groups" class="headerlink" title="Dispatch Groups"></a>Dispatch Groups</h4><p>Open PhotoManager.swift and check out downloadPhotosWithCompletion(_ :):<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line"><span class="function"><span class="keyword">func</span> <span class="title">downloadPhotosWithCompletion</span><span class="params">(</span></span></div><div class="line">  <span class="number">_</span> completion: BatchPhotoDownloadingCompletionClosure?) &#123;</div><div class="line">  <span class="keyword">var</span> storedError: <span class="type">NSError</span>?</div><div class="line">  <span class="keyword">for</span> address <span class="keyword">in</span> [overlyAttachedGirlfriendURLString,</div><div class="line">                  successKidURLString,</div><div class="line">                  lotsOfFacesURLString] &#123;</div><div class="line">                    <span class="keyword">let</span> url = <span class="type">URL</span>(string: address)</div><div class="line">                    <span class="keyword">let</span> photo = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">                      <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">                      <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</div><div class="line">                        storedError = error</div><div class="line">                      &#125;</div><div class="line">                    &#125;</div><div class="line">                    <span class="type">PhotoManager</span>.sharedManager.addPhoto(photo)</div><div class="line">    &#125;  </div><div class="line">    completion?(storedError)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>The alert is fired by the completion closure passed into the method. This is called after the for loop where the photos are downloaded. You’ve incorrectly assumed that the downloads are complete before the closure is called.<br>Photo downloads are kicked off by calling DownloadPhoto(url:). This call returns immediately but the actual download happens asynchronously. Therefore when completion is called, there’s no guarantee that all the downloads are done.<br>What you want is for downloadPhotosWithCompletion(<em> :) to call its completion closure after all the photo download tasks are complete. How can you monitor these concurrent asynchronous events to achieve this? With the current methodology, you don’t know when the tasks are complete and they can finish in any order.<br>Good news! This is exactly what dispatch groups are designed to handle. With dispatch groups you can group together multiple tasks and either wait for them to be completed or be notified once they are complete. Tasks can be asynchronous or synchronous and can even run on different queues.<br>DispatchGroup manages dispatch groups. You’ll first look at its wait method. This blocks your current thread until all the group’s enqueued tasks have been completed.<br>In PhotoManager.swift and replace the code in downloadPhotosWithCompletion(</em> :) with the following:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="type">DispatchQueue</span>.global(qos: .userInitiated).async &#123; <span class="comment">// 1</span></div><div class="line">  <span class="keyword">var</span> storedError: <span class="type">NSError</span>?</div><div class="line">  <span class="keyword">let</span> downloadGroup = <span class="type">DispatchGroup</span>() <span class="comment">// 2</span></div><div class="line">  <span class="keyword">for</span> address <span class="keyword">in</span> [overlyAttachedGirlfriendURLString,</div><div class="line">                  successKidURLString,</div><div class="line">                  lotsOfFacesURLString] &#123;</div><div class="line">    <span class="keyword">let</span> url = <span class="type">URL</span>(string: address)</div><div class="line">    downloadGroup.enter() <span class="comment">// 3</span></div><div class="line">    <span class="keyword">let</span> photo = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">      <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">      <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</div><div class="line">        storedError = error</div><div class="line">      &#125;   </div><div class="line">      downloadGroup.leave() <span class="comment">// 4</span></div><div class="line">    &#125;   </div><div class="line">    <span class="type">PhotoManager</span>.sharedManager.addPhoto(photo)</div><div class="line">  &#125;   </div><div class="line"></div><div class="line">  downloadGroup.wait() <span class="comment">// 5</span></div><div class="line">  <span class="type">DispatchQueue</span>.main.async &#123; <span class="comment">// 6</span></div><div class="line">    completion?(storedError)</div><div class="line">  &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Here’s what the code is doing step-by-step:<br>Since you’re using the synchronous wait method which blocks the current thread, you use async to place the entire method into a background queue to ensure you don’t block the main thread.<br>This creates a new dispatch group.<br>You call enter() to manually notify the group that a task has started. You must balance out the number of enter() calls with the number of leave() calls or your app will crash.<br>Here you notify the group that this work is done.<br>You call wait() to block the current thread while waiting for tasks’ completion. This waits forever which is fine because the photos creation task always completes. You can use wait(timeout:) to specify a timeout and bail out on waiting after a specified time.<br>At this point, you are guaranteed that all image tasks have either completed or timed out. You then make a call back to the main queue to run your completion closure.<br>Build and run the app. Download photos through Le Internet option and verify that the alert doesn’t show up until all the images are downloaded.<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/3339010-file_1494133130625_ae05.png" alt=""></p>
<blockquote>
<p>Note: If the network activities occur too quickly to discern when the completion closure should be called and you’re running the app on a device, you can make sure this really works by toggling some network settings in the Developer Section of the Settings app. Just go to the Network Link Conditioner section, enable it, and select a profile. “Very Bad Network” is a good choice.<br>If you are running on the Simulator, you can use the Network Link Conditioner included in the Advanced Tools for Xcode to change your network speed. This is a good tool to have in your arsenal because it forces you to be conscious of what happens to your apps when connection speeds are less than optimal.</p>
</blockquote>
<p>Dispatch groups are a good candidate for all types of queues. You should be wary of using dispatch groups on the main queue if you’re waiting synchronously for the completion of all work since you don’t want to hold up the main thread. However, the asynchronous model is an attractive way to update the UI once several long-running tasks finish, such as network calls.<br>Your current solution is good, but in general it’s best to avoid blocking threads if at all possible. Your next task is to rewrite the same method to notify you asynchronously when all the downloads have completed.</p>
<hr>
<h4 id="Dispatch-Groups-Take-2"><a href="#Dispatch-Groups-Take-2" class="headerlink" title="Dispatch Groups, Take 2"></a>Dispatch Groups, Take 2</h4><p>Dispatching asynchronously to another queue then blocking work using wait is clumsy. Fortunately, there is a better way. DispatchGroup can instead notify you when all the group’s tasks are complete.<br>Still in PhotoManager.swift, replace the code inside downloadPhotosWithCompletion(_ :) with the following:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// 1</span></div><div class="line"><span class="keyword">var</span> storedError: <span class="type">NSError</span>?</div><div class="line"><span class="keyword">let</span> downloadGroup = <span class="type">DispatchGroup</span>()</div><div class="line"><span class="keyword">for</span> address <span class="keyword">in</span> [overlyAttachedGirlfriendURLString,</div><div class="line">                successKidURLString,</div><div class="line">                lotsOfFacesURLString] &#123;</div><div class="line">  <span class="keyword">let</span> url = <span class="type">URL</span>(string: address)</div><div class="line">  downloadGroup.enter()</div><div class="line">  <span class="keyword">let</span> photo = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">    <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">    <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</div><div class="line">      storedError = error</div><div class="line">    &#125;   </div><div class="line">    downloadGroup.leave()</div><div class="line">  &#125;   </div><div class="line">  <span class="type">PhotoManager</span>.sharedManager.addPhoto(photo)</div><div class="line">&#125;   </div><div class="line"></div><div class="line">downloadGroup.notify(queue: <span class="type">DispatchQueue</span>.main) &#123; <span class="comment">// 2</span></div><div class="line">  completion?(storedError)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Here’s what’s going on:<br>In this new implementation you don’t need to surround the method in an async call since you’re not blocking the main thread.<br>notify(queue:work:) serves as the asynchronous completion closure. It is called when there are no more items left in the group. You also specify that you want to schedule the completion work to be run on the main queue.<br>This is a much cleaner way to handle this particular job as it doesn’t block any threads.<br>Build and run the app. Verify that the download complete alert is still displayed afer all internet photos are downloaded:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/53468989-file_1494133213760_5f12.png" alt=""></p>
<hr>
<h4 id="Concurrency-Looping"><a href="#Concurrency-Looping" class="headerlink" title="Concurrency Looping"></a>Concurrency Looping</h4><p>With all of these new tools at your disposal, you should probably thread everything, right!?<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/48639756-file_1494133255218_7209.jpg" alt=""><br>Take a look at downloadPhotosWithCompletion(<em> :) in PhotoManager. You might notice that there’s a for loop in there that cycles through three iterations and downloads three separate images. Your job is to see if you can run this for loop concurrently to try and speed things up.<br>This is a job for DispatchQueue.concurrentPerform(iterations:execute:). It works similarly to a for loop in that it executes different iterations concurrently. It is sychronous and returns only when all of the work is done.<br>Care must be taken when figuring out the optimal number of iterations for a given amount of work. Many iterations and a small amount of work per iteration can create so much overhead that it negates any gains from making the calls concurrent. The technique known as striding helps you out here. This is where for each iteration you do multiple pieces of work.<br>When is it appropriate to use DispatchQueue.concurrentPerform(iterations:execute:)? You can rule out serial queues because there’s no benefit there – you may as well use a normal for loop. It’s a good choice for concurrent queues that contain looping, especially if you need to keep track of progress.<br>In PhotoManager.swift replace the code inside downloadPhotosWithCompletion(</em> :) with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> storedError: <span class="type">NSError</span>?</div><div class="line"><span class="keyword">let</span> downloadGroup = <span class="type">DispatchGroup</span>()</div><div class="line"><span class="keyword">let</span> addresses = [overlyAttachedGirlfriendURLString,</div><div class="line">                 successKidURLString,</div><div class="line">                 lotsOfFacesURLString]</div><div class="line"><span class="keyword">let</span> <span class="number">_</span> = <span class="type">DispatchQueue</span>.global(qos: .userInitiated)</div><div class="line"><span class="type">DispatchQueue</span>.concurrentPerform(iterations: addresses.<span class="built_in">count</span>) &#123;</div><div class="line">  i <span class="keyword">in</span></div><div class="line">  <span class="keyword">let</span> index = <span class="type">Int</span>(i)</div><div class="line">  <span class="keyword">let</span> address = addresses[index]</div><div class="line">  <span class="keyword">let</span> url = <span class="type">URL</span>(string: address)</div><div class="line">  downloadGroup.enter()</div><div class="line">  <span class="keyword">let</span> photo = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">    <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">    <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</div><div class="line">      storedError = error</div><div class="line">    &#125;</div><div class="line">    downloadGroup.leave()</div><div class="line">  &#125;</div><div class="line">  <span class="type">PhotoManager</span>.sharedManager.addPhoto(photo)</div><div class="line">&#125;</div><div class="line">downloadGroup.notify(queue: <span class="type">DispatchQueue</span>.main) &#123;</div><div class="line">  completion?(storedError)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>The former for loop has been replaced with DispatchQueue.concurrentPerform(iterations:execute:) to handle concurrent looping.<br>Build and run the app. Verify that the internet download functionality still behaves properly:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/60359457-file_1494133305128_182f.png" alt=""></p>
<p>Running this new code on the device will occasionally produce marginally faster results. But was all this work worth it?<br>Actually, it’s not worth it in this case. Here’s why:<br>You’ve probably created more overhead running the threads in parallel than just running the for loop in the first place. You should use DispatchQueue.concurrentPerform(iterations:execute:) for iterating over very large sets along with the appropriate stride length.<br>Your time to create an app is limited — don’t waste time pre-optimizing code that you don’t know is broken. If you’re going to optimize something, optimize something that is noticeable and worth your time. Find the methods with the longest execution times by profiling your app in Instruments. Check out How to Use Instruments in Xcode to learn more.<br>Typically, optimizing code makes your code more complicated for yourself and for other developers coming after you. Make sure the added complication is worth the benefit.<br>Remember, don’t go crazy with optimizations. You’ll only make it harder on yourself and others who have to wade through your code.</p>
<hr>
<h4 id="Cancelling-Dispatch-Blocks"><a href="#Cancelling-Dispatch-Blocks" class="headerlink" title="Cancelling Dispatch Blocks"></a>Cancelling Dispatch Blocks</h4><p>Thus far, you haven’t seen code that allows you to cancel enqueued tasks. This is where dispatch block objects represented by DispatchWorkItem comes into focus. Be aware that you can only cancel a DispatchWorkItem before it reaches the head of a queue and starts executing.<br>Let’s demonstrate this by starting download tasks for several images from Le Internet then cancelling some of them.<br>Still in PhotoManager.swift, replace the code in downloadPhotosWithCompletion(_ :) with the following:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">var</span> storedError: <span class="type">NSError</span>?</div><div class="line"><span class="keyword">let</span> downloadGroup = <span class="type">DispatchGroup</span>()</div><div class="line"><span class="keyword">var</span> addresses = [overlyAttachedGirlfriendURLString,</div><div class="line">                 successKidURLString,</div><div class="line">                 lotsOfFacesURLString]</div><div class="line">addresses += addresses + addresses <span class="comment">// 1</span></div><div class="line"><span class="keyword">var</span> blocks: [<span class="type">DispatchWorkItem</span>] = [] <span class="comment">// 2</span></div><div class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="number">0</span> ..&lt; addresses.<span class="built_in">count</span> &#123;</div><div class="line">  downloadGroup.enter()</div><div class="line">  <span class="keyword">let</span> block = <span class="type">DispatchWorkItem</span>(flags: .inheritQoS) &#123; <span class="comment">// 3</span></div><div class="line">    <span class="keyword">let</span> index = <span class="type">Int</span>(i)</div><div class="line">    <span class="keyword">let</span> address = addresses[index]</div><div class="line">    <span class="keyword">let</span> url = <span class="type">URL</span>(string: address)</div><div class="line">    <span class="keyword">let</span> photo = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">      <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">      <span class="keyword">if</span> error != <span class="literal">nil</span> &#123;</div><div class="line">        storedError = error</div><div class="line">      &#125;</div><div class="line">      downloadGroup.leave()</div><div class="line">    &#125;</div><div class="line">    <span class="type">PhotoManager</span>.sharedManager.addPhoto(photo)</div><div class="line">  &#125;</div><div class="line">  blocks.append(block)</div><div class="line">  <span class="type">DispatchQueue</span>.main.async(execute: block) <span class="comment">// 4</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">for</span> block <span class="keyword">in</span> blocks[<span class="number">3</span> ..&lt; blocks.<span class="built_in">count</span>] &#123; <span class="comment">// 5</span></div><div class="line">  <span class="keyword">let</span> cancel = arc4random_uniform(<span class="number">2</span>) <span class="comment">// 6</span></div><div class="line">  <span class="keyword">if</span> cancel == <span class="number">1</span> &#123;</div><div class="line">    block.cancel() <span class="comment">// 7</span></div><div class="line">    downloadGroup.leave() <span class="comment">// 8</span></div><div class="line">  &#125;</div><div class="line">&#125;</div><div class="line">downloadGroup.notify(queue: <span class="type">DispatchQueue</span>.main) &#123;</div><div class="line">  completion?(storedError)</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>Here’s a step-by-step walk through the code above:<br>You expand the addresses array to hold three copies of each image.<br>You initialize a blocks array to hold dispatch block objects for later use.<br>You create a new DispatchWorkItem. You pass in a flags parameter to specify that the block should inherit its Quality of Service class from the queue it is dispatched to. You then define the work to be done in a closure.<br>You dispatch the block asynchronously to the main queue. For this example, using the main queue makes it easier to cancel select blocks since it’s a serial queue. The code that sets up the dispatch blocks is already executing on the main queue so you are guaranteed that the download blocks will execute at some later time.<br>You skip the first three download blocks by slicing the blocks array.<br>Here you use arc4random_uniform() to randomly pick a number between 0 and 1. It’s like a coin toss.<br>If the random number is 1 you cancel the block. This can only cancel blocks that are still in a queue and haven’t began executing. Blocks can’t be canceled in the middle of execution.<br>Here you remember to remove the canceled block from the dispatch group.<br>Build and run the app, then add images from Le Internet. You’ll see that the app now downloads more than three images. The number of extra images changes each time you re-run your app. Some of the additional image downloads in the queue are canceled before they start.<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/13450555-file_1494133398536_8619.png" alt=""><br>This is a pretty contrived example but it a nice illustration of how dispatch block objects are used and cancelled.<br>Dispatch block objects can do a lot more, so be sure to check out Apple’s documentation.</p>
<hr>
<h4 id="Miscellaneous-GCD-Fun"><a href="#Miscellaneous-GCD-Fun" class="headerlink" title="Miscellaneous GCD Fun"></a>Miscellaneous GCD Fun</h4><p>But wait! There’s more! Here are some extra functions that are a little farther off the beaten path. Although you won’t use these tools nearly as frequently, they can be tremendously helpful in the right situations.<br><strong>Testing Asynchronous Code</strong><br>This might sound like a crazy idea, but did you know that Xcode has testing functionality? :] I know, sometimes I like to pretend it’s not there, but writing and running tests is important when building complex relationships in code.<br>Testing in Xcode is performed on subclasses of XCTestCase and runs any method in its method signature that begins with test. Testing is measured on the main thread, so you can assume that every test happens in a serial manner.<br>As soon as a given test method completes, XCTest methods will consider a test to be finished and move onto the next test. That means that any asynchronous code from the previous test will continue to run while the next test is running.<br>Networking code is usually asynchronous, since you don’t want to block the main thread while performing a network fetch. That, coupled with the fact that tests finish when the test method finishes, can make it hard to test networking code.<br>Let’s take a brief look at two common techniques for testing asynchronous code: one using semaphores and one using expectations.<br><strong>Semaphores</strong><br>Semaphores are an old-school threading concept introduced to the world by the ever-so-humble Edsger W. Dijkstra. Semaphores are a complex topic because they build upon the intricacies of operating system functions.<br>If you want to learn more about semaphores, check out this detailed discussion on semaphore theory. If you’re the academic type, you may want to check out Dining Philosophers Problem which is a classic software development problem that uses semaphores.<br>Open GooglyPuffTests.swift and replace the code inside downloadImageURLWithString(_ :) with the following:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: urlString)</div><div class="line"><span class="keyword">let</span> semaphore = <span class="type">DispatchSemaphore</span>(value: <span class="number">0</span>) <span class="comment">// 1</span></div><div class="line"><span class="keyword">let</span> <span class="number">_</span> = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">  <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">  <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</div><div class="line">    <span class="type">XCTFail</span>(<span class="string">"\(urlString) failed. \(error.localizedDescription)"</span>)</div><div class="line">  &#125;   </div><div class="line">  semaphore.signal() <span class="comment">// 2</span></div><div class="line">&#125;</div><div class="line"><span class="keyword">let</span> timeout = <span class="type">DispatchTime</span>.now() + .seconds(defaultTimeoutLengthInSeconds)</div><div class="line"><span class="keyword">if</span> semaphore.wait(timeout: timeout) == .timedOut &#123; <span class="comment">// 3</span></div><div class="line">  <span class="type">XCTFail</span>(<span class="string">"\(urlString) timed out"</span>)</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Here’s how the semaphore works in the code above:<br>You create a semaphore and set its start value. This represents the number of things that can access the semaphore without needing the semaphore to be incremented (note that incrementing a semaphore is known as signaling it).<br>You signal the semaphore in the completion closure. This increments the semaphore count and signals that the semaphore is available to other resources that want it.<br>You wait on the semaphore, with a given timeout. This call blocks the current thread until the semaphore has been signaled. A non-zero return code from this function means that the timeout was reached. In this case, the test is failed because it is deemed that the network should not take more than 10 seconds to return – a fair point!<br>Run your tests by selecting Product\Test from the menu or using ⌘+U if you have the default key bindings. They should all succeed in a timely manner:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/2877691-file_1494133486228_2fe4.png" alt=""><br>Disable your connection and run the tests again. If you’re running on a device, put it in airplane mode. If you’re running on the simulator then simply turn off your connection. The tests complete with a fail result after 10 seconds. Great, it worked!<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/79772589-file_1494133514790_4d33.png" alt=""><br>These are rather trivial tests, but if you’re working with a server team then these basic tests can prevent a wholesome round of finger-pointing of who is to blame for the latest network issue.<br><strong>Expectations</strong><br>The XCTest framework provides another solution to the asynchronous code testing problem in the form of expectations. This feature lets you set up an expectation – something you expect will happen – and then start an asynchronous task. Then you can have the test runner wait until the asynchronous task marks the expectation as fulfilled.<br>Still working in GooglyPuffTests.swift, replace the code in downloadImageURLWithString(_ :) with the following:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">let</span> url = <span class="type">URL</span>(string: urlString)</div><div class="line"><span class="keyword">let</span> downloadExpectation =</div><div class="line">  expectation(description: <span class="string">"Image downloaded from \(urlString)"</span>) <span class="comment">// 1</span></div><div class="line"><span class="keyword">let</span> <span class="number">_</span> = <span class="type">DownloadPhoto</span>(url: url!) &#123;</div><div class="line">  <span class="number">_</span>, error <span class="keyword">in</span></div><div class="line">  <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</div><div class="line">    <span class="type">XCTFail</span>(<span class="string">"\(urlString) failed. \(error.localizedDescription)"</span>)</div><div class="line">  &#125;   </div><div class="line">  downloadExpectation.fulfill() <span class="comment">// 2</span></div><div class="line">&#125;   </div><div class="line">waitForExpectations(timeout: <span class="number">10</span>) &#123; <span class="comment">// 3</span></div><div class="line">  error <span class="keyword">in</span></div><div class="line">  <span class="keyword">if</span> <span class="keyword">let</span> error = error &#123;</div><div class="line">    <span class="type">XCTFail</span>(error.localizedDescription)</div><div class="line">  &#125;   </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>Here’s how it works:<br>You create the expectation with expectation(description:). The test runner will display the string parameter in the test log upon failure, so describe what you expect to happen.<br>You call fulfill() in the closure that executes asynchronously to mark the expectation as fulfilled.<br>You wait for expectations to be fulfilled by calling waitForExpectations(timeout:handler:). If the wait times out, it’s treated as an error.<br>Run the tests with a good network connection. You should see a summary logged to Xcode’s console like this:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"><span class="type">Test</span> <span class="type">Suite</span> '<span class="type">All</span> tests' passed at <span class="number">2016</span>-<span class="number">12</span>-<span class="number">01</span> <span class="number">02</span>:<span class="number">32</span>:<span class="number">57.179</span>.</div><div class="line">   <span class="type">Executed</span> <span class="number">3</span> tests, with <span class="number">0</span> failures (<span class="number">0</span> unexpected) <span class="keyword">in</span> <span class="number">10.666</span> (<span class="number">10.672</span>) seconds</div></pre></td></tr></table></figure></p>
<p>Now disable your network connection and re-run the tests. You should see an error message and summary results logged that looks like this:<br><figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">[<span class="type">GooglyPuffTests</span>.<span class="type">GooglyPuffTests</span> testLotsOfFacesImageURL] : failed - http:<span class="comment">//i.imgur.com/tPzTg7A.jpg failed. The Internet connection appears to be offline.</span></div><div class="line">...</div><div class="line"><span class="type">Test</span> <span class="type">Suite</span> '<span class="type">All</span> tests' failed at <span class="number">2016</span>-<span class="number">12</span>-<span class="number">01</span> <span class="number">02</span>:<span class="number">35</span>:<span class="number">10.055</span>.</div><div class="line">   <span class="type">Executed</span> <span class="number">3</span> tests, with <span class="number">3</span> failures (<span class="number">0</span> unexpected) <span class="keyword">in</span> <span class="number">0.061</span> (<span class="number">0.082</span>) seconds</div></pre></td></tr></table></figure></p>
<p>The end result is not very different from using a semaphore, but leveraging the XCTest framework is a cleaner and more readable solution.</p>
<hr>
<h4 id="Dispatch-Sources"><a href="#Dispatch-Sources" class="headerlink" title="Dispatch Sources"></a>Dispatch Sources</h4><p>Dispatch sources are a particularly interesting feature of GCD. A dispatch source can basically be used to monitor for some type of event. Events can include Unix signals, file descriptors, Mach ports, VFS Nodes, and other obscure stuff.<br>When setting up a dispatch source, you tell it what type of events you want to monitor and the dispatch queue on which its event handler block should be executed. You then assign an event handler to the dispatch source.<br>Upon creation, dispatch sources start off in a suspended state. This allows for additional configuration steps to take place, for example setting up the event handler. Once you’ve configured your dispatch source, you should resume it to start processing events.<br>In this tutorial, you’ll get a small taste of working with dispatch sources by using it in a rather peculiar way: to monitor when your app is put into debug mode.<br>Open PhotoCollectionViewController.swift and add the following just below the backgroundImageOpacity global property declaration:</p>
<figure class="highlight swift"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">#<span class="keyword">if</span> <span class="type">DEBUG</span> <span class="comment">// 1</span></div><div class="line">  <span class="keyword">var</span> signal: <span class="type">DispatchSourceSignal</span>? <span class="comment">// 2</span></div><div class="line">  <span class="keyword">private</span> <span class="keyword">let</span> setupSignalHandlerFor = &#123; (<span class="number">_</span> object: <span class="type">AnyObject</span>) -&gt; <span class="type">Void</span> <span class="keyword">in</span> <span class="comment">// 3</span></div><div class="line">    <span class="keyword">let</span> queue = <span class="type">DispatchQueue</span>.main</div><div class="line">    signal =</div><div class="line">      <span class="type">DispatchSource</span>.makeSignalSource(signal: <span class="type">Int32</span>(<span class="type">SIGSTOP</span>), queue: queue) <span class="comment">// 4</span></div><div class="line">    signal?.setEventHandler &#123; <span class="comment">// 5</span></div><div class="line">      <span class="built_in">print</span>(<span class="string">"Hi, I am: \(object.description!)"</span>)</div><div class="line">    &#125;</div><div class="line">    signal?.resume() <span class="comment">// 6</span></div><div class="line">  &#125;</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>The code is a little involved, so walk through it step-by-step:<br>You compile this code only in DEBUG mode to prevent “interested parties” from gaining a lot of insight into your app. :] DEBUG is defined by adding -D DEBUG under Project Settings -&gt; Build Settings -&gt; Swift Compiler - Custom Flags -&gt; Other Swift Flags -&gt; Debug. It should be set already in the starter project.<br>You declare a signal variable of type DispatchSourceSignal for use in monitoring Unix signals.<br>You create a block assigned to the setupSignalHandlerFor global variable that you’ll use for one-time setup of your dispatch source.<br>Here you set up signal. You indicate that you’re interested in monitoring the SIGSTOP Unix signal and handling received events on the main queue — you’ll discover why shortly.<br>If the dispatch source is successfully created, you register an event handler closure that’s invoked whenever you receive the SIGSTOP signal. Your handler prints a message that includes the class description.<br>All sources start off in the suspended state by default. Here you tell the dispatch source to resume so it can start monitoring events.<br>Add the following code to viewDidLoad() just below the call to super.viewDidLoad():</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">#if DEBUG</div><div class="line">  _ = setupSignalHandlerFor(self)</div><div class="line">#endif</div></pre></td></tr></table></figure>
<p>This code invokes the dispatch source’s initialization code.<br>Build and run the app. Pause the program execution and resume the app immediately by tapping the pause then play buttons in Xcode’s debugger:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/48648090-file_1494133674861_137ae.png" alt=""><br>Check out the console. You should see something like this:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">Hi, I am: &lt;GooglyPuff.PhotoCollectionViewController: 0x7fbf0af08a10&gt;</div></pre></td></tr></table></figure></p>
<p>You app is now debugging-aware! That’s pretty awesome, but how would you use this in real life?<br>You could use this to debug an object and display data whenever you resume the app. You could also give your app custom security logic to protect itself (or the user’s data) when malicious attackers attach a debugger to your application.<br>An interesting idea is to use this approach as a stack trace tool to find the object you want to manipulate in the debugger.<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/35951308-file_1494133722143_149a8.jpg" alt=""><br>Think about that situation for a second. When you stop the debugger out of the blue, you’re almost never on the desired stack frame. Now you can stop the debugger at anytime and have code execute at your desired location. This is very useful if you want to execute code at a point in your app that’s tedious to access from the debugger. Try it out!<br>Put a breakpoint on the print() statement inside the setupSignalHandlerFor block that you just added.<br>Pause in the debugger, then start again. The app will hit the breakpoint you added. You’re now deep in the depths of your PhotoCollectionViewController method. Now you can access the instance of PhotoCollectionViewController to your heart’s content. Pretty handy!</p>
<blockquote>
<p>Note: If you haven’t already noticed which threads are which in the debugger, take a look at them now. The main thread will always be the first thread followed by libdispatch, the coordinator for GCD, as the second thread. After that, the thread count and remaining threads depend on what the hardware was doing when the app hit the breakpoint.</p>
</blockquote>
<p>In the debugger console, type the following:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) expr object.navigationItem.prompt = &quot;WOOT!&quot;</div></pre></td></tr></table></figure></p>
<p>The Xcode debugger can sometimes be uncooperative. If you get the message:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">error: use of unresolved identifier &apos;self&apos;</div></pre></td></tr></table></figure></p>
<p>Then you have to do it the hard way to work around a bug in LLDB. First take note of the address of object in the debug area:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">(lldb) po object</div></pre></td></tr></table></figure></p>
<p>Then manually cast the value to the type you want:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">(lldb) expr let $vc = unsafeBitCast(0x7fbf0af08a10, to: GooglyPuff.PhotoCollectionViewController.self)</div><div class="line">(lldb) expr $vc.navigationItem.prompt = &quot;WOOT!&quot;</div></pre></td></tr></table></figure></p>
<p>Now resume execution of the app. You’ll see the following:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/50123049-file_1494133831026_c2aa.png" alt=""><br>With this method, you can make updates to the UI, inquire about the properties of a class, and even execute methods — all while not having to restart the app to get into that special workflow state. Pretty neat.</p>
<hr>
<h4 id="Where-To-Go-From-Here"><a href="#Where-To-Go-From-Here" class="headerlink" title="Where To Go From Here?"></a>Where To Go From Here?</h4><p>You can download the completed project for this Grand Central Dispatch tutorial here.<br>I hate to bang on this subject again, but you really should check out the How to Use Instruments tutorial. You’ll definitely need this if you plan on doing any optimization of your apps. Be aware that Instruments is good for profiling relative execution: comparing which areas of code takes longer in relation to other areas. If you’re trying to figure out the actual execution time of a method, you might need to come up with a more home-brewed solution.<br>Also check out How to Use NSOperations and NSOperationQueue Tutorial in Swift, a concurrency technology that is built on top of GCD. In general, it’s best practice to use GCD if you are using simple fire-and-forget tasks. NSOperations offers better control, an implementation for handling maximum concurrent operations, and a more object-oriented paradigm at the cost of speed.<br>You should also take a look at our iOS Concurrency with GCD and Operations video tutorial series, which covers a lot of the same topics that we’ve covered in this tutorial.<br>Remember, unless you have a specific reason to go lower, always try and stick with a higher level API. Only venture into the dark arts of Apple if you want to learn more or to do something really, really “interesting”. :]<br>Good luck and have fun! Post any questions or feedback in the discussion below!</p>
<hr>
<h4 id="Team"><a href="#Team" class="headerlink" title="Team"></a>Team</h4><p>Each tutorial at www.raywenderlich.com is created by a team of dedicated developers so that it meets our high quality standards. The team members who worked on this tutorial are:<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-5-7/25089062-file_1494133899718_ea86.png" alt=""></p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2017/06/03/YoungLetter/" style="float: left;">
        ← 轻年之美
    </a>
    
    
    <a class="pull-right" href="/2017/05/07/Swift3-center01/">
        Grand Central Dispatch Tutorial for Swift 3(1) →
    </a>
    
</nav>

        <div class="duoshuo"></div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Steven. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
