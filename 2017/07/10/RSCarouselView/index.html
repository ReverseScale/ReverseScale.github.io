<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>极致高效简洁的轮播图实现 | Steven&#39;s Technology Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Steven's Technology Blog">
    <meta name="author" content="Steven">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Steven&#39;s Technology Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/tags/博客，文章" target="_BLANK" class="animsition-link">文章</a></li>
                    
                        <li><a href="/tags/博客，资料" target="_BLANK" class="animsition-link">资料</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/API/" class="animsition-link">API<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Android/" class="animsition-link">Android<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Git/" class="animsition-link">Git<small>(1)</small></a></li>
				    
				    <li><a href="/categories/HTML5/" class="animsition-link">HTML5<small>(5)</small></a></li>
				    
				    <li><a href="/categories/Markdown/" class="animsition-link">Markdown<small>(1)</small></a></li>
				    
				    <li><a href="/categories/PHP/" class="animsition-link">PHP<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Tools/" class="animsition-link">Tools<small>(2)</small></a></li>
				    
				    <li><a href="/categories/Unity-3D/" class="animsition-link">Unity 3D<small>(1)</small></a></li>
				    
				    <li><a href="/categories/iOS/" class="animsition-link">iOS<small>(127)</small></a></li>
				    
				    <li><a href="/categories/前沿技术/" class="animsition-link">前沿技术<small>(5)</small></a></li>
				    
				    <li><a href="/categories/文章/" class="animsition-link">文章<small>(5)</small></a></li>
				    
				    <li><a href="/categories/设计/" class="animsition-link">设计<small>(4)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="https://www.qtumist.com" class="animsition-link">量子计算</a></li>
                    
                    <li><a href="https://blog.ibeats.top" class="animsition-link">CI_Knight</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Steven's Technology Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2017-07-10T13:28:56.000Z" itemprop="datePublished">
          2017-07-10
      </time>
    
    
    | 
    <a href='/tags/博客，文章/'>博客，文章</a>
    
    
</span>
                <h1>极致高效简洁的轮播图实现</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>#在不少项目中，都会有图片轮播这个功能，现在网上关于图片轮播的框架层出不穷，千奇百怪，笔者根据自己的思路，用两个imageView也实现了图片轮播。</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a><!--more--></h2><p><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/40982862.jpg" alt=""><br>图1.1 列表页<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/53634923.jpg" alt=""><br>图1.2 XIB创建<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/60384124.jpg" alt=""><br>图1.3 纯代码创建</p>
<hr>
<h2 id="Advantage-框架的优势"><a href="#Advantage-框架的优势" class="headerlink" title="Advantage 框架的优势"></a>Advantage 框架的优势</h2><ul>
<li>1.文件少，代码简洁</li>
<li>2.不依赖任何其他第三方库</li>
<li>3.同时支持本地图片/Gif及网络图片/Gif</li>
<li>4.自带图片下载与缓存</li>
<li>5.具备较高自定义性</li>
</ul>
<hr>
<h2 id="Usage-实际使用"><a href="#Usage-实际使用" class="headerlink" title="Usage 实际使用"></a>Usage 实际使用</h2><h3 id="Created-by-XIB-通过XIB创建"><a href="#Created-by-XIB-通过XIB创建" class="headerlink" title="Created by XIB 通过XIB创建"></a>Created by XIB 通过XIB创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line">- (void)setupCarouselByXIBWithArray:(NSArray *)arr &#123;</div><div class="line">    /**</div><div class="line">     *  通过storyboard创建的轮播控件</div><div class="line">     */</div><div class="line">    self.carouselByXIB.imageArray = arr;</div><div class="line">    //设置分页控件指示器的颜色</div><div class="line">    [self.carouselByXIB setPageColor:[UIColor whiteColor] andCurrentPageColor:[UIColor grayColor]];</div><div class="line">    //设置图片切换的方式</div><div class="line">    self.carouselByXIB.changeMode = ChangeModeFade;</div><div class="line">    //设置分页控件的位置，默认为PositionBottomCenter</div><div class="line">    self.carouselByXIB.pagePosition = PositionBottomRight;</div><div class="line">    //用block处理图片点击事件</div><div class="line">    self.carouselByXIB.imageClickBlock = ^(NSInteger index)&#123;</div><div class="line">        NSLog(@&quot;在XIB创建状态下，点击了第%ld张图片&quot;, index);</div><div class="line">    &#125;;</div><div class="line">    self.carouselByXIB.time = 3;</div><div class="line">&#125;</div><div class="line">- (IBAction)startAction:(id)sender &#123;</div><div class="line">    [self.carouselByXIB startTimer];</div><div class="line">&#125;</div><div class="line">- (IBAction)stopAction:(id)sender &#123;</div><div class="line">    [self.carouselByXIB stopTimer];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="Created-by-Code-通过纯代码创建"><a href="#Created-by-Code-通过纯代码创建" class="headerlink" title="Created by Code 通过纯代码创建"></a>Created by Code 通过纯代码创建</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div></pre></td><td class="code"><pre><div class="line">- (void)setupCarouselByCodeWithArray:(NSArray *)arr describeArray:(NSArray *)describeArray &#123;</div><div class="line">    /**</div><div class="line">     *  通过代码创建</div><div class="line">     */</div><div class="line">    self.carouselView = [[RSCarouselView alloc] initWithFrame:CGRectMake(16, 129, [UIScreen mainScreen].bounds.size.width - 32, 145)];</div><div class="line">    //设置占位图片,须在设置图片数组之前设置,不设置则为默认占位图</div><div class="line">    self.carouselView.placeholderImage = [UIImage imageNamed:@&quot;placeholderImage.jpg&quot;];</div><div class="line">    //设置图片数组及图片描述文字</div><div class="line">    self.carouselView.imageArray = arr;</div><div class="line">    self.carouselView.describeArray = describeArray;</div><div class="line">    //用代理处理图片点击</div><div class="line">    self.carouselView.delegate = self;</div><div class="line">    //设置每张图片的停留时间，默认值为5s，最少为2s</div><div class="line">    self.carouselView.time = 2;</div><div class="line">    //设置分页控件的图片,不设置则为系统默认</div><div class="line">    [self.carouselView setPageImage:[UIImage imageNamed:@&quot;other&quot;] andCurrentPageImage:[UIImage imageNamed:@&quot;current&quot;]];</div><div class="line">    //设置分页控件的位置，默认为PositionBottomCenter</div><div class="line">    self.carouselView.pagePosition = PositionBottomCenter;</div><div class="line">    /**</div><div class="line">     *  修改图片描述控件的外观，不需要修改的传nil</div><div class="line">     *</div><div class="line">     *  参数一 字体颜色，默认为白色</div><div class="line">     *  参数二 字体，默认为13号字体</div><div class="line">     *  参数三 背景颜色，默认为黑色半透明</div><div class="line">     */</div><div class="line">    UIColor *bgColor = [[UIColor whiteColor] colorWithAlphaComponent:0.8];</div><div class="line">    UIFont *font = [UIFont systemFontOfSize:15];</div><div class="line">    UIColor *textColor = [UIColor grayColor];</div><div class="line">    [self.carouselView setDescribeTextColor:textColor font:font bgColor:bgColor];</div><div class="line">    [self.view addSubview:_carouselView];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h2 id="Theory-轮播实现步骤"><a href="#Theory-轮播实现步骤" class="headerlink" title="Theory 轮播实现步骤"></a>Theory 轮播实现步骤</h2><h3 id="层级结构"><a href="#层级结构" class="headerlink" title="层级结构"></a>层级结构</h3><p>最底层是一个UIView，上面有一个UIScrollView以及UIPageControl，scrollView上有两个UIImageView，imageView宽高 = scrollview宽高 = view宽高<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/42630920.jpg" alt=""><br>假设轮播控件的宽度为x高度为y，我们设置scrollview的contentSize.width为3x，并让scrollview的水平偏移量为x，既显示最中间内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">scrollView.contentSize = CGSizeMake(3x, y);</div><div class="line">scrollView.contentOffset = CGPointMake(x, 0);</div></pre></td></tr></table></figure></p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/47687911.jpg" alt=""><br>将imageView添加到scrollview内容视图的中间位置<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/67719806.jpg" alt=""><br>接下来使用代理方法scrollViewDidScroll来监听scrollview的滚动，定义一个枚举变量来记录滚动的方向<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">typedef enum&#123;</div><div class="line">  DirecNone,</div><div class="line">  DirecLeft,</div><div class="line">  DirecRight</div><div class="line">&#125; Direction;</div><div class="line">@property (nonatomic, assign) Direction direction;</div><div class="line">- (void)scrollViewDidScroll:(UIScrollView *)scrollView &#123;</div><div class="line">  self.direction = scrollView.contentOffset.x &gt;x? DirecLeft : DirecRight;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>使用KVO来监听direction属性值的改变<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[self addObserver:self forKeyPath:@&quot;direction&quot; options:NSKeyValueObservingOptionNew context:nil];</div></pre></td></tr></table></figure></p>
<p>判断滚动的方向，当偏移量大于x，表示左移，则将otherImageView加在右边，偏移量小于x，表示右移，则将otherImageView加在左边</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/15531601.jpg" alt=""></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSString *,id&gt; *)change context:(void *)context &#123;</div><div class="line">   //self.currIndex表示当前显示图片的索引，self.nextIndex表示将要显示图片的索引</div><div class="line">  //_images为图片数组</div><div class="line">  if(change[NSKeyValueChangeNewKey] == change[NSKeyValueChangeOldKey]) return;</div><div class="line">  if ([change[NSKeyValueChangeNewKey] intValue] == DirecRight) &#123;</div><div class="line">    self.otherImageView.frame = CGRectMake(0, 0, self.width, self.height);</div><div class="line">    self.nextIndex = self.currIndex - 1;</div><div class="line">    if (self.nextIndex &lt; 0) self.nextIndex = _images.count – 1;</div><div class="line">  &#125; else if ([change[NSKeyValueChangeNewKey] intValue] == DirecLeft)&#123;</div><div class="line">    self.otherImageView.frame = CGRectMake(CGRectGetMaxX(_currImageView.frame), 0, self.width, self.height);</div><div class="line">    self.nextIndex = (self.currIndex + 1) % _images.count;</div><div class="line">  &#125;</div><div class="line">  self.otherImageView.image = self.images[self.nextIndex];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>通过代理方法scrollViewDidEndDecelerating来监听滚动结束，结束后，会变成以下两种情况<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/9374679.jpg" alt=""><br>此时，scrollview的偏移量为0或者2x，我们通过代码再次将scrollview的偏移量设置为x，并将currImageView的图片修改为otherImageView的图片<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidEndDecelerating:(UIScrollView *)scrollView &#123;</div><div class="line">  [self pauseScroll];</div><div class="line">&#125;</div><div class="line">- (void)pauseScroll &#123;</div><div class="line">  self.direction = DirecNone;//清空滚动方向</div><div class="line">    //判断最终是滚到了右边还是左边</div><div class="line">  int index = self.scrollView.contentOffset.x / x;</div><div class="line">  if (index == 1) return; //等于1表示最后没有滚动，返回不做任何操作</div><div class="line">  self.currIndex = self.nextIndex;//当前图片索引改变</div><div class="line">  self.pageControl.currentPage = self.currIndex;</div><div class="line">  self.currImageView.frame = CGRectMake(x, 0, x, y);</div><div class="line">  self.currImageView.image = self.otherImageView.image;</div><div class="line">  self.scrollView.contentOffset = CGPointMake(x, 0);</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>那么我们看到的还是currImageView，只不过展示的是下一张图片，如图，又变成了最初的效果<br><img src="http://og1yl0w9z.bkt.clouddn.com/17-7-5/75396773.jpg" alt=""></p>
<hr>
<h3 id="自动滚动"><a href="#自动滚动" class="headerlink" title="自动滚动"></a>自动滚动</h3><p>轮播的功能实现了，接下来添加定时器让它自动滚动，相当简单<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">- (void)startTimer &#123;</div><div class="line">   //如果只有一张图片，则直接返回，不开启定时器</div><div class="line">   if (_images.count &lt;= 1) return;</div><div class="line">   //如果定时器已开启，先停止再重新开启</div><div class="line">   if (self.timer) [self stopTimer];</div><div class="line">   self.timer = [NSTimer timerWithTimeInterval:self.time target:self selector:@selector(nextPage) userInfo:nil repeats:YES];</div><div class="line">   [[NSRunLoop currentRunLoop] addTimer:self.timer forMode:NSRunLoopCommonModes];</div><div class="line">&#125;</div><div class="line">- (void)nextPage &#123;</div><div class="line">    //动画改变scrollview的偏移量就可以实现自动滚动</div><div class="line">  [self.scrollView setContentOffset:CGPointMake(self.width * 2, 0) animated:YES];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<blockquote>
<p>setContentOffset:animated:方法执行完毕后不会调用scrollview的scrollViewDidEndDecelerating方法，但是会调用scrollViewDidEndScrollingAnimation方法，因此我们要在该方法中调用pauseScroll</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewDidEndScrollingAnimation:(UIScrollView *)scrollView &#123;</div><div class="line">  [self pauseScroll];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="拖拽时停止自动滚动"><a href="#拖拽时停止自动滚动" class="headerlink" title="拖拽时停止自动滚动"></a>拖拽时停止自动滚动</h3><p>当我们手动拖拽图片时，需要停止自动滚动，此时我们只需要让定时器失效就行了，当停止拖拽时，重新启动定时器<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">- (void)scrollViewWillBeginDragging:(UIScrollView *)scrollView &#123;</div><div class="line">  [self.timer invalidate];</div><div class="line">&#125;</div><div class="line">- (void)scrollViewDidEndDragging:(UIScrollView *)scrollView willDecelerate:(BOOL)decelerate&#123;</div><div class="line">  [self startTimer];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<hr>
<h3 id="加载图片"><a href="#加载图片" class="headerlink" title="加载图片"></a>加载图片</h3><p>实际开发中，我们很少会轮播本地图片，大部分都是服务器获取的，也有可能既有本地图片，也有网络图片，那要如何来加载呢？<br>定义4个属性</p>
<ul>
<li>NSArray imageArray：暴露在.h文件中，外界将要加载的图片或路径数组赋值给该属性</li>
<li>NSMutableArray images：用来存放图片的数组</li>
<li>NSMutableDictionary imageDic：用来缓存图片的字典，key为URL</li>
<li>NSMutableDictionary operationDic：用来保存下载操作的字典，key为URL<br>判断外界传入的是图片还是路径，如果是图片，直接加入图片数组中，如果是路径，先添加一个占位图片，然后根据路径去下载图片</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">_images = [NSMutableArray array];</div><div class="line">for (int i = 0; i &lt; imageArray.count; i++) &#123;</div><div class="line">    if ([imageArray[i] isKindOfClass:[UIImage class]]) &#123;</div><div class="line">      [_images addObject:imageArray[i]];//如果是图片，直接添加到images中</div><div class="line">    &#125; else if ([imageArray[i] isKindOfClass:[NSString class]])&#123;</div><div class="line">      [_images addObject:[UIImage imageNamed:@&quot;placeholder&quot;]];//如果是路径，添加一个占位图片到images中</div><div class="line">      [self downloadImages:i];  //下载网络图片</div><div class="line">    &#125;</div><div class="line">  &#125;</div></pre></td></tr></table></figure>
<p>下载图片，先从缓存中取，如果有，则替换之前的占位图片，如果没有，去沙盒中取，如果有，替换占位图片，并添加到缓存中，如果没有，开启异步线程下载</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">- (void)downloadImages:(int)index &#123;</div><div class="line">  NSString *key = _imageArray[index];</div><div class="line">  //从字典缓存中取图片</div><div class="line">  UIImage *image = [self.imageDic objectForKey:key];</div><div class="line">  if (image) &#123;</div><div class="line">    _images[index] = image;//如果图片存在，则直接替换之前的占位图片</div><div class="line">  &#125;else&#123;</div><div class="line">    //字典中没有从沙盒中取图片</div><div class="line">    NSString *cache = [NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES) lastObject];</div><div class="line">    NSString *path = [cache stringByAppendingPathComponent:[key lastPathComponent]];</div><div class="line">    NSData *data = [NSData dataWithContentsOfFile:path];</div><div class="line">    if (data) &#123;</div><div class="line">             //沙盒中有，替换占位图片，并加入字典缓存中</div><div class="line">      image = [UIImage imageWithData:data];</div><div class="line">      _images[index] = image;</div><div class="line">      [self.imageDic setObject:image forKey:key];</div><div class="line">    &#125;else&#123;</div><div class="line">       //字典沙盒都没有，下载图片</div><div class="line">      NSBlockOperation *download = [self.operationDic objectForKey:key];//查看下载操作是否存在</div><div class="line">      if (!download) &#123;//不存在</div><div class="line">        //创建一个队列，默认为并发队列</div><div class="line">        NSOperationQueue *queue = [[NSOperationQueue alloc] init];</div><div class="line">        //创建一个下载操作</div><div class="line">        download = [NSBlockOperation blockOperationWithBlock:^&#123;</div><div class="line">          NSURL *url = [NSURL URLWithString:key];</div><div class="line">          NSData *data = [NSData dataWithContentsOfURL:url];</div><div class="line">           if (data) &#123;</div><div class="line">                        //下载完成后，替换占位图片，存入字典并写入沙盒，将下载操作从字典中移除掉</div><div class="line">            UIImage *image = [UIImage imageWithData:data];</div><div class="line">            [self.imageDic setObject:image forKey:key];</div><div class="line">            self.images[index] = image;</div><div class="line">                        //如果只有一张图片，需要在主线程主动去修改currImageView的值</div><div class="line">            if (_images.count == 1) [_currImageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:NO];</div><div class="line">            [data writeToFile:path atomically:YES];</div><div class="line">            [self.operationDic removeObjectForKey:key];</div><div class="line">            &#125;</div><div class="line">        &#125;];</div><div class="line">        [queue addOperation:download];</div><div class="line">        [self.operationDic setObject:download forKey:key];//将下载操作加入字典</div><div class="line">      &#125;</div><div class="line">    &#125;</div><div class="line">  &#125;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<hr>
<h3 id="监听图片点击"><a href="#监听图片点击" class="headerlink" title="监听图片点击"></a>监听图片点击</h3><p>当图片被点击的时候，我们往往需要执行某些操作，因此需要监听图片的点击，思路如下<br>1.定义一个block属性暴露给外界void(^imageClickBlock)(NSInteger index)<br>2.设置currImageView的userInteractionEnabled为YES<br>3.给currImageView添加一个点击的手势<br>4.在手势方法里调用block，并传入图片索引</p>
<hr>
<p>使用简单、效率高效、进程安全~~~如果你有更好的建议,希望不吝赐教!</p>
<hr>
<h2 id="License-许可证"><a href="#License-许可证" class="headerlink" title="License 许可证"></a>License 许可证</h2><p>RSCarouselViewDemo 使用 MIT 许可证，详情见 LICENSE 文件。</p>
<hr>
<p>Github：<a href="https://github.com/ReverseScale/RSCarouselViewDemo" target="_blank" rel="external">https://github.com/ReverseScale/RSCarouselViewDemo</a><br>你的star是我持续更新的动力!</p>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2017/07/15/Weex-redear/" style="float: left;">
        ← Weex 使用体验 引文
    </a>
    
    
    <a class="pull-right" href="/2017/07/02/WeChatRedEnvelop/">
        iOS版微信抢红包插件 →
    </a>
    
</nav>

        <div class="duoshuo"></div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Steven. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
