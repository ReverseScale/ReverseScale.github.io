{"meta":{"title":"Technology","subtitle":"","description":"","author":"Steven's Blog","url":"https://reversescale.github.io"},"pages":[{"title":"Not found","date":"2018-11-15T12:15:47.151Z","updated":"2018-11-15T02:35:05.000Z","comments":true,"path":"404.html","permalink":"https://reversescale.github.io/404.html","excerpt":"","text":"404 *{margin:0;padding:0;outline:none;font-family:\\5FAE\\8F6F\\96C5\\9ED1,å®‹ä½“;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;-khtml-user-select:none;user-select:none;cursor:default;font-weight:lighter;} .center{margin:0 auto;} .whole{width:100%;height:100%;line-height:100%;position:fixed;bottom:0;left:0;z-index:-1000;overflow:hidden;} .whole img{width:100%;height:100%;} .mask{width:100%;height:100%;position:absolute;top:0;left:0;background:#fff;opacity:0.6;filter:alpha(opacity=60);} .b{width:100%;text-align:center;height:400px;position:absolute;top:50%;margin-top:-230px}.a{width:150px;height:50px;margin-top:30px}.a a{display:block;float:left;width:150px;height:50px;background:#fff;text-align:center;line-height:50px;font-size:18px;border-radius:25px;color:#333}.a a:hover{color:#000;box-shadow:#fff 0 0 20px} p{color:#000;margin-top:260px;font-size:24px;} #num{margin:0 5px;font-weight:bold;} var num=5; function redirect(){ num--; document.getElementById(\"num\").innerHTML=num; if(num"},{"title":"About","date":"2015-08-16T06:58:08.000Z","updated":"2018-11-18T06:21:30.698Z","comments":false,"path":"about/index.html","permalink":"https://reversescale.github.io/about/index.html","excerpt":"","text":"Excellence is a continuous process and not an accident. Thanks for reading! ~ ğŸ‘¨ğŸ»â€ğŸ’» èŒä¸šï¼šç¨‹åºå‘˜åŠé€€å¸ˆğŸ“Ÿ WeChatï¼šWhatsXieğŸ¤ª ä¸åªç”Ÿäº§ bug æ›´æ˜¯ bug çš„æ¬è¿å·¥ğŸ“® é‚®ä»¶ï¼šReverseScale@iCloud.com åšå®¢æ–°è£…ä¿®ï¼Œå†å²æ–‡ç« æ­£åœ¨è·¯ä¸Šâ€¦"},{"title":"Archives","date":"2016-08-16T07:00:24.000Z","updated":"2018-01-25T14:41:06.000Z","comments":true,"path":"archives/index.html","permalink":"https://reversescale.github.io/archives/index.html","excerpt":"","text":""},{"title":"Categories","date":"2016-08-16T07:00:44.000Z","updated":"2018-01-25T14:41:06.000Z","comments":false,"path":"categories/index.html","permalink":"https://reversescale.github.io/categories/index.html","excerpt":"","text":""},{"title":"Tags","date":"2016-08-11T04:12:45.000Z","updated":"2018-01-25T14:41:06.000Z","comments":true,"path":"tags/index.html","permalink":"https://reversescale.github.io/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"è¯»ä¹¦å¥½ä¼™ä¼´ Kindle App","slug":"Kindle App","date":"2018-11-19T12:16:27.000Z","updated":"2018-11-19T12:27:11.449Z","comments":true,"path":"2018/11/19/Kindle App/","link":"","permalink":"https://reversescale.github.io/2018/11/19/Kindle App/","excerpt":"kindle æœªå¿…éšèº«æºå¸¦ï¼Œä½†æ˜¯æ€»æœ‰é‚£ä¹ˆå‡ æ®µæ—¶é—´ä½ ä¼šæ²¡äº‹å¯å¹²ï¼ŒKindle App çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†å‘æŒ¥â€œç¢ç‰‡æ—¶é—´é˜…è¯»â€æ•ˆèƒ½çš„ï¼ŒåŒæ­¥é˜…è¯»è¿›åº¦ï¼ŒåŒæ­¥é˜…è¯»å†…å®¹ã€åŒæ­¥ç¬”è®°ç­‰ç­‰~~","text":"kindle æœªå¿…éšèº«æºå¸¦ï¼Œä½†æ˜¯æ€»æœ‰é‚£ä¹ˆå‡ æ®µæ—¶é—´ä½ ä¼šæ²¡äº‹å¯å¹²ï¼ŒKindle App çš„æ„ä¹‰å°±æ˜¯ä¸ºäº†å‘æŒ¥â€œç¢ç‰‡æ—¶é—´é˜…è¯»â€æ•ˆèƒ½çš„ï¼ŒåŒæ­¥é˜…è¯»è¿›åº¦ï¼ŒåŒæ­¥é˜…è¯»å†…å®¹ã€åŒæ­¥ç¬”è®°ç­‰ç­‰~~ Kindle App Kindle App æ˜¯äºšé©¬é€Š Kindle å¼€å‘å‡ºçš„é˜…è¯» Appï¼Œå¯ç”¨äºåŒæ­¥æˆ‘ä»¬åœ¨äºšé©¬é€Š Kindle ä¹¦åŸè´­ä¹°ä¸­è´­ä¹°çš„ä¹¦åˆ°å„ä¸ªå®¢æˆ·ç«¯ï¼ˆWindowsã€OSXã€Android ä»¥åŠ iOSï¼‰ã€‚ åªè¦ä½ åœ¨ Z.cn æ³¨å†Œä¸€ä¸ªäºšé©¬é€Šè´¦æˆ·ï¼Œå°±å¯ä»¥è¯•è¯»å„ç§æŠ€æœ¯ç±»ä¹¦ç±ï¼Œçœ‹çš„ä¸é”™çš„å°±å¯ä»¥ç›´æ¥è´­ä¹°ã€‚ä¸‹å•åè¿™æœ¬ä¹¦å°±ä¼šå‚¨å­˜åœ¨ä½ çš„äºšé©¬é€Šäº‘ï¼Œä½ å¯ä»¥å†æ™ºèƒ½æ‰‹æœºã€å¹³æ¿ç”µè„‘å’Œ MacBook ä¸Šéšæ—¶æ±²å–çŸ¥è¯†ï¼Œä¸å†æµªè´¹æ—¶é—´ã€‚ å®é™…ä½“éªŒåŸºäºäºšé©¬é€Šçš„åºå¤§å›¾ä¹¦ç½‘ç»œï¼Œè¿™é‡Œåº”æœ‰å°½æœ‰ï¼Œé…åˆæ•´é½æ’å¸ƒçš„å½©è‰²å›¾ä¹¦å°é¢ï¼Œç»™äººè€³ç›®ä¸€æ–°çš„ Kindle æ„Ÿè§‰ã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ App ä¸­çœ‹åˆ°çš„ Kindle App åœ¨å¸ƒå±€ä¸Šæ˜¯æ¯”è¾ƒæ¥è¿‘äº Kindle è®¾å¤‡æœ¬èº«çš„ï¼Œæˆ‘ä»¬å¯ä»¥è°ƒæ•´å­—å·ã€äº®åº¦ã€å¯¹å…¶æ–¹å¼ç”šè‡³æ˜¯èƒŒæ™¯é¢œè‰²ï¼Œé¢ï¼Œç­‰ç­‰ï¼Œå®ƒæ˜¯å½©â€¦è‰²çš„ï¼ å½“æˆ‘ä»¬é€‰æ‹©äº†å…¶ä¸­ä¸€æœ¬ä¹¦åå°±å¯ä»¥ç›´æ¥è¿›å…¥é˜…è¯»ç•Œé¢ï¼Œåœ¨ä¸‰æ çš„èœå•åæˆ‘ä»¬ä¼šå‘ç°ï¼Œè¿™ä¸ªèœå•é›†æˆäº†åŒæ­¥ã€X-Rayã€ç”Ÿè¯å¡ä»¥åŠç›®å½•ç­‰è¯¸å¤šå…ƒç´ ä¸€èº«ã€‚ Kindle App æ›´æ˜¯æ”¯æŒ X-Rayï¼Œå…¶ä¸€ç›´ä»¥æ¥éƒ½æ˜¯ Kindle çš„ä¸€ä¸ªäº®ç‚¹æ‰€åœ¨ï¼Œå®ƒå¯ä»¥æŠŠæˆ‘ä»¬éœ€è¦çš„é‡ç‚¹ä¿¡æ¯ï¼ˆäººç‰©ã€æœ¯è¯­ã€å›¾ç‰‡ï¼‰æ±‡æ€»åœ¨äº†ä¸€èµ·ï¼Œè®©æˆ‘ä»¬å¯ä»¥å‡å°‘æˆæœ¬å»äº†è§£ä½œè€…çš„å†™ä½œé‡ç‚¹ã€‚ç°åœ¨ï¼Œè¿™ä¸ªåŠŸèƒ½ä¹Ÿå¯ä»¥åœ¨ Kindle App ä½¿ç”¨äº†ï¼ŒçœŸæ˜¯æ™®å–œå¤§å¥”ã€‚ ä¸ä»…å¦‚æ­¤ï¼ŒKindle App è¿˜å°† X-Ray ä¸­çš„æ’åºæ–¹å¼ä¹Ÿåšäº†ä¼˜åŒ–ï¼Œå¯ä»¥è¯´éå¸¸äººæ€§åŒ–äº†ã€‚ å…¶å® Kindle App è¿˜æœ‰å¾ˆå¤šçš„åŠŸèƒ½æœ‰å¾…å‘ç°å’Œç§‘å­¦ä½¿ç”¨çš„ï¼Œæ¯”å¦‚é€šè¿‡å¡ç‰‡æ¥å­¦ä¹ å•¥çš„ï¼Œå®ç”¨æ€§è¿˜æ˜¯å¾ˆå¼ºçš„ï¼Œå¤§å®¶å¯ä»¥å‚è€ƒ Kindle å­¦ä¹ æ–¹é¢çš„èµ„æ–™å°±è¡Œäº†ã€‚ ä½œä¸ºä¸€åç¨‹åºå‘˜å¯èƒ½é¢å¯¹ç”µè„‘çš„æ—¶é—´ä¼šæ›´å¤šä¸€äº›ï¼Œè€Œä¸”å¤§å±å¹•ä¹Ÿæ›´é€‚åˆé˜…è¯»ï¼Œæ‰€ä»¥è¿™é‡Œé¡ºå¸¦æ¨èä¸€ä¸‹ Kindle Mac Appã€‚","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"Book","slug":"Book","permalink":"https://reversescale.github.io/tags/Book/"}]},{"title":"ä½¿ç”¨ Ngrok å¿«é€Ÿå®ç°å†…ç½‘ç©¿é€","slug":"Ngrok through","date":"2018-08-13T03:56:27.000Z","updated":"2018-11-16T13:22:10.603Z","comments":true,"path":"2018/08/13/Ngrok through/","link":"","permalink":"https://reversescale.github.io/2018/08/13/Ngrok through/","excerpt":"å®ç°å†…ç½‘ç©¿é€çš„å·¥å…·å¾ˆå¤šï¼Œä¹‹æ‰€ä»¥ä»‹ç» Ngrokï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºå®ƒä½¿ç”¨ä¾¿æ·ï¼Œä¸ç”¨æ­å»ºæœåŠ¡å™¨ç­‰ç­‰éº»çƒ¦çš„å·¥åºï¼Œé€‚åˆå‰æ®µå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¿«é€Ÿè¯„ä¼°æ£€æµ‹é¡¹ç›®~","text":"å®ç°å†…ç½‘ç©¿é€çš„å·¥å…·å¾ˆå¤šï¼Œä¹‹æ‰€ä»¥ä»‹ç» Ngrokï¼Œä¸»è¦è¿˜æ˜¯å› ä¸ºå®ƒä½¿ç”¨ä¾¿æ·ï¼Œä¸ç”¨æ­å»ºæœåŠ¡å™¨ç­‰ç­‰éº»çƒ¦çš„å·¥åºï¼Œé€‚åˆå‰æ®µå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¿«é€Ÿè¯„ä¼°æ£€æµ‹é¡¹ç›®~ Ngrokæ˜¯ä»€ä¹ˆngrok æ˜¯ä¸€ä¸ªåå‘ä»£ç†ï¼Œé€šè¿‡åœ¨å…¬å…±çš„ç«¯ç‚¹å’Œæœ¬åœ°è¿è¡Œçš„ Web æœåŠ¡å™¨ä¹‹é—´å»ºç«‹ä¸€ä¸ªå®‰å…¨çš„é€šé“ã€‚ngrok å¯æ•è·å’Œåˆ†ææ‰€æœ‰é€šé“ä¸Šçš„æµé‡ï¼Œä¾¿äºåæœŸåˆ†æå’Œé‡æ”¾ã€‚ è€Œæˆ‘ç”¨æ¥åœ¨å®¶é‡Œå¿«é€Ÿè®¿é—® Jenkinsï¼Œå·ä¸ªæ‡’ğŸ¤ª æ­å»ºæ–¹æ³•ç”±äºè¦å®Œæˆä¸€ä¸ªç½‘é¡µä¼˜åŒ–çš„ä½œä¸šæ‰¾äº†å¾ˆä¹…ngrokçš„ä½¿ç”¨æ–¹æ³•ï¼Œéƒ½ä¸å¤Ÿç®€ä¾¿æ˜“è¡Œæœ€åç»ˆäºå‘ç°äº†ä¸€ä¸ªå¥½æ–¹æ³•ã€‚ ä¸‹è½½ MAC ç‰ˆçš„ ngrokï¼šhttps://ngrok.com/download è§£å‹åˆ°æŒ‡å®šç›®å½•ï¼šSafari æµè§ˆå™¨ä¸‹è½½ Mac OS X ç¯å¢ƒä¸€èˆ¬ç›´æ¥è§£å‹ï¼ˆåæ­£æˆ‘æ˜¯è‡ªåŠ¨è§£å‹çš„ï¼‰ï¼Œå°† ngrok æ”¾è¿›é¡¹ç›®ç›®å½•ã€‚ è¿›å…¥åˆ° ngrok æ‰€åœ¨è·¯å¾„ï¼š1cd /tmp å¼€å¯æœåŠ¡1./ngrok http localhost:8080 ä¼šå‡ºç°å¦‚ä¸‹ ngrok æ§åˆ¶å° ç­‰å¾… Session Status çŠ¶æ€ä¸º onlineï¼ˆå˜ç»¿ï¼‰ï¼Œå°±å¯ä»¥åœ¨å¤–ç½‘é€šè¿‡ Forwarding çš„åœ°å€è¿›è¡Œè¿æ¥äº†ã€‚ æ³¨æ„ï¼šForwardingåœ°å€ä¸­çš„ c33faf1b ä¸æ˜¯å›ºå®šçš„ï¼Œåœ¨æ¯æ¬¡å¼€å§‹ ngrok æœåŠ¡çš„æ—¶å€™éƒ½ä¼šå˜æ›´ï¼Œæƒ³å›ºå®šï¼Ÿ ngrok:ğŸ˜›è¦é’±ã€‚ æµ‹è¯•ä¸€ä¸‹ä¾‹å¦‚ï¼š ngrok ç©¿é€å‰åœ¨å±€åŸŸç½‘ä¸­è®¿é—®åœ°å€ï¼šhttp://localhost:8080 ngrok ç©¿é€åå±€åŸŸç½‘ + å…¬ç½‘è®¿é—®åœ°å€ï¼šhttps://c33faf1b.ngrok.io","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"Web","slug":"Web","permalink":"https://reversescale.github.io/tags/Web/"}]},{"title":"å¦‚ä½•ç”¨ Swift æ‰“é€ ä½ çš„ç¬¬ä¸€ä¸ªåŒºå—é“¾ App","slug":"How to build DApp","date":"2018-07-06T14:51:21.000Z","updated":"2018-11-16T12:06:29.783Z","comments":true,"path":"2018/07/06/How to build DApp/","link":"","permalink":"https://reversescale.github.io/2018/07/06/How to build DApp/","excerpt":"åŒºå—é“¾(Blockchain) æ˜¯ä¸€ç§çªç ´æ€§æŠ€æœ¯(Disruptive Technologies)ï¼Œè¿‘å¹´æ¸è·å…³æ³¨ï¼Œå·ç§°å°†äº’è”ç½‘ä»ä¿¡æ¯å…±äº«ï¼Œæ¨å‘ä»·å€¼ä¼ é€’ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„æ¥æ¢ç´¢å®ƒè®¾è®¡ä¸Šçš„å¥‡æ€å¦™æƒ³~","text":"åŒºå—é“¾(Blockchain) æ˜¯ä¸€ç§çªç ´æ€§æŠ€æœ¯(Disruptive Technologies)ï¼Œè¿‘å¹´æ¸è·å…³æ³¨ï¼Œå·ç§°å°†äº’è”ç½‘ä»ä¿¡æ¯å…±äº«ï¼Œæ¨å‘ä»·å€¼ä¼ é€’ï¼Œè®©æˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥çš„æ¥æ¢ç´¢å®ƒè®¾è®¡ä¸Šçš„å¥‡æ€å¦™æƒ³~ å› ä¸ºåŒºå—é“¾æ˜¯è®¸å¤šåŠ å¯†è´§å¸(Cryptocurrencies) å¦‚æ¯”ç‰¹å¸(Bitcoin)ã€ä»¥å¤ªåŠ(Ethereum)ã€è±ç‰¹å¸(Litecoin) çš„åˆ›å§‹æŠ€æœ¯ã€‚é‚£åŒºå—é“¾æ˜¯å¦‚ä½•è¿ä½œçš„å‘¢ï¼Ÿåœ¨æœ¬æ¬¡çš„æ•™å­¦é‡Œï¼Œæˆ‘å°†ä¼šè°ˆåˆ°æ‰€æœ‰å…³äºåŒºå—é“¾æŠ€æœ¯çš„çŸ¥è¯†ï¼Œä»¥åŠå¦‚ä½•ç”¨Swift æ¥åˆ¶ä½œè‡ªå·±çš„ã€ŒåŒºå—é“¾ã€ã€‚é‚£ä¹ˆï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼ åŒºå—é“¾çš„è¿ä½œé¡¾åæ€ä¹‰ï¼ŒåŒºå—é“¾å°±æ˜¯ä¸€ä¸ªç”±ä¸åŒçš„åŒºå—ä¸²è¿åœ¨ä¸€èµ·çš„ã€Œé“¾ã€ï¼Œæ¯ä¸ªåŒºå—åŒ…å«ä¸‰åˆ™èµ„è®¯ï¼šèµ„æ–™(Data)ã€æ‚å‡‘å€¼(Hash)ã€å’Œå‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘å€¼ã€‚ èµ„æ–™ â”€â”€ä¾æ®ä½¿ç”¨æƒ…å¢ƒï¼Œå‚¨å­˜åœ¨åŒºå—çš„èµ„æ–™ä¼šå› åŒºå—é“¾çš„ç±»å‹è€Œä¸åŒã€‚ä¾‹å¦‚ï¼Œåœ¨æ¯”ç‰¹å¸åŒºå—é“¾ä¸­ï¼Œå‚¨å­˜èµ„æ–™å°±æ˜¯ä¸äº¤æ˜“æœ‰å…³çš„èµ„è®¯ï¼Œå³æ˜¯è½¬å¸çš„é‡‘é¢ã€ä»¥åŠå‚ä¸äº¤æ˜“äºŒäººçš„èµ„è®¯ã€‚ æ‚å‡‘å€¼ â”€â”€ä½ å¯ä»¥æŠŠæ‚å‡‘æƒ³æˆæ˜¯ä¸€ç§æ•°ä½æŒ‡çº¹ï¼Œå®ƒæ˜¯ç”¨æ¥è¯†åˆ«ä¸€ä¸ªåŒºå—åŠå…¶èµ„æ–™ã€‚æ‚å‡‘æœ€é‡è¦çš„åœ°æ–¹ï¼Œå°±æ˜¯å®ƒæ˜¯ä¸€ä¸ªç‹¬ä¸€æ— äºŒçš„å­—æ¯æ•°å­—(Alphanumeric)ç¨‹å¼ç ï¼Œé€šå¸¸ä¼šç”±64ä¸ªå­—å…ƒç»„æˆã€‚å½“ä¸€ä¸ªåŒºå—è¢«åˆ›é€ æ—¶ï¼Œæ‚å‡‘å€¼ä¹ŸåŒæ—¶äº§ç”Ÿã€‚å½“ä¸€ä¸ªåŒºå—è¢«æ›´åŠ¨æ—¶ï¼Œæ‚å‡‘å€¼ä¹Ÿä¼šåŒæ—¶è¢«æ›´åŠ¨ã€‚é€è¿‡è¿™ç§æ–¹å¼ï¼Œå½“ä½ æƒ³è¦æŸ¥çœ‹åŒºå—ä¸Šçš„ä»»ä½•å˜åŠ¨æ—¶ï¼Œæ‚å‡‘å€¼å°±éå¸¸é‡è¦ã€‚ å‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘å€¼ â”€â”€æ¯ä¸ªåŒºå—å°±æ˜¯è—‰ç”±å‚¨å­˜å‰ä¸ªåŒºå—çš„æ‚å‡‘æ¥é“¾ç»“åœ¨ä¸€èµ·ï¼Œç»„æˆä¸€ä¸ªåŒºå—é“¾ï¼è¿™å°±æ˜¯è®©åŒºå—é“¾å¦‚æ­¤å®‰å…¨çš„åŸå› ã€‚çœ‹çœ‹è¿™å¼ å›¾ç‰‡ï¼š å¦‚ä½ æ‰€è§ï¼Œæ¯ä¸ªåŒºå—ç”±èµ„æ–™ï¼ˆæœªæ˜¾ç¤ºï¼‰ã€æ‚å‡‘å€¼ã€å’Œå‰ä¸€ä¸ªåŒºå—æ‚å‡‘å€¼æ‰€ç»„æˆã€‚ä¸¾ä¸ªä¾‹å­ï¼Œé»„è‰²åŒºå—åŒ…å«äº†è‡ªå·±çš„æ‚å‡‘å€¼H7S6ã€å’Œçº¢è‰²åŒºå—çš„æ‚å‡‘å€¼8SD9ã€‚ä»¥è¿™ç§æ–¹å¼ï¼Œå®ƒä»¬ç»„æˆäº†ä¸€ä¸ªé“¾ç»“ï¼Œå¹¶ä»¥æ­¤è¿ç»“åœ¨ä¸€èµ·ã€‚ç°åœ¨ï¼Œå‡è®¾æœ‰ä¸ªéª‡å®¢å…¥ä¾µå¹¶å°è¯•æ›´åŠ¨çº¢è‰²åŒºå—ã€‚è¯·è®°ä½ï¼Œæ¯æ¬¡ä¸€ä¸ªåŒºå—ä»¥ä»»ä½•æ–¹å¼è¢«æ›´åŠ¨æ—¶ï¼ŒåŒºå—çš„æ‚å€¼å‡‘ä¹Ÿä¼šè¢«æ›´åŠ¨ï¼å› æ­¤ï¼Œå½“ä¸‹ä¸€ä¸ªåŒºå—æ‰§è¡Œç¡®è®¤ã€å¹¶çœ‹åˆ°å‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘å€¼å¹¶ä¸å»åˆæ—¶ï¼Œå®ƒä¼šæœ‰æ•ˆåœ°å°†è‡ªå·±ä»ã€Œé“¾ã€ä¸­åˆ†ç¦»å‡ºæ¥ï¼Œè€Œä¸ä¼šè¢«éª‡å®¢è¯»å–ã€‚ è¿™å°±æ˜¯åŒºå—ç»ƒä¼šå¦‚æ­¤å®‰å…¨çš„åŸå› ï¼Œä½ å‡ ä¹ä¸å¯èƒ½å°è¯•å›æº¯å¹¶æ›´æ”¹ä»»ä½•èµ„æ–™ã€‚æ‚å‡‘å€¼æä¾›äº†ä¸é”™çš„ä¿å¯†åŠéšç§ï¼Œä½†è¿˜æœ‰ä¸¤ä¸ªå®‰å…¨æœºåˆ¶æ¥è®©åŒºå—é“¾æ›´åŠ å®‰å…¨ï¼šéªŒè¯(Proof-of-work)åŠæ™ºæ…§åˆçº¦(Smart Contract)ã€‚è™½ç„¶æˆ‘ä¸ä¼šè¯¦è¿°ï¼Œä½†ä½ å¯ä»¥åœ¨è¿™é‡Œäº†è§£æ›´å¤šã€‚åŒºå—é“¾æœ€åä¸€ä¸ªä¿å…¨æ–¹å¼å°±æ˜¯åŸºäºå®ƒçš„ä½ç½®ã€‚ä¸å¤§å¤šå‚¨å­˜åœ¨ä¼ºæœå™¨æˆ–æ˜¯èµ„æ–™åº“å†…çš„èµ„æ–™ä¸åŒï¼ŒåŒºå—é“¾ä½¿ç”¨ç‚¹å¯¹ç‚¹ç½‘è·¯(Peer-To-Peer, P2P)ï¼Œå®ƒæ˜¯ä¸€ç§ç½‘è·¯å‹æ€ï¼Œå…è®¸ä»»ä½•äººåŠ å…¥å¹¶å°†è¯¥ç½‘è·¯ä¸Šçš„èµ„æ–™åˆ†å‘ç»™æ¯ä½æ¥æ”¶è€…ã€‚æ¯å½“æœ‰äººåŠ å…¥è¿™ä¸ªç½‘è·¯æ—¶ï¼Œä»–ä»¬å°±ä¼šå¾—åˆ°åŒºå—é“¾çš„å®Œæ•´æ‹·è´ï¼›æ¯å½“æœ‰äººå»ºç«‹ä¸€ä¸ªæ–°åŒºå—æ—¶ï¼Œå°±ä¼šä¼ é€åˆ°ç½‘è·¯å†…çš„æ‰€æœ‰äººã€‚ç„¶åï¼Œé€è¿‡ä¸€äº›å¤æ‚çš„ç¨‹å¼ï¼Œè®©èŠ‚ç‚¹(Node)åœ¨åŠ å…¥è¿™ä¸ªåŒºå—åˆ°åŒºå—é“¾ä¹‹å‰ï¼Œå…ˆç¡®è®¤è¯¥åŒºå—æœ‰å¦è¢«çªœæ”¹ã€‚å°±è¿™æ ·ï¼Œä»»ä½•åœ°æ–¹çš„ä»»ä½•äººéƒ½å¯ä»¥å–å¾—è¿™äº›èµ„è®¯ã€‚å¦‚æœä½ æ˜¯HBOçŸ½è°·ç¾¤çä¼ (Silicon Valley)çš„å¿ å®ç²‰ä¸ï¼Œè¿™å¬èµ·æ¥å¯èƒ½æœ‰ç‚¹ç†Ÿæ‚‰ï¼Œå› ä¸ºåœ¨è¿™å‡ºç¾å‰§é‡Œï¼Œä¸»è§’å°±æ˜¯ç”¨äº†ç±»ä¼¼çš„æŠ€æœ¯æ¥å»ºç«‹ä¸€ä¸ªå…¨æ–°ç½‘è·¯ã€‚ å› ä¸ºæ¯ä¸ªäººæˆ–èŠ‚ç‚¹éƒ½æœ‰ä¸€ä»½åŒºå—é“¾çš„æ‹·è´ï¼Œä»–ä»¬å¯ä»¥æœ‰å…±è¯†å¹¶ç¡®è®¤å“ªäº›åŒºå—æ˜¯åˆæ³•çš„ã€‚å› æ­¤ï¼Œå¦‚æœä½ æƒ³è¦éª‡å…¥ä¸€ä¸ªåŒºå—ï¼Œä½ å¿…é¡»éª‡å…¥ç½‘è·¯ä¸Šè¶…è¿‡50% çš„åŒºå—æ¥é€šè¿‡ä½ çš„èµ„è®¯ã€‚è¿™å°±æ˜¯ä¸ºä»€ä¹ˆåŒºå—é“¾æˆ–è®¸æ˜¯è¿‡å»åå¹´ä»¥æ¥æœ€å®‰å…¨çš„æŠ€æœ¯ä¹‹ä¸€ã€‚ å…³äºèŒƒä¾‹åº”ç”¨ç°åœ¨ä½ äº†è§£åŒºå—é“¾æ˜¯å¦‚ä½•è¿ä½œäº†ï¼Œé‚£ä¹ˆå¼€å§‹æ¥åˆ¶ä½œæˆ‘ä»¬çš„èŒƒä¾‹Appå§ï¼è¯·å…ˆä¸‹è½½åˆå§‹é¡¹ç›®ã€‚ï¼ˆhttps://raw.githubusercontent.com/appcoda/BlockchainDemo/master/BlockchainStarter.zipï¼‰ å¦‚ä½ æ‰€è§ï¼Œæˆ‘ä»¬æœ‰ä¸¤ä¸ªæ¯”ç‰¹å¸é’±åŒ…ã€‚ç¬¬ä¸€ä¸ªå¸å·Account 1065 æ‹¥æœ‰500 BTCï¼Œè€Œç¬¬äºŒä¸ªå¸å·0217 åˆ™ä»€ä¹ˆéƒ½æ²¡æœ‰ã€‚æˆ‘ä»¬åˆ©ç”¨ä¼ é€æŒ‰é’®æ¥ä¼ é€æ¯”ç‰¹å¸åˆ°å…¶ä»–å¸å·ã€‚ä¸ºäº†èµšå–BTCï¼Œæˆ‘ä»¬æŒ‰ä¸‹Mine æŒ‰é’®å°±å¯ä»¥è·å¾—50 BTC ä¸ºå¥–åŠ±ã€‚åŸºæœ¬æ¥è¯´ï¼Œæˆ‘ä»¬åšçš„æ˜¯å½“App æ‰§è¡Œæ—¶ï¼Œåˆ©ç”¨æ§åˆ¶å°æ¥è§‚å¯Ÿä¸¤ä¸ªæ¯”ç‰¹å¸å¸å·é—´çš„äº¤æ˜“æƒ…å†µã€‚ ä½ ä¼šæ³¨æ„åˆ°ï¼Œä¾§è¾¹æ é‡Œæœ‰ä¸¤ä¸ªé‡è¦çš„ç±»åˆ«ï¼šBlockåŠBlockchainã€‚æ‰“å¼€è¿™äº›æ¡£æ¡ˆï¼Œä½ ä¼šçœ‹åˆ°æ¡£æ¡ˆæ˜¯ç©ºçš„ï¼Œé‚£æ˜¯å› ä¸ºæˆ‘å°†ä¼šå¼•å¯¼ä½ å†™å‡ºè¿™äº›ç±»åˆ«çš„é€»è¾‘ã€‚é‚£æˆ‘ä»¬å¼€å§‹å§ï¼ åœ¨Swift å®šä¹‰Blockå‰å¾€Block.swiftå¹¶æ·»åŠ ç¨‹å¼ç ä»¥å®šä¹‰ä¸€ä¸ªåŒºå—ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬äº†è§£ä¸€ä¸‹åŒºå—æ˜¯ä»€ä¹ˆã€‚æˆ‘ä»¬å…ˆå‰å®šä¹‰äº†ä¸€ä¸ªåŒºå—ç”±ä¸‰ä¸ªéƒ¨åˆ†ç»„æˆï¼šæ‚å‡‘å€¼ã€è®°å½•çš„å®é™…èµ„æ–™ã€ä»¥åŠå‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘å€¼ã€‚å½“æˆ‘ä»¬æƒ³å»ºç«‹è‡ªå·±çš„åŒºå—é“¾æ—¶ï¼Œå¿…é¡»è¦çŸ¥é“åŒºå—çš„æ’åºï¼Œè¿™ä¸€ç‚¹å¯ä»¥å¾ˆå®¹æ˜“åœ°åœ¨Swiftä¸­å®šä¹‰ã€‚æ·»åŠ ä»¥ä¸‹ç¨‹å¼ç åˆ°ç±»åˆ«é‡Œï¼š 1234var hash: String!var data: String!var previousHash: String!var index: Int! ç°åœ¨ï¼Œæˆ‘ä»¬éœ€è¦æ·»åŠ æœ€åä¸€ä¸ªé‡è¦çš„ç¨‹å¼ç ã€‚æˆ‘ä¹‹å‰æåˆ°æ¯æ¬¡ä¸€ä¸ªåŒºå—è¢«æ›´åŠ¨ï¼Œæ‚å‡‘å°±ä¼šæ”¹å˜ï¼›è¿™å°±æ˜¯åŒºå—é“¾å¦‚æ­¤å®‰å…¨çš„ç‰¹è‰²ä¹‹ä¸€ã€‚æ‰€ä»¥æˆ‘ä»¬å¿…é¡»å»ºç«‹ä¸€ä¸ªå‡½å¼æ¥äº§ç”Ÿä¸€ä¸ªéšæœºå­—æ¯æ•°å­—çš„æ‚å‡‘ã€‚è¿™ä¸ªå‡½å¼åªéœ€è¦å‡ è¡Œç¨‹å¼ç ï¼š 123func generateHash() -&gt; String &#123; return NSUUID().uuidString.replacingOccurrences(of: \"-\", with: \"\")&#125; NSUUIDæ˜¯ä¸€ä¸ªç‰©ä»¶ï¼Œä»£è¡¨æ¡¥æ¥UUIDçš„é€šç”¨å”¯ä¸€å€¼ã€‚å®ƒå†…ç½®äºSwiftä¸­ï¼Œè€Œä¸”éå¸¸é€‚åˆç”¨æ¥äº§ç”Ÿ32å­—å…ƒçš„å­—ä¸²ã€‚è¿™ä¸ªå‡½å¼äº§ç”Ÿä¸€ä¸ªUUIDï¼Œæ¶ˆé™¤æ‰€æœ‰è¿å­—ç¬¦(-)ï¼Œç„¶åå›ä¼ Stringï¼Œå³åŒºå—çš„æ‚å‡‘ã€‚Block.swiftç°åœ¨åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š æˆ‘ä»¬å·²ç»å®šä¹‰äº†Blockç±»åˆ«ï¼Œæ¥ç€è®©æˆ‘ä»¬å®šä¹‰Blockchainç±»åˆ«å§ã€‚åˆ‡æ¢åˆ°Blockchain.swiftã€‚ åœ¨Swift å®šä¹‰Blockchainå¦‚å‰æ–‡æ‰€è¯´ï¼Œè®©æˆ‘ä»¬å°è¯•ä»åŸºæœ¬é¢æ¥äº†è§£åŒºå—é“¾ã€‚åœ¨åŸºæœ¬çš„æœ¯è¯­é‡Œï¼ŒåŒºå—é“¾åªæ˜¯åŒºå—ä¸²åœ¨ä¸€èµ·ç»„æˆçš„é“¾ï¼›æ¢å¥è¯è¯´ï¼Œå®ƒæ˜¯ä¸€ä¸ªåŒ…å«æ‰€æœ‰é¡¹ç›®çš„åˆ—è¡¨ã€‚å¬èµ·æ¥æ˜¯ä¸æ˜¯æœ‰ç‚¹ç†Ÿæ‚‰å‘¢ï¼Ÿå› ä¸ºè¿™å°±æ˜¯é˜µåˆ—çš„å®šä¹‰ï¼Œè€Œè¿™ä¸ªé˜µåˆ—å°±æ˜¯ç”±åŒºå—æ‰€ç»„æˆï¼è®©æˆ‘ä»¬æŠŠä¸‹åˆ—çš„ç¨‹å¼ç åŠ è¿›å»å§ï¼š 1var chain = [Block]() å°æç¤ºï¼šè¿™å‡ ä¹å¯ä»¥åº”ç”¨åœ¨ç”µè„‘ç§‘å­¦ä¸–ç•Œçš„æ‰€æœ‰äº‹ä¸Šã€‚å¦‚æœä½ æ›¾é‡è¿‡å¤§é—®é¢˜ï¼Œè¯•ç€å°†å®ƒæ‹†è§£æˆå°ç»„ä»¶ï¼Œç„¶åä»¥è‡ªå·±çš„æ–¹æ³•æ¥è§£å†³é—®é¢˜ï¼›å°±åƒæˆ‘ä»¬å¼„æ¸…æ¥šå¦‚ä½•åœ¨Swiftä¸­åŠ å…¥åŒºå—åŠåŒºå—é“¾ä¸€æ ·ï¼ ä½ ä¼šæ³¨æ„åˆ°åœ¨é˜µåˆ—é‡Œé¢åŒ…å«äº†å…ˆå‰å®šä¹‰çš„Blockç±»åˆ«ï¼Œé‚£æ˜¯æˆ‘ä»¬åœ¨åŒºå—é“¾ä¸­éœ€è¦çš„æ‰€æœ‰å˜æ•°ã€‚åŠ å…¥ä¸¤ä¸ªå‡½å¼åˆ°ç±»åˆ«é‡Œï¼Œæˆ‘ä»¬å°±å®Œæˆäº†ã€‚è¯•ç€ç”¨æˆ‘å‰æ–‡æ‰€æ•™çš„æ¥å›ç­”è¿™ä¸ªé—®é¢˜ï¼š åœ¨ä¸€ä¸ªåŒºå—é“¾ä¸­ï¼Œä¸¤ä¸ªä¸»è¦çš„å‡½å¼æ˜¯ä»€ä¹ˆï¼Ÿ å¸Œæœ›ä½ èƒ½å¤Ÿå›ç­”è¿™ä¸ªé—®é¢˜ï¼è¿™ä¸¤ä¸ªåŒºå—é“¾æ‹¥æœ‰çš„ä¸»è¦å‡½å¼ï¼Œæ˜¯ç”¨æ¥å»ºç«‹åˆå§‹åŒºå—ï¼Œä»¥åŠåœ¨åé¢æ–°å¢æ–°çš„åŒºå—ã€‚å½“ç„¶ï¼Œç°åœ¨æˆ‘ä¸ä¼šä¸‹æ”¾è¿™ä¸ªé“¾å¹¶åŠ å…¥æ™ºæ…§åˆçº¦ï¼Œä½†æ˜¯è¿™äº›æ˜¯åŸºæœ¬å‡½å¼ï¼åŠ å…¥ä»¥ä¸‹ç¨‹å¼ç åˆ°Blockchain.swiftï¼š 1234567891011121314151617func createGenesisBlock(data:String) &#123; let genesisBlock = Block() genesisBlock.hash = genesisBlock.generateHash() genesisBlock.data = data genesisBlock.previousHash = \"0000\" genesisBlock.index = 0 chain.append(genesisBlock)&#125; func createBlock(data:String) &#123; let newBlock = Block() newBlock.hash = newBlock.generateHash() newBlock.data = data newBlock.previousHash = chain[chain.count-1].hash newBlock.index = chain.count chain.append(newBlock)&#125; æˆ‘ä»¬åŠ å…¥çš„ç¬¬ä¸€ä¸ªå‡½å¼æ˜¯ç”¨æ¥å»ºç«‹åˆå§‹åŒºå—ã€‚ä¸ºæ­¤ï¼Œæˆ‘ä»¬å»ºç«‹äº†ä¸€ä¸ªå‡½å¼æ¥æŠŠåŒºå—çš„èµ„æ–™ä½œä¸ºInputã€‚ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªåä¸ºgenesisBlockçš„å˜æ•°ï¼Œå¹¶å°†å®ƒè®¾ä¸ºBlockå‹åˆ«ã€‚å› ä¸ºå®ƒæ˜¯Blockå‹åˆ«ï¼Œæ‰€ä»¥å®ƒæœ‰æˆ‘ä»¬ä¹‹å‰åœ¨Block.swiftå®šä¹‰çš„æ‰€æœ‰å˜æ•°åŠå‡½å¼ã€‚æˆ‘ä»¬è®¾å®šgenerateHash()ä¸ºæ‚å‡‘ã€ Input dataä¸ºèµ„æ–™ã€‚å› ä¸ºè¿™æ˜¯ç¬¬ä¸€ä¸ªåŒºå—ï¼Œæ‰€ä»¥æˆ‘ä»¬å°†å‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘è®¾å®šä¸º000ï¼Œå¥½è®©æˆ‘ä»¬çŸ¥é“è¿™æ˜¯åˆå§‹åŒºå—ã€‚æˆ‘ä»¬å°†å®ƒçš„ç´¢å¼•å€¼è®¾ä¸º0 ï¼Œç„¶åæ”¾åˆ°åŒºå—é“¾chainã€‚ æˆ‘ä»¬å»ºç«‹çš„ä¸‹ä¸€ä¸ªå‡½å¼åˆ™é€‚ç”¨äºæ‰€æœ‰genesisBlockåçš„åŒºå—ï¼Œè€Œå®ƒä¼šå»ºç«‹å‰©ä¸‹çš„æ‰€æœ‰åŒºå—ã€‚ä½ ä¼šæ³¨æ„åˆ°å®ƒè·Ÿä¹‹å‰çš„å‡½å¼éå¸¸ç›¸ä¼¼ï¼Œå”¯ä¸€çš„ä¸åŒçš„æ˜¯æˆ‘ä»¬å°†previousHashè®¾å®šä¸ºå‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘ï¼Œå¹¶å°†indexè®¾ä¸ºå®ƒåœ¨åŒºå—ç»ƒçš„ä½ç½®ã€‚å®Œæˆäº†ï¼æˆ‘ä»¬å·²ç»æˆåŠŸå®šä¹‰è‡ªå·±çš„Blockchainï¼ä½ çš„ç¨‹å¼ç åº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ æ¥ç€ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„éƒ¨åˆ†è¿æ¥åˆ°ViewController.swiftæ¡£æ¡ˆï¼Œå¹¶çœ‹çœ‹æ‰§è¡Œæˆæœå§ï¼ é’±åŒ…åå°(Wallet Backend)åˆ‡æ¢åˆ°ViewController.swiftï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°æ‰€æœ‰çš„UIå…ƒä»¶éƒ½å·²ç»è¿ç»“å®Œæ¯•ã€‚æˆ‘ä»¬æ‰€éœ€è¦åšçš„å°±æ˜¯å¤„ç†äº¤æ˜“ï¼Œå¹¶å°†äº¤æ˜“åˆ—å°åˆ°æ§åˆ¶å°ä¸Šã€‚ç„¶è€Œåœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬åº”è¯¥ç¨å¾®æ¢è®¨ä¸€ä¸‹æ¯”ç‰¹å¸åŒºå—é“¾ã€‚æ¯”ç‰¹å¸æ¥è‡ªä¸€ä¸ªæ€»å¸å·ï¼Œå‡è®¾è¿™ä¸ªå¸å·çš„ç¼–å·æ˜¯000ã€‚å½“ä½ æŒ–æ˜ä¸€é¢—æ¯”ç‰¹å¸æ—¶ï¼Œå°±è¡¨ç¤ºä½ è§£ç­”äº†æ•°å­¦é—®é¢˜ï¼Œå¹¶è·å¾—ä¸€å®šæ•°é‡çš„æ¯”ç‰¹å¸ä½œä¸ºå¥–åŠ±ã€‚è¿™æ˜¯å‘è¡Œè´§å¸ä¸€ä¸ªå¾ˆèªæ˜çš„æ–¹æ³•ï¼ŒåŒæ—¶ä¹Ÿåˆ›é€ äº†è®©æ›´å¤šäººå»æŒ–æ˜çš„åŠ¨æœºã€‚åœ¨æˆ‘ä»¬çš„App é‡Œï¼Œæˆ‘ä»¬å°†100 BTC ä½œä¸ºå¥–åŠ±ã€‚é¦–å…ˆï¼Œè®©æˆ‘ä»¬åœ¨ViewController æ·»åŠ éœ€è¦çš„å˜æ•°ï¼š 123456let firstAccount = 1065let secondAccount = 0217let bitcoinChain = Blockchain()let reward = 100var accounts: [String: Int] = [\"0000\": 10000000]let invalidAlert = UIAlertController(title: \"Invalid Transaction\", message: \"Please check the details of your transaction as we were unable to process this.\", preferredStyle: .alert) æˆ‘ä»¬å®šä¹‰ä¸¤ä¸ªå¸å·ï¼šä¸€ä¸ªç¼–å·ä¸º1065ï¼Œå¦ä¸€ä¸ªç¼–å·ä¸º0217ã€‚æˆ‘ä»¬åŒæ—¶æ–°å¢ä¸€ä¸ªbitcoinChainå˜æ•°æ¥ä½œä¸ºæˆ‘ä»¬çš„åŒºå—é“¾ï¼Œå¹¶å°†rewardè®¾å®šä¸º100ã€‚æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä½œä¸ºæ¯”ç‰¹å¸æ¥æºçš„ä¸»å¸å·ï¼šè¿™æ˜¯æˆ‘ä»¬çš„åˆå§‹å¸å·ï¼Œç¼–å·ä¸º0000ï¼Œå®ƒæ‹¥æœ‰ä¸€åƒä¸‡ä¸ªæ¯”ç‰¹å¸ã€‚ä½ å¯ä»¥æŠŠè¿™ä¸ªå¸å·å½“æˆé“¶è¡Œï¼Œåœ¨æ¯ä¸€æ¬¡çš„å¥–åŠ±ä¸­ï¼Œå°±ä¼šä»ä¸­å–å‡º100ä¸ªæ¯”ç‰¹å¸ï¼Œå¹¶è½¬è‡³åˆæ³•çš„å¸å·é‡Œã€‚æˆ‘ä»¬ä¹Ÿå®šä¹‰ä¸€ä¸ªè­¦å‘Šï¼Œåœ¨æ¯æ¬¡äº¤æ˜“æ— æ³•å®Œæˆæ—¶æ˜¾ç¤ºã€‚ ç°åœ¨ï¼Œè®©æˆ‘ä»¬æ¥å†™äº›å°†ä¼šæ‰§è¡Œçš„æ³›ç”¨å‡½å¼ã€‚ä½ å¯ä»¥çŒœåˆ°è¿™äº›å‡½å¼æ˜¯ä»€ä¹ˆå—ï¼Ÿ ç¬¬ä¸€ä¸ªå‡½å¼æ˜¯ç”¨æ¥å¤„ç†äº¤æ˜“çš„ã€‚æˆ‘ä»¬è¦ç¡®è®¤ä¼ é€è€…åŠæ¥æ”¶è€…çš„å¸å·ä¸­ï¼Œæ¥æ”¶æˆ–æ‰£é™¤çš„é‡‘é¢æ˜¯æ­£ç¡®çš„ï¼Œè€Œä¸”è¿™ä¸ªèµ„è®¯ä¼šè¢«è®°å½•åœ¨æˆ‘ä»¬çš„åŒºå—é“¾ä¸Šã€‚ ä¸‹ä¸€ä¸ªå‡½å¼æ˜¯è¦åœ¨æ§åˆ¶å°é‡Œå°å‡ºå®Œæ•´çš„çºªå½•ï¼Œå®ƒä¼šæ˜¾ç¤ºæ¯ä¸ªåŒºå—åŠæ¯ä¸ªåŒºå—å†…çš„èµ„æ–™ã€‚ æœ€åä¸€ä¸ªå‡½å¼æ˜¯ç”¨æ¥éªŒè¯åŒºå—é“¾æ˜¯å¦åˆæ³•ï¼Œæ–¹æ³•ä¸ºç¡®è®¤å‰ä¸ªåŒºå—çš„æ‚å‡‘æ˜¯å¦ç¬¦åˆä¸‹ä¸€ä¸ªåŒºå—çš„èµ„è®¯ã€‚å› ä¸ºæˆ‘ä»¬ä¸ä¼šç¤ºèŒƒä»»ä½•éª‡å®¢æ–¹æ³•ï¼Œæ‰€ä»¥èŒƒä¾‹ä¸­çš„é“¾æ°¸è¿œéƒ½æ˜¯åˆæ³•çš„ã€‚ Transaction å‡½å¼ä»¥ä¸‹æ˜¯æˆ‘ä»¬çš„æ³›ç”¨äº¤æ˜“å‡½å¼ã€‚åœ¨å®šä¹‰å˜æ•°ä¹‹ä¸‹è¾“å…¥ä»¥ä¸‹ç¨‹å¼ç ï¼š 1234567891011121314151617181920212223242526func transaction(from: String, to: String, amount: Int, type: String) &#123; // 1 if accounts[from] == nil &#123; self.present(invalidAlert, animated: true, completion: nil) return &#125; else if accounts[from]!-amount &lt; 0 &#123; self.present(invalidAlert, animated: true, completion: nil) return &#125; else &#123; accounts.updateValue(accounts[from]!-amount, forKey: from) &#125; // 2 if accounts[to] == nil &#123; accounts.updateValue(amount, forKey: to) &#125; else &#123; accounts.updateValue(accounts[to]!+amount, forKey: to) &#125; // 3 if type == \"genesis\" &#123; bitcoinChain.createGenesisBlock(data: \"From: \\(from); To: \\(to); Amount: \\(amount)BTC\") &#125; else if type == \"normal\" &#123; bitcoinChain.createBlock(data: \"From: \\(from); To: \\(to); Amount: \\(amount)BTC\") &#125;&#125; çœ‹èµ·æ¥ç¨‹å¼ç å¾ˆå¤šï¼Œä½†æ˜¯å®ƒçš„æ ¸å¿ƒåªæ˜¯ä¸ºæ¯æ¬¡çš„äº¤æ˜“å®šä¹‰ä¸€äº›è§„åˆ™ã€‚åœ¨å¼€å¤´çš„åœ°æ–¹ï¼Œæˆ‘ä»¬æœ‰å››ä¸ªå‚æ•°ï¼štoã€fromã€amountä»¥åŠtypeã€‚Toã€Fromã€åŠAmountçš„å«ä¹‰ä¸€ç›®äº†ç„¶ï¼Œè€ŒTypeåŸºæœ¬ä¸Šå°±æ˜¯å®šä¹‰äº¤æ˜“çš„ç±»å‹ã€‚è¿™é‡Œæœ‰ä¸¤ç§Typeï¼šNormalå’ŒGenesisã€‚ä¸€ä¸ªNormalçš„äº¤æ˜“ç±»å‹ä¼šæ˜¯åœ¨å¸å·1065ä¸0217ä¹‹é—´è¿›è¡Œï¼Œè€ŒGenesisäº¤æ˜“ç±»å‹åˆ™ä¼šæ¶‰åŠåˆ°å¸å·0000ã€‚ ç¬¬ä¸€ä¸ªif-elseæ¡ä»¶å¼æ˜¯å…³äºæ¥æºå¸å·ã€‚å¦‚æœæ¥æºå¸å·ä¸å­˜åœ¨æˆ–é‡‘é¢ä¸è¶³ï¼Œæˆ‘ä»¬ä¼šæ˜¾ç¤ºäº¤æ˜“æ— æ•ˆçš„è­¦å‘Šï¼Œç„¶åç»“æŸå‡½å¼ã€‚è€Œå¦‚æœé€šè¿‡çš„è¯ï¼Œæˆ‘ä»¬ä¼šæ›´æ–°æ•°å€¼ã€‚ ç¬¬äºŒä¸ªif-elseæ¡ä»¶å¼æ˜¯å…³äºæ¥æ”¶å¸å·ã€‚å¦‚æœæ¥æ”¶å¸å·ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬éšå®ƒè€Œå»ï¼Œç„¶åç»“æŸå‡½å¼ã€‚è¦ä¸ç„¶ï¼Œæˆ‘ä»¬å°±ä¼šä¼ é€æ­£ç¡®çš„æ¯”ç‰¹å¸æ•°é‡åˆ°å¸å·ã€‚ ç¬¬ä¸‰ä¸ªif-elseæ¡ä»¶å¼å¤„ç†äº¤æ˜“çš„ç±»å‹ã€‚å¦‚æœä¸€ä¸ªäº¤æ˜“æ¶‰åŠåˆå§‹åŒºå—ï¼Œæˆ‘ä»¬å°±å»ºç«‹ä¸€ä¸ªæ–°çš„åˆå§‹åŒºå—ï¼›åä¹‹æˆ‘ä»¬å»ºç«‹ä¸€ä¸ªæ–°åŒºå—æ¥å‚¨å­˜èµ„æ–™ã€‚ Printing å‡½å¼åœ¨æ¯æ¬¡äº¤æ˜“çš„æœ€åï¼Œæˆ‘ä»¬æƒ³è¦çœ‹åˆ°ä¸€ä¸ªæ¸…å•åˆ—å‡ºæ‰€æœ‰äº¤æ˜“ï¼Œæ¥ç¡®ä¿æˆ‘ä»¬çŸ¥é“æ‰€æœ‰å‘ç”Ÿçš„äº‹æƒ…ã€‚ä»¥ä¸‹æ˜¯æˆ‘ä»¬åœ¨transactionå‡½å¼ä¸‹è¾“å…¥çš„ç¨‹å¼ç ï¼š 123456789func chainState() &#123; for i in 0...bitcoinChain.chain.count-1 &#123; print(\"\\tBlock: \\(bitcoinChain.chain[i].index!)\\n\\tHash: \\(bitcoinChain.chain[i].hash!)\\n\\tPreviousHash: \\(bitcoinChain.chain[i].previousHash!)\\n\\tData: \\(bitcoinChain.chain[i].data!)\") &#125; redLabel.text = \"Balance: \\(accounts[String(describing: firstAccount)]!) BTC\" blueLabel.text = \"Balance: \\(accounts[String(describing: secondAccount)]!) BTC\" print(accounts) print(chainValidity())&#125; è¿™æ˜¯ä¸€ä¸ªç®€å•çš„forå›åœˆï¼ŒåŒ…å«bitcoinChainçš„æ¯ä¸ªåŒºå—ã€‚æˆ‘ä»¬å°å‡ºåŒºå—çš„ç¼–å·ã€æ‚å‡‘å€¼ã€å‰ä¸ªåŒºå—çš„æ‚å‡‘ã€ä»¥åŠå‚¨å­˜çš„èµ„æ–™ï¼Œå†æ›´æ–°UILabelæ¥æ˜¾ç¤ºæ¯ä¸ªå¸å·å†…æ­£ç¡®çš„BTCæ•°ç›®ã€‚æœ€åï¼Œå°å‡ºä¸€ä¸ªåˆ—å‡ºæ¯ä¸ªå¸å·çš„æ¸…å•ï¼ˆåº”è¯¥ä¼šæœ‰ä¸‰ä¸ªï¼‰ï¼Œå¹¶éªŒè¯é“¾çš„åˆæ³•æ€§ã€‚ç°åœ¨ï¼Œä½ åº”è¯¥ä¼šåœ¨å‡½å¼æœ€åä¸€è¡Œä¸­å‘ç”Ÿé”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºæˆ‘ä»¬è¿˜æ²¡å®šä¹‰chainValidity()å‡½å¼ï¼Œé‚£ä¹ˆå°±æ¥å¼€å§‹å§ï¼ Validity å‡½å¼è®°ä½ï¼Œå¦‚æœå‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘å€¼ç¬¦åˆç›®å‰åŒºå—æ‰€æè¿°çš„å†…å®¹ï¼Œé‚£ä¹ˆè¿™ä¸€ä¸ªé“¾å°±æ˜¯åˆæ³•çš„ã€‚æˆ‘ä»¬å¯ä»¥è½»æ˜“åœ°ç”¨å¦ä¸€ä¸ªfor å›åœˆæ¥é‡å¤éªŒè¯æ¯ä¸ªåŒºå—ã€‚ 123456789func chainValidity() -&gt; String &#123; var isChainValid = true for i in 1...bitcoinChain.chain.count-1 &#123; if bitcoinChain.chain[i].previousHash != bitcoinChain.chain[i-1].hash &#123; isChainValid = false &#125; &#125; return \"Chain is valid: \\(isChainValid)\\n\"&#125; è·Ÿä¹‹å‰æœ‰ç‚¹ç›¸ä¼¼ï¼Œæˆ‘ä»¬åœ¨bitcoinChainä¸­é‡å¤éªŒè¯æ¯ä¸ªåŒºå—ï¼Œæ¥ç¡®è®¤å‰ä¸€ä¸ªåŒºå—çš„æ‚å‡‘å€¼æ˜¯å¦ä¸ç›®å‰åŒºå—æ‰€æè¿°çš„å†…å®¹ç¬¦åˆã€‚è¿™æ ·å°±å®Œæˆäº†ï¼æˆ‘ä»¬å·²ç»å®šä¹‰äº†å‡½å¼ï¼Œå¹¶å°†ä¼šæ¯æ¬¡éƒ½ç”¨åˆ°å®ƒä»¬ï¼ä½ çš„ViewController.swiftç°åœ¨åº”è¯¥çœ‹èµ·æ¥åƒè¿™æ ·ï¼š ç°åœ¨æˆ‘ä»¬åªéœ€è¦å°†æŒ‰é’®è¿æ¥åˆ°å‡½å¼å°±å®Œæˆäº†ï¼Œæ¥å¼€å§‹æœ€åçš„ç¯‡ç« å§ï¼ å°†æ‰€æœ‰ä¸œè¥¿è¿ç»“åœ¨ä¸€èµ·å½“æˆ‘ä»¬çš„Appé¦–æ¬¡å¯åŠ¨æ—¶ï¼Œæˆ‘ä»¬æƒ³è®©åˆå§‹å¸å·0000ä¼ é€50 BTCåˆ°æˆ‘ä»¬çš„ç¬¬ä¸€ä¸ªå¸å·ã€‚ç„¶åï¼Œæˆ‘ä»¬å°†è®©ç¬¬ä¸€ä¸ªå¸å·ä¼ é€10 BTCåˆ°ç¬¬äºŒä¸ªå¸å·ã€‚è¿™ä¸ªæ­¥éª¤ä»…éœ€ä¸‰è¡Œç¨‹å¼ç å°±å¯ä»¥å®Œæˆã€‚å¦‚æ­¤æ›´æ”¹ä½ çš„viewDidLoadå‡½å¼ï¼š 1234567override func viewDidLoad() &#123; super.viewDidLoad() transaction(from: \"0000\", to: \"\\(firstAccount)\", amount: 50, type: \"genesis\") transaction(from: \"\\(firstAccount)\", to: \"\\(secondAccount)\", amount: 10, type: \"normal\") chainState() self.invalidAlert.addAction(UIAlertAction(title: \"OK\", style: .default, handler: nil))&#125; æˆ‘ä»¬ä½¿ç”¨å…ˆå‰å®šä¹‰å¥½çš„å‡½å¼ï¼Œå¹¶åœ¨æœ€åå‘¼å«chainState()ã€‚åŒæ—¶ï¼Œæˆ‘ä»¬æ–°å¢ä¸€ä¸ªOKæŒ‰é’®åˆ°äº¤æ˜“æ— æ•ˆçš„è­¦å‘Šä¸­ã€‚ç°åœ¨è®©æˆ‘ä»¬æ¥çœ‹çœ‹å‰©ä¸‹çš„å››ä¸ªå‡½å¼é‡Œè¦åŠ å…¥ä»€ä¹ˆï¼šredMine()ã€blueMine()ã€redSend()åŠblueSend()ã€‚ æŒ–çŸ¿å‡½å¼æŒ–çŸ¿å‡½å¼éå¸¸åœ°ç®€å•ï¼Œåªè¦ä¸‰è¡Œç¨‹å¼ç å°±è¡Œäº†ã€‚è¿™å°±æ˜¯æˆ‘ä»¬è¦æ·»åŠ çš„ç¨‹å¼ç ï¼š 1234567891011@IBAction func redMine(_ sender: Any) &#123; transaction(from: \"0000\", to: \"\\(firstAccount)\", amount: 100, type: \"normal\") print(\"New block mined by: \\(firstAccount)\") chainState()&#125; @IBAction func blueMine(_ sender: Any) &#123; transaction(from: \"0000\", to: \"\\(secondAccount)\", amount: 100, type: \"normal\") print(\"New block mined by: \\(secondAccount)\") chainState()&#125; åœ¨ç¬¬ä¸€ä¸ªæŒ–çŸ¿å‡½å¼ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨transactionå‡½å¼ä»åˆå§‹å¸å·ä¼ é€100 BTCåˆ°ç¬¬ä¸€ä¸ªå¸å·ï¼Œå…ˆå°å‡ºä¸€ä¸ªåŒºå—è¢«æŒ–å‡ºï¼Œå†å°å‡ºchainStateã€‚åŒæ ·åœ°ï¼Œæˆ‘ä»¬åœ¨blueMineå‡½å¼é‡Œå°†100 BTCä¼ é€åˆ°ç¬¬äºŒä¸ªå¸å·ã€‚ ä¼ é€å‡½å¼ä¼ é€å‡½å¼ä¸å…ˆå‰çš„å‡½å¼ä¹Ÿç¨å¾®ç›¸ä¼¼ã€‚ 123456789101112131415161718192021@IBAction func redSend(_ sender: Any) &#123; if redAmount.text == \"\" &#123; present(invalidAlert, animated: true, completion: nil) &#125; else &#123; transaction(from: \"\\(firstAccount)\", to: \"\\(secondAccount)\", amount: Int(redAmount.text!)!, type: \"normal\") print(\"\\(redAmount.text!) BTC sent from \\(firstAccount) to \\(secondAccount)\") chainState() redAmount.text = \"\" &#125;&#125; @IBAction func blueSend(_ sender: Any) &#123; if blueAmount.text == \"\" &#123; present(invalidAlert, animated: true, completion: nil) &#125; else &#123; transaction(from: \"\\(secondAccount)\", to: \"\\(firstAccount)\", amount: Int(blueAmount.text!)!, type: \"normal\") print(\"\\(blueAmount.text!) BTC sent from \\(secondAccount) to \\(firstAccount)\") chainState() blueAmount.text = \"\" &#125;&#125; é¦–å…ˆï¼Œæˆ‘ä»¬ç¡®è®¤redAmountæˆ–blueAmountä¸­çš„æ–‡å­—æ ä½æ˜¯å¦ä¸ºç©ºå€¼ã€‚å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬ä¼šæ˜¾ç¤ºä¸€ä¸ªäº¤æ˜“æ— æ•ˆçš„è­¦å‘Šã€‚å¦‚æœä¸æ˜¯ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç»§ç»­ã€‚æˆ‘ä»¬ä½¿ç”¨transactionå‡½å¼è¾“å…¥é‡‘é¢ï¼Œå¹¶æŠŠäº¤æ˜“è®¾ä¸ºnormalå‹æ€ï¼Œä»¥å°†ç¬¬ä¸€ä¸ªå¸å·çš„é‡‘é¢ä¼ é€åˆ°ç¬¬äºŒä¸ªå¸å·ï¼ˆæˆ–ç›¸åï¼‰ã€‚æˆ‘ä»¬å°å‡ºè¢«ä¼ é€çš„é‡‘é¢ï¼Œç„¶åå‘¼å«chainState()å‡½å¼ã€‚æœ€åï¼ŒæŠŠæ–‡å­—æ ä½æ¸…ç©ºã€‚è¿™æ ·æˆ‘ä»¬å°±å®Œæˆå•°ï¼ç¡®è®¤ä¸€ä¸‹ä½ çš„ç¨‹å¼ç æ˜¯å¦ç¬¦åˆä¸‹å›¾æ‰€ç¤ºã€‚ æ‰§è¡ŒApp è¯•è¯•çœ‹ï¼ä»å‰ç«¯æ¥è¯´ï¼Œå®ƒçœ‹èµ·æ¥å°±å¦‚ä¸€ä¸ªæ™®é€šçš„äº¤æ˜“Appï¼Œä½†ä½ ä¼šçŸ¥é“å®ƒåå°çš„è¿ä½œã€‚è¯•è¯•ä½¿ç”¨App å°†BTC ä»ä¸€ä¸ªå¸å·äº¤æ˜“ç»™å¦ä¸€ä¸ªå¸å·ã€å¹¶è¯•ç€æ¬ºéª—App å§ï¼ ç»“è®ºåœ¨è¿™æ¬¡çš„æ•™å­¦ä¸­ï¼Œä½ å­¦åˆ°äº†å¦‚ä½•ä½¿ç”¨Swift æ¥å»ºç«‹ä¸€ä¸ªåŒºå—é“¾ï¼Œå¹¶å»ºç«‹è‡ªå·±çš„æ¯”ç‰¹å¸äº¤æ˜“ã€‚è¯·æ³¨æ„åœ¨çœŸå®çš„åŠ å¯†è´§å¸åå°é‡Œï¼Œå®ä½œéƒ¨åˆ†æ˜¯è·Ÿä¸Šæ–‡æ˜¯å®Œå…¨ä¸ä¸€æ ·çš„ä¸œè¥¿ï¼Œå› ä¸ºå®ƒéœ€è¦è—‰ç”±æ™ºæ…§åˆçº¦æ¥åˆ†æ•£ï¼Œä½†æ˜¯ä¸Šé¢çš„ç¤ºèŒƒå†…å®¹ç”¨æ¥å­¦ä¹ çš„ã€‚åœ¨è¿™ä¸ªèŒƒä¾‹ä¸­ï¼Œæˆ‘ä»¬è¿ç”¨äº†æ¯”ç‰¹å¸æ¥å½“åŠ å¯†è´§å¸ï¼Œä½†ä½ èƒ½æƒ³åˆ°åŒºå—é“¾è¿˜çš„å…¶ä»–ç”¨é€”å—ï¼Ÿæ¬¢è¿åœ¨ä¸‹é¢ç•™è¨€åˆ†äº«ä½ çš„çœ‹æ³•ï¼å¸Œæœ›ä½ åœ¨æ­¤å­¦åˆ°æ–°çš„ä¸œè¥¿ï¼ä½ å¯ä»¥åœ¨Githubä¸‹è½½å®Œæ•´é¡¹ç›®ä½œå‚è€ƒã€‚ å®Œæ•´é¡¹ç›®ï¼šhttps://github.com/appcoda/BlockchainDemoåŸæ–‡é“¾æ¥ï¼šhttps://www.appcoda.com/blockchain-introduction/","categories":[{"name":"Summary","slug":"Summary","permalink":"https://reversescale.github.io/categories/Summary/"}],"tags":[{"name":"Blockchain","slug":"Blockchain","permalink":"https://reversescale.github.io/tags/Blockchain/"}]},{"title":"iOS Principleï¼šReactNative","slug":"iOS Principle ReactNative","date":"2018-06-11T13:56:27.000Z","updated":"2018-11-18T05:45:34.574Z","comments":true,"path":"2018/06/11/iOS Principle ReactNative/","link":"","permalink":"https://reversescale.github.io/2018/06/11/iOS Principle ReactNative/","excerpt":"ReactNative åˆ©ç”¨äº†ç§»åŠ¨å¹³å°èƒ½å¤Ÿè¿è¡Œ JavaScript (è„šæœ¬è¯­è¨€)ä»£ç çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å‘æŒ¥äº† JavaScript ä¸ä»…ä»…å¯ä»¥ä¼ é€’é…ç½®ä¿¡æ¯ï¼Œè¿˜å¯ä»¥è¡¨è¾¾é€»è¾‘ä¿¡æ¯çš„ä¼˜ç‚¹~","text":"ReactNative åˆ©ç”¨äº†ç§»åŠ¨å¹³å°èƒ½å¤Ÿè¿è¡Œ JavaScript (è„šæœ¬è¯­è¨€)ä»£ç çš„èƒ½åŠ›ï¼Œå¹¶ä¸”å‘æŒ¥äº† JavaScript ä¸ä»…ä»…å¯ä»¥ä¼ é€’é…ç½®ä¿¡æ¯ï¼Œè¿˜å¯ä»¥è¡¨è¾¾é€»è¾‘ä¿¡æ¯çš„ä¼˜ç‚¹~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿†ï¼š ReactåŸç†ï¼šä¸€å¥—å¯ä»¥ç”¨ç®€æ´çš„è¯­æ³•é«˜æ•ˆç»˜åˆ¶ DOM çš„æ¡†æ¶ Reactç‰¹ç‚¹ï¼š ç®€æ´ï¼šä¸å•å•æŒ‡å®ƒçš„ HTML å’Œ CSS è¯­æ³•ï¼Œæ›´å› ä¸ºå¯ä»¥å•ç”¨ JavaScript æ„é€ é¡µé¢ é«˜æ•ˆï¼šå› ä¸º React ç‹¬åˆ›äº† Virtual DOM æœºåˆ¶ï¼Œä¸¤å¤§ç‰¹å¾ å®ƒå­˜åœ¨äºå†…å­˜ä¸­çš„ JavaScript å¯¹è±¡ï¼Œå¹¶ä¸”ä¸ DOM æ˜¯å¯¹åº”å…³ç³» ä½¿ç”¨é«˜æ•ˆçš„ DOM Diff ç®—æ³•ä¸éœ€è¦å¯¹ DOM è¿›è¡Œé‡æ–°ç»˜åˆ¶ React NativeåŸç†ï¼šé€šè¿‡ JS å¯¹ OC çš„ JavaScript Core æ¡†æ¶çš„äº¤äº’æ¥å®ç°å¯¹åŸç”Ÿçš„è°ƒç”¨ rn åœ¨ OC å’Œ JS ä¸¤ç«¯éƒ½ä¿å­˜äº†ä¸€ä»½é…ç½®è¡¨ï¼Œé‡Œé¢æ ‡è®°äº†æ‰€æœ‰ OC æš´éœ²ç»™ JS çš„æ¨¡å—å’Œæ–¹æ³• ï¼Œjså¯¹ocçš„è°ƒç”¨é€šè¿‡blockæ–¹å¼å®ç°å›è°ƒ AppDelegateåˆå§‹åŒ–è¿‡ç¨‹ä¸­åˆ›å»ºbridgeï¼Œå†…éƒ¨é€šè¿‡setUpåˆ›å»ºBatchedBridgeæ¥æ‰¹é‡è¯»å– JS å¯¹ OC çš„æ–¹æ³•è°ƒç”¨å¹¶é€šè¿‡JavaScriptExecutoræ‰§è¡Œ JS ä»£ç  åˆ›å»º BatchedBridge æ­¥éª¤ è¯»å– JS æºç ï¼šæŠŠ JSX ä»£ç è½¬æˆ JS åŠ è½½è¿›å†…å­˜ä¸­ åˆå§‹åŒ–æ¨¡å—ä¿¡æ¯ï¼šæ‰¾åˆ°æ‰€æœ‰éœ€è¦æš´éœ²ç»™ JS çš„ç±» åˆå§‹åŒ– JS ä»£ç çš„æ‰§è¡Œå™¨ï¼šå³ RCTJSCExecutor å¯¹è±¡ ç”Ÿæˆæ¨¡å—åˆ—è¡¨å¹¶å†™å…¥ JS ç«¯ï¼šæ¥å— ModuleName å¹¶ä¸”ç”Ÿæˆæ¨¡å—ä¿¡æ¯ æ‰§è¡Œ JavaScript æºç ï¼šé€šè¿‡RCTJSCExecutoræ‰§è¡Œä»£ç ï¼Œå†™å…¥ä¿¡æ¯ ç›¸äº’è°ƒç”¨æ–¹æ³•ï¼š OCè°ƒç”¨JSï¼šOCä¼šé€šè¿‡executeBlockOnJavaScriptQueueæ–¹æ³•åœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šè¿è¡Œ JS ä»£ç  å¤„ç†å‚æ•°ï¼š_executeJSCall:(NSString *)methodæ–¹æ³• å®é™…è°ƒç”¨ï¼šsendAppEventWithNameå’Œbodyæ–¹æ³• JSè°ƒç”¨OCï¼šJS ä¼šè§£æå‡ºæ–¹æ³•çš„ç±»ã€æ–¹æ³•å’Œæ–¹æ³•å‚æ•°å¹¶æ”¾å…¥åˆ° MessageQueue ä¸­ï¼Œç­‰å¾… OC è°ƒç”¨æˆ–è¶…æ—¶å‘é€ ä½¿ç”¨RCT_EXPORT_METHOD å®ï¼Œç”¨æ¥æ³¨å†Œæ¨¡å—è¡¨ JSä¸­ä½¿ç”¨NativeModules.CryptoExport.æ³¨å†Œæ–¹æ³•è°ƒç”¨ rn çš„æ›´æ–°æœºåˆ¶ï¼šReact çŠ¶æ€æœºï¼Œä¸åœåœ°æ£€æŸ¥ç¡®è®¤æ›´æ–° æ–‡æœ¬å…ƒç´ ï¼šReactDOMTextComponent æ¯”è¾ƒæ›¿æ¢æ–‡æœ¬å…ƒç´  åŸºæœ¬å…ƒç´ ï¼šupdateComponentæ–¹æ³•åˆ†å±æ€§ã€èŠ‚ç‚¹æ›¿æ¢åŸºæœ¬å…ƒç´  è‡ªå®šä¹‰å…ƒç´ ï¼š_performComponentUpdateåˆ¤æ–­-å…ˆå¸è½½å†å®‰è£…å­èŠ‚ç‚¹ 20180522æ›´æ–°ï¼šReact Native åŸç†è§£æ å‡†å¤‡å·¥ä½œï¼Œé¦–å…ˆè¦æœ‰ä¸ªè§£å‰–å¯¹è±¡ä» HelloWord çœ‹èµ·ï¼Œæˆ‘ä»¬æ¥åˆ†æRNçš„å®ç°åŸç† 1234567891011import React, &#123; Component &#125; from 'react';import &#123; AppRegistry, Text &#125; from 'react-native';class HelloWorldApp extends Component &#123; render() &#123; return ( &lt;Text&gt;Hello world!&lt;/Text&gt; ); &#125;&#125;// æ³¨æ„ï¼Œè¿™é‡Œç”¨å¼•å·æ‹¬èµ·æ¥çš„'HelloWorldApp'å¿…é¡»å’Œä½ initåˆ›å»ºçš„é¡¹ç›®åä¸€è‡´AppRegistry.registerComponent('HelloWorldApp', () =&gt; HelloWorldApp); å¯ä»¥åˆ›å»ºä¸€ä¸ªæ–°çš„é¡¹ç›® 1react-native init ProjectName åˆ›å»ºå®Œæˆä½ å¯ä»¥æ‰‹åŠ¨æ‰“å¼€é¡¹ç›®ï¼Œä¹Ÿå¯ä»¥åœ¨é¡¹ç›®æ ¹ç›®å½•æ‰§è¡Œ 1234// å¯åŠ¨ iOSreact-native run-ios// å¯åŠ¨ Androidreact-native run-android å‡†å¤‡å·¥ä½œå®Œæˆäº† React åŸç†æ¢ç©¶é¦–å…ˆæˆ‘ä»¬èŠèŠ Reactï¼Œæˆ‘ä»¬æ³¨æ„åˆ°è¿™æ¡æ•°æ®æºä»£ç  123return ( &lt;Text&gt;Hello world!&lt;/Text&gt;); â€œä¸ºä»€ä¹ˆ JavaScript ä»£ç é‡Œé¢å‡ºç°äº† HTML çš„è¯­æ³•ï¼Ÿâ€ React Native æŠŠä¸€ç»„ç›¸å…³çš„ HTML æ ‡ç­¾ï¼Œä¹Ÿå°±æ˜¯ app å†…çš„ UI æ§ä»¶ï¼Œå°è£…è¿›ä¸€ä¸ªç»„ä»¶(Component)ä¸­ï¼Œè¿™ç§è¯­æ³•è¢«ç§°ä¸º JSXï¼Œå®ƒæ˜¯ä¸€ç§ JavaScript è¯­æ³•æ‹“å±•ã€‚ JSX å…è®¸æˆ‘ä»¬å†™ HTML æ ‡ç­¾æˆ– React æ ‡ç­¾ï¼Œå®ƒä»¬ç»ˆå°†è¢«è½¬æ¢æˆåŸç”Ÿçš„ JavaScript å¹¶åˆ›å»º DOMã€‚ åœ¨ React æ¡†æ¶ä¸­ï¼Œé™¤äº†å¯ä»¥ç”¨ JavaScript å†™ HTML ä»¥å¤–ï¼Œæˆ‘ä»¬ç”šè‡³å¯ä»¥å†™ CSSã€‚ æ€»ä¹‹ React æ˜¯ä¸€å¥—å¯ä»¥ç”¨ç®€æ´çš„è¯­æ³•é«˜æ•ˆç»˜åˆ¶ DOM çš„æ¡†æ¶ ç®€æ´ï¼šä¸å•å•æŒ‡å®ƒçš„ HTML å’Œ CSS è¯­æ³•ï¼Œæ›´å› ä¸ºå¯ä»¥å•ç”¨ JavaScript æ„é€ é¡µé¢ï¼› é«˜æ•ˆï¼šå› ä¸º React ç‹¬åˆ›äº† Virtual DOM æœºåˆ¶ï¼ŒVirtual DOM æœ‰ä¸¤å¤§ç‰¹å¾ï¼Œä¸€å®ƒå­˜åœ¨äºå†…å­˜ä¸­çš„ JavaScript å¯¹è±¡ï¼Œå¹¶ä¸”ä¸ DOM æ˜¯ä¸€ä¸€å¯¹åº”çš„å…³ç³»ï¼›äºŒä½¿ç”¨é«˜æ•ˆçš„ DOM Diff ç®—æ³•ä¸éœ€è¦å¯¹ DOM è¿›è¡Œé‡æ–°ç»˜åˆ¶ã€‚ å½“ç„¶ï¼ŒReact å¹¶ä¸æ˜¯å‰ç«¯å¼€å‘çš„å…¨éƒ¨ã€‚ä»ä¹‹å‰çš„æè¿°ä¹Ÿèƒ½çœ‹å‡ºï¼Œå®ƒä¸“æ³¨äº UI éƒ¨åˆ†ï¼Œå¯¹åº”åˆ° MVC ç»“æ„ä¸­å°±æ˜¯ View å±‚ã€‚ è¦æƒ³å®ç°å®Œæ•´çš„ MVC æ¶æ„ï¼Œè¿˜éœ€è¦ Model å’Œ Controller çš„ç»“æ„ã€‚åœ¨å‰ç«¯å¼€å‘æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥é‡‡ç”¨ Flux å’Œ Reduxï¼ˆåŸºäºFluxï¼‰ æ¶æ„ï¼Œå®ƒä»¬å¹¶éæ¡†æ¶(Library)ï¼Œè€Œæ˜¯å’Œ MVC ä¸€æ ·éƒ½æ˜¯ä¸€ç§æ¶æ„è®¾è®¡(Architecture)ã€‚ React Native åŸç†æ¢ç©¶è°ˆè°ˆ RN çš„æ•…äº‹èƒŒæ™¯React åœ¨å‰ç«¯å–å¾—çªç ´æ€§æˆåŠŸä»¥åï¼ŒJavaScript å¼€å§‹è¯•å›¾ä¸€ç»Ÿä¸‰ç«¯ã€‚ æœ€ç»ˆï¼Œä¸€ä¸ªåŸºäº JavaScriptï¼Œå…·å¤‡åŠ¨æ€é…ç½®èƒ½åŠ›ï¼Œé¢å‘å‰ç«¯å¼€å‘è€…çš„ç§»åŠ¨ç«¯å¼€å‘æ¡†æ¶ â€”â€” React Native è°ˆè°ˆ RN çš„åŸç†å³ä½¿ä½¿ç”¨äº† React Nativeï¼Œæˆ‘ä»¬ä¾ç„¶éœ€è¦ UIKit ç­‰æ¡†æ¶ï¼Œè°ƒç”¨çš„æ˜¯ Objective-C ä»£ç ï¼ŒJavaScript åªæ˜¯æä¾›äº†é…ç½®ä¿¡æ¯å’Œé€»è¾‘çš„å¤„ç†ç»“æœã€‚ è€Œ JavaScript æ˜¯ä¸€ç§è„šæœ¬è¯­è¨€ï¼Œå®ƒä¸ä¼šç»è¿‡ç¼–è¯‘ã€é“¾æ¥ç­‰æ“ä½œï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶æ‰åŠ¨æ€çš„è¿›è¡Œè¯æ³•ã€è¯­æ³•åˆ†æï¼Œç”ŸæˆæŠ½è±¡è¯­æ³•æ ‘(AST)å’Œå­—èŠ‚ç ï¼Œç„¶åç”±è§£é‡Šå™¨è´Ÿè´£æ‰§è¡Œæˆ–è€…ä½¿ç”¨ JIT å°†å­—èŠ‚ç è½¬åŒ–ä¸ºæœºå™¨ç å†æ‰§è¡Œã€‚ è‹¹æœæä¾›äº†ä¸€ä¸ªå«åš JavaScript Core çš„æ¡†æ¶ï¼Œè¿™æ˜¯ä¸€ä¸ª JavaScript å¼•æ“ã€‚æ•´ä¸ªæµç¨‹ç”± JavaScript å¼•æ“è´Ÿè´£å®Œæˆã€‚ 123JSContext *context = [[JSContext alloc] init]; JSValue *jsVal = [context evaluateScript:@\"21+7\"]; int iVal = [jsVal toInt32]; JavaScript æ˜¯ä¸€ç§å•çº¿ç¨‹çš„è¯­è¨€ï¼Œå®ƒä¸å…·å¤‡è‡ªè¿è¡Œçš„èƒ½åŠ›ï¼Œå› æ­¤æ€»æ˜¯è¢«åŠ¨è°ƒç”¨ã€‚å¾ˆå¤šä»‹ç» React Native çš„æ–‡ç« éƒ½ä¼šæåˆ° â€œJavaScript çº¿ç¨‹â€ çš„æ¦‚å¿µï¼Œå®é™…ä¸Šï¼Œå®ƒè¡¨ç¤ºçš„æ˜¯ Objective-C åˆ›å»ºäº†ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ï¼Œè¿™ä¸ªçº¿ç¨‹åªç”¨äºæ‰§è¡Œ JavaScript ä»£ç ï¼Œè€Œä¸” JavaScript ä»£ç åªä¼šåœ¨è¿™ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œã€‚ ä¸‹é¢å°† JavaScript ğŸ‘‰ OC ç”±äº JavaScript Core æ˜¯ä¸€ä¸ªé¢å‘ Objective-C çš„æ¡†æ¶ï¼Œåœ¨ Objective-C è¿™ä¸€ç«¯ï¼Œæˆ‘ä»¬å¯¹ JavaScript ä¸Šä¸‹æ–‡çŸ¥æ ¹çŸ¥åº•ï¼Œå¯ä»¥å¾ˆå®¹æ˜“çš„è·å–åˆ°å¯¹è±¡ï¼Œæ–¹æ³•ç­‰å„ç§ä¿¡æ¯ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬è°ƒç”¨ JavaScript å‡½æ•°ã€‚ çœŸæ­£å¤æ‚çš„é—®é¢˜åœ¨äºï¼ŒJavaScript ä¸çŸ¥é“ Objective-C æœ‰å“ªäº›æ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚ React Native è§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ¡ˆæ˜¯åœ¨ Objective-C å’Œ JavaScript ä¸¤ç«¯éƒ½ä¿å­˜äº†ä¸€ä»½é…ç½®è¡¨ï¼Œé‡Œé¢æ ‡è®°äº†æ‰€æœ‰ Objective-C æš´éœ²ç»™ JavaScript çš„æ¨¡å—å’Œæ–¹æ³•ã€‚ è¿™æ ·ï¼Œæ— è®ºæ˜¯å“ªä¸€æ–¹è°ƒç”¨å¦ä¸€æ–¹çš„æ–¹æ³•ï¼Œå®é™…ä¸Šä¼ é€’çš„æ•°æ®åªæœ‰ ModuleId ç±» MethodId æ–¹æ³• Arguments æ–¹æ³•å‚æ•° å½“ Objective-C æ¥æ”¶åˆ°è¿™ä¸‰ä¸ªå€¼åï¼Œå°±å¯ä»¥é€šè¿‡ runtime å”¯ä¸€ç¡®å®šè¦è°ƒç”¨çš„æ˜¯å“ªä¸ªå‡½æ•°ï¼Œç„¶åè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ å¯¹äº Objective-C æ¥è¯´ï¼Œæ‰§è¡Œå®Œ JavaScript ä»£ç å†æ‰§è¡Œ Objective-C å›è°ƒæ¯«æ— éš¾åº¦ï¼Œéš¾ç‚¹ä¾ç„¶åœ¨äº JavaScript ä»£ç è°ƒç”¨ Objective-C ä¹‹åï¼Œå¦‚ä½•åœ¨ Objective-C çš„ä»£ç ä¸­ï¼Œå›è°ƒæ‰§è¡Œ JavaScript ä»£ç ã€‚ ç›®å‰ React Native çš„åšæ³•æ˜¯ï¼šåœ¨ JavaScript è°ƒç”¨ Objective-C ä»£ç æ—¶ï¼Œæ³¨å†Œè¦å›è°ƒçš„ Blockï¼Œå¹¶ä¸”æŠŠ Block Id ä½œä¸ºå‚æ•°å‘é€ç»™ Objective-Cï¼ŒObjective-C æ”¶åˆ°å‚æ•°æ—¶ä¼šåˆ›å»º Blockï¼Œè°ƒç”¨å®Œ Objective-C å‡½æ•°åå°±ä¼šæ‰§è¡Œè¿™ä¸ªåˆšåˆšåˆ›å»ºçš„ Blockã€‚ Objective-C ä¼šå‘ Block ä¸­ä¼ å…¥å‚æ•°å’Œ Block Idï¼Œç„¶ååœ¨ Block å†…éƒ¨è°ƒç”¨ JavaScript çš„æ–¹æ³•ï¼Œéšå JavaScript æŸ¥æ‰¾åˆ°å½“æ—¶æ³¨å†Œçš„ Block å¹¶æ‰§è¡Œã€‚ ç®€å•çš„è¡¨ç¤ºå°±æ˜¯ï¼šJS ğŸ‘‰ OC (Block ğŸ‘‰ JS) ç»§ç»­çœ‹é¡¹ç›®-åˆå§‹åŒ–é™¤äº† index.js ä¸­çš„ JavaScript ä»£ç ï¼Œç•™ç»™æˆ‘ä»¬çš„è¿˜æœ‰ AppDelegate ä¸­çš„å…¥å£æ–¹æ³•ï¼š 123456789101112131415161718- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; NSURL *jsCodeLocation; jsCodeLocation = [[RCTBundleURLProvider sharedSettings] jsBundleURLForBundleRoot:@\"index\" fallbackResource:nil]; RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation moduleName:@\"demo\" initialProperties:nil launchOptions:launchOptions]; rootView.backgroundColor = [[UIColor alloc] initWithRed:1.0f green:1.0f blue:1.0f alpha:1]; self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds]; UIViewController *rootViewController = [UIViewController new]; rootViewController.view = rootView; self.window.rootViewController = rootViewController; [self.window makeKeyAndVisible]; return YES;&#125; å®é™…æˆ‘ä»¬æ“ä½œçš„è§†å›¾å°±æ˜¯è¿™ä¸ª RootView ï¼Œä½†æ˜¯ RootView æ˜¯ä¾æ‰˜äº Bridge å¯¹è±¡ï¼Œå®ƒæ˜¯ Objective-C ä¸ JavaScript äº¤äº’çš„æ¡¥æ¢ï¼Œåç»­çš„æ–¹æ³•äº¤äº’å®Œå…¨ä¾èµ–äºå®ƒï¼Œè€Œæ•´ä¸ªåˆå§‹åŒ–è¿‡ç¨‹çš„æœ€ç»ˆç›®çš„å…¶å®ä¹Ÿå°±æ˜¯åˆ›å»ºè¿™ä¸ªæ¡¥æ¢å¯¹è±¡ã€‚ 12345678910- (instancetype)initWithBundleURL:(NSURL *)bundleURL moduleName:(NSString *)moduleName initialProperties:(NSDictionary *)initialProperties launchOptions:(NSDictionary *)launchOptions &#123; RCTBridge *bridge = [[RCTBridge alloc] initWithBundleURL:bundleURL moduleProvider:nil launchOptions:launchOptions]; return [self initWithBridge:bridge moduleName:moduleName initialProperties:initialProperties];&#125; åˆå§‹åŒ–æ–¹æ³•çš„æ ¸å¿ƒæ˜¯ setUp æ–¹æ³•ï¼Œè€Œ setUp æ–¹æ³•çš„ä¸»è¦ä»»åŠ¡åˆ™æ˜¯åˆ›å»º BatchedBridgeã€‚ 123456789101112131415161718192021222324252627282930- (void)setUp &#123; RCT_PROFILE_BEGIN_EVENT(0, @\"-[RCTBridge setUp]\", nil); _performanceLogger = [RCTPerformanceLogger new]; [_performanceLogger markStartForTag:RCTPLBridgeStartup]; [_performanceLogger markStartForTag:RCTPLTTI]; Class bridgeClass = self.bridgeClass; #if RCT_DEV RCTExecuteOnMainQueue(^&#123; RCTRegisterReloadCommandListener(self); &#125;); #endif // Only update bundleURL from delegate if delegate bundleURL has changed NSURL *previousDelegateURL = _delegateBundleURL; _delegateBundleURL = [self.delegate sourceURLForBridge:self]; if (_delegateBundleURL &amp;&amp; ![_delegateBundleURL isEqual:previousDelegateURL]) &#123; _bundleURL = _delegateBundleURL; &#125; // Sanitize the bundle URL _bundleURL = [RCTConvert NSURL:_bundleURL.absoluteString]; self.batchedBridge = [[bridgeClass alloc] initWithParentBridge:self]; [self.batchedBridge start]; RCT_PROFILE_END_EVENT(RCTProfileTagAlways, @\"\");&#125; BatchedBridge çš„ä½œç”¨æ˜¯æ‰¹é‡è¯»å– JavaScript å¯¹ Objective-C çš„æ–¹æ³•è°ƒç”¨ï¼ŒåŒæ—¶å®ƒå†…éƒ¨æŒæœ‰ä¸€ä¸ª JavaScriptExecutorï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™ä¸ªå¯¹è±¡ç”¨æ¥æ‰§è¡Œ JavaScript ä»£ç ã€‚ åˆ›å»º BatchedBridge çš„å…³é”®æ˜¯ start æ–¹æ³•ï¼Œå®ƒå¯ä»¥åˆ†ä¸ºäº”ä¸ªæ­¥éª¤ï¼š è¯»å– JavaScript æºç  åˆå§‹åŒ–æ¨¡å—ä¿¡æ¯ åˆå§‹åŒ– JavaScript ä»£ç çš„æ‰§è¡Œå™¨ï¼Œå³ RCTJSCExecutor å¯¹è±¡ ç”Ÿæˆæ¨¡å—åˆ—è¡¨å¹¶å†™å…¥ JavaScript ç«¯ æ‰§è¡Œ JavaScript æºç  é€ä¸ªåˆ†æä¸Šé¢æ¯ä¸€æ­¥å®Œæˆçš„æ“ä½œï¼š 1.è¯»å–JavaScriptæºç è¿™ä¸€éƒ¨åˆ†çš„å…·ä½“ä»£ç å®ç°æ²¡æœ‰å¤ªå¤§çš„è®¨è®ºæ„ä¹‰ã€‚æˆ‘ä»¬åªè¦æ˜ç™½ï¼ŒJavaScript çš„ä»£ç æ˜¯åœ¨ Objective-C æä¾›çš„ç¯å¢ƒä¸‹è¿è¡Œçš„ï¼Œæ‰€ä»¥ç¬¬ä¸€æ­¥å°±æ˜¯æŠŠ JavaScript åŠ è½½è¿›å†…å­˜ä¸­ï¼Œå¯¹äºä¸€ä¸ªç©ºçš„é¡¹ç›®æ¥è¯´ï¼Œæ‰€æœ‰çš„ JavaScript ä»£ç å¤§çº¦å ç”¨ 1.5 Mb çš„å†…å­˜ç©ºé—´ã€‚ éœ€è¦è¯´æ˜çš„æ˜¯ï¼Œåœ¨è¿™ä¸€æ­¥ä¸­ï¼ŒJSX ä»£ç å·²ç»è¢«è½¬åŒ–æˆåŸç”Ÿçš„ JavaScript ä»£ç ã€‚ 2.åˆå§‹åŒ–æ¨¡å—ä¿¡æ¯è¿™ä¸€æ­¥åœ¨æ–¹æ³• initModulesWithDispatchGroup: ä¸­å®ç°ï¼Œä¸»è¦ä»»åŠ¡æ˜¯æ‰¾åˆ°æ‰€æœ‰éœ€è¦æš´éœ²ç»™ JavaScript çš„ç±»ã€‚ æ¯ä¸€ä¸ªéœ€è¦æš´éœ²ç»™ JavaScript çš„ç±»(ä¹Ÿæˆä¸º Moduleï¼Œä»¥ä¸‹ä¸ä½œåŒºåˆ†)éƒ½ä¼šæ ‡è®°ä¸€ä¸ªå®ï¼šRCT_EXPORT_MODULEï¼Œè¿™ä¸ªå®çš„å…·ä½“å®ç°å¹¶ä¸å¤æ‚ 1234#define RCT_EXPORT_MODULE(js_name) \\RCT_EXTERN void RCTRegisterModule(Class); \\+ (NSString *)moduleName &#123; return @#js_name; &#125; \\+ (void)load &#123; RCTRegisterModule(self); &#125; è¿™æ ·ï¼Œè¿™ä¸ªç±»åœ¨ load æ–¹æ³•ä¸­å°±ä¼šè°ƒç”¨ RCTRegisterModule æ–¹æ³•æ³¨å†Œè‡ªå·±ï¼š 1234567void RCTRegisterModule(Class moduleClass) &#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; RCTModuleClasses = [NSMutableArray new]; &#125;); [RCTModuleClasses addObject:moduleClass];&#125; å› æ­¤ï¼ŒReact Native å¯ä»¥é€šè¿‡ RCTModuleClasses æ‹¿åˆ°æ‰€æœ‰æš´éœ²ç»™ JavaScript çš„ç±»ã€‚ä¸‹ä¸€æ­¥æ“ä½œæ˜¯éå†è¿™ä¸ªæ•°ç»„ï¼Œç„¶åç”Ÿæˆ RCTModuleData å¯¹è±¡ï¼š 12345for (Class moduleClass in RCTGetModuleClasses()) &#123; RCTModuleData *moduleData = [[RCTModuleData alloc]initWithModuleClass:moduleClass bridge:self]; [moduleClassesByID addObject:moduleClass]; [moduleDataByID addObject:moduleData];&#125; å¯ä»¥æƒ³è§ï¼ŒRCTModuleData å¯¹è±¡æ˜¯æ¨¡å—é…ç½®è¡¨çš„ä¸»è¦ç»„æˆéƒ¨åˆ†ã€‚å¦‚æœæŠŠæ¨¡å—é…ç½®è¡¨æƒ³è±¡æˆä¸€ä¸ªæ•°ç»„ï¼Œé‚£ä¹ˆæ¯ä¸€ä¸ªå…ƒç´ å°±æ˜¯ä¸€ä¸ª RCTModuleData å¯¹è±¡ã€‚ è¿™ä¸ªå¯¹è±¡ä¿å­˜äº† Module çš„åå­—ï¼Œå¸¸é‡ç­‰åŸºæœ¬ä¿¡æ¯ï¼Œæœ€é‡è¦çš„å±æ€§æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œä¿å­˜äº†æ‰€æœ‰éœ€è¦æš´éœ²ç»™ JavaScript çš„æ–¹æ³•ã€‚ æš´éœ²ç»™ JavaScript çš„æ–¹æ³•éœ€è¦ç”¨ RCT_EXPORT_METHOD è¿™ä¸ªå®æ¥æ ‡è®°ï¼Œå®ƒçš„å®ç°åŸç†æ¯”è¾ƒå¤æ‚ï¼Œæœ‰å…´è¶£çš„è¯»è€…å¯ä»¥è‡ªè¡Œé˜…è¯»ã€‚ç®€å•æ¥è¯´ï¼Œå®ƒä¸ºå‡½æ•°ååŠ ä¸Šäº† rct_export å‰ç¼€ï¼Œå†é€šè¿‡ runtime è·å–ç±»çš„å‡½æ•°åˆ—è¡¨ï¼Œæ‰¾å‡ºå…¶ä¸­å¸¦æœ‰æŒ‡å®šå‰ç¼€çš„æ–¹æ³•å¹¶æ”¾å…¥æ•°ç»„ä¸­: 12345678910- (NSArray&lt;id&lt;RCTBridgeMethod&gt;&gt; *)methods&#123; unsigned int methodCount; Method *methods = class_copyMethodList(object_getClass(_moduleClass), &amp;methodCount); // è·å–æ–¹æ³•åˆ—è¡¨ for (unsigned int i = 0; i &lt; methodCount; i++) &#123; RCTModuleMethod *moduleMethod = /* åˆ›å»º method */ [_methods addObject:moduleMethod]; &#125; &#125; return _methods;&#125; å› æ­¤ Objective-C ç®¡ç†æ¨¡å—é…ç½®è¡¨çš„é€»è¾‘æ˜¯ï¼šBridge æŒæœ‰ä¸€ä¸ªæ•°ç»„ï¼Œæ•°ç»„ä¸­ä¿å­˜äº†æ‰€æœ‰çš„æ¨¡å—çš„ RCTModuleData å¯¹è±¡ï¼ŒRCTModuleDataåˆä¿å­˜äº†ç±»çš„æ–¹æ³•ã€å¸¸äº®ã€ç±»åç­‰ä¿¡æ¯ã€‚åªè¦ç»™å®š ModuleId å’Œ MethodId å°±å¯ä»¥å”¯ä¸€ç¡®å®šè¦è°ƒç”¨çš„æ–¹æ³•ã€‚ 3.åˆå§‹åŒ–JavaScriptæ‰§è¡Œå™¨ï¼ˆRCTJSCExecutorï¼‰é€šè¿‡æŸ¥çœ‹æºç å¯ä»¥çœ‹åˆ°ï¼Œåˆå§‹åŒ– JavaScript æ‰§è¡Œå™¨çš„æ—¶å€™ï¼Œä¼šè°ƒç”¨12345+ (instancetype)initializedExecutorWithContextProvider:(RCTJSContextProvider *)JSContextProvider applicationScript:(NSData *)applicationScript sourceURL:(NSURL *)sourceURL JSContext:(JSContext **)JSContext error:(NSError **)error; è¿”å›çš„ excuter å¯¹è±¡æ˜¯å·²ç»è¢«åŒæ­¥æ‰§è¡Œçš„12345// æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•- (void)callFunctionOnModule:(NSString *)module method:(NSString *)method arguments:(NSArray *)args jsValueCallback:(RCTJavaScriptValueCallback)onComplete&#123; [self _callFunctionOnModule:module method:method arguments:args returnValue:NO unwrapResult:NO callback:onComplete];&#125; è¿™é‡Œéœ€è¦å…³æ³¨ nativeRequireModuleConfig å’Œ nativeFlushQueueImmediate è¿™ä¸¤ä¸ªblockã€‚ åœ¨è¿™ä¸¤ä¸ª block ä¸­ä¼šé€šè¿‡ bridge è°ƒç”¨ oc çš„æ–¹æ³•ã€‚1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192[self executeBlockOnJavaScriptQueue:^&#123; if (!self.valid) &#123; return; &#125; JSContext *context = nil; if (self-&gt;_jscWrapper) &#123; RCTAssert(self-&gt;_context != nil, @\"If wrapper was pre-initialized, context should be too\"); context = self-&gt;_context.context; &#125; else &#123; [self-&gt;_performanceLogger markStartForTag:RCTPLJSCWrapperOpenLibrary]; self-&gt;_jscWrapper = RCTJSCWrapperCreate(self-&gt;_useCustomJSCLibrary); [self-&gt;_performanceLogger markStopForTag:RCTPLJSCWrapperOpenLibrary]; RCTAssert(self-&gt;_context == nil, @\"Didn't expect to set up twice\"); context = [self-&gt;_jscWrapper-&gt;JSContext new]; self-&gt;_context = [[RCTJavaScriptContext alloc] initWithJSContext:context onThread:self-&gt;_javaScriptThread]; [[NSNotificationCenter defaultCenter] postNotificationName:RCTJavaScriptContextCreatedNotification object:context]; configureCacheOnContext(context, self-&gt;_jscWrapper); installBasicSynchronousHooksOnContext(context); &#125; __weak RCTJSCExecutor *weakSelf = self; context[@\"nativeRequireModuleConfig\"] = ^NSString *(NSString *moduleName) &#123; RCTJSCExecutor *strongSelf = weakSelf; if (!strongSelf.valid) &#123; return nil; &#125; RCT_PROFILE_BEGIN_EVENT(RCTProfileTagAlways, @\"nativeRequireModuleConfig\", nil); NSArray *config = [strongSelf-&gt;_bridge configForModuleName:moduleName]; NSString *result = config ? RCTJSONStringify(config, NULL) : nil; RCT_PROFILE_END_EVENT(RCTProfileTagAlways, @\"js_call,config\", @&#123; @\"moduleName\": moduleName &#125;); return result; &#125;; context[@\"nativeFlushQueueImmediate\"] = ^(NSArray&lt;NSArray *&gt; *calls)&#123; RCTJSCExecutor *strongSelf = weakSelf; if (!strongSelf.valid || !calls) &#123; return; &#125; RCT_PROFILE_BEGIN_EVENT(RCTProfileTagAlways, @\"nativeFlushQueueImmediate\", nil); [strongSelf-&gt;_bridge handleBuffer:calls batchEnded:NO]; RCT_PROFILE_END_EVENT(RCTProfileTagAlways, @\"js_call\", nil); &#125;;#if RCT_PROFILE __weak RCTBridge *weakBridge = self-&gt;_bridge; context[@\"nativeTraceBeginAsyncFlow\"] = ^(__unused uint64_t tag, __unused NSString *name, int64_t cookie) &#123; if (RCTProfileIsProfiling()) &#123; [weakBridge.flowIDMapLock lock]; int64_t newCookie = [_RCTProfileBeginFlowEvent() longLongValue]; CFDictionarySetValue(weakBridge.flowIDMap, (const void *)cookie, (const void *)newCookie); [weakBridge.flowIDMapLock unlock]; &#125; &#125;; context[@\"nativeTraceEndAsyncFlow\"] = ^(__unused uint64_t tag, __unused NSString *name, int64_t cookie) &#123; if (RCTProfileIsProfiling()) &#123; [weakBridge.flowIDMapLock lock]; int64_t newCookie = (int64_t)CFDictionaryGetValue(weakBridge.flowIDMap, (const void *)cookie); _RCTProfileEndFlowEvent(@(newCookie)); CFDictionaryRemoveValue(weakBridge.flowIDMap, (const void *)cookie); [weakBridge.flowIDMapLock unlock]; &#125; &#125;;#endif#if RCT_DEV RCTInstallJSCProfiler(self-&gt;_bridge, context.JSGlobalContextRef); // Inject handler used by HMR context[@\"nativeInjectHMRUpdate\"] = ^(NSString *sourceCode, NSString *sourceCodeURL) &#123; RCTJSCExecutor *strongSelf = weakSelf; if (!strongSelf.valid) &#123; return; &#125; RCTJSCWrapper *jscWrapper = strongSelf-&gt;_jscWrapper; JSStringRef execJSString = jscWrapper-&gt;JSStringCreateWithUTF8CString(sourceCode.UTF8String); JSStringRef jsURL = jscWrapper-&gt;JSStringCreateWithUTF8CString(sourceCodeURL.UTF8String); jscWrapper-&gt;JSEvaluateScript(strongSelf-&gt;_context.context.JSGlobalContextRef, execJSString, NULL, jsURL, 0, NULL); jscWrapper-&gt;JSStringRelease(jsURL); jscWrapper-&gt;JSStringRelease(execJSString); &#125;;#endif &#125;];&#125; 4.ç”Ÿæˆæ¨¡å—é…ç½®è¡¨å¹¶å†™å…¥JavaScriptç«¯ å¤ä¹ ä¸€ä¸‹ nativeRequireModuleConfig è¿™ä¸ª Blockï¼Œå®ƒå¯ä»¥æ¥å— ModuleName å¹¶ä¸”ç”Ÿæˆè¯¦ç»†çš„æ¨¡å—ä¿¡æ¯ï¼Œä½†åœ¨å‰æ–‡ä¸­æˆ‘ä»¬æ²¡æœ‰æåˆ° JavaScript æ˜¯å¦‚ä½•çŸ¥é“ Objective-C è¦æš´éœ²å“ªäº›ç±»çš„(ç›®å‰åªæ˜¯ Objective-C è‡ªå·±çŸ¥é“)ã€‚ è¿™ä¸€æ­¥çš„æ“ä½œå°±æ˜¯ä¸ºäº†è®© JavaScript è·å–æ‰€æœ‰æ¨¡å—çš„åå­— 1234567891011121314- (NSString *)moduleConfig &#123; NSMutableArray&lt;NSArray *&gt; *config = [NSMutableArray new]; for (RCTModuleData *moduleData in _moduleDataByID) &#123; if (self.executorClass == [RCTJSCExecutor class]) &#123; [config addObject:@[moduleData.name]]; &#125; else &#123; [config addObject:RCTNullIfNil(moduleData.config)]; &#125; &#125; return RCTJSONStringify(@&#123; @\"remoteModuleConfig\": config, &#125;, NULL);&#125; 5.æ‰§è¡ŒJavaScriptä»£ç  è¿™ä¸€æ­¥ä¹Ÿæ²¡ä»€ä¹ˆæŠ€æœ¯éš¾åº¦å¯ä»¥ï¼Œä»£ç å·²ç»åŠ è½½è¿›äº†å†…å­˜ï¼Œè¯¥åšçš„é…ç½®ä¹Ÿå·²ç»å®Œæˆï¼Œåªè¦æŠŠ JavaScript ä»£ç è¿è¡Œä¸€éå³å¯ã€‚ è¿è¡Œä»£ç æ—¶ï¼Œç¬¬ä¸‰æ­¥ä¸­æ‰€è¯´çš„é‚£äº› Block å°±ä¼šè¢«æ‰§è¡Œï¼Œä»è€Œå‘ JavaScript ç«¯å†™å…¥é…ç½®ä¿¡æ¯ã€‚ è‡³æ­¤ï¼ŒJavaScript å’Œ Objective-C éƒ½å…·å¤‡äº†å‘å¯¹æ–¹äº¤äº’çš„èƒ½åŠ›ï¼Œå‡†å¤‡å·¥ä½œä¹Ÿå°±å…¨éƒ¨å®Œæˆäº†ã€‚ æ–¹æ³•è°ƒç”¨å¦‚å‰æ–‡æ‰€è¿°ï¼Œåœ¨ React Native ä¸­ï¼ŒObjective-C å’Œ JavaScript çš„äº¤äº’éƒ½æ˜¯é€šè¿‡ä¼ é€’ ModuleIdã€MethodId å’Œ Arguments è¿›è¡Œçš„ã€‚ä»¥ä¸‹æ˜¯åˆ†æƒ…å†µè®¨è®º OC è°ƒç”¨ JavaScriptä¹Ÿè®¸ä½ åœ¨å…¶ä»–æ–‡ç« ä¸­æ›¾ç»å¤šæ¬¡å¬è¯´ JavaScript ä»£ç æ€»æ˜¯åœ¨ä¸€ä¸ªå•ç‹¬çš„çº¿ç¨‹ä¸Šé¢è°ƒç”¨ï¼Œå®ƒçš„å®é™…å«ä¹‰æ˜¯ Objective-C ä¼šåœ¨å•ç‹¬çš„çº¿ç¨‹ä¸Šè¿è¡Œ JavaScript ä»£ç  12345678- (void)executeBlockOnJavaScriptQueue:(dispatch_block_t)block &#123; if ([NSThread currentThread] != _javaScriptThread) &#123; [self performSelector:@selector(executeBlockOnJavaScriptQueue:) onThread:_javaScriptThread withObject:block waitUntilDone:NO]; &#125; else &#123; block(); &#125;&#125; è°ƒç”¨JavaScriptçš„æ ¸å¿ƒä»£ç å¦‚ä¸‹ 12345678910- (void)_executeJSCall:(NSString *)method arguments:(NSArray *)arguments callback:(RCTJavaScriptCallback)onComplete&#123; [self executeBlockOnJavaScriptQueue:^&#123; // è·å– contextJSRefã€methodJSRefã€moduleJSRef resultJSRef = JSObjectCallAsFunction(contextJSRef, (JSObjectRef)methodJSRef, (JSObjectRef)moduleJSRef, arguments.count, jsArgs, &amp;errorJSRef); objcValue = /*resultJSRef è½¬æ¢æˆ Objective-C ç±»å‹*/ onComplete(objcValue, nil); &#125;];&#125; éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¿™ä¸ªå‡½æ•°åæ˜¯æˆ‘ä»¬è¦è°ƒç”¨ JavaScript çš„ä¸­è½¬å‡½æ•°åï¼Œæ¯”å¦‚ callFunctionReturnFlushedQueueã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒçš„ä½œç”¨å…¶å®æ˜¯å¤„ç†å‚æ•°ï¼Œè€ŒéçœŸæ­£è¦è°ƒç”¨çš„ JavaScript å‡½æ•°ã€‚ åœ¨å®é™…ä½¿ç”¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·å‘èµ·å¯¹ JavaScript çš„è°ƒç”¨ï¼š 12[_bridge.eventDispatcher sendAppEventWithName:@\"greeted\" body:@&#123; @\"name\": @\"nmae\"&#125;]; è¿™é‡Œçš„ Name å’Œ Body å‚æ•°åˆ†åˆ«è¡¨ç¤ºè¦è°ƒç”¨çš„ JavaScript çš„å‡½æ•°åå’Œå‚æ•°ã€‚ JavaScriptè°ƒç”¨OCåœ¨è°ƒç”¨ Objective-C ä»£ç æ—¶ï¼Œå¦‚å‰æ–‡æ‰€è¿°ï¼ŒJavaScript ä¼šè§£æå‡ºæ–¹æ³•çš„ ModuleIdã€MethodId å’Œ Arguments å¹¶æ”¾å…¥åˆ° MessageQueue ä¸­ï¼Œç­‰å¾… Objective-C ä¸»åŠ¨æ‹¿èµ°ï¼Œæˆ–è€…è¶…æ—¶åä¸»åŠ¨å‘é€ç»™ Objective-Cã€‚ Objective-C è´Ÿè´£å¤„ç†è°ƒç”¨çš„æ–¹æ³•æ˜¯ handleBufferï¼Œå®ƒçš„å‚æ•°æ˜¯ä¸€ä¸ªå«æœ‰å››ä¸ªå…ƒç´ çš„æ•°ç»„ï¼Œæ¯ä¸ªå…ƒç´ ä¹Ÿéƒ½æ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œåˆ†åˆ«å­˜æ”¾äº† ModuleIdã€MethodIdã€Paramsï¼Œç¬¬å››ä¸ªå…ƒç´ ç›®æµ‹ç”¨å¤„ä¸å¤§ã€‚ å‡½æ•°å†…éƒ¨åœ¨æ¯ä¸€æ¬¡æ–¹è°ƒç”¨ä¸­è°ƒç”¨ _handleRequestNumber:moduleID:methodID:params æ–¹æ³•ï¼Œé€šè¿‡æŸ¥æ‰¾æ¨¡å—é…ç½®è¡¨æ‰¾å‡ºè¦è°ƒç”¨çš„æ–¹æ³•ï¼Œå¹¶é€šè¿‡ runtime åŠ¨æ€çš„è°ƒç”¨ï¼š æ¼”ç¤ºJavaScriptè°ƒç”¨OCæ–¹æ³•: 123456789101112131415161718//.hæ–‡ä»¶#import &lt;Foundation/Foundation.h&gt;#import \"RCTBridge.h\"#import \"RCTLog.h\"#import \"EncryptUtil.h\"#import \"RSA.h\"@interface CryptoExport : NSObject&lt;RCTBridgeModule&gt;@end//.mæ–‡ä»¶#import \"CryptoExport.h\"@implementation CryptoExportRCT_EXPORT_MODULE()//å¿…é¡»å®šä¹‰çš„å®RCT_EXPORT_METHOD(rsaEncryptValue:(NSString *)src withKey:(NSString *)rsaKey successCallback:(RCTResponseSenderBlock)successCallback)&#123; NSString *rsaValue = [RSA encryptString:src publicKey:rsaKey]; successCallback(@[rsaValue]);&#125;@end æ¯ä¸ªocçš„æ–¹æ³•å‰å¿…é¡»åŠ ä¸Š RCT_EXPORT_METHOD å®ï¼Œç”¨æ¥æ³¨å†Œæ¨¡å—è¡¨ã€‚ åœ¨JavaScriptä¸­çš„è°ƒåŠ¨å¦‚ä¸‹ 123NativeModules.CryptoExport.rsaEncryptValue(value, rsaKey,function (rsaValue) &#123; console.log(rsaValue)&#125;); React Native æ›´æ–°æœºåˆ¶ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒReactæ˜¯çŠ¶æ€æœºï¼Œå°±æ˜¯ä¸åœçš„å»æ£€æŸ¥å½“å‰çš„çŠ¶æ€ï¼Œåˆ¤æ–­æ˜¯å¦éœ€è¦åˆ·æ–°ã€‚ è°ƒç”¨this.setState123ReactClass.prototype.setState = function(newState) &#123; this._reactInternalInstance.receiveComponent(null, newState);&#125; è°ƒç”¨å†…éƒ¨receiveComponentæ–¹æ³•ï¼Œè¿™é‡Œåœ¨æ¥å—å…ƒç´ çš„æ—¶å€™ä¸»è¦åˆ†ä¸‰ç§æƒ…å†µï¼š æ–‡æœ¬å…ƒç´  åŸºæœ¬å…ƒç´  è‡ªå®šä¹‰å…ƒç´  æ–‡æœ¬å…ƒç´ 1234567891011121314151617ReactDOMTextComponent.prototype.receiveComponent(nextText, transaction) &#123; //è·Ÿä»¥å‰ä¿å­˜çš„å­—ç¬¦ä¸²æ¯”è¾ƒ if (nextText !== this._currentElement) &#123; this._currentElement = nextText; var nextStringText = '' + nextText; if (nextStringText !== this._stringText) &#123; this._stringText = nextStringText; var commentNodes = this.getHostNode(); // æ›¿æ¢æ–‡æœ¬å…ƒç´  DOMChildrenOperations.replaceDelimitedText( commentNodes[0], commentNodes[1], nextStringText ); &#125; &#125; &#125; åŸºæœ¬å…ƒç´ 12345ReactDOMComponent.prototype.receiveComponent = function(nextElement, transaction, context) &#123; var prevElement = this._currentElement; this._currentElement = nextElement; this.updateComponent(transaction, prevElement, nextElement, context);&#125; updateComponent æ–¹æ³•12345678910111213ReactDOMComponent.prototype.updateComponent = function(transaction, prevElement, nextElement, context) &#123; // ç•¥..... //éœ€è¦å•ç‹¬çš„æ›´æ–°å±æ€§ this._updateDOMProperties(lastProps, nextProps, transaction, isCustomComponentTag); //å†æ›´æ–°å­èŠ‚ç‚¹ this._updateDOMChildren( lastProps, nextProps, transaction, context ); // ......&#125; è‡ªå®šä¹‰å…ƒç´ 123456789101112ReactCompositeComponent.prototype.receiveComponent = function(nextElement, transaction, nextContext) &#123; var prevElement = this._currentElement; var prevContext = this._context; this._pendingElement = null; this.updateComponent( transaction, prevElement, nextElement, prevContext, nextContext );&#125; updateComponent æ–¹æ³•123456789ReactCompositeComponent.prototype.updateComponent = function( transaction, prevParentElement, nextParentElement, prevUnmaskedContext, nextUnmaskedContext)&#123;//çœç•¥&#125; è°ƒç”¨å†…éƒ¨ _performComponentUpdate æ–¹æ³•123456789101112131415161718192021222324252627282930313233343536ReactCompositeComponent.prototype._updateRenderedComponentWithNextElement = function() &#123; // åˆ¤å®šä¸¤ä¸ªelementéœ€ä¸éœ€è¦æ›´æ–° if (shouldUpdateReactComponent(prevRenderedElement, nextRenderedElement)) &#123; // å¦‚æœéœ€è¦æ›´æ–°ï¼Œå°±ç»§ç»­è°ƒç”¨å­èŠ‚ç‚¹çš„receiveComponentçš„æ–¹æ³•ï¼Œä¼ å…¥æ–°çš„elementæ›´æ–°å­èŠ‚ç‚¹ã€‚ ReactReconciler.receiveComponent( prevComponentInstance, nextRenderedElement, transaction, this._processChildContext(context) ); &#125; else &#123; // å¸è½½ä¹‹å‰çš„å­èŠ‚ç‚¹ï¼Œå®‰è£…æ–°çš„å­èŠ‚ç‚¹ var oldHostNode = ReactReconciler.getHostNode(prevComponentInstance); ReactReconciler.unmountComponent( prevComponentInstance, safely, false /* skipLifecycle */ ); var nodeType = ReactNodeTypes.getType(nextRenderedElement); this._renderedNodeType = nodeType; var child = this._instantiateReactComponent( nextRenderedElement, nodeType !== ReactNodeTypes.EMPTY /* shouldHaveDebugID */ ); this._renderedComponent = child; var nextMarkup = ReactReconciler.mountComponent( child, transaction, this._hostParent, this._hostContainerInfo, this._processChildContext(context), debugID ); &#125; this._updateDOMChildren æ–¹æ³•å†…éƒ¨è°ƒç”¨diffç®—æ³• å®ç°è¿‡ç¨‹1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283_updateChildren: function(nextNestedChildrenElements, transaction, context) &#123; var prevChildren = this._renderedChildren; var removedNodes = &#123;&#125;; var mountImages = []; // è·å–æ–°çš„å­å…ƒç´ æ•°ç»„ var nextChildren = this._reconcilerUpdateChildren( prevChildren, nextNestedChildrenElements, mountImages, removedNodes, transaction, context ); if (!nextChildren &amp;&amp; !prevChildren) &#123; return; &#125; var updates = null; var name; var nextIndex = 0; var lastIndex = 0; var nextMountIndex = 0; var lastPlacedNode = null; for (name in nextChildren) &#123; if (!nextChildren.hasOwnProperty(name)) &#123; continue; &#125; var prevChild = prevChildren &amp;&amp; prevChildren[name]; var nextChild = nextChildren[name]; if (prevChild === nextChild) &#123; // åŒä¸€ä¸ªå¼•ç”¨ï¼Œè¯´æ˜æ˜¯ä½¿ç”¨çš„åŒä¸€ä¸ªcomponent,æ‰€ä»¥æˆ‘ä»¬éœ€è¦åšç§»åŠ¨çš„æ“ä½œ // ç§»åŠ¨å·²æœ‰çš„å­èŠ‚ç‚¹ // NOTICEï¼šè¿™é‡Œæ ¹æ®nextIndex, lastIndexå†³å®šæ˜¯å¦ç§»åŠ¨ updates = enqueue( updates, this.moveChild(prevChild, lastPlacedNode, nextIndex, lastIndex) ); // æ›´æ–°lastIndex lastIndex = Math.max(prevChild._mountIndex, lastIndex); // æ›´æ–°componentçš„.mountIndexå±æ€§ prevChild._mountIndex = nextIndex; &#125; else &#123; if (prevChild) &#123; // æ›´æ–°lastIndex lastIndex = Math.max(prevChild._mountIndex, lastIndex); &#125; // æ·»åŠ æ–°çš„å­èŠ‚ç‚¹åœ¨æŒ‡å®šçš„ä½ç½®ä¸Š updates = enqueue( updates, this._mountChildAtIndex( nextChild, mountImages[nextMountIndex], lastPlacedNode, nextIndex, transaction, context ) ); nextMountIndex++; &#125; // æ›´æ–°nextIndex nextIndex++; lastPlacedNode = ReactReconciler.getHostNode(nextChild); &#125; // ç§»é™¤æ‰ä¸å­˜åœ¨çš„æ—§å­èŠ‚ç‚¹ï¼Œå’Œæ—§å­èŠ‚ç‚¹å’Œæ–°å­èŠ‚ç‚¹ä¸åŒçš„æ—§å­èŠ‚ç‚¹ for (name in removedNodes) &#123; if (removedNodes.hasOwnProperty(name)) &#123; updates = enqueue( updates, this._unmountChild(prevChildren[name], removedNodes[name]) ); &#125; &#125; &#125; ä»¥ä¸‹æ˜¯é’ˆå¯¹ Demo é¡¹ç›®çš„é€šä¿¡åŸç†è§£é‡Š é€šä¿¡åŸºæœ¬åŸç†é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨iOSä¸­Nativeå¦‚ä½•è°ƒç”¨JSã€‚ä»iOS7å¼€å§‹ï¼Œç³»ç»Ÿè¿›ä¸€æ­¥å¼€æ”¾äº†WebCore SDKï¼Œæä¾›JavaScriptå¼•æ“åº“ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥ä¸å¼•æ“äº¤äº’æ‹¥æœ‰æ›´å¤šçš„æ§åˆ¶æƒã€‚å…¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªæœ€åŸºç¡€çš„æ¦‚å¿µï¼š 12JSContext // JSä»£ç çš„ç¯å¢ƒï¼Œä¸€ä¸ªJSContextæ˜¯ä¸€ä¸ªå…¨å±€ç¯å¢ƒçš„å®ä¾‹JSValue // åŒ…è£…äº†æ¯ä¸€ä¸ªå¯èƒ½çš„JSå€¼ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å¯¹è±¡ã€æ–¹æ³•ç­‰ é€šè¿‡è¿™ä¸¤ä¸ªç±»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸æ–¹ä¾¿çš„å®ç°Javascriptä¸Nativeä»£ç ä¹‹é—´çš„äº¤äº’ï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹æ¥è§‚å¯ŸNativeå¦‚ä½•è°ƒç”¨Javascriptä»£ç ï¼š ğŸŒ°ï¼šNative -&gt; JavaScript 1234567891011121314// å¤´æ–‡ä»¶#import &lt;JavaScriptCore/JSContext.h&gt;#import &lt;JavaScriptCore/JSValue.h&gt;- (void)createJSContext &#123; JSContext *context = [[JSContext alloc] init]; [context evaluateScript:@\"var num = 5 + 5\"]; [context evaluateScript:@\"var names = ['Grace', 'Ada', 'Margaret']\"]; [context evaluateScript:@\"var triple = function(value) &#123; return value * 3 &#125;\"]; JSValue *tripleNum = [context evaluateScript:@\"triple(num)\"]; JSValue *tripleFunction = context[@\"triple\"]; JSValue *result = [tripleFunction callWithArguments:@[@5]]; // æ‰“å°ç»“æœ NSLog(@\"JSContext function \\ntripleNum:%@ \\nresult:%@\", tripleNum, result);&#125; é‚£ä¹ˆï¼ŒJSContextå¦‚ä½•è®¿é—®æˆ‘ä»¬æœ¬åœ°å®¢æˆ·ç«¯OCä»£ç å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡Blockså’ŒJSExportsåè®®ä¸¤ç§æ–¹å¼ã€‚æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé€šè¿‡Blocksæ¥å®ç°JSè®¿é—®æœ¬åœ°ä»£ç çš„ç¤ºä¾‹ï¼š ğŸŒ°ï¼šJavaScript -&gt; Native 1234567context[@\"testSay\"] = ^(NSString *input) &#123; NSMutableString *mutableString = [input mutableCopy]; CFStringTransform((__bridge CFMutableStringRef)mutableString, NULL, kCFStringTransformToLatin, NO); CFStringTransform((__bridge CFMutableStringRef)mutableString, NULL, kCFStringTransformStripCombiningMarks, NO); return mutableString;&#125;;NSLog(@\"%@\", [context evaluateScript:@\"testSay('hello world')\"]); å…³äºJSCoreåº“çš„æ›´å¤šå­¦ä¹ ä»‹ç»ï¼Œè¯·çœ‹JavaScriptCoreã€‚ Javaâ€‹Scriptâ€‹Core ç›¸å…³ä»‹ç» http://nshipster.cn/javascriptcore/ React Native åˆå§‹åŒ–è¿‡ç¨‹è§£æåœ¨äº†è§£React-Nativeä¸­JS-&gt;Nativeçš„å…·ä½“è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œçœ‹çœ‹æ¡†æ¶ä¸­Native appçš„å¯åŠ¨è¿‡ç¨‹ã€‚æ‰“å¼€FBæä¾›çš„AwesomeProjectå®šä½åˆ°appDelegateçš„didFinishLaunchingWithOptionsæ–¹æ³•ä¸­ï¼š 12345678910111213// æŒ‡å®šJSé¡µé¢æ–‡ä»¶ä½ç½®jsCodeLocation = [NSURL URLWithString:@\"http://localhost:8081/index.ios.bundle?platform=ios&amp;dev=false\"];// åˆ›å»ºReact Nativeè§†å›¾å¯¹è±¡RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocationmoduleName:@\"ReactExperiment\"initialProperties:nillaunchOptions:launchOptions];self.window = [[UIWindow alloc] initWithFrame:[UIScreen mainScreen].bounds];// åˆ›å»ºVCï¼Œå¹¶ä¸”æŠŠReact Native Root Viewèµ‹å€¼ç»™VCUIViewController *rootViewController = [UIViewController new];rootViewController.view = rootView;self.window.rootViewController = rootViewController;[self.window makeKeyAndVisible]; å¯ä»¥çœ‹åˆ°ä½¿ç”¨é›†æˆéå¸¸ç®€å•ï¼Œé‚£ä¹ˆRCTRootViewåˆ°åº•åšäº†å“ªäº›äº‹æƒ…æœ€åæ¸²æŸ“å°†è§†å›¾å‘ˆç°åœ¨ç”¨æˆ·é¢å‰å‘¢ï¼Ÿæˆ‘ä»¬ç»§ç»­è·Ÿç€ä»£ç å¾€ä¸‹åˆ†æå°±ä¼šçœ‹åˆ°æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’RCTBridgeã€‚ ğŸ¥Ÿï¼šRCTBridge 123456789- (instancetype)initWithBundleURL:(NSURL *)bundleURLmoduleName:(NSString *)moduleNameinitialProperties:(NSDictionary *)initialPropertieslaunchOptions:(NSDictionary *)launchOptions &#123; RCTBridge *bridge = [[RCTBridge alloc] initWithBundleURL:bundleURL moduleProvider:nil launchOptions:launchOptions]; return [self initWithBridge:bridge moduleName:moduleName initialProperties:initialProperties];&#125; RCTBridgeæ˜¯Naitiveç«¯çš„bridgeï¼Œèµ·ç€æ¡¥æ¥ä¸¤ç«¯çš„ä½œç”¨ ã€‚äº‹å®ä¸Šå…·ä½“çš„å®ç°æ”¾ç½®åœ¨RCTBatchedBridgeä¸­ï¼Œåœ¨å®ƒçš„startæ–¹æ³•ä¸­æ‰§è¡Œäº†ä¸€ç³»åˆ—é‡è¦çš„åˆå§‹åŒ–å·¥ä½œã€‚è¿™éƒ¨åˆ†ä¹Ÿæ˜¯ReactNative SDKçš„ç²¾é«“æ‰€åœ¨ï¼ŒåŸºäºGCDå®ç°ä¸€å¥—å¼‚æ­¥åˆå§‹åŒ–ç»„ä»¶æ¡†æ¶ã€‚å¤§è‡´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Load JS Source Codeï¼ˆå¹¶è¡Œï¼‰åŠ è½½é¡µé¢æºç é˜¶æ®µã€‚è¯¥é˜¶æ®µä¸»è¦è´Ÿè´£ä»æŒ‡å®šçš„ä½ç½®ï¼ˆç½‘ç»œæˆ–è€…æœ¬åœ°ï¼‰åŠ è½½React Nativeé¡µé¢ä»£ç ã€‚ä¸initModuleså„æ¨¡å—åˆå§‹åŒ–è¿‡ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œé€šè¿‡GCDåˆ†ç»„é˜Ÿåˆ—ä¿è¯ä¸¤ä¸ªé˜¶æ®µå®Œæˆåæ‰ä¼šåŠ è½½è§£æé¡µé¢æºç ã€‚ Init Moduleï¼ˆåŒæ­¥ï¼‰åˆå§‹åŒ–åŠ è½½React Nativeæ¨¡å—ã€‚è¯¥é˜¶æ®µä¼šå°†æ‰€æœ‰æ³¨å†Œçš„Nativeæ¨¡å—ç±»æ•´ç†ä¿å­˜åˆ°ä¸€ä¸ªä»¥Module Idä¸ºä¸‹æ ‡çš„æ•°ç»„å¯¹è±¡ä¸­ï¼ˆåŒæ—¶è¿˜ä¼šä¿å­˜ä¸€ä¸ªä»¥Module Nameä¸ºKeyçš„Dictionaryï¼Œç”¨äºåšç´¢å¼•æ–¹ä¾¿åç»­çš„æ¨¡å—æŸ¥æ‰¾ï¼‰ã€‚ æ•´ä¸ªæ¨¡å—çš„åŸºç¡€åˆå§‹åŒ–å’Œæ³¨å†Œè¿‡ç¨‹åœ¨ç³»ç»ŸLoad Classé˜¶æ®µå°±ä¼šå®Œæˆã€‚React Nativeå¯¹æ¨¡å—æ³¨å†Œçš„å®ç°è¿˜æ˜¯æ¯”è¾ƒå·§å¦™ã€æ–¹ä¾¿ï¼Œåªéœ€è¦å¯¹ç›®æ ‡ç±»æ·»åŠ ç›¸åº”çš„å®å³å¯ã€‚ 1.æ³¨å†Œæ¨¡å—ã€‚å®ç°RCTBridgeModuleåè®®ï¼Œå¹¶ä¸”åœ¨å“åº”çš„Implementionæ–‡ä»¶ä¸­æ·»åŠ RCT_EXPORT_MODULEå®ï¼Œè¯¥å®ä¼šä¸ºæ‰€åœ¨ç±»è‡ªåŠ¨æ·»åŠ ä¸€ä¸ª+loadæ–¹æ³•ï¼Œè°ƒç”¨RCTBridgeçš„RCTRegisterModuleå®ç°åœ¨Load Classé˜¶æ®µå°±å®Œæˆæ¨¡å—æ³¨å†Œå·¥ä½œã€‚ 2.æ³¨å†Œå‡½æ•°ã€‚å¾…æ³¨å†Œå‡½æ•°æ‰€åœ¨çš„ç±»å¿…é¡»æ˜¯å·²æ³¨å†Œæ¨¡å—ï¼Œåœ¨éœ€è¦æ³¨å†Œçš„å‡½æ•°å‰æ·»åŠ RCT_EXPORT_MODULEå®å³å¯ã€‚ å½“ç„¶è¿™é‡Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯æ¨¡å—åˆå§‹åŒ–æ˜¯ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ï¼Œå®ƒå¿…é¡»è¢«åŒæ­¥åŠ è½½ï¼Œæ‰€ä»¥å½“æ¨¡å—è¾ƒå¤šæ—¶åŠ¿å¿…ä¼šå¸¦æ¥é«˜å»¶è¿Ÿçš„é—®é¢˜ï¼Œä¹Ÿæ˜¯åœ¨æ–°çš„ç‰ˆæœ¬ä¸­SDKå°†Module Methodæ”¹ä¸ºLazy Loadçš„åŸå› ä¹‹ä¸€ã€‚ Setup JS Executorï¼ˆå¹¶è¡Œï¼‰åˆå§‹åŒ–JSå¼•æ“ã€‚React Nativeåœ¨0.18ä¸­å·²ç»å¾ˆå¥½çš„æŠ½è±¡äº†åŸæ¥äº†JSExecutorï¼Œç›®å‰å®ç°äº†RCTWebSocketExecutorå’ŒRCTJSCExecutorä¸¤ä¸ªè„šæœ¬å¼•æ“çš„å°è£…ï¼Œå‰è€…ç”¨äºé€šè¿‡WebSocketé“¾æ¥åˆ°Chromeè°ƒè¯•ï¼Œåè€…åˆ™æ˜¯å†…ç½®é»˜è®¤å¼•æ“ç›´æ¥é€šè¿‡IOS SDK JSContextæ¥å®ç°ç›¸å…³çš„é€»è¾‘ã€‚ å¦å¤–ï¼Œåœ¨æœ¬é˜¶æ®µè¿˜ä¼šé€šè¿‡block hookçš„æ–¹å¼æ³¨å†Œéƒ¨åˆ†æ ¸å¿ƒAPI 1.nativeRequireModuleConfigï¼šç”¨äºåœ¨JSç«¯è·å–å¯¹åº”çš„Native Moduleï¼Œåœ¨0.14åçš„ç‰ˆæœ¬React Nativeå·²ç»å¯¹åˆå§‹åŒ–æ¨¡å—åšäº†éƒ¨åˆ†ä¼˜åŒ–ï¼ŒæŠŠå…³äºNative Module Methodéƒ¨åˆ†çš„åŠ è½½å·¥ä½œæ”¾ç½®åœ¨requireModuleConfigæ—¶æ‰åš 2.nativeLoggingHookï¼šè°ƒç”¨Nativeå†™å…¥æ—¥å¿— 3.nativeFlushQueueImmediateï¼šæ‰‹åŠ¨è§¦å‘æ‰§è¡Œå½“å‰Native Callé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„Nativeå¤„ç†è¯·æ±‚ 4.nativePerformanceNowï¼šç”¨äºæ€§èƒ½ç»Ÿè®¡ï¼Œè·å–å½“å‰Nativeçš„ç»å¯¹æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰ å¯¹äºæ¨¡å—ç±»ä¸­æƒ³è¦å£°æ˜çš„æ–¹æ³•ï¼Œéœ€è¦æ·»åŠ RCT_EXPORT_METHODå®ã€‚å®ƒä¼šç»™æ–¹æ³•åæ·»åŠ â€ rct_export â€œå‰ç¼€ã€‚ ğŸŒ°ï¼šReact è°ƒç”¨ Native çš„ SVProgressHUD æç¤ºçª— åœ¨ Native ä¸­å£°æ˜æ–¹æ³•1234RCT_EXPORT_METHOD(calliOSActionWithOneParams:(NSString *)name) &#123; [SVProgressHUD setDefaultMaskType:SVProgressHUDMaskTypeBlack]; [SVProgressHUD showSuccessWithStatus:[NSString stringWithFormat:@\"å‚æ•°ï¼š%@\",name]];&#125; åœ¨ React ä¸­è°ƒç”¨ calliOSActionWithOneParams æ–¹æ³•123456&lt;TouchableOpacity style=&#123;styles.calltonative&#125; onPress=&#123;()=&gt;&#123; RNCalliOSAction.calliOSActionWithOneParams('hello'); &#125;&#125;&gt; &lt;Text&gt;ç‚¹å‡»è°ƒç”¨ Native æ–¹æ³•, å¹¶ä¼ é€’ä¸€ä¸ªå‚æ•°&lt;/Text&gt;&lt;/TouchableOpacity&gt; Module Configï¼ˆå¹¶è¡Œï¼‰è¿™æ­¥å°†ç¬¬2æ­¥ä¸­çš„Nativeæ¨¡å—ç±»è½¬æ¢æˆJsonï¼Œä¿å­˜ä¸ºremoteModuleConfigã€‚æ³¨æ„åœ¨è¿™é‡Œè·å–åˆ°çš„åˆ—è¡¨å¹¶éå«æœ‰å®Œæ•´æ¨¡å—ä¿¡æ¯ï¼Œè€Œä»…ä»…æ˜¯ä¸€ä¸ªModule Listè€Œå·²ã€‚ 1234567891011121314151617&#123;\"remoteModuleConfig\":[[\"HTSimpleAPI\", // module],[\"RCTViewManager\",],[\"HTTestView\",],[\"RCTAccessibilityManager\",],...],&#125; JS Source Codeä»£ç åˆ†æJSçš„ä¸»å…¥å£index.ios.jsåœ¨æˆ‘ä»¬çœ‹æ¥åªæœ‰çŸ­çŸ­æ•°åè¡Œï¼Œç„¶è€Œè¿™ä¸æ˜¯æœ€ç»ˆæ‰§è¡Œçš„ä»£ç ã€‚React-Nativeé¡µé¢æºç éœ€è¦é€šè¿‡Transform Serverè½¬æ¢å¤„ç†ï¼Œå¹¶æŠŠè½¬åŒ–åçš„æ¨¡å—ä¸€èµ·åˆå¹¶ä¸ºä¸€ä¸ªbundle.jsï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºbuildBundleã€‚è½¬æ¢åçš„index.ios.bundleæ‰æ˜¯æœ€ç»ˆå¯è¢«Javascriptå¼•æ“ç›´æ¥è§£é‡Šè¿è¡Œçš„ä»£ç ã€‚ä¸‹é¢æˆ‘ä»¬æŒ‰ç…§ä¸»ç¨‹åºçš„é€»è¾‘æ¥åˆ†ææºç å‡ ä¸ªæ ¸å¿ƒæ¨¡å—å®ç°åŸç†ã€‚ åœ¨React Serverä¸­éœ€è¦æŸ¥çœ‹Bundleçš„æ¨¡å—æ˜ å°„å…³ç³»å¯ä»¥ç›´æ¥è®¿é—®ï¼šhttp://localhost:8081/index.ios.bundle.mapï¼ŒæŸ¥çœ‹ç›¸å…³ä¾èµ–å’ŒBundleçš„ç¼“å­˜åˆ™å¯ä»¥è®¿é—®ï¼š http://localhost:8081/debug 1.BatchedBridge åœ¨ä¸Šä¸€éƒ¨åˆ†æˆ‘ä»¬çŸ¥é“ï¼ŒNativeå®Œæˆæ¨¡å—åˆå§‹åŒ–åä¼šé€šè¿‡Inject Json Configå°†é…ç½®ä¿¡æ¯åŒæ­¥è‡³JSé‡Œä¸­çš„å…¨å±€å˜é‡__fbBatchedBridgeConfigï¼Œæ‰“å¼€BatchedBridge.jsæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ã€‚ 123456789__d('BatchedBridge',function(global, require, module, exports) &#123; 'use strict';var MessageQueue=require('MessageQueue');var BatchedBridge=new MessageQueue(__fbBatchedBridgeConfig.remoteModuleConfig,__fbBatchedBridgeConfig.localModulesConfig);//......Object.defineProperty(global,'__fbBatchedBridge',&#123;value:BatchedBridge&#125;);module.exports = BatchedBridge;&#125;); å¯¹äºè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ä¸ªç»“è®ºï¼š 1.åœ¨JSç«¯ä¹Ÿå­˜åœ¨ä¸€ä¸ªbridgeæ¨¡å—BatchedBridgeï¼Œä¹Ÿæ˜¯ä¸Nativeå»ºç«‹åŒå‘é€šä¿¡çš„å…³é”®æ‰€åœ¨ 2.BatchedBridgeæ˜¯ä¸€ä¸ªMessageQueueå®ä¾‹ï¼Œå®ƒåœ¨åˆ›å»ºæ—¶ä¼ å…¥äº†__fbBatchedBridgeConfigå€¼ä¿å­˜Nativeç«¯æ”¯æŒçš„æ¨¡å—åˆ—è¡¨é…ç½® BatchedBridgeåœ¨åˆ›å»ºæ—¶å°†è‡ªå·±å†™å…¥å…¨å±€å˜é‡fbBatchedBridgeä¸Šï¼Œè¿™æ ·Nativeå¯ä»¥é€šè¿‡JSContext[@â€fbBatchedBridgeâ€]è®¿é—®åˆ°JS bridgeå¯¹è±¡ã€‚ 2.MessageQueue æ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹MessageQueueï¼Œå®ƒåœ¨æ•´ä¸ªé€šè®¯é“¾è·¯çš„æœºåˆ¶ä¸Šé¢æœ‰ç€é‡è¦ä½œç”¨ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹å®ƒçš„æ„é€ å‡½æ•°ã€‚ 1234567891011121314constructor(remoteModules, localModules) &#123;this.RemoteModules = &#123;&#125;;this._callableModules = &#123;&#125;;this._queue = [[], [], [], 0];this._moduleTable = &#123;&#125;;this._methodTable = &#123;&#125;;this._callbacks = [];this._callbackID = 0;this._callID = 0;//......let modulesConfig = this._genModulesConfig(remoteModules);this._genModules(modulesConfig);//......&#125; ä»æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¤§è‡´èƒ½äº†è§£MessageQueueçš„å‡ ä¸ªä¿¡æ¯ï¼š 1.RemoteModuleså±æ€§ï¼Œç”¨äºä¿å­˜Nativeç«¯æ¨¡å—é…ç½® 2.Callbackså±æ€§ç¼“å­˜jsçš„å›è°ƒæ–¹æ³• 3.Queueäº‹ä»¶é˜Ÿåˆ—ç”¨äºå¤„ç†å„ç±»äº‹ä»¶ç­‰ åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè§£æNativeä¼ å…¥çš„remoteModules JSONï¼Œè½¬æ¢æˆJSå¯¹è±¡ 3.Config Modules æ ¹æ®ä¸Šä¸€æ­¥MessageQueueçš„é€»è¾‘ï¼Œç»§ç»­å¾€ä¸‹è·Ÿè¸ª_genModuleså‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°åœ¨MessageQueueå·²ç»å¯¹Nativeæ³¨å…¥çš„Module Configåšäº†ä¸€æ¬¡é¢„å¤„ç†ï¼Œå¦‚æœdebugæ¨¡å¼å¯ä»¥çœ‹åˆ°å¤§è‡´çš„æ•°æ®ç»“æ„ä¼šè½¬æ¢æˆå¦‚ä¸‹è¡¨ä¸­æ‰€ç¤ºç»“æ„ï¼ˆå…¶ä¸­HTSimepleAPIæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—ï¼‰ã€‚ 1234config = [\"HTSimpleAPI\", Array[1]], moduleID = 0config = null, moduleID = 1config = null, moduleID = 2config = [\"RCTAccessibilityManager\", Array[3]], moduleID = 3 è‡³äºè¿™æ ·çš„é¢„å¤„ç†æœ‰ä»€ä¹ˆä½œç”¨ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹åˆ†æï¼Œåé¢å†æ¥æ€»ç»“ã€‚ 4.Lazily Config Methods å¯¹äºNativeModuleï¼Œå®ƒä»¬åœ¨ä¸Šä¸€æ­¥ä¹‹ååªæœ‰ä¸€ä¸ªåŒ…å«Module Nameç­‰ç®€å•ä¿¡æ¯çš„Module Listçš„å¯¹è±¡ï¼Œåªæœ‰åœ¨å®é™…è°ƒç”¨äº†è¯¥æ¨¡å—ä¹‹åæ‰ä¼šåŠ è½½è¯¥æ¨¡å—çš„å…·ä½“ä¿¡æ¯ï¼ˆæ¯”å¦‚æš´éœ²çš„APIç­‰ï¼‰ã€‚ 12345678910111213141516const NativeModules = &#123;&#125;;Object.keys(RemoteModules).forEach((moduleName) =&gt; &#123;Object.defineProperty(NativeModules, moduleName, &#123;enumerable: true,get: () =&gt; &#123;let module = RemoteModules[moduleName];if (module &amp;&amp; typeof module.moduleID === 'number' &amp;&amp; global.nativeRequireModuleConfig) &#123;const json = global.nativeRequireModuleConfig(moduleName);const config = json &amp;&amp; JSON.parse(json);module = config &amp;&amp; BatchedBridge.processModuleConfig(config, module.moduleID);RemoteModules[moduleName] = module;&#125;return module;&#125;,&#125;);&#125;); è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå…¨å±€æ¨¡å—NativeModulesï¼Œéå†ä¹‹å‰å–åˆ°çš„remoteModulesï¼Œå°†æ¯ä¸€ä¸ªmoduleåœ¨NativeModuleså¯¹è±¡ä¸Šæ‰©å±•äº†ä¸€ä¸ªgetteræ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­é€šè¿‡nativeRequireModuleConfigè¿›ä¸€æ­¥åŠ è½½æ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ï¼Œé€šè¿‡processModuleConfigå¯¹æ¨¡å—ä¿¡æ¯è¿›è¡Œé¢„å¤„ç†ã€‚è¿›ä¸€æ­¥åˆ†æä»£ç å°±å¯ä»¥å‘ç°è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯Nativeä¸­å®šä¹‰çš„å…¨å±€JS Blockï¼ˆnativeRequireModuleConfigï¼‰ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹processModuleConfigä¸­å…·ä½“çš„ä»£ç é€»è¾‘ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š 123456789101112processModuleConfig(config, moduleID) &#123; const module = this._genModule(config, moduleID); return module;&#125;_genMethod(module, method, type) &#123;//...... fn = function(...args) &#123; return self.__nativeCall(module, method, args, onFail, onSucc);&#125;;//......return fn;&#125; processModuleConfigæ–¹æ³•çš„ä¸»è¦å·¥ä½œæ˜¯ç”Ÿæˆmethodsé…ç½®ï¼Œå¹¶å¯¹æ¯ä¸€ä¸ªmethodå°è£…äº†ä¸€ä¸ªé—­åŒ…fnï¼Œå½“è°ƒç”¨methodæ—¶ï¼Œä¼šè½¬æ¢æˆæˆè°ƒç”¨self.__nativeCall(moduleID, methodID, args, onFail, onSucc)æ–¹æ³• é¢„å¤„ç†å®Œæˆåï¼Œåœ¨JavaScriptç¯å¢ƒä¸­çš„Moudle Configä¿¡æ¯æ‰ç®—å®Œæ•´ï¼ŒåŒ…å«Module Nameã€Native Methodç­‰ä¿¡æ¯ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºã€‚ 12345678config = [\"HTSimpleAPI\", Array[1]], moduleID = 0methodName = \"test\", methodID = 0config = null, moduleID = 1config = null, moduleID = 2config = [\"RCTAccessibilityManager\", Array[3]], moduleID = 3methodName = \"setAccessibilityContentSizeMultipliers\", methodID = 0methodName = \"getMultiplier\", methodID = 1methodName = \"getCurrentVoiceOverState\", methodID = 2 è¿˜è®°å¾—ç¬¬äºŒéƒ¨åˆ†ç¬¬5æ­¥ä¸­Nativeç«¯ç”Ÿæˆçš„æ¨¡å—é…ç½®è¡¨å—ï¼Ÿç»“åˆå®ƒçš„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼šå¯¹äºModule&amp;Methodï¼Œåœ¨Nativeå’ŒJSç«¯éƒ½ä»¥æ•°ç»„çš„å½¢å¼å­˜æ”¾ï¼Œæ•°ç»„ä¸‹æ ‡å³ä¸ºå®ƒä»¬çš„ModuleIDå’ŒMethodIDã€‚ 5.__nativeCall åˆ†æå®ŒBridgeéƒ¨åˆ†çš„æ˜ å°„å…³ç³»ä»¥åŠæ¨¡å—åŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹æœ€ç»ˆè°ƒç”¨Nativeä»£ç æ˜¯å¦‚ä½•å®ç°çš„ã€‚å½“JSè°ƒç”¨module.methodæ—¶ï¼Œå…¶å®è°ƒç”¨äº†self.nativeCall(module, method, args, onFail, onSucc)ï¼Œå¯¹äºnativeCallæ–¹æ³•ï¼š 1234567891011121314__nativeCall(module, method, params, onFail, onSucc) &#123; if (onFail || onSucc) &#123; ...... onFail &amp;&amp; params.push(this._callbackID); this._callbacks[this._callbackID++] = onFail; onSucc &amp;&amp; params.push(this._callbackID); this._callbacks[this._callbackID++] = onSucc; &#125;this._queue[MODULE_IDS].push(module);this._queue[METHOD_IDS].push(method);this._queue[PARAMS].push(params);global.nativeFlushQueueImmediate(this._queue);......&#125; è¿™æ®µä»£ç ä¸ºæ¯ä¸ªmethodåˆ›å»ºäº†ä¸€ä¸ªé—­åŒ…fnï¼Œåœ¨__nativeCallæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œåšäº†ä¸¤ä»¶é‡è¦çš„å·¥ä½œï¼š 1.æŠŠonFailå’ŒonSuccç¼“å­˜åˆ°_callbacksä¸­ï¼ŒåŒæ—¶æŠŠcallbackIDæ·»åŠ åˆ°params 2.æŠŠmoduleID, methodID, paramsæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå›è°ƒNativeä»£ç . __nativeCallå¦‚ä½•åšåˆ°å›è°ƒNativeä»£ç å‘¢ï¼Ÿçœ‹ç¬¬äºŒéƒ¨åˆ†ç¬¬3æ­¥ï¼Œåœ¨åˆå§‹åŒ–JSå¼•æ“JSExecutor Setupæ—¶ï¼ŒNativeç«¯æ³¨å†Œä¸€ä¸ªå…¨å±€blockå›è°ƒnativeFlushedQueueImmediateï¼ŒnativeCallåœ¨å¤„ç†å®Œæ¯•åï¼Œé€šè¿‡è¯¥å›è°ƒæŠŠé˜Ÿåˆ—ä½œä¸ºè¿”å›å€¼ä¼ ç»™Nativeã€‚nativeFlushedQueueImmediateçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚ 1234567[self addSynchronousHookWithName:@\"nativeFlushQueueImmediate\" usingBlock:^(NSArray *calls)&#123;RCTJSCExecutor *strongSelf = weakSelf; if (!strongSelf.valid || !calls) &#123; return; &#125;[strongSelf-&gt;_bridge handleBuffer:calls batchEnded:NO];&#125;]; è¿™é‡Œçš„handleBufferå°±æ˜¯Nativeç«¯è§£æJSçš„æ¨¡å—è°ƒç”¨æœ€åé€šè¿‡NSInvocationæœºåˆ¶è°ƒç”¨Nativeä»£ç å¯¹åº”çš„é€»è¾‘ã€‚æœ‰å…´è¶£çš„æœ‹å‹ç»§ç»­è·Ÿè¸ªhandleBufferä»£ç ä¼šå‘ç°ï¼Œä»–çš„å®ç°å’ŒReactåœ¨JSç«¯å®šä¹‰çš„MessageQueueæœ‰æƒŠäººçš„ç›¸ä¼¼ä¹‹å¤„ã€‚ 6.Call JS function &amp; Callbacks æœ€åï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹Nativeç«¯æ˜¯å¦‚ä½•è°ƒç”¨JSç«¯çš„ç›¸å…³é€»è¾‘çš„ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬éœ€è¦å›åˆ°MessageQueue.jsä»£ç ä¸­æ¥ï¼Œå¯ä»¥çœ‹åˆ°MessageQueueæš´éœ²äº†3ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šâ€™invokeCallbackAndReturnFlushedQueueâ€™ã€â€™callFunctionReturnFlushedQueueâ€™ã€â€™flushedQueueâ€™ã€‚ 1234567891011121314151617181920212223// å°†APIæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸä¸­['invokeCallbackAndReturnFlushedQueue','callFunctionReturnFlushedQueue','flushedQueue',].forEach((fn) =&gt; this[fn] = this[fn].bind(this));â€¦// å£°æ˜å¸¦æœ‰è¿”å›å€¼çš„å‡½æ•°callFunctionReturnFlushedQueue(module, method, args) &#123;guard(() =&gt; &#123;Cthis.__callFunction(module, method, args);this.__callImmediates();&#125;);return this.flushedQueue();&#125;// å£°æ˜å¸¦æœ‰Callbackçš„å‡½æ•°invokeCallbackAndReturnFlushedQueue(cbID, args) &#123;guard(() =&gt; &#123;this.__invokeCallback(cbID, args);this.__callImmediates();&#125;);return this.flushedQueue();&#125; callFunctionReturnFlushedQueueç”¨äºå®ç°Nativeè°ƒç”¨å¸¦æœ‰è¿”å›å€¼çš„JSç«¯å‡½æ•°ï¼ˆè¿™é‡Œçš„è¿”å›å€¼ä¹Ÿæ˜¯é€šè¿‡Queueæ¥æ¨¡æ‹Ÿï¼‰ï¼›invokeCallbackAndReturnFlushedQueueç”¨äºå®ç°Nativeè°ƒç”¨å¸¦æœ‰Callçš„JSç«¯å‡½æ•°ï¼ˆå¯ä»¥å°†Nativeçš„Callbackä½œä¸ºJSç«¯å‡½æ•°çš„å…¥å‚ï¼ŒJSç«¯æ‰§è¡Œå®Œåè°ƒç”¨Nativeçš„Callbackï¼‰ã€‚ å¯¹äºcallFunctionReturnFlushedQueueæ–¹æ³•ï¼Œå®ƒæœ€ç»ˆè°ƒç”¨çš„æ˜¯__callFunctionï¼š 123456__callFunction(module, method, args) &#123;......var moduleMethods = this._callableModules[module];......moduleMethods[method].apply(moduleMethods, args);&#125; å¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„ä¼šæ ¹æ®Nativeä¼ å…¥çš„module, methodï¼Œè°ƒç”¨JSç«¯ç›¸åº”çš„æ¨¡å—å¹¶ä¼ å…¥å‚æ•°åˆ—è¡¨args.åŒæ—¶æˆ‘ä»¬åˆå¯ä»¥è·å¾—å¯¹äºMessageQueueçš„å¦ä¸€æ¡æ¨æµ‹ï¼Œ_callableModulesç”¨æ¥å­˜æ”¾JSç«¯æš´éœ²ç»™Nativeçš„æ¨¡å—ï¼Œè¿›ä¸€æ­¥åˆ†ææˆ‘ä»¬å¯ä»¥å‘ç°SDKä¸­æ­£æ˜¯é€šè¿‡registerCallableModulesæ–¹æ³•æ³¨å†ŒJSç«¯æš´éœ²APIæ¨¡å—ã€‚ å¯¹äºJS bridgeæä¾›çš„è°ƒç”¨å›è°ƒæ–¹æ³•invokeCallbackAndReturnFlushedQueueï¼ŒåŸç†ä¸Šå’ŒcallFunctionå·®ä¸å¤šï¼Œä¸å†ç»†è¯´ã€‚ JS Native é€šä¿¡åŸç†1.Native-&gt;JS ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨JSç«¯æä¾›callFunctionReturnFlushedQueueï¼ŒNative bridgeè°ƒç”¨JSç«¯æ–¹æ³•æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚æŸ¥çœ‹Nativeä»£ç å®ç°å¯çŸ¥ï¼ŒRCTBridgeå°è£…äº†enqueueJSCallæ–¹æ³•è°ƒç”¨JSï¼Œæ¢³ç†Native-&gt;JSçš„æ•´ä½“äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ ä¹‹å‰å·²ç»è®ºè¿°è¿‡ï¼Œå¦‚æœåœ¨NATIVEç«¯éœ€è¦è‡ªå®šä¹‰æ¨¡å—æä¾›ç»™JSç«¯ä½¿ç”¨é‚£ä¹ˆè¯¥ç±»éœ€è¦å®ç°RCTBridgeModuleåè®® ã€‚ æ­¤å¤–ï¼ŒReact-Nativeæä¾›äº†å¦ä¸€ç§åŸºäºé€šçŸ¥çš„æ–¹å¼ï¼Œé€šè¿‡RCTEventDispatcherå‘é€æ¶ˆæ¯é€šçŸ¥ ã€‚eventDispatcherä½œä¸ºNative Bridgeçš„å±æ€§ï¼Œå°è£…äº†sendEventWithName:body:æ–¹æ³•ã€‚ä½¿ç”¨æ—¶ï¼ŒNativeä¸­ç±»åŒæ ·éœ€è¦å®ç°RCTBridgeModuleåè®®ï¼Œé€šè¿‡self.bridgeå‘é€é€šçŸ¥ï¼ŒJSç«¯å¯¹åº”äº‹ä»¶çš„EventEmitteræ·»åŠ ç›‘å¬å¤„ç†è°ƒç”¨ã€‚ æŸ¥çœ‹sendEventæ–¹æ³•çš„ä»£ç å¯ä»¥å‘ç°ï¼Œè¿™ç§æ–¹å¼æœ¬è´¨ä¸Šè¿˜æ˜¯è°ƒç”¨enqueueJSCallæ–¹æ³•ã€‚å®˜æ–¹æ¨èæˆ‘ä»¬ä½¿ç”¨é€šçŸ¥çš„æ–¹å¼æ¥å®ç° Native-&gt;JSï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¨¡å—åˆå§‹åŒ–åŠ è½½è§£æçš„æ—¶é—´ã€‚ 2.JS-&gt;Native æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹JSå¦‚ä½•è°ƒç”¨Nativeã€‚ç­”æ¡ˆæ˜¯JSä¸ä¼šä¸»åŠ¨ä¼ é€’æ•°æ®ç»™Nativeï¼Œä¹Ÿä¸èƒ½ç›´æ¥è°ƒç”¨Nativeï¼ˆä¸€ç§æƒ…å†µé™¤å¤–ï¼Œåœ¨å…¥å£ç›´æ¥é€šè¿‡NativeModulesè°ƒç”¨APIï¼‰ï¼Œåªæœ‰åœ¨Nativeè°ƒç”¨JSæ—¶æ‰ä¼šé€šè¿‡è¿”å›å€¼è§¦å‘è°ƒç”¨ã€‚å› ä¸ºNativeæ˜¯åŸºäºäº‹ä»¶å“åº”æœºåˆ¶çš„ï¼Œæ¯”å¦‚è§¦æ‘¸äº‹ä»¶ã€å¯åŠ¨äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€å›è°ƒäº‹ä»¶ç­‰ã€‚ å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒNativeä¼šè°ƒç”¨JSç›¸åº”æ¨¡å—å¤„ç†ï¼Œå®Œæ¯•åå†é€šè¿‡è¿”å›å€¼æŠŠé˜Ÿåˆ—ä¼ é€’ç»™Nativeæ‰§è¡Œå¯¹åº”çš„ä»£ç ã€‚ å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å¯ä»¥å½’çº³ä¸ºï¼š 1.JSæŠŠéœ€è¦Module, Method, args(CallbackID)ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œ ä½œä¸ºè¿”å›å€¼é€šè¿‡blockså›è°ƒNative 2.Nativeè°ƒç”¨ç›¸åº”æ¨¡å—æ–¹æ³•ï¼Œå®Œæˆ 3.Nativeé€šè¿‡CallbackIDè°ƒç”¨JSå›è°ƒ æ€»ç»“React Nativeçš„é€šè®¯åŸºç¡€å»ºç«‹åœ¨ä¼ ç»Ÿçš„JS Bridgeä¹‹ä¸Šï¼Œä¸è¿‡å¯¹äºBridgeå¤„ç†çš„MessageQueueæœºåˆ¶ã€æ¨¡å—å®šä¹‰ã€åŠ è½½æœºåˆ¶ä¸Šçš„å·§å¦™å¤„ç†æŒ‡çš„å€Ÿé‰´ã€‚å¯¹äºä¸Šè¿°çš„æ•´ä¸ªåŸç†è§£æå¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š 1.åœ¨å¯åŠ¨é˜¶æ®µï¼Œåˆå§‹åŒ–JSå¼•æ“ï¼Œç”ŸæˆNativeç«¯æ¨¡å—é…ç½®è¡¨å­˜äºä¸¤ç«¯ï¼Œå…¶ä¸­æ¨¡å—é…ç½®æ˜¯åŒæ­¥å–å¾—ï¼Œè€Œå„æ¨¡å—çš„æ–¹æ³•é…ç½®åœ¨è¯¥æ–¹æ³•è¢«çœŸæ­£è°ƒç”¨æ—¶æ‡’åŠ è½½ã€‚ 2.Nativeå’ŒJSç«¯åˆ†åˆ«æœ‰ä¸€ä¸ªbridgeï¼Œå‘ç”Ÿè°ƒç”¨æ—¶ï¼Œè°ƒç”¨ç«¯bridgeæŸ¥æ‰¾æ¨¡å—é…ç½®è¡¨å°†è°ƒç”¨è½¬æ¢æˆ{moduleID, methodID, args(callbackID)}ï¼Œå¤„ç†ç«¯é€šè¿‡åŒä¸€ä»½æ¨¡å—é…ç½®è¡¨è½¬æ¢ä¸ºå®é™…çš„æ–¹æ³•å®ç°ã€‚ 3.Native-&gt;JSï¼ŒåŸç†ä¸Šä½¿ç”¨JSCoreä»Nativeæ‰§è¡ŒJSä»£ç ï¼ŒReact-Nativeåœ¨æ­¤åŸºç¡€ä¸Šç»™æˆ‘ä»¬æä¾›äº†é€šçŸ¥å‘é€çš„æ‰§è¡Œæ–¹å¼ã€‚ 4.JS-&gt;Nativeï¼ŒåŸç†ä¸ŠJSå¹¶ä¸ä¸»åŠ¨è°ƒç”¨Nativeï¼Œè€Œæ˜¯æŠŠæ–¹æ³•å’Œå‚æ•°(å›è°ƒ)ç¼“å­˜åˆ°é˜Ÿåˆ—ä¸­ï¼Œåœ¨Nativeäº‹ä»¶è§¦å‘å¹¶è®¿é—®JSåï¼Œé€šè¿‡blockså›è°ƒNativeã€‚ ä»¥ä¸ŠåŸç†è§£ææ–‡ç« æ¥æºï¼šhttp://i.dotidea.cn/2016/05/react-native-communication-principle-for-ios/ã€https://blog.csdn.net/passionhe/article/details/52498061ã€https://blog.csdn.net/xiangzhihong8/article/details/54425807","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šBlock","slug":"iOS Principle Block","date":"2018-06-10T13:56:27.000Z","updated":"2018-11-18T05:44:25.499Z","comments":true,"path":"2018/06/10/iOS Principle Block/","link":"","permalink":"https://reversescale.github.io/2018/06/10/iOS Principle Block/","excerpt":"Block å…¶å®å°±æ˜¯ C è¯­è¨€çš„æ‰©å……åŠŸèƒ½ï¼Œå®ç°äº†å¯¹ C çš„é—­åŒ…å®ç°ï¼Œä¸€ä¸ªå¸¦æœ‰å±€éƒ¨å˜é‡çš„åŒ¿åå‡½æ•°~","text":"Block å…¶å®å°±æ˜¯ C è¯­è¨€çš„æ‰©å……åŠŸèƒ½ï¼Œå®ç°äº†å¯¹ C çš„é—­åŒ…å®ç°ï¼Œä¸€ä¸ªå¸¦æœ‰å±€éƒ¨å˜é‡çš„åŒ¿åå‡½æ•°~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿†ï¼š Block å®ç°äº†å¯¹Cçš„é—­åŒ…å®ç°ï¼Œä¸€ä¸ªå¸¦æœ‰å±€éƒ¨å˜é‡çš„åŒ¿åå‡½æ•° æºç ç»“æ„åˆ†æ æœ¬ä½“éƒ¨åˆ†ï¼šblockå®é™…çš„ç»“æ„ä½“éƒ¨åˆ† æˆå‘˜å˜é‡ï¼šimplå’ŒDesc ç»“æ„ä½“çš„æ„é€ å‡½æ•°ï¼š__main_block_impl_0 æ•è·å¤–éƒ¨å˜é‡ å±€éƒ¨å˜é‡ä½œä¸ºBlockç»“æ„ä½“çš„æˆå‘˜å˜é‡è¿½åŠ åˆ°äº†__main_block_impl_0 æ ¹æ®ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‚æ•°å¯¹ç”±å±€éƒ¨å˜é‡è¿½åŠ çš„æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ– __main_block_func_0ä¸­è¿›è¡Œäº†å˜é‡è·å–_cself-&gt;ch(å˜é‡çš„å€¼-æ·±æ‹·è´) æ”¹å˜Blocké‡Œçš„å€¼ cæ–¹æ³•ï¼šé™æ€å˜é‡ã€é™æ€å…¨å±€å˜é‡ã€å…¨å±€å˜é‡ __blockä¿®é¥°ç¬¦ï¼šå˜æˆäº†ç»“æ„ä½“å®ä¾‹ï¼Œåˆå§‹åŒ–_main_block_impl_0çš„æ—¶å€™è¿½åŠ çš„æ˜¯_blockç”Ÿæˆçš„ç»“æ„ä½“æŒ‡é’ˆ ä¸‰ç§Blockæœ¬ä½“ NSConcreteStackBlockï¼šåœ¨å±€éƒ¨å®šä¹‰çš„ï¼ˆæ ˆï¼‰ NSConcreteGlobalBlockï¼šåœ¨å…¨å±€ä¸­å®šä¹‰çš„ï¼ˆæ•°æ®åŒºåŸŸï¼‰-ä¸å­˜åœ¨å¯¹å±€éƒ¨å˜é‡çš„æ•è· NSConcreteMallocBlockï¼šåˆ†é…åœ¨å †ä¸­-Blockä»æ ˆä¸Šå¤åˆ¶åˆ°å †ä¸Šçš„æ–¹æ³• å£°æ˜ä¸€ä¸ªBlock:ä½¿ç”¨åœºæ™¯ä¸€ï¼šè¿”å›å€¼ (^åç§°) (å‚æ•°åˆ—è¡¨) = ^(å‚æ•°åˆ—è¡¨) {}; 123int (^name)(int, int) = ^(int a, int b) &#123; return (a+b);&#125;; ä½¿ç”¨åœºæ™¯äºŒï¼šä½œä¸ºä¸€ä¸ªå‡½æ•°çš„å‚æ•°ï¼š 12345678910- (void)testBlock:(NSString *(è¿”å›ç±»å‹) (^)(int a))s (blockåå­—ï¼‰ &#123; NSString *a = s(1);&#125;&#123; [self testBlock:^NSString *(int a) &#123; a = 5; return @\"1\"; &#125;];&#125; Demo ä¸­æ–‡ä»¶å¯¹ç…§ mainTestBlock.cpp -&gt; åŸºæœ¬çš„blockè½¬è¯‘ mainTestBlockValue.cpp -&gt; blockæ•è·å¤–éƒ¨å˜é‡ mainTestBlockValueC.cpp -&gt; é€šè¿‡Cè¯­è¨€å˜é‡è®¿é—®å€¼ mainTestBlockValueValueBlock.cpp -&gt; é€šè¿‡__blockå˜é‡è®¿é—®å€¼ ä»åº•å±‚åˆ†æBlockçš„å®ç°å…ˆä»æœ€ç®€å•çš„çœ‹èµ·1234void (^block)(void) = ^(void) &#123; &#125;;block(); ä½¿ç”¨ Clangï¼ˆLLVMï¼‰è½¬åŒ–ä¸º C++ çš„å®ç°1clang -rewrite-objc æ–‡ä»¶å æ³¨æ„ï¼šç”±äº ViewController ä¸­ä½¿ç”¨ UIKit åº“ï¼Œç¼–è¯‘æ—¶ä¼šå‡ºç°æ‰¾ä¸åˆ°æ–‡ä»¶çš„æƒ…å†µã€‚ è½¬åŒ–åçš„ä»£ç å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728struct __block_impl &#123; void *isa; int Flags; int Reserved; void *FuncPtr; &#125;; struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125; &#125;; static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; printf(\"aaa\\n\");&#125; static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size; &#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;; int main() &#123; void (*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA)); ((void (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block); return 0; &#125; æºç ç»“æ„åˆ†æ1.blockå®é™…çš„ç»“æ„ä½“éƒ¨åˆ†ï¼ˆæœ¬ä½“ï¼‰12345678910struct __main_block_impl_0 &#123; struct __block_impl impl; // ç»“æ„ä½“ implï¼Œè§ä¸‹ 2 struct __main_block_desc_0* Desc; // ç»“æ„ä½“ Descï¼Œè§ä¸‹ 3 __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) &#123; // æ„é€ å‡½æ•°ï¼Œè§ä¸‹ 4 impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125; &#125;; 2.å†çœ‹çœ‹ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡impl123456struct __block_impl &#123; void *isa; // struct ä¸­ï¼Œé¦–åœ°å€æ˜¯ *isaï¼Œè¯æ˜ block æ˜¯ objc ä¸­çš„å¯¹è±¡ int Flags; // æ ‡è®° int Reserved; // æ ‡è®° void *FuncPtr; // å‡½æ•°æŒ‡é’ˆï¼Œblockæ‰€éœ€è¦æ‰§è¡Œçš„ä»£ç æ®µ&#125;; ä»–çš„ç¬¬ä¸€ä¸ªå±æ€§ä¹Ÿæ˜¯ä¸€ä¸ªç»“æ„__block_implï¼Œè€Œç¬¬ä¸€ä¸ªå‚æ•°ä¹Ÿæ˜¯ä¸€ä¸ªisaçš„æŒ‡é’ˆã€‚ åœ¨è¿è¡Œæ—¶ï¼ŒNSObjectå’Œblockçš„isaæŒ‡é’ˆéƒ½æ˜¯æŒ‡å‘å¯¹è±¡çš„ä¸€ä¸ª8å­—èŠ‚ã€‚NSObjectåŠæ´¾ç”Ÿç±»å¯¹è±¡çš„isaæŒ‡å‘Classçš„prototypeï¼Œè€Œblockçš„isaæŒ‡å‘äº†_NSConcreteStackBlockè¿™ä¸ªæŒ‡é’ˆã€‚å°±æ˜¯è¯´å½“ä¸€ä¸ªblockè¢«å£°æ˜çš„æ—¶å€™ä»–éƒ½æ˜¯ä¸€ä¸ª_NSConcreteStackBlockç±»çš„å¯¹è±¡ã€‚ 3.ç¬¬äºŒä¸ªæˆå‘˜å˜é‡Desc1234static struct __main_block_desc_0 &#123; size_t reserved; // ç‰ˆæœ¬å‡çº§æ‰€éœ€çš„åŒºåŸŸ size_t Block_size; // Blockçš„å ç”¨ç©ºé—´å¤§å°&#125; 4.ç¬¬ä¸‰ä¸ªå°±æ˜¯è¿™ä¸ªç»“æ„ä½“çš„æ„é€ å‡½æ•°ï¼ˆå¯ä»¥ç†è§£ä¸ºå¯¹è±¡çš„åˆå§‹åŒ–æ–¹æ³•ï¼‰123456__main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, int flags=0) &#123; impl.isa = &amp;_NSConcreteStackBlock; // block çš„æœ¬ä½“ç±»å‹ï¼Œåé¢ä¸“é—¨è®²è§£ impl.Flags = flags; impl.FuncPtr = fp; // void *fpçš„æŒ‡é’ˆèµ‹å€¼ç»™äº†FuncPtræŒ‡é’ˆ Desc = desc; // desc ç»“æ„ä½“çš„æŒ‡é’ˆä¼ å…¥çš„åˆå§‹åŒ–&#125; ä»¥ä¸‹æ˜¯æºç è°ƒç”¨åˆ†æ 5.ç°åœ¨æ¥çœ‹çœ‹Mainå‡½æ•°ä¸­è°ƒç”¨çš„åŸºæœ¬è½¬æ¢ï¼ˆåˆå§‹åŒ–è½¬æ¢ï¼‰1void (*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA)); çœ‹èµ·æ¥è¿™ä¸ªå‡½æ•°å¥½å“äººå•Šï¼Œæ²¡äº‹ï¼Œå’±ä»¬æŠŠç±»å‹éƒ½å»äº†ï¼Œè€Œä¸”åˆ†å¼€ä¸¤æ­¥æ¥å†™12345/* è°ƒç”¨ç»“æ„ä½“å‡½æ•°åˆå§‹åŒ– struct __main_block_impl_0 impBlock = __main_block_impl_0(__main_block_func_0,&amp;__main_block_desc_0_DATA); /* èµ‹å€¼ç»™è¯¥ç»“æ„ä½“ç±»å‹æŒ‡é’ˆå˜é‡ struct __main_block_impl_0 *block = &amp;impBlock; æŠŠæ ˆä¸Šç”Ÿæˆçš„main_block_impl_0çš„ç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆï¼Œèµ‹å€¼ç»™main_block_impl_0ç»“æ„ä½“æŒ‡é’ˆç±»å‹çš„å˜é‡block __main_block_func_0å°±æ˜¯è½¬æ¢æˆçš„å‡½æ•°æŒ‡é’ˆï¼Œè¿™æ ·void (*block)(void) = ^{}è¿™å¥ç®€å•çš„ä»£ç æœ€ç»ˆå°±æ˜¯ä¸Šé¢çš„ç»“æ„ä½“åˆå§‹åŒ–å‡½æ•°çš„å†…éƒ¨å®ç°é€»è¾‘ 6.å†æ¥ç»†çœ‹ä¸‹åˆå§‹åŒ–å‡½æ•°å†…éƒ¨çš„å®ç°__block_main_impl_01__main_block_impl_0(__main_block_func_0,&amp;__main_block_desc_0_DATA); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ç”±Blockå—è¯­æ³•è½¬æ¢çš„æ­£çœŸå†…éƒ¨å‡½æ•°æŒ‡é’ˆï¼Œç¬¬äºŒä¸ªå‚æ•°å°±æ˜¯ä½œä¸ºé™æ€å…¨å±€å˜é‡åˆå§‹åŒ–__main_block_desc_0çš„ç»“æ„ä½“å®ä¾‹æŒ‡é’ˆï¼Œåˆå§‹åŒ–å¦‚ä¸‹1__main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;; æœ€ç»ˆï¼Œåˆå§‹åŒ–å†…éƒ¨è¿›è¡Œèµ‹å€¼12345isa = &amp;_NSConcreteStackBlockFlags = 0Reversed = 0FuncPtr = __main_blcok_func_0 // å°±æ˜¯Blockå—ä»£ç è½¬æ¢æˆçš„Cè¯­è¨€å‡½æ•°æŒ‡é’ˆDesc = &amp;__ main_block_desc_0_DATA 7.æœ€ç»ˆ block() è°ƒç”¨çš„å†…éƒ¨å®ç°1((void (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block); è€è§„çŸ© ï¼Œå»æ‰ç±»å‹å°±æ˜¯1(*block-&gt;imp.FuncPtr)(block); æ‰“å°æ¢è¡Œ12static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; printf(\"aaa\\n\");&#125; æ²¡é”™ï¼Œæœ€åå°±æ˜¯ç›´æ¥è°ƒç”¨å‡½æ•°æŒ‡é’ˆè¿›è¡Œæœ€ç»ˆçš„è°ƒç”¨ï¼Œç”±ä¸Šé¢æ‰€æè¿°çš„ï¼ŒFuncPtrå°±æ˜¯ç”±__main_block_func_0çš„å‡½æ•°æŒ‡é’ˆæ‰€èµ‹å€¼çš„æŒ‡é’ˆï¼Œè€Œä¸”å¯ä»¥çœ‹å‡ºï¼Œè¿™ä¸ªå‡½æ•°çš„å‚æ•°æ­£æ˜¯æŒ‡å‘blockæœ¬èº«ç»“æ„ä½“å®ä¾‹ï¼Œblockä½œä¸ºå‚æ•°è¿›è¡Œäº†ä¼ é€’ ç»¼ä¸Šæ‰€è¿°ï¼Œblockçš„å®è´¨ï¼Œå°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼ŒåŒ…å«äº†ä¸€ä¸ªæŒ‡å‘å‡½æ•°é¦–åœ°å€çš„æŒ‡é’ˆï¼Œå’Œä¸€äº›ä¸è‡ªå·±ç›¸å…³çš„æˆå‘˜å˜é‡ã€‚ Block è®¿é—®å¤–éƒ¨å˜é‡æ˜¯æ€ä¹ˆå›äº‹123456789101112int main()&#123; int a = 100; int b = 200; const char *ch = \"b = %d\\n\"; void (^block)(void) = ^&#123; &#125;; b = 300; ch = \"value had changed.b = %d\\n\"; block(); return 0; &#125; Clang è½¬åŒ–åä»£ç 12345678910111213141516171819202122232425262728293031323334353637struct __block_impl &#123; void *isa; int Flags; int Reserved; void *FuncPtr;&#125;;struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; const char *ch; int b; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, const char *_ch, int _b, int flags=0) : ch(_ch), b(_b) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;;static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; const char *ch = __cself-&gt;ch; // bound by copy int b = __cself-&gt;b; // bound by copy printf(ch,b);&#125;static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size;&#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;;int main()&#123; int a = 100; int b = 200; const char *ch = \"b = %d\\n\"; void (*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, ch, b)); b = 300; ch = \"value had changed.b = %d\\n\"; ((void (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block); return 0;&#125; 1.é¦–å…ˆçœ‹çœ‹Blockçš„å†…éƒ¨ç»“æ„æœ¬å°Šå’Œæ²¡æœ‰æˆªè·çš„åŒºåˆ«123456789101112struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; const char *ch; int b; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, const char *_ch, int _b, int flags=0) : ch(_ch), b(_b) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125;&#125;; æ ¹æ®mainå‡½æ•°é‡Œé¢çš„Blockè¯­æ³•ï¼Œè¿™é‡ŒæŠŠBlockå—è¡¨è¾¾å¼é‡Œé¢çš„å±€éƒ¨å˜é‡ä½œä¸ºäº†è¿™ä¸ªBlockç»“æ„ä½“çš„æˆå‘˜å˜é‡è¿½åŠ åˆ°äº†__main_block_impl_0çš„ç»“æ„ä½“ä¸­ å€¼å¾—æ³¨æ„çš„æ˜¯ï¼š ç»“æ„ä½“å†…å£°æ˜çš„æˆå‘˜å˜é‡ç±»å‹ä¸å±€éƒ¨å˜é‡ç±»å‹å®Œå…¨ç›¸åŒ è¯­æ³•ä¸­æ²¡æœ‰ä½¿ç”¨çš„å±€éƒ¨å˜é‡ï¼ˆä¾‹å¦‚å’±ä»¬è¿™é‡Œçš„aå˜é‡ï¼‰ä¸ä¼šè¢«è¿½åŠ  ç»†èŠ‚éœ€è¦æ³¨æ„ï¼Œè¿™é‡Œæˆªè·çš„chæ˜¯ä¸å¯ä¿®æ”¹çš„ï¼Œè€Œä¸”æ•æ‰çš„båªæ˜¯æˆªè·äº†è¯¥å±€éƒ¨å˜é‡çš„å€¼è€Œå·²ï¼ˆä¸‹é¢åœ¨å°†å¦‚ä½•æˆªè·æŒ‡é’ˆï¼‰ 2.å†æ¥çœ‹çœ‹è¯¥ç»“æ„ä½“å®ä¾‹åŒ–çš„æ„é€ å‡½æ•°ä»¥åŠè°ƒç”¨å’Œæ²¡æœ‰æˆªè·çš„åŒºåˆ«1234567__main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, const charchar *_ch, int _b, int flags=0) : ch(_ch), b(_b) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125; void (*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, ch, b)); æ ¹æ®ä¼ é€’ç»™æ„é€ å‡½æ•°çš„å‚æ•°å¯¹ç”±å±€éƒ¨å˜é‡è¿½åŠ çš„æˆå‘˜å˜é‡è¿›è¡Œåˆå§‹åŒ–ã€‚ï¼ˆè¿™é‡Œä¼ é€’çš„å‚æ•°ä»…ä»…åªæ˜¯chå’Œbçš„å€¼è€Œå·²ï¼‰ ç†è§£ä¸ºæŠŠBlockè¯­æ³•å—é‡Œé¢æˆªè·çš„å±€éƒ¨å˜é‡å¯¹__main_block_impl_0çš„æˆå‘˜è¿½åŠ å¹¶ä¸”ä¼ é€’èµ‹å€¼ï¼Œå¦‚ï¼š123456impl.isa = &amp;_NSConcreteStackBlock;impl.Flags = 0;impl.FuncPtr = __main_block_func_0;Desc = &amp;__main_block_desc_0_DATA;ch = \"b=%d\\n\";b = 200; ç”±æ­¤å¯ä»¥çœ‹å‡ºï¼Œ__main_block_impl_0çš„ç»“æ„ä½“ï¼ˆå³Blockï¼‰å¯¹è‡ªåŠ¨å˜é‡è¿›è¡Œäº†æˆªè· 3.å†æ¥çœ‹çœ‹æœ€ç»ˆè°ƒç”¨Blockçš„æ—¶å€™å’Œæ²¡æœ‰æˆªè·çš„åŒºåˆ«123456((void (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block); static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; const charchar *ch = __cself-&gt;ch; // bound by copy int b = __cself-&gt;b; // bound by copy printf(ch,b); &#125; å¯ä»¥çœ‹å‡ºblock()è¿™å¥ä»£ç è½¬æ¢çš„è°ƒç”¨æ–¹å¼æ²¡æœ‰ä»»ä½•å˜åŒ–è¿˜æ˜¯è½¬æ¢ä¸ºä¸€ä¸‹è¿™å¥è¯ï¼Œè€Œä¸”æŠŠæœ¬èº«ç»“æ„ä½“ä½œä¸ºå‚æ•°è¿›è¡Œäº†ä¼ é€’1(*block-impl.FuncPtr)(block) ç°åœ¨æ³¨æ„çœ‹main_block_func_0è¿™ä¸ªCè¯­è¨€çš„å‡½æ•°ï¼Œå’Œä¹‹å‰ç›¸æ¯”è¿™é‡Œå¯¹ä¼ é€’è¿‡æ¥çš„blockç»“æ„ä½“å‚æ•°è¿›è¡Œäº†å˜é‡è·å–cself-&gt;ch å’Œ __cself-&gt;bï¼ˆè¿™ä¸¤ä¸ªå˜é‡å·²ç»åœ¨Blockè¡¨è¾¾å¼ä¹‹å‰è¿›è¡Œäº†å£°æ˜å®šä¹‰ï¼‰ï¼Œå¹¶æœ€ç»ˆæ‰“å°å‡ºæ¥ ä½†æ˜¯ï¼ŒBlockä¸­æ‰€æ•è·çš„å˜é‡å°±çŠ¹å¦‚â€œå¸¦æœ‰å±€éƒ¨å˜é‡å€¼çš„åŒ¿åå‡½æ•°â€æ‰€è¯´ï¼Œä»…ä»…æˆªè·å±€éƒ¨å˜é‡çš„å€¼è€Œå·²ï¼Œå¦‚æœåœ¨æˆªè·çš„Blocké‡Œé¢é‡å†™å±€éƒ¨å˜é‡ä¹Ÿä¸ä¼šæ”¹å˜åŸå…ˆæ‰€æˆªè·çš„å±€éƒ¨å˜é‡ block å¼•ç”¨å¤–éƒ¨å¯¹è±¡æ—¶å€™ï¼Œä¸æ˜¯ç®€å•çš„æŒ‡é’ˆå¼•ç”¨ï¼ˆæµ…å¤åˆ¶ï¼‰ï¼Œè€Œæ˜¯ä¸€ç§é‡å»ºï¼ˆæ·±å¤åˆ¶ï¼‰æ–¹å¼ï¼ˆæ‹¬å·å†…å¤–åˆ†åˆ«å¯¹äºåŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡åˆ†åˆ«æè¿°ï¼‰ æ‰€ä»¥å¦‚æœåœ¨ block ä¸­å¯¹å¤–éƒ¨å¯¹è±¡è¿›è¡Œä¿®æ”¹ï¼Œæ— è®ºæ˜¯å€¼ä¿®æ”¹è¿˜æ˜¯æŒ‡é’ˆä¿®æ”¹ï¼Œè‡ªç„¶æ˜¯æ²¡æœ‰ä»»ä½•æ•ˆæœ ä¾‹å¦‚ï¼š12int a = 0ï¼›void (^block)(void) = ^&#123;a = 1&#125;; è¿™æ ·å†™ç›´æ¥å°±ç¼–è¯‘å‡ºé”™äº†ï¼ï¼ï¼ å¯ä»¥ç›´æ¥çœ‹__block_main_block_impl_0çš„å®ç°ä¸Šï¼Œå¹¶ä¸èƒ½æ”¹å†™å…¶æ•è·å˜é‡çš„å€¼ï¼Œå› æ­¤ç›´æ¥æŠ¥é”™äº† ç»¼ä¸Šæ‰€è¿°ï¼Œæ‰€è°“çš„â€œæˆªè·è‡ªåŠ¨å˜é‡â€ï¼Œæ— éå°±æ˜¯åœ¨æ‰§è¡ŒBlockè¯­æ³•çš„æ—¶å€™ï¼ŒBlockè¯­æ³•æ‰€ç”¨åˆ°çš„å±€éƒ¨å˜é‡å€¼è¢«ä¿å­˜åˆ°Blockçš„ç»“æ„ä½“å®ä¾‹å½“ä¸­ï¼ˆå³æ‰€è°“çš„Blockæœ¬ä½“ï¼‰ è¦åœ¨ Block ä¸­æ”¹å˜é‡Œé¢çš„å€¼ç¬¬ä¸€ç§æ–¹æ³•ï¼šè¿ç”¨Cè¯­è¨€ä¸­çš„å˜é‡ é™æ€å˜é‡ é™æ€å…¨å±€å˜é‡ å…¨å±€å˜é‡ 1234567891011int global_val = 1; // å…¨å±€å˜é‡ static int static_global_val = 2; // é™æ€å…¨å±€ int main()&#123; static int static_val = 3; // é™æ€å±€éƒ¨ void (^block)(void) = ^&#123; global_val *= 1; static_global_val *= 2; static_val *= 3; &#125;; block(); &#125; è¿™é‡Œå…¨å±€å’Œé™æ€å…¨å±€é—®é¢˜ä¸å¤§ï¼Œå‡ºäº†ä½œç”¨äºç…§æ ·èƒ½è®¿é—®ï¼Œä½†æ˜¯é™æ€å±€éƒ¨çš„è¯å¦‚æœå»æ‰StaticæŒ‰ä¸Šé¢é‚£ç§å†™æ³•ï¼Œå°±ç›´æ¥æŠ¥é”™äº†ï¼ŒåŸå› å°±æ˜¯å®ç°ä¸Šä¸èƒ½æ”¹å˜æ•è·çš„å±€éƒ¨å˜é‡çš„å€¼ã€‚ æ²¡é”™ï¼Œåº”è¯¥èƒ½æƒ³åˆ°äº†ï¼Œèƒ½æ”¹å˜çš„æƒ…å†µå°±æ˜¯ç›´æ¥è®©Blockæˆªè·å±€éƒ¨å˜é‡çš„æŒ‡é’ˆï¼Œçœ‹Clangçš„æºç 12345678910111213141516171819202122232425262728293031int global_val = 1; static int static_global_val = 2; struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; intint *static_val; __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, intint *_static_val, int flags=0) : static_val(_static_val) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125; &#125;; static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; intint *static_val = __cself-&gt;static_val; // bound by copy global_val *= 1; static_global_val *= 2; (*static_val) *= 3; &#125; static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size; &#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0)&#125;; int main()&#123; static int static_val = 3; void (*block)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, &amp;static_val)); ((void (*)(__block_impl *))((__block_impl *)block)-&gt;FuncPtr)((__block_impl *)block); printf(\"%d\\n\",global_val); printf(\"%d\\n\",static_global_val); printf(\"%d\\n\",static_val); &#125; å¾ˆç®€å•å°±èƒ½çœ‹å‡ºåŒºåˆ«äº† åœ¨__main_block_impl_0è¿™ä¸ªç»“æ„ä½“ä¸­çš„è¿½åŠ çš„æˆå‘˜å˜é‡å˜æˆäº†int *_static_valæŒ‡é’ˆäº† åœ¨ç»“æ„ä½“å®ä¾‹åŒ–å‡½æ•°ä¸­__main_block_impl_0å‚æ•°ä¹Ÿå˜ä¸ºäº†&amp;static_valåœ°å€äº† 123456static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; intint *static_val = __cself-&gt;static_val; // bound by copy global_val *= 1; static_global_val *= 2; (*static_val) *= 3; &#125; æ ¹æ®Blockè¯­æ³•è½¬æ¢è€Œæ¥çš„Cé™æ€å‡½æ•°ï¼Œä½¿ç”¨static_valçš„æŒ‡é’ˆè¿›è¡Œè®¿é—®ï¼Œä¸Šé¢å‚æ•°å¯ä»¥çœ‹å‡ºï¼Œåˆå§‹åŒ–çš„æ—¶å€™å°†é™æ€å˜é‡çš„static_valæŒ‡é’ˆä¼ é€’ç»™__main_block_impl_0ç»“æ„ä½“è¿›è¡Œè¿½åŠ æˆå‘˜å˜é‡åˆå§‹åŒ–å¹¶ä¿å­˜ï¼Œè¿™æ ·åšä¹Ÿæ˜¯å¯¹è¶…å‡ºä½œç”¨äºä½¿ç”¨å˜é‡çš„æœ€ç®€å•çš„æ–¹æ³• ç¬¬äºŒç§æ–¹æ³•ï¼šå°±æ˜¯å¤§å®¶æ‰€ç†ŸçŸ¥çš„__blockä¿®é¥°ç¬¦çš„ä½¿ç”¨12__block int a = 0;void (^block)(void) = ^&#123;a = 1&#125;; Clang è½¬åŒ–åä»£ç 1234567891011121314151617181920212223242526272829303132333435363738394041struct __Block_byref_a_0 &#123; void *__isa; __Block_byref_a_0 *__forwarding; int __flags; int __size; int a; &#125;; struct __main_block_impl_0 &#123; struct __block_impl impl; struct __main_block_desc_0* Desc; __Block_byref_a_0 *a; // by ref __main_block_impl_0(void *fp, struct __main_block_desc_0 *desc, __Block_byref_a_0 *_a, int flags=0) : a(_a-&gt;__forwarding) &#123; impl.isa = &amp;_NSConcreteStackBlock; impl.Flags = flags; impl.FuncPtr = fp; Desc = desc; &#125; &#125;; static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; __Block_byref_a_0 *a = __cself-&gt;a; // bound by ref (a-&gt;__forwarding-&gt;a) = 1;&#125; static void __main_block_copy_0(struct __main_block_impl_0*dst, struct __main_block_impl_0*src) &#123; _Block_object_assign((void*)&amp;dst-&gt;a, (void*)src-&gt;a, 8/*BLOCK_FIELD_IS_BYREF*/);&#125; static void __main_block_dispose_0(struct __main_block_impl_0*src) &#123; _Block_object_dispose((void*)src-&gt;a, 8/*BLOCK_FIELD_IS_BYREF*/);&#125; static struct __main_block_desc_0 &#123; size_t reserved; size_t Block_size; void (*copy)(struct __main_block_impl_0*, struct __main_block_impl_0*); void (*dispose)(struct __main_block_impl_0*); &#125; __main_block_desc_0_DATA = &#123; 0, sizeof(struct __main_block_impl_0), __main_block_copy_0, __main_block_dispose_0&#125;; int main()&#123; __attribute__((__blocks__(byref))) __Block_byref_a_0 a = &#123;(void*)0,(__Block_byref_a_0 *)&amp;a, 0, sizeof(__Block_byref_a_0), 0&#125;; void(*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_a_0 *)&amp;a, 570425344)); return 0; &#125; ä»£ç å¤šäº†ä¸å°‘ï¼Œåˆ†è§£ä¸€ä¸‹1__block int a = 0ï¼› Clang çš„ä»£ç å¦‚ä¸‹1__Block_byref_a_0 a = &#123;(void*)0,(__Block_byref_a_0 *)&amp;a,0,sizeof(__Block_byref_a_0),0&#125;; è¿™è´§ç«Ÿç„¶åŠ äº†_blockå˜æˆäº†ç»“æ„ä½“å®ä¾‹ï¼Œåœ¨æ ˆä¸Šç”Ÿæˆäº†__block_byref_a_0çš„ç»“æ„ä½“å®ä¾‹ï¼Œaå˜é‡åˆå§‹åŒ–ä¸º0ï¼Œè¿™ä¸ªå€¼ä¹Ÿå‡ºç°åœ¨äº†è¿™ä¸ªç»“æ„ä½“æˆå‘˜å˜é‡å˜é‡ä¸­ï¼Œæ„å‘³ç€è¯¥ç»“æ„ä½“æŒæœ‰ç›¸å½“äºåŸå±€éƒ¨å˜é‡çš„æˆå‘˜å˜é‡ 12345678struct __Block_byref_a_0 &#123; *__isa; __Block_byref_a_0 *__forwarding; int __flags; int __size; int a; &#125;; è¿™ä¸ªåˆå§‹åŒ–çš„åŸç»“æ„ï¼Œé‡Œé¢çš„æœ€åä¸€ä¸ªint aå°±æ˜¯åŸå±€éƒ¨å˜é‡çš„æˆå‘˜å˜é‡ 1void (^block)(void) = ^&#123;a = 1&#125;; åˆ†è§£å¦‚ä¸‹ 1void(*blk)(void) = ((void (*)())&amp;__main_block_impl_0((void *)__main_block_func_0, &amp;__main_block_desc_0_DATA, (__Block_byref_a_0 *)&amp;a, 570425344)); è¿˜æ˜¯è°ƒç”¨main_block_impl_0çš„åˆå§‹åŒ–ç»“æ„ä½“ï¼Œç”±äºint aåŠ äº†blockä¿®é¥°ç¬¦ï¼Œé‚£ä¹ˆè¿™ä¸ªåˆå§‹åŒ–å‡½æ•°ä¼ é€’çš„ä¸å†æ˜¯&amp;açš„åœ°å€ï¼Œè€Œæ˜¯æ¢æˆ__Block_byref_a_0è¿™ä¸ªç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆè¿›è¡Œä¼ é€’ï¼ˆè¯¥ç»“æ„ä½“å…¶å®ä¹Ÿæ˜¯ä¸ªå¯¹è±¡ï¼Œæœ€åçš„å±æ€§æ”¾ç€éœ€è¦æˆªè·çš„å±€éƒ¨å˜é‡ï¼‰ è¿™é‡Œçš„__main_block_func_0å¯¹åº”çš„blockå—å‡½æ•°è½¬æ¢ä¸ºC 1234static void __main_block_func_0(struct __main_block_impl_0 *__cself) &#123; __Block_byref_a_0 *a = __cself-&gt;a; // bound by ref (a-&gt;__forwarding-&gt;a) = 1;&#125; çœ‹äº†ä¸¤ä¸ªæ–¹æ¡ˆï¼Œç¬¬ä¸€ä¸ªç”¨Cè¯­è¨€çš„é™æ€å˜é‡æ¥è§£å†³ï¼Œé‚£ä¹ˆç›´æ¥æ“ä½œé™æ€å˜é‡çš„æŒ‡é’ˆå°±å®Œäº‹äº†ï¼Œä½†æ˜¯blockè¦æ¯”è¿™ä¸ªçœŸçš„å¤æ‚å¤šäº†ã€‚Blockçš„ç»“æ„ä½“å®ä¾‹æŒæœ‰æŒ‡å‘blockå˜é‡çš„ __Block_byref_a_0ç»“æ„ä½“å®ä¾‹çš„æŒ‡é’ˆã€‚ Block_byref_a_0è¿™ä¸ªç»“æ„ä½“å®ä¾‹çš„æˆå‘˜å˜é‡forwardingæŒæœ‰æŒ‡å‘è¯¥ç»“æ„ä½“å®ä¾‹è‡ªèº«çš„æŒ‡é’ˆã€‚é€šè¿‡__forwardingè®¿é—®æˆå‘˜å˜é‡aã€‚ å¦å¤–æä¸€ç‚¹ï¼Œblockå†…éƒ¨çš„Block_byhef_val_0è¿™ä¸ªä¹Ÿæ˜¯ç‹¬ç«‹çš„ç»“æ„ä½“å®ä¾‹ï¼Œä¸å±äºmain_blocl_impl_0ç»“æ„ä½“ä¸­ï¼Œè¿™æ ·æ–¹ä¾¿äº†åœ¨å¤šä¸ªblockä¸­éƒ½èƒ½è®¿é—®blockå˜é‡ã€‚ å°ç»“ä¸€ä¸‹ï¼Œä¸ç„¶å¤ªä¹±ï¼š 1.æ™®é€šçš„å±€éƒ¨å˜é‡è¢«Blockæˆªè·åªæ˜¯å•çº¯çš„æˆªè·å…¶å€¼ï¼Œå¹¶è¿½åŠ åˆ°__main_block_impl_0ç»“æ„ä½“ä¸­ï¼ˆæ— æ³•ä¿®æ”¹é‡å†™ï¼‰ 2.è¦å…è®¸Blockä¿®æ”¹å€¼æœ‰ä¸¤ä¸ªæ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå°±æ˜¯ç”¨Cè¯­è¨€çš„å˜é‡ï¼Œä»£è¡¨å°±æ˜¯é™æ€å±€éƒ¨å˜é‡ï¼Œç¬¬äºŒä¸ªå°±æ˜¯__blockä¿®é¥°ç¬¦ 3.blockä¿®é¥°çš„å˜é‡ï¼Œå…¶å®è¿™å°±æ˜¯å˜æˆäº†ä¸ªå¯¹è±¡ç»“æ„ä½“Block_byref_val_0,åˆå§‹åŒ–main_block_impl_0çš„æ—¶å€™è¿½åŠ çš„æ˜¯blockç”Ÿæˆçš„ç»“æ„ä½“æŒ‡é’ˆ,ä¾‹å¦‚__block int a = 0;è¿™ä¸ªintä¸åœ¨æ˜¯æ™®é€šçš„æ•°æ®ç±»å‹ï¼Œè€Œæ˜¯åœ¨æ ‡è¯†ç¬¦çš„å¼•ç”¨ä¸‹å˜æˆäº†å¯¹è±¡ 1234567struct __Block_byref_a_0 &#123; void *__isa; __Block_byref_a_0 *__forwarding; int __flags; int __size; int a; &#125;; è€Œintçš„å€¼å°±å­˜å‚¨åœ¨è¿™ä¸ªå¯¹è±¡çš„ä¸€ä¸ªå­—æ®µ aä¸­ï¼Œè€ŒBlockæˆªè·çš„å°±æ˜¯è¿™ä¸ªç»“æ„ä½“å¯¹è±¡çš„æŒ‡é’ˆï¼Œå¯ä»¥éšæ„ä¿®æ”¹ç»“æ„ä½“å†…éƒ¨açš„å€¼ 4.æœ€ç»ˆåœ¨main_block_func_0å‡½æ•°ä¸­è°ƒç”¨blockç»“æ„ä½“æŒ‡é’ˆçš„forwardingæŒ‡é’ˆï¼ˆè¿™ä¸€èŠ‚æŒ‡å‘è‡ªå·±ï¼Œåé¢ä¼šå˜ï¼‰çš„æˆå‘˜å˜é‡aæ¥è¿›è¡Œé‡æ–°èµ‹å€¼ 5.å…¶å®__blockè¿™æ–¹æ³•ç”Ÿæˆçš„æºç ï¼Œèƒ½å¤§è‡´çœ‹å‡ºæ¥è¿™å…¶å®ç±»ä¼¼OCé‡Œé¢å¯¹è±¡çš„retainå’Œreleaseä¸€ç³»åˆ—æ“ä½œ ä¸‰ç§ Block æœ¬ä½“åˆ°è¿™ä¸ªé˜¶æ®µï¼Œæˆ‘ä»¬ç”¨Cçš„ç»“æ„ç¼–è¯‘çš„ä»£ç ä»¥åŠæºç èƒ½çœ‹åˆ°Blockç»“æ„ä½“å†…éƒ¨çš„isaæŒ‡é’ˆæ˜¯æŒ‡å‘_NSConcreteStackBlockçš„ï¼Œå…¶å®è¿™åªæ˜¯å…¶ä¸­çš„ä¸€ç§ï¼Œåˆ†åˆ«è¿˜æœ‰_NSContreteGlobalBlock å’Œ _NSContreteMallocBlock,å¯ä»¥æ ¹æ®å‘½åçš„åç¼€çœ‹å‡ºæ¥StackBlockæ˜¯è®¾ç½®åœ¨æ ˆä¸Šçš„ï¼ŒGlobalBlockå°±ç±»ä¼¼å…¨å±€å˜é‡ï¼Œè®¾ç½®åœ¨ç¨‹åºçš„æ•°æ®åŒºåŸŸï¼ˆ.dataåŒºåŸŸï¼‰ï¼Œé‚£ä¹ˆæœ€é‡è¦çš„ä¹Ÿæ˜¯æˆ‘ä»¬å†™OCä»£ç çš„æ—¶å€™æ ¹æœ¬ä¸å…³æ³¨çš„ä¸€ç§ç±»å‹NSContreteMallocBlockï¼Œæ²¡é”™ï¼Œä»–å°±æ˜¯å’Œå¯¹è±¡ä¸€æ ·åˆ†ç±»å†…å­˜å—(å †)ä¸­ã€‚ 12345&#123; NSConcreteGlobalBlock; // åœ¨å…¨å±€ä¸­å®šä¹‰çš„ï¼ˆæ•°æ®åŒºåŸŸï¼‰ NSConcreteStackBlock; // åœ¨å±€éƒ¨å®šä¹‰çš„ï¼ˆæ ˆï¼‰ NSConcreteMallocBlock; // åˆ†é…åœ¨å †ä¸­&#125; NSConcreteGlobalBlock å…¨å±€å®šä¹‰ä¸Šé¢æˆ‘ä»¬è¯´çš„éƒ½æ˜¯ NSConcreteStackBlock åœ¨å±€éƒ¨å®šä¹‰çš„ï¼ˆæ ˆï¼‰ï¼Œä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹ NSConcreteGlobalBlock ä½ å¯ä»¥æŠŠå®ƒç†è§£ä¸ºå…¨å±€å˜é‡ï¼Œåæ­£å­˜å‚¨åœ¨.dataåŒºåŸŸçš„ï¼Œæœ€ç›´æ¥å¾—å†™æ³•æ˜¯è¿™æ ·çš„ 123void (^block)(void) = ^&#123;&#125;; int main()&#123;&#125; Clang è½¬æ¢è¿‡åçš„æºç æŒ‡é’ˆimpl.isa = &amp;_NSContreteGlobalBlockç±»å‹çš„ ç”±äºåœ¨ä½¿ç”¨å…¨å±€å˜é‡çš„åœ°æ–¹ä¸èƒ½ä½¿ç”¨å±€éƒ¨å˜é‡ï¼Œè¿™ä¹ˆè¯´æ¥å°±æ ¹æœ¬ä¸å­˜åœ¨å¯¹å±€éƒ¨å˜é‡çš„æ•è·ã€‚é‚£ä¹ˆè¿™ä¸ªBlockçš„ç»“æ„ä½“å®ä¾‹çš„å†…å®¹å‹æ ¹ä¸ä¼šå†è¿›è¡Œè¿½åŠ æˆå‘˜å˜é‡ï¼Œæ‰€ä»¥ä¸ä¼šä¾èµ–äºæ‰§è¡ŒçŠ¶æ€ï¼Œæ‰€ä»¥æ•´ä¸ªç¨‹åºè¿è¡Œåªæœ‰ä¸€ä¸ªå®ä¾‹ã€‚å› æ­¤å°†Blockä½¿ç”¨çš„ç»“æ„ä½“å®ä¾‹è®¾ç½®åœ¨ä¸å…¨å±€å˜é‡ç›¸åŒçš„æ•°æ®åŒºåŸŸå³å¯ã€‚ï¼ˆæŠŠå®ƒç†è§£ä¸ºå•çº¯çš„å…¨å±€å˜é‡å°±å¥½äº†ï¼Œè€Œä¸”ä¸ä¼šæœ‰ä»»ä½•å€¼çš„æ•è·ï¼‰ å­˜åœ¨çš„ä¸¤ç§æ¡ˆä¾‹ å…¨å±€å˜é‡çš„åœ°æ–¹ï¼Œç”¨è¿™ç§Blockè¯­æ³•æ—¶ï¼Œå¦‚ä¸Šé¢æ‰€ç¤º Blockè¯­æ³•ä¸­è¡¨è¾¾å¼ä¸æˆªè·ä»»ä½•å±€éƒ¨å˜é‡æ—¶ï¼Œè¿™ä¸ªç¨åDemoä»‹ç»ï¼Œä¹Ÿå¾ˆç®€å• NSContreteMallocBlock å †å®šä¹‰é…ç½®åœ¨å…¨å±€çš„GlobalBlockå¯ä»¥å‡ºäº†ä½œç”¨åŸŸè¿˜æ˜¯èƒ½ç»§ç»­è®¿é—®ï¼Œä½†æ˜¯åœ¨æ ˆä¸Šçš„StackBlockå°±åºŸå¼ƒäº†ï¼Œå› æ­¤ä¸ºäº†å‡ºäº†ä½œç”¨åŸŸèƒ½ç»§ç»­ä½¿ç”¨ï¼ŒBlocksæä¾›äº†æŠŠBlockå’Œblockè¿™ä¸¤ä¸ªä¸œè¥¿ä»æ ˆä¸Šå¤åˆ¶åˆ°å †ä¸Šçš„æ–¹æ³•æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚è€Œ_forwardingå…¶å®æ—¢å¯ä»¥æŒ‡å‘è‡ªå·±ï¼Œä¹Ÿå¯ä»¥æŒ‡å‘å¤åˆ¶åçš„è‡ªå·±ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰äº†è¿™ä¸ªæŒ‡é’ˆçš„å­˜åœ¨ï¼Œæ— è®ºblockå˜é‡é…ç½®åœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šéƒ½èƒ½å¤Ÿæ­£ç¡®çš„è®¿é—®__blockå˜é‡ ä¸€ç§ä½œä¸ºè¿”å›å€¼è¿”å›çš„æƒ…å†µ1234typedef void(^block)(void); block func (int a) &#123; return ^&#123;&#125;; &#125; è½¬æ¢å12345block func (int a) &#123; block tmp = ((void (*)())&amp;__func_block_impl_0((void *)__func_block_func_0, &amp;__func_block_desc_0_DATA)); tmp = objc_retainBlock(tmp); return objc_autoreleaseReturnValue(tmp); &#125; è¿™é‡Œå…ˆæ˜¯é€šè¿‡Blockè¯­æ³•ç”ŸæˆBlockï¼Œå³ç”Ÿæˆé…ç½®åœ¨æ ˆä¸Šçš„Blockç»“æ„ä½“å®ä¾‹ï¼Œç„¶åèµ‹å€¼ç»™Blockç±»å‹çš„å˜é‡tmpä¸­ï¼Œç„¶åæ‰§è¡Œobjc_retainBlock(tmp)è¿™å¥å…¶å®å°±æ˜¯_Block_copy(tmp)ï¼Œå°†æ ˆä¸Šçš„çš„Blockå¤åˆ¶åˆ°å †ä¸Šï¼Œèµ‹å€¼åå°†å †ä¸Šçš„æŒ‡é’ˆèµ‹å€¼ç»™tmpï¼Œç„¶åå †ä¸Šçš„æ‰€æœ‰éƒ½æ˜¯å¯¹è±¡ï¼Œéœ€è¦æ³¨å†Œé™¶autoreleasepoolä¸­è¿›è¡Œç®¡ç†ï¼Œç„¶åè¿”å›å…¶å¯¹è±¡ å…¶å®è¿™ç§å†…éƒ¨è°ƒç”¨æ–¹å¼ï¼ŒMallocBlockå°±æ˜¯å¯¹è±¡ï¼Œè€Œä¸”è¿™ç§å†™æ³•æ˜¯å¦å¾ˆä¼¼æ›¾ç›¸è¯†ï¼Œå°±æ˜¯ç±»æ–¹æ³•å®ä¾‹åŒ– 1234- (NSArray *) myTestArray &#123; NSArray *array = [[NSArray alloc] initWithObjects: @\"a\", @\"b\", @\"c\", nil nil]; return [array autorelease]; &#125; ç®€å•æ¥è¯´å°±æ˜¯ç¬¬ä¸€æ­¥copyBlockåˆ°å †ä¸Šï¼Œç„¶åå’ŒOCå¯¹è±¡ä¸€æ ·ï¼Œè¿”å›çš„å¯¹è±¡éœ€è¦è¿›è¡Œautoreleaseé˜²æ²»å†…å­˜æ³„éœ² ARCä¸‹é¢å¾ˆå¤šéƒ½å·²ç»è‡ªåŠ¨å¸®æˆ‘ä»¬Copyæˆäº†MallocBlockäº†ï¼Œè¯·çœ‹ä¸€ä¸‹å‡ ç§æƒ…å†µ ç”±äºBlockæ˜¯é»˜è®¤å»ºç«‹åœ¨æ ˆä¸Š,æ‰€ä»¥å¦‚æœç¦»å¼€æ–¹æ³•ä½œç”¨åŸŸï¼ŒBlockå°±ä¼šè¢«ä¸¢å¼ƒï¼Œåœ¨éARCæƒ…å†µä¸‹ï¼Œæˆ‘ä»¬è¦è¿”å›ä¸€ä¸ªBlockï¼Œéœ€è¦ 1[Block copy]; åœ¨ARCä¸‹,ä»¥ä¸‹å‡ ç§æƒ…å†µ, Blockä¼šè‡ªåŠ¨è¢«ä»æ ˆå¤åˆ¶åˆ°å †: 1.è¢«æ‰§è¡Œcopyæ–¹æ³• 2.ä½œä¸ºæ–¹æ³•è¿”å›å€¼ 3.å°†Blockèµ‹å€¼ç»™é™„æœ‰__strongä¿®é¥°ç¬¦çš„idç±»å‹çš„ç±»æˆ–è€…Blcokç±»å‹æˆå‘˜å˜é‡æ—¶ 4.åœ¨æ–¹æ³•åä¸­å«æœ‰usingBlockçš„Cocoaæ¡†æ¶æ–¹æ³•æˆ–è€…GDCçš„APIä¸­ä¼ é€’çš„æ—¶å€™ æ¥çŒœä¸€çŒœ1234567891011121314151617181920212223242526272829303132333435363738394041424344454647int a = 1; // è¿™é‡Œçš„^&#123;&#125;åˆå§‹åŒ–çš„blockèµ‹å€¼ç»™blockå˜é‡ï¼Œåœ¨OCä¸­æ²¡æœ‰å…·ä½“å†™æ˜çš„æƒ…å†µä¸‹åº”è¯¥å°±æ˜¯strongç±»å‹çš„ï¼Œè¿™å°±æ˜¯ä¸Šé¢ç¬¬ä¸‰ç‚¹çš„ä¾‹å­ // æ‰“å°å‡ºæ¥ first &lt;__NSMallocBlock__: 0x60800004d290&gt; void (^block)(void) = ^&#123; NSLog(@\"%d\",a); &#125;; NSLog(@\"first %@\",block); // æ²¡æœ‰æˆªè·å˜é‡çš„æ—¶å€™å°±æ˜¯globalBlock // second&lt;__NSGlobalBlock__: 0x102f80100&gt; NSLog(@\"second%@\",^&#123;NSLog(@\"å‘µå‘µ\");&#125;); // æˆªè·äº†å˜é‡å°±æ˜¯stackBlock // third&lt;__NSStackBlock__: 0x7fff5cc7faa0&gt; NSLog(@\"third%@\",^&#123;NSLog(@\"%d\",a);&#125;); __block int val = 10; __strong blk strongPointerBlock = ^&#123;NSLog(@\"val1 = %d\", ++val);&#125;; // strongPointerBlock: &lt;__NSMallocBlock__: 0x600000044e90&gt; NSLog(@\"strongPointerBlock: %@\", strongPointerBlock); //1 __weak blk weakPointerBlock = ^&#123;NSLog(@\"val2 = %d\", ++val);&#125;; // weakPointerBlock: &lt;__NSStackBlock__: 0x7fff5282ea70&gt; NSLog(@\"weakPointerBlock: %@\", weakPointerBlock); //2 // mallocBlock3: &lt;__NSMallocBlock__: 0x608000046930&gt; NSLog(@\"mallocBlock3: %@\", [weakPointerBlock copy]); //3 // æˆªè·äº†test &lt;__NSStackBlock__: 0x7fff5282ea48&gt; NSLog(@\"test4 %@\", ^&#123;NSLog(@\"val4 = %d\", ++val);&#125;); //4 // test5 &lt;__NSMallocBlock__: 0x60800005c0b0&gt; NSLog(@\"test5 %@\", [^&#123;NSLog(@\"val4 = %d\", ++val);&#125; copy]); //5 // stackBlockç»è¿‡ä¼ å‚ æ‰“å° NSLog(@\"ä¼ å‚å %@\",[self getBlock]); &#125; - (blk)getBlock &#123; int val = 11; // ä¸Šé¢å·²ç»ä»‹ç»äº†ï¼Œè¿™ç§ç›´æ¥æ‰“å°ä¼ å‚å‰çš„blockï¼Œåº”è¯¥æ˜¯__NSStackBlock__ NSLog(@\"ä¼ å‚å‰ï¼š%@\",^&#123;NSLog(@\"%d\",val);&#125;); // é‚£ä¹ˆç°åœ¨æˆ‘ä»¬ç›´æ¥ä¼ å‡ºå» return ^&#123;NSLog(@\"%d\",val);&#125;; &#125; è¿™é‡ŒæŠŠå‡ ç§æƒ…å†µéƒ½æ‰“å°äº†ä¸€ä¸‹çœ‹çœ‹åˆ°åº•æ˜¯å“ªä¸ªç±»å‹ 1.ç¬¬ä¸€ä¸ªå’Œç¬¬äºŒä¸ªæ‰“å°çš„åŒºåˆ«åœ¨äºï¼Œç¬¬ä¸€ä¸ªç”Ÿæˆçš„Blocké»˜è®¤èµ‹å€¼ç»™äº†blockå˜é‡ï¼Œç¬¬äºŒä¸ªç›´æ¥æ‰“å°ï¼Œç”±äºOCé‡Œé¢æ²¡æœ‰ä¿®é¥°ç¬¦é»˜è®¤å°±æ˜¯strongï¼Œæ‰€ä»¥è¿™ä¹ˆçœ‹æ¥éµå¾ªç¬¬ä¸‰æ¡è§„åˆ™ä¹‹åï¼Œç¬¬äºŒæ¡æ¡æ‰“å°å°±æ˜¯NSGlobalBlockï¼ˆæ²¡æœ‰æˆªè·å˜é‡ï¼‰ï¼Œç¬¬ä¸€æ¡æ‰“å°å°±æ˜¯NSMallocBlockï¼ˆè‡ªåŠ¨å¤åˆ¶åˆ°å †ä¸Šäº†ï¼‰ 2.åé¢ç”¨strongä¿®é¥°ç¬¦å’Œweakä¿®é¥°ç¬¦åˆ†åˆ«æ‰“å°çš„æ˜¯mallocçš„å’Œstackçš„ï¼Œä½†æ˜¯æ— è®ºå“ªç§ï¼Œåªè¦copyå°±æ˜¯å˜æˆmallocç±»å‹äº† 3.æœ€åä¸€ç§å°±æ˜¯ä¸Šé¢ä»‹ç»çš„ï¼ŒstackBlockç»è¿‡ä¼ å‚ï¼Œè‡ªåŠ¨å˜æˆäº†mallocBlock å±æ€§ä¿®é¥°ç¬¦ copy ä¿®é¥° Blockæ¥çœ‹ä¸€å¼ è¡¨ï¼Œçœ‹çœ‹ä¸‰ç§ç±»å‹copyä¹‹åæœ‰ä»€ä¹ˆåŒºåˆ« 1@property (nonatomic,copy) blk blk; å½“æˆ‘ä»¬è¿™ä¹ˆå£°æ˜å±æ€§çš„æ—¶å€™ï¼Œå…¶setteræ–¹æ³•å°±æ˜¯ç”¨äº†copyæ–¹æ³• 123456- (void)setBlk:(blk)blk &#123; if (_blk != blk) &#123; [_blk release]; // MRC _blk = [blk copy]; &#125; &#125; 1.è¶…å‡ºä½œç”¨åŸŸå­˜åœ¨çš„ç†ç”±å°±æ˜¯ç”Ÿæˆäº†MallocBlockå¯¹è±¡ï¼Œå³ä½¿å‡ºæ ˆäº†è¿˜æ˜¯èƒ½ç»§ç»­è°ƒç”¨ 2.forwardingçš„ç†ç”±å°±æ˜¯æ— è®ºåœ¨å †ä¸Šè¿˜æ˜¯æ ˆä¸Šï¼Œæˆ‘ä»¬éƒ½èƒ½è®¿é—®Blockï¼Œè€Œä¸”èƒ½ä¿è¯è®¿é—®åŒä¸€ä¸ª 3.GlobalBlock ã€MallocBlockå’ŒStackBlockçš„åŒºåˆ«ä»¥åŠå¦‚ä½•Blockå¦‚ä½•ä¼šè¢«copyåˆ°å †ä¸Š 4.ç‰¹åˆ«ä¸Šä½œä¸ºå‚æ•°ä¼ é€’æ—¶ï¼Œç±»ä¼¼ç±»æ–¹æ³•çš„autoreleasepoolæ³¨å†Œè¿›å»ï¼Œé¿å…å†…å­˜æ³„éœ² 5.åœ¨æ­£å¸¸å†™ä»£ç çš„æ—¶å€™ä¸éœ€è¦ç®¡ç†è¿™ä¸ªï¼Œé»˜è®¤ç™¾åˆ†ä¹‹99çš„æƒ…å†µåŸºæœ¬éƒ½æ˜¯MallocBlock 6.æ— è®ºä»€ä¹ˆæƒ…å†µä¸‹ï¼Œcopyä¸€ä¸‹æˆ–è€…å¼ºæŒ‡é’ˆå¼•ç”¨ä¸€ä¸‹æ˜¯ä¸ä¼šæœ‰é”™çš„ï¼Œèƒ½ä¿è¯å¿…ç„¶æ˜¯MallocBlock 7.å„ç§è¿¹è±¡è¡¨æ˜ï¼Œä»–å°±æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡copyæ”¹å˜ç±»å‹çš„ç‰¹æ®Šå¯¹è±¡ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://blog.csdn.net/deft_mkjing/article/details/53143076","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šThread","slug":"iOS Principle Thread","date":"2018-06-09T13:56:27.000Z","updated":"2018-11-18T05:37:42.197Z","comments":true,"path":"2018/06/09/iOS Principle Thread/","link":"","permalink":"https://reversescale.github.io/2018/06/09/iOS Principle Thread/","excerpt":"è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€~","text":"è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿†ï¼š è¿›ç¨‹å’Œçº¿ç¨‹ï¼šè¿›ç¨‹æ˜¯é¥­é¦†ã€çº¿ç¨‹æ˜¯å·¥ä½œäººå‘˜ çº¿ç¨‹çš„æ‰§è¡Œï¼š1ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼šCPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ iOS å¤šçº¿ç¨‹ pthreadï¼šcè¯­è¨€çš„é€šç”¨apiï¼Œè·¨å¹³å°ã€éš¾åº¦å¤§ã€éè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ NSThreadï¼šé¢å‘å¯¹è±¡çš„éè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ GCDï¼šåˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ NSOperationã€NSOperationQueueï¼šå°è£…GCDï¼ŒåŠ å¼ºä¾èµ–å…³ç³»ã€ç›‘æ§çŠ¶æ€ã€å¹¶å‘ç®¡ç† å¸¸ç”¨å®‰å…¨é”ï¼š@synchronized{}ã€[self.lock lock] ç›¸å…³æ¦‚å¿µè¿›ç¨‹è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…ã€‚ çº¿ç¨‹çº¿ç¨‹å’Œè¿›ç¨‹çš„å…³ç³» 1ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼ˆæ¯1ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰1æ¡çº¿ç¨‹ï¼‰ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ çº¿ç¨‹å†…éƒ¨æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Ÿ 1ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œå¦‚æœè¦åœ¨1ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆåªèƒ½ä¸€ä¸ªä¸€ä¸ªåœ°æŒ‰é¡ºåºæ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€æ—¶é—´å†…ï¼Œ1ä¸ªçº¿ç¨‹åªèƒ½æ‰§è¡Œ1ä¸ªä»»åŠ¡ã€‚ å¤šçº¿ç¨‹å³1ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¯ä»¥å¹¶è¡Œï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚æ¯”å¦‚åŒæ—¶å¼€å¯3æ¡çº¿ç¨‹åˆ†åˆ«ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆåˆ†åˆ«æ˜¯æ–‡ä»¶Aã€æ–‡ä»¶Bã€æ–‡ä»¶Cï¼‰ã€‚ å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„åŸç†ï¼Ÿ åœ¨åŒä¸€æ—¶é—´é‡Œï¼ŒCPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œåªæœ‰1æ¡çº¿ç¨‹åœ¨å·¥ä½œï¼ˆæ‰§è¡Œï¼‰ã€‚å¤šçº¿ç¨‹å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰ï¼Œå¦‚æœCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ï¼Œå°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡ã€‚ å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ï¼Ÿ ä¼˜ç‚¹ï¼š 1ï¼‰èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚ 2ï¼‰èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰ ç¼ºç‚¹ï¼š 1ï¼‰å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KBï¼‰ï¼Œå¦‚æœå¼€å¯å¤§é‡çš„çº¿ç¨‹ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œé™ä½ç¨‹åºçš„æ€§èƒ½ã€‚ 2ï¼‰çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§ã€‚ 3ï¼‰ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼šæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€å¤šçº¿ç¨‹çš„æ•°æ®å…±äº« å¤šçº¿ç¨‹åœ¨ iOS å¼€å‘ä¸­çš„åº”ç”¨iOS çš„ä¸»çº¿ç¨‹ï¼Ÿ ä¸€ä¸ª iOS ç¨‹åºè¿è¡Œåï¼Œé»˜è®¤ä¼šå¼€å¯1æ¡çº¿ç¨‹ï¼Œç§°ä¸ºâ€œä¸»çº¿ç¨‹â€æˆ–â€œUIçº¿ç¨‹â€ï¼Œç”¨äºåˆ·æ–°æ˜¾ç¤ºUI,å¤„ç†UIäº‹ä»¶ã€‚ ä¸è¦å°†è€—æ—¶æ“ä½œæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­å»å¤„ç†ï¼Œä¼šå¡ä½çº¿ç¨‹ã€‚ iOS çš„å¤šçº¿ç¨‹ï¼Ÿ 1ï¼‰ç¬¬ä¸€ç§ï¼špthread ç‰¹ç‚¹ï¼š ä¸€å¥—é€šç”¨çš„å¤šçº¿ç¨‹API é€‚ç”¨äºUnix\\Linux\\Windowsç­‰ç³»ç»Ÿ è·¨å¹³å°\\å¯ç§»æ¤ ä½¿ç”¨éš¾åº¦å¤§ ä½¿ç”¨è¯­è¨€ï¼šcè¯­è¨€ ä½¿ç”¨é¢‘ç‡ï¼šå‡ ä¹ä¸ç”¨ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šç”±ç¨‹åºå‘˜è¿›è¡Œç®¡ç† 2ï¼‰ç¬¬äºŒç§ï¼šNSThread ç‰¹ç‚¹ï¼š ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡ ç®€å•æ˜“ç”¨ï¼Œå¯ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡ ä½¿ç”¨è¯­è¨€ï¼šOCè¯­è¨€ ä½¿ç”¨é¢‘ç‡ï¼šå¶å°”ä½¿ç”¨ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šç”±ç¨‹åºå‘˜è¿›è¡Œç®¡ç† 3ï¼‰ç¬¬ä¸‰ç§ï¼šGCD ç‰¹ç‚¹ï¼š æ—¨åœ¨æ›¿ä»£NSThreadç­‰çº¿ç¨‹æŠ€æœ¯ å……åˆ†åˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸(è‡ªåŠ¨) ä½¿ç”¨è¯­è¨€ï¼šOCè¯­è¨€ ä½¿ç”¨é¢‘ç‡ï¼šç»å¸¸ä½¿ç”¨ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šè‡ªåŠ¨ç®¡ç† 4ï¼‰ç¬¬å››ç§ï¼šNSOperation ç‰¹ç‚¹ï¼š åŸºäºGCDï¼ˆåº•å±‚æ˜¯GCDï¼‰ æ¯”GCDå¤šäº†ä¸€äº›æ›´ç®€å•å®ç”¨çš„åŠŸèƒ½ ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡ å¯¹æ¯” GCD çš„ä¼˜ç‚¹ï¼š åœ¨NSOperationQueueä¸­ï¼Œå¯ä»¥å»ºç«‹å„ä¸ªNSOperationä¹‹é—´çš„ä¾èµ–å…³ç³» æœ‰KVOï¼Œå¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ï¼Œæ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰ NSOperationQueueå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†å¹¶å‘ã€NSOperationä¹‹é—´çš„ä¼˜å…ˆçº§ ä½¿ç”¨è¯­è¨€ï¼šOCè¯­è¨€ ä½¿ç”¨é¢‘ç‡ï¼šç»å¸¸ä½¿ç”¨ çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šè‡ªåŠ¨ç®¡ç† ä»£ç ç¤ºä¾‹ç”±äºè¦ä½¿ç”¨ä¸€äº› c æ¥æ¼”ç¤ºï¼Œå…ˆè¯´æ˜äº›è§„èŒƒï¼Œé˜²æ‡µé€¼ ğŸ˜³ 1.åœ¨cè¯­è¨€ä¸­ï¼Œæ²¡æœ‰å¯¹è±¡çš„æ¦‚å¿µï¼Œå¯¹è±¡ç±»å‹æ˜¯ä»¥-t/Refç»“å°¾çš„; 2.cè¯­è¨€ä¸­çš„void * å’ŒOCçš„idæ˜¯ç­‰ä»·çš„; 3.åœ¨æ··åˆå¼€å‘æ—¶ï¼Œå¦‚æœåœ¨ C å’Œ OC ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ __bridge è¿›è¡Œæ¡¥æ¥ï¼Œæ¡¥æ¥çš„ç›®çš„å°±æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•ç®¡ç†å†…å­˜ï¼ŒMRC ä¸­ä¸éœ€è¦ä½¿ç”¨æ¡¥æ¥; 4.åœ¨ OC ä¸­ï¼Œå¦‚æœæ˜¯ ARC å¼€å‘ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ï¼Œæ ¹æ®ä»£ç ç»“æ„ï¼Œ è‡ªåŠ¨æ·»åŠ  retain/release/autoreleaseã€‚ä½†æ˜¯ï¼ŒARC åªè´Ÿè´£ç®¡ç† OC éƒ¨åˆ†çš„å†…å­˜ç®¡ç†ï¼Œè€Œä¸è´Ÿè´£ C è¯­è¨€ ä»£ç çš„å†…å­˜ç®¡ç†ã€‚å› æ­¤ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä½¿ç”¨çš„ C è¯­è¨€æ¡†æ¶å‡ºç°retain/create/copy/new ç­‰å­—æ ·çš„å‡½æ•°ï¼Œå¤§å¤šéƒ½éœ€è¦ releaseï¼Œå¦åˆ™ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚ pthread åŸºæœ¬ä½¿ç”¨éœ€è¦å¼•å…¥ pthread å¤´æ–‡ä»¶1#import &lt;pthread.h&gt; ä½¿ç”¨ pthread_create æ–¹æ³•12345678/**pthread_create(&lt;#pthread_t _Nullable *restrict _Nonnull#&gt;, &lt;#const pthread_attr_t *restrict _Nullable#&gt;, &lt;#void * _Nullable (* _Nonnull)(void * _Nullable)#&gt;, &lt;#void *restrict _Nullable#&gt;)å‚æ•°ï¼š1.æŒ‡å‘çº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆï¼ŒC è¯­è¨€ä¸­ç±»å‹çš„ç»“å°¾é€šå¸¸ _t/Refï¼Œè€Œä¸”ä¸éœ€è¦ä½¿ç”¨ *;2.ç”¨æ¥è®¾ç½®çº¿ç¨‹å±æ€§;3.æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ,ä¼ å…¥å‡½æ•°å(å‡½æ•°çš„åœ°å€)ï¼Œçº¿ç¨‹è¦æ‰§è¡Œçš„å‡½æ•°/ä»»åŠ¡;4.è¿è¡Œå‡½æ•°çš„å‚æ•°;*/ å®Œæ•´ä»£ç 1234567891011121314151617&#123; //1.åˆ›å»ºçº¿ç¨‹å¯¹è±¡ pthread_t thread; //2.åˆ›å»ºçº¿ç¨‹ NSString *param = @\"å‚æ•°\"; int result = pthread_create(&amp;thread, NULL, task, (__bridge void *)(param)); result == 0?NSLog(@\"success\"):NSLog(@\"failure\"); //3.è®¾ç½®å­çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºdetached,åˆ™è¯¥çº¿ç¨‹è¿è¡Œç»“æŸåä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æºï¼Œæˆ–è€…åœ¨å­çº¿ç¨‹ä¸­æ·»åŠ  pthread_detach(pthread_self()),å…¶ä¸­pthread_self()æ˜¯è·å¾—çº¿ç¨‹è‡ªèº«çš„id pthread_detach(thread);&#125;void *task(void * param) &#123; //åœ¨æ­¤åšè€—æ—¶æ“ä½œ NSLog(@\"new thread : %@ å‚æ•°æ˜¯: %@\",[NSThread currentThread],(__bridge NSString *)(param)); return NULL;&#125; NSThread åŸºæœ¬ä½¿ç”¨1.1ï¼‰ç¬¬ä¸€ç§ åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šalloc init. ç‰¹ç‚¹ï¼šéœ€è¦æ‰‹åŠ¨å¼€å¯çº¿ç¨‹ï¼Œå¯ä»¥æ‹¿åˆ°çº¿ç¨‹å¯¹è±¡è¿›è¡Œè¯¦ç»†è®¾ç½® ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ ç¬¬äºŒä¸ªå‚æ•°ï¼šé€‰æ‹©å™¨ï¼Œçº¿ç¨‹å¯åŠ¨è¦è°ƒç”¨å“ªä¸ªæ–¹æ³• ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå‰é¢æ–¹æ³•è¦æ¥æ”¶çš„å‚æ•°ï¼ˆæœ€å¤šåªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ²¡æœ‰åˆ™ä¼ nilï¼‰ 123NSThread *thread = [[NSThread alloc]initWithTarget:self selector:@selector(run) object:@\"wendingding\"];//å¯åŠ¨çº¿ç¨‹[thread start]; 1.2ï¼‰ç¬¬äºŒç§ åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šåˆ†ç¦»å‡ºä¸€æ¡å­çº¿ç¨‹ ç‰¹ç‚¹ï¼šè‡ªåŠ¨å¯åŠ¨çº¿ç¨‹ï¼Œæ— æ³•å¯¹çº¿ç¨‹è¿›è¡Œæ›´è¯¦ç»†çš„è®¾ç½® ç¬¬ä¸€ä¸ªå‚æ•°ï¼šçº¿ç¨‹å¯åŠ¨è°ƒç”¨çš„æ–¹æ³• ç¬¬äºŒä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡ ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¼ é€’ç»™è°ƒç”¨æ–¹æ³•çš„å‚æ•° 1[NSThread detachNewThreadSelector:@selector(run) toTarget:self withObject:@\"æˆ‘æ˜¯åˆ†ç¦»å‡ºæ¥çš„å­çº¿ç¨‹\"]; 1.3ï¼‰ç¬¬ä¸‰ç§ åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šåå°çº¿ç¨‹ ç‰¹ç‚¹ï¼šè‡ªåŠ¨å¯åŠ¨å¿åŸï¼Œæ— æ³•è¿›è¡Œæ›´è¯¦ç»†è®¾ç½® 1[self performSelectorInBackground:@selector(run) withObject:@\"æˆ‘æ˜¯åå°çº¿ç¨‹\"]; 2ï¼‰å¸¸ç”¨çš„æ§åˆ¶çº¿ç¨‹æ–¹æ³• ä¸ºçº¿ç¨‹å‘½åï¼Œä»¥ä¾¿åŒºåˆ†12//è®¾ç½®çº¿ç¨‹çš„åç§°thread.name = @\"çº¿ç¨‹A\"; è®¾ç½®ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´ä¸º0.0~1.0ä¹‹é—´ï¼Œ1.0è¡¨ç¤ºçº¿ç¨‹çš„ä¼˜å…ˆçº§æœ€é«˜,å¦‚æœä¸è®¾ç½®è¯¥å€¼ï¼Œé‚£ä¹ˆç†æƒ³çŠ¶æ€ä¸‹é»˜è®¤ä¸º0.512//è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§thread.threadPriority = 1.0; é€€å‡ºå½“å‰çº¿ç¨‹12//é€€å‡ºå½“å‰çº¿ç¨‹[NSThread exit]; çº¿ç¨‹çš„å„ç§çŠ¶æ€ï¼šæ–°å»º-å°±ç»ª-è¿è¡Œ-é˜»å¡-æ­»äº¡ï¼Œé˜»å¡çº¿ç¨‹æ–¹æ³•æ¥äº†123[NSThread sleepForTimeInterval:2.0]; //é˜»å¡çº¿ç¨‹[NSThread sleepUntilDate:[NSDate dateWithTimeIntervalSinceNow:2.0]]; //é˜»å¡çº¿ç¨‹//æ³¨æ„ï¼šçº¿ç¨‹æ­»äº†ä¸èƒ½å¤ç”Ÿ 3ï¼‰çº¿ç¨‹å®‰å…¨ å‰æï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å—èµ„æºä¼šå‘ç”Ÿæ•°æ®å®‰å…¨é—®é¢˜ è§£å†³æ–¹æ¡ˆï¼šåŠ äº’æ–¥é” ç›¸å…³ä»£ç ï¼š@synchronized(self){} ä¸“ä¸šæœ¯è¯­-çº¿ç¨‹åŒæ­¥ åŸå­å’ŒéåŸå­å±æ€§ï¼ˆæ˜¯å¦å¯¹setteræ–¹æ³•åŠ é”ï¼‰ æ­»é”ï¼šæ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚ äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚ å æœ‰ä¸”ç­‰å¾…ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚ ä¸å¯å¼ºè¡Œå æœ‰:è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚ å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚ äº§ç”Ÿæ­»é”çš„åŸå› ä¸»è¦æ˜¯ï¼š å› ä¸ºç³»ç»Ÿèµ„æºä¸è¶³ã€‚ è¿›ç¨‹è¿è¡Œæ¨è¿›çš„é¡ºåºä¸åˆé€‚ã€‚ èµ„æºåˆ†é…ä¸å½“ç­‰ã€‚ å”®ç¥¨å‘˜å”®ç¥¨é—®é¢˜123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051@interface NSThreadSafeViewController ()//ä¸‰åªå”®ç¥¨å‘˜ğŸ±ğŸ¶ğŸ­@property (nonatomic, strong) NSThread *thread01;@property (nonatomic, strong) NSThread *thread02;@property (nonatomic, strong) NSThread *thread03;//æ€»ç¥¨æ•°@property(nonatomic, assign) NSInteger totalticket;@end@implementation NSThreadSafeViewController- (void)viewDidLoad &#123; [super viewDidLoad]; //å‡è®¾æœ‰10å¼ ç¥¨ self.totalticket = 10; //åˆ›å»ºçº¿ç¨‹ self.thread01 = [[NSThread alloc]initWithTarget:self selector:@selector(saleTicket) object:nil]; self.thread01.name = @\"å°ğŸ±\"; self.thread02 = [[NSThread alloc]initWithTarget:self selector:@selector(saleTicket) object:nil]; self.thread02.name = @\"å°ğŸ¶\"; self.thread03 = [[NSThread alloc]initWithTarget:self selector:@selector(saleTicket) object:nil]; self.thread03.name = @\"å°ğŸ­\";&#125;- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; //å¯åŠ¨çº¿ç¨‹ [self.thread01 start]; [self.thread02 start]; [self.thread03 start];&#125;//å”®ç¥¨- (void)saleTicket &#123; while (1) &#123; //2.åŠ äº’æ–¥é” @synchronized(self) &#123; [NSThread sleepForTimeInterval:0.03]; //1.å…ˆæŸ¥çœ‹ä½™ç¥¨æ•°é‡ NSInteger count = self.totalticket; if (count &gt; 0) &#123; self.totalticket = count - 1; NSLog(@\"%@å–å‡ºå»äº†ä¸€å¼ ç¥¨,è¿˜å‰©ä¸‹%zdå¼ ç¥¨\",[NSThread currentThread].name,self.totalticket); &#125; else &#123; NSLog(@\"%@å‘ç°å½“å‰ç¥¨å·²ç»ä¹°å®Œäº†--\",[NSThread currentThread].name); break; &#125; &#125; &#125;&#125; è¿è¡Œç»“æœ 4ï¼‰NSThread çº¿ç¨‹é—´é€šä¿¡ï¼ˆå­çº¿ç¨‹åŠ è½½å›¾ç‰‡å®Œæˆé€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°UIï¼‰123456789101112131415161718192021222324- (void)touchesBegan:(nonnull NSSet&lt;UITouch *&gt; *)touches withEvent:(nullable UIEvent *)event &#123; //å¼€å¯ä¸€æ¡å­çº¿ç¨‹æ¥ä¸‹è½½å›¾ç‰‡ [NSThread detachNewThreadSelector:@selector(downloadImage) toTarget:self withObject:nil];&#125;- (void)downloadImage &#123; //1.ç¡®å®šè¦ä¸‹è½½ç½‘ç»œå›¾ç‰‡çš„urlåœ°å€ï¼Œä¸€ä¸ªurlå”¯ä¸€å¯¹åº”ç€ç½‘ç»œä¸Šçš„ä¸€ä¸ªèµ„æº NSURL *url = [NSURL URLWithString:@\"http://p6.qhimg.com/t01d2954e2799c461ab.jpg\"]; //2.æ ¹æ®urlåœ°å€ä¸‹è½½å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°ï¼ˆäºŒè¿›åˆ¶æ•°æ® NSData *data = [NSData dataWithContentsOfURL:url]; //3.æŠŠä¸‹è½½åˆ°æœ¬åœ°çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆå›¾ç‰‡ UIImage *image = [UIImage imageWithData:data]; //4.å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI //4.1 ç¬¬ä¸€ç§æ–¹å¼ // [self performSelectorOnMainThread:@selector(showImage:) withObject:image waitUntilDone:YES]; //4.2 ç¬¬äºŒç§æ–¹å¼ // [self.imageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:YES]; //4.3 ç¬¬ä¸‰ç§æ–¹å¼ [self.imageView performSelector:@selector(setImage:) onThread:[NSThread mainThread] withObject:image waitUntilDone:YES];&#125; 5ï¼‰ç‰¹æ®Šç”¨æ³•ï¼ˆè®¡ç®—ä»£ç æ®µçš„æ‰§è¡Œæ—¶é—´ï¼‰1234567891011121314151617NSURL *url = [NSURL URLWithString:@\"http://p6.qhimg.com/t01d2954e2799c461ab.jpg\"];//ç¬¬ä¸€ç§æ–¹æ³•NSDate *start = [NSDate date];//2.æ ¹æ®urlåœ°å€ä¸‹è½½å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰NSData *data = [NSData dataWithContentsOfURL:url];NSDate *end = [NSDate date];NSLog(@\"ç¬¬äºŒæ­¥æ“ä½œèŠ±è´¹çš„æ—¶é—´ä¸º%f\",[end timeIntervalSinceDate:start]);//ç¬¬äºŒç§æ–¹æ³•CFTimeInterval start = CFAbsoluteTimeGetCurrent();NSData *data = [NSData dataWithContentsOfURL:url];CFTimeInterval end = CFAbsoluteTimeGetCurrent();NSLog(@\"ç¬¬äºŒæ­¥æ“ä½œèŠ±è´¹çš„æ—¶é—´ä¸º%f\",end - start); GCD åŸºæœ¬ä½¿ç”¨1ï¼‰GCD æ ¸å¿ƒæ¦‚å¿µ é˜Ÿåˆ—å’Œä»»åŠ¡ åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•° 2ï¼‰GCD ç»„åˆæ‹³ ğŸ¤£ å¼‚æ­¥å‡½æ•°ï¼š å¼‚æ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šå¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œä»»åŠ¡ å¼‚æ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šå¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ åŒæ­¥å‡½æ•°ï¼š åŒæ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ åŒæ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ ä¸»é˜Ÿåˆ—ï¼š å¼‚æ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ä¸²è¡Œæ‰§è¡Œä»»åŠ¡ åŒæ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼ˆæ³¨æ„æ­»é”å‘ç”Ÿï¼‰ 3ï¼‰GCD çº¿ç¨‹é—´é€šä¿¡123456789101112131415161718//0.è·å–ä¸€ä¸ªå…¨å±€çš„é˜Ÿåˆ—dispatch_queue_t queue = dispatch_get_global_queue(0, 0);//1.å…ˆå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼ŒæŠŠä¸‹è½½å›¾ç‰‡çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­å¤„ç†dispatch_async(queue, ^&#123; //2.ä¸‹è½½å›¾ç‰‡ NSURL *url = [NSURL URLWithString:@\"http://h.hiphotos.baidu.com/zhidao/pic/item/6a63f6246b600c3320b14bb3184c510fd8f9a185.jpg\"]; NSData *data = [NSData dataWithContentsOfURL:url]; UIImage *image = [UIImage imageWithData:data]; NSLog(@\"ä¸‹è½½æ“ä½œæ‰€åœ¨çš„çº¿ç¨‹--%@\",[NSThread currentThread]); //3.å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI dispatch_async(dispatch_get_main_queue(), ^&#123; self.imageView.image = image; //æ‰“å°æŸ¥çœ‹å½“å‰çº¿ç¨‹ NSLog(@\"åˆ·æ–°UI---%@\",[NSThread currentThread]); &#125;);&#125;); 4ï¼‰GCD å¸¸ç”¨å°åŠŸèƒ½ æ …æ å‡½æ•°ï¼ˆæ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼‰123dispatch_barrier_async(queue, ^&#123; NSLog(@\"--dispatch_barrier_async-\");&#125;); å»¶è¿Ÿæ‰§è¡Œï¼ˆå»¶è¿ŸÂ·æ§åˆ¶åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰123dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2.0 * NSEC_PER_SEC)), dispatch_get_global_ queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0), ^&#123; NSLog(@\"---%@\",[NSThread currentThread]);&#125;); ä¸€æ¬¡æ€§ä»£ç ï¼ˆæ³¨æ„ä¸èƒ½æ”¾åˆ°æ‡’åŠ è½½ï¼‰12345678- (void)once &#123; //æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªä¼šæ‰§è¡Œä¸€æ¬¡ //onceTokenç”¨æ¥è®°å½•è¯¥éƒ¨åˆ†çš„ä»£ç æ˜¯å¦è¢«æ‰§è¡Œè¿‡ static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; NSLog(@\"-----\"); &#125;);&#125; å¿«é€Ÿè¿­ä»£ï¼ˆå¼€å¤šä¸ªçº¿ç¨‹å¹¶å‘å®Œæˆè¿­ä»£æ“ä½œï¼‰12dispatch_apply(subpaths.count, queue, ^(size_t index) &#123;&#125;); é˜Ÿåˆ—ç»„ï¼ˆåŒæ …æ å‡½æ•°ï¼‰12345678910111213141516171819202122232425//åˆ›å»ºé˜Ÿåˆ—ç»„dispatch_group_t group = dispatch_group_create();dispatch_queue_t globalQueue = dispatch_get_global_queue(0, 0);dispatch_group_enter(group);//æ¨¡æ‹Ÿå¤šçº¿ç¨‹è€—æ—¶æ“ä½œdispatch_group_async(group, globalQueue, ^&#123; sleep(3); NSLog(@\"%@---block1ç»“æŸã€‚ã€‚ã€‚\",[NSThread currentThread]); dispatch_group_leave(group);&#125;);NSLog(@\"%@---1ç»“æŸã€‚ã€‚ã€‚\",[NSThread currentThread]);dispatch_group_enter(group);//æ¨¡æ‹Ÿå¤šçº¿ç¨‹è€—æ—¶æ“ä½œdispatch_group_async(group, globalQueue, ^&#123; sleep(3); NSLog(@\"%@---block2ç»“æŸã€‚ã€‚ã€‚\",[NSThread currentThread]); dispatch_group_leave(group);&#125;);NSLog(@\"%@---2ç»“æŸã€‚ã€‚ã€‚\",[NSThread currentThread]);dispatch_group_notify(group, globalQueue, ^&#123; NSLog(@\"%@---å…¨éƒ¨ç»“æŸã€‚ã€‚ã€‚\",[NSThread currentThread]);&#125;); NSOperation åŸºæœ¬ä½¿ç”¨1ï¼‰NSOperationã€NSOperationQueue ç®€ä»‹ NSOperationã€NSOperationQueue æ˜¯è‹¹æœæä¾›ç»™æˆ‘ä»¬çš„ä¸€å¥—å¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Š NSOperationã€NSOperationQueue æ˜¯åŸºäº GCD æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œå®Œå…¨é¢å‘å¯¹è±¡ã€‚ä½†æ˜¯æ¯” GCD æ›´ç®€å•æ˜“ç”¨ã€ä»£ç å¯è¯»æ€§ä¹Ÿæ›´é«˜ã€‚ ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ 1.å¯æ·»åŠ å®Œæˆçš„ä»£ç å—ï¼Œåœ¨æ“ä½œå®Œæˆåæ‰§è¡Œã€‚ 2.æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ–¹ä¾¿çš„æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚ 3.è®¾å®šæ“ä½œæ‰§è¡Œçš„ä¼˜å…ˆçº§ã€‚ 4.å¯ä»¥å¾ˆæ–¹ä¾¿çš„å–æ¶ˆä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œã€‚ 5.ä½¿ç”¨ KVO è§‚å¯Ÿå¯¹æ“ä½œæ‰§è¡ŒçŠ¶æ€çš„æ›´æ”¹ï¼šisExecuteingã€isFinishedã€isCancelledã€‚ 2ï¼‰NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ— æ—¢ç„¶æ˜¯åŸºäº GCD çš„æ›´é«˜ä¸€å±‚çš„å°è£…ã€‚é‚£ä¹ˆï¼ŒGCD ä¸­çš„ä¸€äº›æ¦‚å¿µåŒæ ·é€‚ç”¨äº NSOperationã€NSOperationQueueã€‚åœ¨ NSOperationã€NSOperationQueue ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä»»åŠ¡ï¼ˆæ“ä½œï¼‰å’Œé˜Ÿåˆ—ï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰çš„æ¦‚å¿µã€‚ æ“ä½œï¼ˆOperationï¼‰ï¼š æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚ åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚åœ¨ NSOperation ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ NSOperation å­ç±» NSInvocationOperationã€NSBlockOperationï¼Œæˆ–è€…è‡ªå®šä¹‰å­ç±»æ¥å°è£…æ“ä½œã€‚ æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š è¿™é‡Œçš„é˜Ÿåˆ—æŒ‡æ“ä½œé˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾æ“ä½œçš„é˜Ÿåˆ—ã€‚ä¸åŒäº GCD ä¸­çš„è°ƒåº¦é˜Ÿåˆ— FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚NSOperationQueue å¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚ æ“ä½œé˜Ÿåˆ—é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼ˆmaxConcurrentOperationCountï¼‰æ¥æ§åˆ¶å¹¶å‘ã€ä¸²è¡Œã€‚ NSOperationQueue ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—å’Œè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¹‹ä¸Šï¼Œè€Œè‡ªå®šä¹‰é˜Ÿåˆ—åœ¨åå°æ‰§è¡Œã€‚ 3ï¼‰NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤ NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒNSOperation å•ç‹¬ä½¿ç”¨æ—¶ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œé…åˆ NSOperationQueue æˆ‘ä»¬èƒ½æ›´å¥½çš„å®ç°å¼‚æ­¥æ‰§è¡Œã€‚ NSOperation å®ç°å¤šçº¿ç¨‹çš„ä½¿ç”¨æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥ï¼š 1.åˆ›å»ºæ“ä½œï¼šå…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ°ä¸€ä¸ª NSOperation å¯¹è±¡ä¸­ã€‚ 2.åˆ›å»ºé˜Ÿåˆ—ï¼šåˆ›å»º NSOperationQueue å¯¹è±¡ã€‚ 3.å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼šå°† NSOperation å¯¹è±¡æ·»åŠ åˆ° NSOperationQueue å¯¹è±¡ä¸­ã€‚ ä¹‹åå‘¢ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°† NSOperationQueue ä¸­çš„ NSOperation å–å‡ºæ¥ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œã€‚ ä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¹ ä¸‹ NSOperation å’Œ NSOperationQueue çš„åŸºæœ¬ä½¿ç”¨ã€‚ 4ï¼‰NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨ 4.1ï¼‰åˆ›å»ºæ“ä½œ NSOperation æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç”¨æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬åªæœ‰ä½¿ç”¨å®ƒçš„å­ç±»æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼æ¥å°è£…æ“ä½œã€‚ ä½¿ç”¨å­ç±» NSInvocationOperation ä½¿ç”¨å­ç±» NSBlockOperation è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…æ“ä½œã€‚ åœ¨ä¸ä½¿ç”¨ NSOperationQueueï¼Œå•ç‹¬ä½¿ç”¨ NSOperation çš„æƒ…å†µä¸‹ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ ä»¥ä¸‹æ“ä½œçš„ä¸‰ç§åˆ›å»ºæ–¹å¼ã€‚ 4.1.1ï¼‰ä½¿ç”¨å­ç±» NSInvocationOperation 1234567891011121314151617181920/*** ä½¿ç”¨å­ç±» NSInvocationOperation*/- (void)useInvocationOperation &#123; // 1.åˆ›å»º NSInvocationOperation å¯¹è±¡ NSInvocationOperation *op = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task1) object:nil]; // 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125;/*** ä»»åŠ¡1*/- (void)task1 &#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125;&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ä½¿ç”¨å­ç±» NSInvocationOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚ å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ 12// åœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨å­ç±» NSInvocationOperation[NSThread detachNewThreadSelector:@selector(useInvocationOperation) toTarget:self withObject:nil]; å¯ä»¥çœ‹åˆ°ï¼šåœ¨å…¶ä»–çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨å­ç±» NSInvocationOperationï¼Œæ“ä½œæ˜¯åœ¨å½“å‰è°ƒç”¨çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚ 4.1.2ï¼‰ä½¿ç”¨å­ç±» NSBlockOperation1234567891011121314/*** ä½¿ç”¨å­ç±» NSBlockOperation*/- (void)useBlockOperation &#123; // 1.åˆ›å»º NSBlockOperation å¯¹è±¡ NSBlockOperation *op = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; // 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125; è¿è¡Œç»“æœ æ³¨æ„ï¼šå’Œä¸Šè¾¹ NSInvocationOperation ä½¿ç”¨ä¸€æ ·ã€‚å› ä¸ºä»£ç æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ‰“å°ç»“æœä¸ºä¸»çº¿ç¨‹ã€‚å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚ ä½†æ˜¯ï¼ŒNSBlockOperation è¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³• addExecutionBlock:ï¼Œé€šè¿‡ addExecutionBlock: å°±å¯ä»¥ä¸º NSBlockOperation æ·»åŠ é¢å¤–çš„æ“ä½œã€‚è¿™äº›æ“ä½œï¼ˆåŒ…æ‹¬ blockOperationWithBlock ä¸­çš„æ“ä½œï¼‰å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­åŒæ—¶ï¼ˆå¹¶å‘ï¼‰æ‰§è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç›¸å…³çš„æ“ä½œå·²ç»å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ‰è§†ä¸ºå®Œæˆã€‚ å¦‚æœæ·»åŠ çš„æ“ä½œå¤šçš„è¯ï¼ŒblockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œå¹¶ä¸æ˜¯è¯´æ·»åŠ åˆ° blockOperationWithBlock: ä¸­çš„æ“ä½œä¸€å®šä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ addExecutionBlock: å¤šæ·»åŠ å‡ ä¸ªæ“ä½œè¯•è¯•ï¼‰ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960/** * ä½¿ç”¨å­ç±» NSBlockOperation * è°ƒç”¨æ–¹æ³• AddExecutionBlock:*/- (void)useBlockOperationAddExecutionBlock &#123; // 1.åˆ›å»º NSBlockOperation å¯¹è±¡ NSBlockOperation *op = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; // 2.æ·»åŠ é¢å¤–çš„æ“ä½œ [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"2---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"3---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"4---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"5---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"6---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"7---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"8---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; // 3.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨å­ç±» NSBlockOperationï¼Œå¹¶è°ƒç”¨æ–¹æ³• AddExecutionBlock: çš„æƒ…å†µä¸‹ï¼ŒblockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œ å’Œ addExecutionBlock: ä¸­çš„æ“ä½œæ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œçš„ã€‚è€Œä¸”ï¼Œè¿™æ¬¡æ‰§è¡Œç»“æœä¸­ blockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œä¹Ÿä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œçš„ã€‚ä»è€Œå°è¯äº†blockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œã€‚ ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ª NSBlockOperation å¯¹è±¡å°è£…äº†å¤šä¸ªæ“ä½œã€‚NSBlockOperation æ˜¯å¦å¼€å¯æ–°çº¿ç¨‹ï¼Œå–å†³äºæ“ä½œçš„ä¸ªæ•°ã€‚å¦‚æœæ·»åŠ çš„æ“ä½œçš„ä¸ªæ•°å¤šï¼Œå°±ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ã€‚å½“ç„¶å¼€å¯çš„çº¿ç¨‹æ•°æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šçš„ã€‚ 4.1.3ï¼‰ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±» å¦‚æœä½¿ç”¨å­ç±» NSInvocationOperationã€NSBlockOperation ä¸èƒ½æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ã€‚å¯ä»¥é€šè¿‡é‡å†™ main æˆ–è€… start æ–¹æ³• æ¥å®šä¹‰è‡ªå·±çš„ NSOperation å¯¹è±¡ã€‚é‡å†™mainæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç®¡ç†æ“ä½œçš„çŠ¶æ€å±æ€§ isExecuting å’Œ isFinishedã€‚å½“ main æ‰§è¡Œå®Œè¿”å›çš„æ—¶å€™ï¼Œè¿™ä¸ªæ“ä½œå°±ç»“æŸäº†ã€‚ å…ˆå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé‡å†™mainæ–¹æ³•ã€‚ CustomOperation.h123#import &lt;Foundation/Foundation.h&gt;@interface CustomOperation : NSOperation@end CustomOperation.m1234567891011#import \"CustomOperation.h\"@implementation CustomOperation- (void)main &#123; if (!self.isCancelled) &#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; NSLog(@\"1---%@\", [NSThread currentThread]); &#125; &#125;&#125;@end ä½¿ç”¨ç¤ºä¾‹123456789/*** ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»*/- (void)useCustomOperation &#123; // 1.åˆ›å»º YSCOperation å¯¹è±¡ CustomOperation *op = [[CustomOperation alloc] init]; // 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ [op start];&#125; å¯ä»¥çœ‹å‡ºï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹å•ç‹¬ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»çš„æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚ 4.2ï¼‰åˆ›å»ºé˜Ÿåˆ— NSOperationQueue ä¸€å…±æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—ã€‚å…¶ä¸­è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶åŒ…å«äº†ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚ä¸‹è¾¹æ˜¯ä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—çš„åŸºæœ¬åˆ›å»ºæ–¹æ³•å’Œç‰¹ç‚¹ã€‚ ä¸»é˜Ÿåˆ— å‡¡æ˜¯æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œéƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚12// ä¸»é˜Ÿåˆ—è·å–æ–¹æ³•NSOperationQueue *queue = [NSOperationQueue mainQueue]; è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰ æ·»åŠ åˆ°è¿™ç§é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œå°±ä¼šè‡ªåŠ¨æ”¾åˆ°å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆåŒæ—¶åŒ…å«äº†ï¼šä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼‰12// è‡ªå®šä¹‰é˜Ÿåˆ—åˆ›å»ºæ–¹æ³•NSOperationQueue *queue = [[NSOperationQueue alloc] init]; 4.3ï¼‰å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ° NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚ é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»ã€‚æ€»å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼š 1.-(void)addOperation:(NSOperation *)op; éœ€è¦å…ˆåˆ›å»ºæ“ä½œï¼Œå†å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°åˆ›å»ºå¥½çš„é˜Ÿåˆ—ä¸­å»ã€‚ 123456789101112131415161718192021222324252627282930313233/*** ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­*/- (void)addOperationToQueue &#123; // 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue = [[NSOperationQueue alloc] init]; // 2.åˆ›å»ºæ“ä½œ // ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ1 NSInvocationOperation *op1 = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task1) object:nil]; // ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ2 NSInvocationOperation *op2 = [[NSInvocationOperation alloc] initWithTarget:self selector:@selector(task2) object:nil]; // ä½¿ç”¨ NSBlockOperation åˆ›å»ºæ“ä½œ3 NSBlockOperation *op3 = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"3---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [op3 addExecutionBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"4---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; // 3.ä½¿ç”¨ addOperation: æ·»åŠ æ‰€æœ‰æ“ä½œåˆ°é˜Ÿåˆ—ä¸­ [queue addOperation:op1]; // [op1 start] [queue addOperation:op2]; // [op2 start] [queue addOperation:op3]; // [op3 start]&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ NSOperation å­ç±»åˆ›å»ºæ“ä½œï¼Œå¹¶ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚ 2.-(void)addOperationWithBlock:(void (^)(void))block; æ— éœ€å…ˆåˆ›å»ºæ“ä½œï¼Œåœ¨ block ä¸­æ·»åŠ æ“ä½œï¼Œç›´æ¥å°†åŒ…å«æ“ä½œçš„ block åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ 123456789101112131415161718192021222324252627/*** ä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­*/- (void)addOperationWithBlockToQueue &#123; // 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue = [[NSOperationQueue alloc] init]; // 2.ä½¿ç”¨ addOperationWithBlock: æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­ [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"2---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"3---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;];&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚ 5ï¼‰NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒNSOperationQueue åˆ›å»ºçš„è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶å…·æœ‰ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼Œä¸Šè¾¹æˆ‘ä»¬æ¼”ç¤ºäº†å¹¶å‘åŠŸèƒ½ï¼Œé‚£ä¹ˆä»–çš„ä¸²è¡ŒåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ è¿™é‡Œæœ‰ä¸ªå…³é”®å±æ€§ maxConcurrentOperationCountï¼Œå«åšæœ€å¤§å¹¶å‘æ“ä½œæ•°ã€‚ç”¨æ¥æ§åˆ¶ä¸€ä¸ªç‰¹å®šé˜Ÿåˆ—ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ªæ“ä½œåŒæ—¶å‚ä¸å¹¶å‘æ‰§è¡Œã€‚ æ³¨æ„ï¼šè¿™é‡Œ maxConcurrentOperationCount æ§åˆ¶çš„ä¸æ˜¯å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­åŒæ—¶èƒ½å¹¶å‘æ‰§è¡Œçš„æœ€å¤§æ“ä½œæ•°ã€‚è€Œä¸”ä¸€ä¸ªæ“ä½œä¹Ÿå¹¶éåªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚ maxConcurrentOperationCount æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼š maxConcurrentOperationCount é»˜è®¤æƒ…å†µä¸‹ä¸º-1ï¼Œè¡¨ç¤ºä¸è¿›è¡Œé™åˆ¶ï¼Œå¯è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚ maxConcurrentOperationCount ä¸º1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ã€‚åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚ maxConcurrentOperationCount å¤§äº1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—ã€‚æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œå½“ç„¶è¿™ä¸ªå€¼ä¸åº”è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼Œå³ä½¿è‡ªå·±è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´ä¸º min{è‡ªå·±è®¾å®šçš„å€¼ï¼Œç³»ç»Ÿè®¾å®šçš„é»˜è®¤æœ€å¤§å€¼}ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738/*** è®¾ç½® MaxConcurrentOperationCountï¼ˆæœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼‰*/- (void)setMaxConcurrentOperationCount &#123; // 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue = [[NSOperationQueue alloc] init]; // 2.è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•° queue.maxConcurrentOperationCount = 1; // ä¸²è¡Œé˜Ÿåˆ— // queue.maxConcurrentOperationCount = 2; // å¹¶å‘é˜Ÿåˆ— // queue.maxConcurrentOperationCount = 8; // å¹¶å‘é˜Ÿåˆ— // 3.æ·»åŠ æ“ä½œ [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"2---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"3---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; [queue addOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"4---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;];&#125; maxConcurrentOperationCount è®¾ç½®ä¸º 1ï¼Œè¿è¡Œç»“æœ maxConcurrentOperationCount è®¾ç½®ä¸º 2ï¼Œè¿è¡Œç»“æœ å¯ä»¥çœ‹å‡ºï¼šå½“æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1æ—¶ï¼Œæ“ä½œæ˜¯æŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹åï¼Œä¸‹ä¸€ä¸ªæ“ä½œæ‰å¼€å§‹æ‰§è¡Œã€‚å½“æœ€å¤§æ“ä½œå¹¶å‘æ•°ä¸º2æ—¶ï¼Œæ“ä½œæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œã€‚è€Œå¼€å¯çº¿ç¨‹æ•°é‡æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥ç®¡ç†ã€‚ 6ï¼‰NSOperation æ“ä½œä¾èµ– NSOperationã€NSOperationQueue æœ€å¸å¼•äººçš„åœ°æ–¹æ˜¯å®ƒèƒ½æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡æ“ä½œä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶æ“ä½œä¹‹é—´çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚NSOperation æä¾›äº†3ä¸ªæ¥å£ä¾›æˆ‘ä»¬ç®¡ç†å’ŒæŸ¥çœ‹ä¾èµ–ã€‚ -(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚ -(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚ @property (readonly, copy) NSArray *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚ å½“ç„¶ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„è¿˜æ˜¯æ·»åŠ ä¾èµ–æ“ä½œã€‚ç°åœ¨è€ƒè™‘è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æœ‰ Aã€B ä¸¤ä¸ªæ“ä½œï¼Œå…¶ä¸­ A æ‰§è¡Œå®Œæ“ä½œï¼ŒB æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚ å¦‚æœä½¿ç”¨ä¾èµ–æ¥å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è®©æ“ä½œ B ä¾èµ–äºæ“ä½œ Aã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829/*** æ“ä½œä¾èµ–* ä½¿ç”¨æ–¹æ³•ï¼šaddDependency:*/- (void)addDependency &#123; // 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue = [[NSOperationQueue alloc] init]; // 2.åˆ›å»ºæ“ä½œ NSBlockOperation *op1 = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; NSBlockOperation *op2 = [NSBlockOperation blockOperationWithBlock:^&#123; for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"2---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; // 3.æ·»åŠ ä¾èµ– [op2 addDependency:op1]; // è®©op2 ä¾èµ–äº op1ï¼Œåˆ™å…ˆæ‰§è¡Œop1ï¼Œåœ¨æ‰§è¡Œop2 // 4.æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­ [queue addOperation:op1]; [queue addOperation:op2];&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡æ·»åŠ æ“ä½œä¾èµ–ï¼Œæ— è®ºè¿è¡Œå‡ æ¬¡ï¼Œå…¶ç»“æœéƒ½æ˜¯ op1 å…ˆæ‰§è¡Œï¼Œop2 åæ‰§è¡Œã€‚ 7ï¼‰NSOperation ä¼˜å…ˆçº§ NSOperation æä¾›äº†queuePriorityï¼ˆä¼˜å…ˆçº§ï¼‰å±æ€§ï¼ŒqueuePriorityå±æ€§é€‚ç”¨äºåŒä¸€æ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œä¸é€‚ç”¨äºä¸åŒæ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„æ“ä½œå¯¹è±¡ä¼˜å…ˆçº§éƒ½æ˜¯NSOperationQueuePriorityNormalã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡setQueuePriority:æ–¹æ³•æ¥æ”¹å˜å½“å‰æ“ä½œåœ¨åŒä¸€é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚ 12345678// ä¼˜å…ˆçº§çš„å–å€¼typedef NS_ENUM(NSInteger, NSOperationQueuePriority) &#123;NSOperationQueuePriorityVeryLow = -8L,NSOperationQueuePriorityLow = -4L,NSOperationQueuePriorityNormal = 0,NSOperationQueuePriorityHigh = 4,NSOperationQueuePriorityVeryHigh = 8&#125;; ä¸Šè¾¹æˆ‘ä»¬è¯´è¿‡ï¼šå¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚ é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ å½“ä¸€ä¸ªæ“ä½œçš„æ‰€æœ‰ä¾èµ–éƒ½å·²ç»å®Œæˆæ—¶ï¼Œæ“ä½œå¯¹è±¡é€šå¸¸ä¼šè¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ‰§è¡Œã€‚ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰4ä¸ªä¼˜å…ˆçº§éƒ½æ˜¯ NSOperationQueuePriorityNormalï¼ˆé»˜è®¤çº§åˆ«ï¼‰çš„æ“ä½œï¼šop1ï¼Œop2ï¼Œop3ï¼Œop4ã€‚å…¶ä¸­ op3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼Œå³ op3 -&gt; op2 -&gt; op1ã€‚ç°åœ¨å°†è¿™4ä¸ªæ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å¹¶å‘æ‰§è¡Œã€‚ å› ä¸º op1 å’Œ op4 éƒ½æ²¡æœ‰éœ€è¦ä¾èµ–çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨ op1ï¼Œop4 æ‰§è¡Œä¹‹å‰ï¼Œå°±æ˜¯å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œã€‚è€Œ op3 å’Œ op2 éƒ½æœ‰ä¾èµ–çš„æ“ä½œï¼ˆop3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼‰ï¼Œæ‰€ä»¥ op3 å’Œ op2 éƒ½ä¸æ˜¯å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œã€‚ç†è§£äº†è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç†è§£äº†queuePriority å±æ€§çš„ä½œç”¨å¯¹è±¡ã€‚ queuePriority å±æ€§å†³å®šäº†è¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œä¹‹é—´çš„å¼€å§‹æ‰§è¡Œé¡ºåºã€‚å¹¶ä¸”ï¼Œä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«é«˜ä¼˜å…ˆçº§æ“ä½œï¼ŒåˆåŒ…å«ä½ä¼˜å…ˆçº§æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ“ä½œéƒ½å·²ç»å‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆé˜Ÿåˆ—å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§æ“ä½œã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­ï¼Œå¦‚æœ op1 å’Œ op4 æ˜¯ä¸åŒä¼˜å…ˆçº§çš„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ‰§è¡Œä¼˜å…ˆçº§é«˜çš„æ“ä½œã€‚ å¦‚æœï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«äº†å‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼ŒåˆåŒ…å«äº†æœªå‡†å¤‡å°±ç»ªçš„æ“ä½œï¼Œæœªå‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§æ¯”å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§é«˜ã€‚é‚£ä¹ˆï¼Œè™½ç„¶å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§ä½ï¼Œä¹Ÿä¼šä¼˜å…ˆæ‰§è¡Œã€‚ä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚å¦‚æœè¦æ§åˆ¶æ“ä½œé—´çš„å¯åŠ¨é¡ºåºï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¾èµ–å…³ç³»ã€‚ 8ï¼‰NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡ åœ¨ iOS å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹é‡Œè¾¹è¿›è¡Œ UI åˆ·æ–°ï¼Œä¾‹å¦‚ï¼šç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ç­‰äº‹ä»¶ã€‚æˆ‘ä»¬é€šå¸¸æŠŠä¸€äº›è€—æ—¶çš„æ“ä½œæ”¾åœ¨å…¶ä»–çº¿ç¨‹ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡ä¸‹è½½ã€æ–‡ä»¶ä¸Šä¼ ç­‰è€—æ—¶æ“ä½œã€‚è€Œå½“æˆ‘ä»¬æœ‰æ—¶å€™åœ¨å…¶ä»–çº¿ç¨‹å®Œæˆäº†è€—æ—¶æ“ä½œæ—¶ï¼Œéœ€è¦å›åˆ°ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç”¨åˆ°äº†çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚ 12345678910111213141516171819202122232425/*** çº¿ç¨‹é—´é€šä¿¡*/- (void)communication &#123; // 1.åˆ›å»ºé˜Ÿåˆ— NSOperationQueue *queue = [[NSOperationQueue alloc]init]; // 2.æ·»åŠ æ“ä½œ [queue addOperationWithBlock:^&#123; // å¼‚æ­¥è¿›è¡Œè€—æ—¶æ“ä½œ for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"1---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; // å›åˆ°ä¸»çº¿ç¨‹ [[NSOperationQueue mainQueue] addOperationWithBlock:^&#123; // è¿›è¡Œä¸€äº› UI åˆ·æ–°ç­‰æ“ä½œ for (int i = 0; i &lt; 2; i++) &#123; [NSThread sleepForTimeInterval:2]; // æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ NSLog(@\"2---%@\", [NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ &#125; &#125;]; &#125;];&#125; è¿è¡Œç»“æœ 9ï¼‰NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨ çº¿ç¨‹å®‰å…¨ï¼šå¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚ è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚ çº¿ç¨‹åŒæ­¥ï¼šå¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚ ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚ ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSOperation çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚ 9.1ï¼‰NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨ å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748/*** éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ NSLock* åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨*/- (void)initTicketStatusNotSave &#123; NSLog(@\"currentThread---%@\",[NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ self.ticketSurplusCount = 50; // 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue1 = [[NSOperationQueue alloc] init]; queue1.maxConcurrentOperationCount = 1; // 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue2 = [[NSOperationQueue alloc] init]; queue2.maxConcurrentOperationCount = 1; // 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1 __weak typeof(self) weakSelf = self; NSBlockOperation *op1 = [NSBlockOperation blockOperationWithBlock:^&#123; [weakSelf saleTicketNotSafe]; &#125;]; // 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2 NSBlockOperation *op2 = [NSBlockOperation blockOperationWithBlock:^&#123; [weakSelf saleTicketNotSafe]; &#125;]; // 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨ [queue1 addOperation:op1]; [queue2 addOperation:op2];&#125;/*** å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)*/- (void)saleTicketNotSafe &#123; while (1) &#123; if (self.ticketSurplusCount &gt; 0) &#123; //å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å– self.ticketSurplusCount--; NSLog(@\"%@\", [NSString stringWithFormat:@\"å‰©ä½™ç¥¨æ•°:%d çª—å£:%@\", self.ticketSurplusCount, [NSThread currentThread]]); [NSThread sleepForTimeInterval:0.2]; &#125; else &#123; NSLog(@\"æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ\"); break; &#125; &#125;&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹åˆ°ï¼šåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ NSLock æƒ…å†µä¸‹ï¼Œåœ¨0ç¥¨åä¾ç„¶å‡ºç¥¨ï¼Œæ•°æ®æ··ä¹±ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ 9.2ï¼‰NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨ çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ç»™çº¿ç¨‹åŠ é”ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ“ä½œçš„æ—¶å€™ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹è¿›è¡Œæ“ä½œã€‚iOS å®ç°çº¿ç¨‹åŠ é”æœ‰å¾ˆå¤šç§æ–¹å¼ã€‚@synchronizedã€ NSLockã€NSRecursiveLockã€NSConditionã€NSConditionLockã€pthread_mutexã€dispatch_semaphoreã€OSSpinLockã€atomic(property) set/geç­‰ç­‰å„ç§æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ NSLock å¯¹è±¡æ¥è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚ NSLock å¯¹è±¡å¯ä»¥é€šè¿‡è¿›å…¥é”æ—¶è°ƒç”¨ lock æ–¹æ³•ï¼Œè§£é”æ—¶è°ƒç”¨ unlock æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758/*** çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ NSLock åŠ é”* åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨*/- (void)initTicketStatusSave &#123; NSLog(@\"currentThread---%@\",[NSThread currentThread]); // æ‰“å°å½“å‰çº¿ç¨‹ self.ticketSurplusCount = 50; self.lock = [[NSLock alloc] init]; // åˆå§‹åŒ– NSLock å¯¹è±¡ // 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue1 = [[NSOperationQueue alloc] init]; queue1.maxConcurrentOperationCount = 1; // 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ NSOperationQueue *queue2 = [[NSOperationQueue alloc] init]; queue2.maxConcurrentOperationCount = 1; // 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1 __weak typeof(self) weakSelf = self; NSBlockOperation *op1 = [NSBlockOperation blockOperationWithBlock:^&#123; [weakSelf saleTicketSafe]; &#125;]; // 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2 NSBlockOperation *op2 = [NSBlockOperation blockOperationWithBlock:^&#123; [weakSelf saleTicketSafe]; &#125;]; // 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨ [queue1 addOperation:op1]; [queue2 addOperation:op2];&#125;/*** å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)*/- (void)saleTicketSafe &#123; while (1) &#123; // åŠ é” [self.lock lock]; if (self.ticketSurplusCount &gt; 0) &#123; //å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å– self.ticketSurplusCount--; NSLog(@\"%@\", [NSString stringWithFormat:@\"å‰©ä½™ç¥¨æ•°:%d çª—å£:%@\", self.ticketSurplusCount, [NSThread currentThread]]); [NSThread sleepForTimeInterval:0.2]; &#125; // è§£é” [self.lock unlock]; if (self.ticketSurplusCount &lt;= 0) &#123; NSLog(@\"æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ\"); break; &#125; &#125;&#125; è¿è¡Œç»“æœ å¯ä»¥çœ‹å‡ºï¼šåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ NSLock åŠ é”ã€è§£é”æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚ 10ï¼‰NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³ 10.1ï¼‰NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³• å–æ¶ˆæ“ä½œæ–¹æ³• -(void)cancel; å¯å–æ¶ˆæ“ä½œï¼Œå®è´¨æ˜¯æ ‡è®° isCancelled çŠ¶æ€ã€‚åˆ¤æ–­æ“ä½œçŠ¶æ€æ–¹æ³• -(BOOL)isFinished; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»ç»“æŸã€‚ -(BOOL)isCancelled; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»æ ‡è®°ä¸ºå–æ¶ˆã€‚ -(BOOL)isExecuting; åˆ¤æ–­æ“ä½œæ˜¯å¦æ­£åœ¨åœ¨è¿è¡Œã€‚ -(BOOL)isReady; åˆ¤æ–­æ“ä½œæ˜¯å¦å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªå€¼å’Œæ“ä½œçš„ä¾èµ–å…³ç³»ç›¸å…³ã€‚æ“ä½œåŒæ­¥ -(void)waitUntilFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥æ“ä½œç»“æŸã€‚å¯ç”¨äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„åŒæ­¥ã€‚ -(void)setCompletionBlock:(void (^)(void))block; completionBlock ä¼šåœ¨å½“å‰æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ completionBlockã€‚ -(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚ -(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚ @property (readonly, copy) NSArray *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚ 10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³• å–æ¶ˆ/æš‚åœ/æ¢å¤æ“ä½œ -(void)cancelAllOperations; å¯ä»¥å–æ¶ˆé˜Ÿåˆ—çš„æ‰€æœ‰æ“ä½œã€‚ -(BOOL)isSuspended; åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å¤„äºæš‚åœçŠ¶æ€ã€‚ YES ä¸ºæš‚åœçŠ¶æ€ï¼ŒNO ä¸ºæ¢å¤çŠ¶æ€ã€‚ -(void)setSuspended:(BOOL)b; å¯è®¾ç½®æ“ä½œçš„æš‚åœå’Œæ¢å¤ï¼ŒYES ä»£è¡¨æš‚åœé˜Ÿåˆ—ï¼ŒNO ä»£è¡¨æ¢å¤é˜Ÿåˆ—ã€‚æ“ä½œåŒæ­¥ -(void)waitUntilAllOperationsAreFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚æ·»åŠ /è·å–æ“ä½œ` -(void)addOperationWithBlock:(void (^)(void))block; å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ª NSBlockOperation ç±»å‹æ“ä½œå¯¹è±¡ã€‚ -(void)addOperations:(NSArray *)ops waitUntilFinished:(BOOL)wait; å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ“ä½œæ•°ç»„ï¼Œwait æ ‡å¿—æ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°æ‰€æœ‰æ“ä½œç»“æŸ -(NSArray *)operations; å½“å‰åœ¨é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ç»„ï¼ˆæŸä¸ªæ“ä½œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨ä»è¿™ä¸ªæ•°ç»„æ¸…é™¤ï¼‰ã€‚ -(NSUInteger)operationCount; å½“å‰é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ã€‚è·å–é˜Ÿåˆ— +(id)currentQueue; è·å–å½“å‰é˜Ÿåˆ—ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯åœ¨ NSOperationQueue ä¸Šè¿è¡Œåˆ™è¿”å› nilã€‚ +(id)mainQueue; è·å–ä¸»é˜Ÿåˆ—ã€‚ æ³¨æ„ï¼šè¿™é‡Œçš„æš‚åœå’Œå–æ¶ˆï¼ˆåŒ…æ‹¬æ“ä½œçš„å–æ¶ˆå’Œé˜Ÿåˆ—çš„å–æ¶ˆï¼‰å¹¶ä¸ä»£è¡¨å¯ä»¥å°†å½“å‰çš„æ“ä½œç«‹å³å–æ¶ˆï¼Œè€Œæ˜¯å½“å½“å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åä¸å†æ‰§è¡Œæ–°çš„æ“ä½œã€‚æš‚åœå’Œå–æ¶ˆçš„åŒºåˆ«å°±åœ¨äºï¼šæš‚åœæ“ä½œä¹‹åè¿˜å¯ä»¥æ¢å¤æ“ä½œï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›è€Œå–æ¶ˆæ“ä½œä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œå°±æ¸…ç©ºäº†ï¼Œæ— æ³•å†æ¥ç€æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://blog.csdn.net/sunnyboy9/article/details/19848031ã€https://www.jianshu.com/p/4b1d77054b35","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šSingleton","slug":"iOS Principle Singleton","date":"2018-06-08T13:56:27.000Z","updated":"2018-11-18T05:33:17.757Z","comments":true,"path":"2018/06/08/iOS Principle Singleton/","link":"","permalink":"https://reversescale.github.io/2018/06/08/iOS Principle Singleton/","excerpt":"SINGLETONâ€”ä¿ºæœ‰6ä¸ªæ¼‚äº®çš„è€å©†ï¼Œå¥¹ä»¬çš„è€å…¬éƒ½æ˜¯æˆ‘ï¼Œæˆ‘å°±æ˜¯æˆ‘ä»¬å®¶é‡Œçš„è€å…¬Singletonï¼Œå¥¹ä»¬åªè¦è¯´é“â€œè€å…¬â€ï¼Œéƒ½æ˜¯æŒ‡çš„åŒä¸€ä¸ªäººï¼Œé‚£å°±æ˜¯æˆ‘ã€‚(åˆšæ‰åšäº†ä¸ªæ¢¦å•¦ï¼Œå“ªæœ‰è¿™ä¹ˆå¥½çš„äº‹)~","text":"SINGLETONâ€”ä¿ºæœ‰6ä¸ªæ¼‚äº®çš„è€å©†ï¼Œå¥¹ä»¬çš„è€å…¬éƒ½æ˜¯æˆ‘ï¼Œæˆ‘å°±æ˜¯æˆ‘ä»¬å®¶é‡Œçš„è€å…¬Singletonï¼Œå¥¹ä»¬åªè¦è¯´é“â€œè€å…¬â€ï¼Œéƒ½æ˜¯æŒ‡çš„åŒä¸€ä¸ªäººï¼Œé‚£å°±æ˜¯æˆ‘ã€‚(åˆšæ‰åšäº†ä¸ªæ¢¦å•¦ï¼Œå“ªæœ‰è¿™ä¹ˆå¥½çš„äº‹)~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿†ï¼š å•ä¾‹æ¨¡å¼ï¼šç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹å•ä¾‹æ¨¡å¼ï¼ˆé€šè¿‡é˜²æŠ¤æªæ–½ï¼Œç¦æ­¢å…¶å†åˆ›å»ºå…¶ä»–å®ä¾‹ï¼‰ å®‰å…¨ä¿éšœï¼šé˜²æ­¢ä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨shareInstanceï¼Œä½¿ç”¨@synchronizedé”å®š GCDåˆ›å»ºï¼šdispatch_onceä¸­dispatch_once_tç±»å‹ä¸ºtypedef long onceToken= 0ï¼Œçº¿ç¨‹æ‰§è¡Œdispatch_onceçš„blockä¸­ä»£ç  onceToken= -1ï¼Œçº¿ç¨‹è·³è¿‡dispatch_onceçš„blockä¸­ä»£ç ä¸æ‰§è¡Œ onceToken= å…¶ä»–å€¼ï¼Œçº¿ç¨‹è¢«çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…onceTokenå€¼æ”¹å˜ ç”¨é€”ï¼šé™åˆ¶åˆ›å»ºï¼Œæä¾›å…¨å±€è°ƒç”¨ï¼ŒèŠ‚çº¦èµ„æºå’Œæé«˜æ€§èƒ½ å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š UIApplication NSNotificationCenter NSFileManager NSUserDefaults NSURLCache NSHTTPCookieStorage å¼•æ–‡ ã€ŠDesign Patterns: Elements of Reusable Object-Oriented Softwareã€‹ï¼ˆå³åè¿°ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ï¼‰æ˜¯ç”± Erich Gammaã€Richard Helmã€Ralph Johnson å’Œ John Vlissides åˆè‘—ï¼ˆAddison-Wesleyï¼Œ1995ï¼‰ã€‚è¿™å‡ ä½ä½œè€…å¸¸è¢«ç§°ä¸ºâ€å››äººç»„ï¼ˆGang of Fourï¼‰ã€‚ å¼€ç¯‡å¼•ç”¨ GoF çš„ç¤ºä¾‹å¸®åŠ©ç†è§£åˆ›å»ºå‹è®¾è®¡æ¨¡å¼â€”â€”å•ä¾‹ å•ä¾‹æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹å•ä¾‹æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼åªåº”åœ¨æœ‰çœŸæ­£çš„â€œå•ä¸€å®ä¾‹â€çš„éœ€æ±‚æ—¶æ‰å¯ä½¿ç”¨ã€‚ å•ä¾‹çš„åˆ›å»ºå•çº¿ç¨‹å•ä¾‹æˆ‘ä»¬çŸ¥é“å¯¹äºå•ä¾‹ç±»ï¼Œæˆ‘ä»¬å¿…é¡»ç•™å‡ºä¸€ä¸ªæ¥å£æ¥è¿”å›ç”Ÿæˆçš„å•ä¾‹ï¼Œç”±äºä¸€ä¸ªç±»ä¸­åªèƒ½æœ‰ä¸€ä¸ªå®ä¾‹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨ç¬¬ä¸€æ¬¡è®¿é—®è¿™ä¸ªå®ä¾‹çš„æ—¶å€™åˆ›å»ºï¼Œä¹‹åè®¿é—®ç›´æ¥å–å·²ç»åˆ›å»ºå¥½çš„å®ä¾‹ 123456789@implementationSingleton+ (instancetype)shareInstance&#123; staticSingleton* single; if(!single) &#123; single = [[Singleton alloc] init]; &#125; return single;&#125;@end ps:ä¸¥æ ¼æ„ä¹‰ä¸Šæ¥è¯´ï¼Œæˆ‘ä»¬è¿˜éœ€è¦å°†allocæ–¹æ³•å°ä½ï¼Œå› ä¸ºä¸¥æ ¼çš„å•ä¾‹æ˜¯ä¸å…è®¸å†åˆ›å»ºå…¶ä»–å®ä¾‹çš„ï¼Œè€Œallocæ–¹æ³•å¯ä»¥åœ¨å¤–éƒ¨ä»»æ„ç”Ÿæˆå®ä¾‹ã€‚ä½†æ˜¯è€ƒè™‘åˆ°allocå±äºNSObjectï¼ŒiOSä¸­æ— æ³•å°†allocå˜æˆç§æœ‰æ–¹æ³•ï¼Œæœ€å¤šåªèƒ½è¦†ç›–allocè®©å…¶è¿”å›ç©ºï¼Œä¸è¿‡è¿™æ ·åšä¹Ÿå¯èƒ½ä¼šè®©ä½¿ç”¨æ¥å£çš„äººè¯¯è§£ï¼Œé€ æˆå…¶ä»–é—®é¢˜ã€‚æ‰€ä»¥æˆ‘ä»¬ä¸€èˆ¬æƒ…å†µä¸‹å¯¹allocä¸åšç‰¹æ®Šå¤„ç†ã€‚ç³»ç»Ÿçš„å•ä¾‹ä¹Ÿæœªå¯¹allocåšä»»ä½•å¤„ç† @synchronizedå•ä¾‹å¯¹äºä¸€ä¸ªå®ä¾‹ï¼Œæˆ‘ä»¬ä¸€èˆ¬å¹¶ä¸èƒ½ä¿è¯ä»–ä¸€å®šä¼šåœ¨å•çº¿ç¨‹æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œæ‰€ä»¥æˆ‘ä»¬å¾—é€‚é…å¤šçº¿ç¨‹æƒ…å†µã€‚åœ¨å¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œä¸Šé¢çš„å•ä¾‹åˆ›å»ºæ–¹å¼å¯èƒ½ä¼šå‡ºç°é—®é¢˜ã€‚å¦‚æœä¸¤ä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨shareInstance,å¯èƒ½ä¼šåˆ›å»ºå‡º2ä¸ªsingleæ¥ã€‚æ‰€ä»¥å¯¹äºå¤šçº¿ç¨‹æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨@synchronizedæ¥åŠ é”ã€‚ 1234567891011@implementationSingleton+ (instancetype)shareInstance&#123; staticSingleton* single; @synchronized(self) &#123; if(!single) &#123; single = [[Singleton alloc] init]; &#125; &#125; return single;&#125;@end è¿™æ ·çš„è¯ï¼Œå½“å¤šä¸ªçº¿ç¨‹åŒæ—¶è°ƒç”¨shareInstanceæ—¶ï¼Œç”±äº@synchronizedå·²ç»åŠ é”ï¼Œæ‰€ä»¥åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åˆ›å»ºsingleã€‚è¿™æ ·å°±è§£å†³äº†å¤šçº¿ç¨‹ä¸‹è°ƒç”¨å•ä¾‹çš„é—®é¢˜ dispatch_onceå•ä¾‹ä½¿ç”¨@synchronizedè™½ç„¶è§£å†³äº†å¤šçº¿ç¨‹çš„é—®é¢˜ï¼Œä½†æ˜¯å¹¶ä¸å®Œç¾ã€‚å› ä¸ºåªæœ‰åœ¨singleæœªåˆ›å»ºæ—¶ï¼Œæˆ‘ä»¬åŠ é”æ‰æ˜¯æœ‰å¿…è¦çš„ã€‚å¦‚æœsingleå·²ç»åˆ›å»º.è¿™æ—¶å€™é”ä¸ä»…æ²¡æœ‰å¥½å¤„ï¼Œè€Œä¸”è¿˜ä¼šå½±å“åˆ°ç¨‹åºæ‰§è¡Œçš„æ€§èƒ½ï¼ˆå¤šä¸ªçº¿ç¨‹æ‰§è¡Œ@synchronizedä¸­çš„ä»£ç æ—¶ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œï¼Œå…¶ä»–çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼‰ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰æ–¹æ³•æ—¢å¯ä»¥è§£å†³é—®é¢˜ï¼Œåˆä¸å½±å“æ€§èƒ½å‘¢ï¼Ÿè¿™ä¸ªæ–¹æ³•å°±æ˜¯GCDä¸­çš„dispatch_once 123456789101112+ (SingletonManager*)shareManager &#123; static dispatch_once_t token; dispatch_once(&amp;token, ^&#123; if(defaultManager == nil) &#123; NSLog(@\"dispatch_once Token: %ld\",token); defaultManager = [[self alloc] init]; &#125; &#125;); NSLog(@\"Token: %ld\",token); NSLog(@\"DefaultManager: %@\",defaultManager); return defaultManager;&#125; æ‰“å°ç»“æœ dispatch_once ä¸ºä»€ä¹ˆèƒ½åšåˆ°æ—¢è§£å†³åŒæ­¥å¤šçº¿ç¨‹é—®é¢˜åˆä¸å½±å“æ€§èƒ½å‘¢ï¼Ÿä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹dispatch_onceçš„åŸç†ï¼š dispatch_onceä¸»è¦æ˜¯æ ¹æ®onceTokençš„å€¼æ¥å†³å®šæ€ä¹ˆå»æ‰§è¡Œä»£ç ã€‚ å½“onceToken= 0æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œdispatch_onceçš„blockä¸­ä»£ç  å½“onceToken= -1æ—¶ï¼Œçº¿ç¨‹è·³è¿‡dispatch_onceçš„blockä¸­ä»£ç ä¸æ‰§è¡Œ å½“onceTokenä¸ºå…¶ä»–å€¼æ—¶ï¼Œçº¿ç¨‹è¢«çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…onceTokenå€¼æ”¹å˜ å½“çº¿ç¨‹é¦–å…ˆè°ƒç”¨shareInstanceï¼ŒæŸä¸€çº¿ç¨‹è¦æ‰§è¡Œblockä¸­çš„ä»£ç æ—¶ï¼Œé¦–å…ˆéœ€è¦æ”¹å˜onceTokençš„å€¼ï¼Œå†å»æ‰§è¡Œblockä¸­çš„ä»£ç ã€‚è¿™é‡ŒonceTokençš„å€¼å˜ä¸ºäº†768ã€‚ è¿™æ ·å½“å…¶ä»–çº¿ç¨‹å†è·å–onceTokençš„å€¼æ—¶ï¼Œå€¼å·²ç»å˜ä¸º768ã€‚å…¶ä»–çº¿ç¨‹è¢«é˜»å¡ã€‚ å½“blockçº¿ç¨‹æ‰§è¡Œå®Œblockä¹‹åã€‚onceTokenå˜ä¸º-1ã€‚å…¶ä»–çº¿ç¨‹ä¸å†é˜»å¡ï¼Œè·³è¿‡blockã€‚ ä¸‹æ¬¡å†è°ƒç”¨shareInstanceæ—¶ï¼Œblockå·²ç»ä¸º-1ã€‚ç›´æ¥è·³è¿‡blockã€‚ è¿™æ ·dispatch_onceåœ¨é¦–æ¬¡è°ƒç”¨æ—¶åŒæ­¥é˜»å¡çº¿ç¨‹ï¼Œç”Ÿæˆå•ä¾‹ä¹‹åï¼Œä¸å†é˜»å¡çº¿ç¨‹ã€‚ é‡åˆ°é—®é¢˜ï¼šçº¿ç¨‹1å’Œçº¿ç¨‹2ï¼Œéƒ½åœ¨è°ƒç”¨shareInstanceæ–¹æ³•æ¥åˆ›å»ºå•ä¾‹ï¼Œé‚£ä¹ˆçº¿ç¨‹1è¿è¡Œåˆ°if (_instance == nil)å‘ç°_instance = nil,é‚£ä¹ˆå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ª_instanceï¼Œå‡è®¾æ­¤æ—¶çº¿ç¨‹2ä¹Ÿè¿è¡Œåˆ°ifçš„åˆ¤æ–­å¤„äº†ï¼Œæ­¤æ—¶çº¿ç¨‹1è¿˜æ²¡æœ‰åˆ›å»ºå®Œæˆå®ä¾‹_instanceï¼Œæ‰€ä»¥æ­¤æ—¶_instance = nilè¿˜æ˜¯æˆç«‹çš„ï¼Œé‚£ä¹ˆçº¿ç¨‹2åˆä¼šåˆ›å»ºä¸€ä¸ª_instaceã€‚ è™½ç„¶ä½¿ç”¨äº’æ–¥é”ä¹Ÿå¯ä»¥è§£å†³å¤šçº¿ç¨‹åŒæ—¶åˆ›å»ºçš„é—®é¢˜ï¼Œä½†æ˜¯dispatch_onceæ›´ä¸ºé«˜æ•ˆå®‰å…¨æ˜¯è§£å†³è¿™ç±»é—®é¢˜çš„æœ€ä¼˜æ–¹æ¡ˆã€‚ å®æ–¹æ³•åˆ›å»ºå•ä¾‹Singleton.h ä¸­è¿›è¡Œå®å®šä¹‰ 12345678910111213141516171819202122232425262728293031323334// Singleton.h#import &lt;Foundation/Foundation.h&gt;#define SingletonH(name) + (instancetype)shared##name;#define SingletonM(name) \\static id _instance; \\\\+ (instancetype)allocWithZone:(struct _NSZone *)zone \\&#123; \\static dispatch_once_t onceToken; \\dispatch_once(&amp;onceToken, ^&#123; \\_instance = [super allocWithZone:zone]; \\&#125;); \\return _instance; \\&#125; \\\\+ (instancetype)shared##name \\&#123; \\static dispatch_once_t onceToken; \\dispatch_once(&amp;onceToken, ^&#123; \\_instance = [[self alloc] init]; \\&#125;); \\return _instance; \\&#125; \\\\- (id)copyWithZone:(NSZone *)zone \\&#123; \\return _instance; \\&#125;\\\\- (id)mutableCopyWithZone:(NSZone *)zone &#123; \\return _instance; \\&#125;@interface Singleton : NSObject@end ä½¿ç”¨æ–¹æ³• ViewController.h ä¸­ 123456// ViewController.h#import &lt;UIKit/UIKit.h&gt;#import \"Singleton.h\" //å®æ–¹æ³•@interface ViewController : UIViewControllerSingletonH(viewController)@end ViewController.m ä¸­ 123456SingletonM(ViewController)- (void)viewDidLoad &#123; [super viewDidLoad]; // è°ƒç”¨å®å®šä¹‰å•ä¾‹ NSLog(@\"åœ°å€æ‰“å°ï¼š\\n%@\\n%@\\n%@\\n%@\", [ViewController sharedViewController], [ViewController sharedViewController], [[ViewController alloc] init], [[ViewController alloc] init]);&#125; æ‰“å°ç»“æœ æ‰“å°ç»“æœå¯è§åœ°å€ç›¸åŒ å•ä¾‹çš„ç”¨é€”1ï¼‰å•ä¾‹æ¨¡å¼ç”¨æ¥é™åˆ¶ä¸€ä¸ªç±»åªèƒ½åˆ›å»ºä¸€ä¸ªå¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡çš„å±æ€§å¯ä»¥å­˜å‚¨å…¨å±€å…±äº«çš„æ•°æ®ã€‚æ‰€æœ‰ç±»éƒ½å¯ä»¥è®¿é—®ã€è®¾ç½®æ­¤å•ä¾‹å¯¹è±¡ä¸­çš„å±æ€§æ•°æ®ï¼› 2ï¼‰å¦‚æœä¸€ä¸ªç±»åˆ›å»ºçš„æ—¶å€™éå¸¸çš„è€—è´¹èµ„æºæˆ–å½±å“æ€§èƒ½ï¼Œé‚£ä¹ˆæ­¤å¯¹è±¡å¯ä»¥è®¾ç½®ä¸ºå•ä¾‹ä»¥èŠ‚çº¦èµ„æºå’Œæé«˜æ€§èƒ½ã€‚ å•ä¾‹ç±»ä¿è¯äº†åº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸä¸­æœ‰ä¸”ä»…æœ‰ä¸€ä¸ªè¯¥ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè€Œä¸”æ˜“äºå¤–ç•Œè®¿é—®ã€‚ iOS ç³»ç»Ÿä¸­ä½¿ç”¨çš„å•ä¾‹ç±» UIApplication NSNotificationCenter NSFileManager NSUserDefaults NSURLCache NSHTTPCookieStorage dispatch_once åŸç†å‰–æåœ¨IOSå¼€å‘ä¸­ï¼Œä¸ºä¿è¯å•ä¾‹åœ¨æ•´ä¸ªç¨‹åºè¿è¡Œä¸­åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œå•çº¿ç¨‹çš„æ—¶å€™ï¼Œé€šè¿‡é™æ€å˜é‡å¯ä»¥å®ç°ï¼›ä½†æ˜¯å¤šçº¿ç¨‹çš„å‡ºç°ï¼Œä½¿å¾—åœ¨å¦‚ä¸Šé¢çš„æç«¯æ¡ä»¶ä¸‹ï¼Œå•ä¾‹ä¹Ÿå¯èƒ½è¿”å›äº†ä¸åŒçš„å¯¹è±¡ã€‚å¦‚åœ¨å•ä¾‹åˆå§‹åŒ–å®Œæˆå‰ï¼Œå¤šä¸ªè¿›ç¨‹åŒæ—¶è®¿é—®å•ä¾‹ï¼Œé‚£ä¹ˆè¿™äº›è¿›ç¨‹å¯èƒ½éƒ½è·å¾—äº†ä¸åŒçš„å•ä¾‹å¯¹è±¡ã€‚ å¤šçº¿ç¨‹ä¿æŠ¤ä¸‹çš„å•ä¾‹åˆå§‹åŒ–ä»£ç  12345678+ (instancetype)defaultObject&#123; static SharedObject *sharedObject = nil; static dispatch_once_t predicate; dispatch_once(&amp;predicate, ^&#123; sharedObject = [[SharedObject alloc] init]; &#125;); return sharedObject;&#125; ç‚¹å‡»æŸ¥çœ‹ dispatch_once_t å‘ç°å…¶æ˜¯ typedef long ç±»å‹ é™æ€å˜é‡åœ¨ç¨‹åºè¿è¡ŒæœŸé—´åªè¢«åˆå§‹åŒ–ä¸€æ¬¡ï¼Œç„¶åå…¶åœ¨ä¸‹ä¸€æ¬¡è¢«è®¿é—®æ—¶ï¼Œå…¶å€¼éƒ½æ˜¯ä¸Šæ¬¡çš„å€¼ï¼Œå…¶åœ¨é™¤äº†è¿™ä¸ªåˆå§‹åŒ–æ–¹æ³•ä»¥å¤–çš„ä»»ä½•åœ°æ–¹éƒ½ä¸èƒ½ç›´æ¥ä¿®æ”¹è¿™ä¸¤ä¸ªå˜é‡çš„å€¼ã€‚è¿™æ˜¯å•ä¾‹åªè¢«åˆå§‹åŒ–ä¸€æ¬¡çš„å‰æã€‚ ç‚¹å‡»æŸ¥çœ‹ dispatch_once å‘ç°å†…éƒ¨é€šè¿‡å®æŠŠ _dispatch_once è½¬åŒ–æˆ dispatch_once æŸ¥æ‰¾åˆ° _dispatch_once å‡½æ•°ï¼Œæˆ‘ä»¬å‘ç° DISPATCH_EXPECT æ–¹æ³• ~0l æ˜¯é•¿æ•´å‹0æŒ‰ä½å–åï¼Œå°±æ˜¯é•¿æ•´å‹çš„-1 GNUC åªä»£è¡¨gccçš„ä¸»ç‰ˆæœ¬å·ï¼Œæˆ‘ä»¬å¿½ç•¥å®ƒï¼Œå‰©ä¸‹å°±æ˜¯ DISPATCH_EXPECT(x, v) äº†ï¼ŒDISPATCH_EXPECT(predicate, ~0l) å°±æ˜¯è¯´ï¼Œpredicate å¾ˆå¯èƒ½æ˜¯ ~0l ï¼Œè€Œå½“ DISPATCH_EXPECT(*predicate, ~0l) ä¸æ˜¯ ~0! æ—¶ æ‰è°ƒç”¨çœŸæ­£çš„ dispatch_once å‡½æ•°ã€‚ ç¬¬ä¸€æ¬¡è¿è¡Œï¼Œpredicateçš„å€¼æ˜¯é»˜è®¤å€¼0ï¼ŒæŒ‰ç…§é€»è¾‘ï¼Œå¦‚æœæœ‰ä¸¤ä¸ªè¿›ç¨‹åŒæ—¶è¿è¡Œåˆ° dispatch_once æ–¹æ³•æ—¶ï¼Œè¿™ä¸ªä¸¤ä¸ªè¿›ç¨‹è·å–åˆ°çš„ predicate å€¼éƒ½æ˜¯0ï¼Œé‚£ä¹ˆæœ€ç»ˆä¸¤ä¸ªè¿›ç¨‹éƒ½ä¼šè°ƒç”¨ æœ€åŸå§‹é‚£ä¸ª dispatch_once å‡½æ•°ã€‚ ç”±æ­¤æˆ‘å†æŠŠä¸Šé¢çš„è§„åˆ™è´´ä¸€éï¼Œå¯ä»¥è‡ªå·±è°ƒè¯•çœ‹çœ‹ å½“onceToken= 0æ—¶ï¼Œçº¿ç¨‹æ‰§è¡Œdispatch_onceçš„blockä¸­ä»£ç  å½“onceToken= -1æ—¶ï¼Œçº¿ç¨‹è·³è¿‡dispatch_onceçš„blockä¸­ä»£ç ä¸æ‰§è¡Œ å½“onceTokenä¸ºå…¶ä»–å€¼æ—¶ï¼Œçº¿ç¨‹è¢«çº¿ç¨‹è¢«é˜»å¡ï¼Œç­‰å¾…onceTokenå€¼æ”¹å˜ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttp://www.cocoachina.com/ios/20160907/17497.htmlï¼Œhttps://www.jianshu.com/p/160d77888443ï¼Œhttps://blog.csdn.net/mlibai/article/details/46945331","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šRunloop","slug":"iOS Principle Runloop","date":"2018-06-07T13:56:27.000Z","updated":"2018-11-18T05:30:32.020Z","comments":true,"path":"2018/06/07/iOS Principle Runloop/","link":"","permalink":"https://reversescale.github.io/2018/06/07/iOS Principle Runloop/","excerpt":"ä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåçº¿ç¨‹å°±ä¼šé€€å‡ºã€‚RunLoop æœºåˆ¶èƒ½è®©çº¿ç¨‹éšæ—¶å¤„ç†äº‹ä»¶ä½†å¹¶ä¸é€€å‡ºã€‚è¿™é‡Œè¯´çš„éšæ—¶æ˜¯æŒ‡ï¼šç¨‹åºéœ€è¦è¿è¡Œæ—¶å°±ä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œï¼Œä¸éœ€è¦çš„æ—¶å€™å°±è¿›å…¥ä¼‘çœ çŠ¶æ€~","text":"ä¸€ä¸ªçº¿ç¨‹ä¸€æ¬¡åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œæ‰§è¡Œå®Œæˆåçº¿ç¨‹å°±ä¼šé€€å‡ºã€‚RunLoop æœºåˆ¶èƒ½è®©çº¿ç¨‹éšæ—¶å¤„ç†äº‹ä»¶ä½†å¹¶ä¸é€€å‡ºã€‚è¿™é‡Œè¯´çš„éšæ—¶æ˜¯æŒ‡ï¼šç¨‹åºéœ€è¦è¿è¡Œæ—¶å°±ä¿æŒç¨‹åºçš„æŒç»­è¿è¡Œï¼Œä¸éœ€è¦çš„æ—¶å€™å°±è¿›å…¥ä¼‘çœ çŠ¶æ€~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿†ï¼š å®è´¨ä½œç”¨ï¼šä¿è¯åœ¨éœ€è¦çš„æ—¶å€™è‡ªå·±è·‘èµ·æ¥è¿è¡Œï¼Œåœ¨æ²¡æœ‰æ“ä½œçš„æ—¶å€™å°±åœä¸‹æ¥ä¼‘æ¯ è¿è¡Œæœºåˆ¶ï¼šå¯åŠ¨ä¸»çº¿ç¨‹ä¿è¯æŒç»­è¿è¡Œï¼Œå¤„ç†è§¦æ‘¸ã€å®šæ—¶å™¨ã€Selectoräº‹ä»¶ï¼Œç©ºé—²é€šçŸ¥CPUé‡Šæ”¾èµ„æº Runloopå’Œçº¿ç¨‹å…³ç³»ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰å¯¹åº”runloopï¼Œçº¿ç¨‹ç»“æŸæ—¶é”€æ¯ Modeï¼šä»£è¡¨RunLoopçš„è¿è¡Œæ¨¡å¼ï¼Œå¯åŠ¨æ˜¯é€‰æ‹©ä¸€ç§modeï¼ˆcurrentModeï¼‰ï¼Œmodeä¸ºç©ºç«‹å³é€€å‡º Source1ï¼šåŸºäºPorté€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ Source0ï¼šè§¦æ‘¸äº‹ä»¶ï¼ŒPerformSelectors Timersï¼šå®šæ—¶å™¨ï¼ŒNSTimer Observerï¼šç›‘å¬å™¨ï¼Œç”¨äºç›‘å¬RunLoopçš„çŠ¶æ€ RunLoop è¿è¡Œæ¨¡å¼ kCFRunLoopDefaultModeï¼šAppçš„é»˜è®¤Modeï¼Œé€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªModeä¸‹è¿è¡Œ UITrackingRunLoopModeï¼šç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“ UIInitializationRunLoopMode: åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ï¼Œä¼šåˆ‡æ¢åˆ°kCFRunLoopDefaultMode GSEventReceiveRunLoopMode: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ° kCFRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªå ä½ç”¨çš„Modeï¼Œä½œä¸ºæ ‡è®°kCFRunLoopDefaultModeå’ŒUITrackingRunLoopModeç”¨ï¼Œå¹¶ä¸æ˜¯ä¸€ç§çœŸæ­£çš„Mode CFRunLoopObserverRef ç›‘å¬RunLoopçš„çŠ¶æ€æ”¹å˜ kCFRunLoopEntry:RunLoopè¿›å…¥ kCFRunLoopBeforeTimers:RunLoopè¦å¤„ç†Timersäº† kCFRunLoopBeforeSources:RunLoopè¦å¤„ç†Sourcesäº† kCFRunLoopBeforeWaiting:RunLoopè¦ä¼‘æ¯äº† kCFRunLoopAfterWaiting:RunLoopé†’æ¥äº† kCFRunLoopExit:RunLoopé€€å‡ºäº† å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š å¸¸é©»çº¿ç¨‹ è‡ªåŠ¨é‡Šæ”¾æ±  AFNetworkingçš„connectionè¿æ¥å¤„ç† TableViewå¹³æ»‘æ»šåŠ¨å»¶è¿ŸåŠ è½½å›¾ç‰‡ ç¨‹åºå´©æºƒæ—¶è‡ªä¸»å¤„ç†ä¾‹ï¼Œå¦‚ï¼šå¼¹å‡ºæç¤ºç­‰ RunLoopç®€ä»‹è¿è¡Œå¾ªç¯ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­å¾ªç¯åšä¸€äº›äº‹æƒ…ï¼Œå¦‚æœæ²¡æœ‰Runloopç¨‹åºæ‰§è¡Œå®Œæ¯•å°±ä¼šç«‹å³é€€å‡ºï¼Œå¦‚æœæœ‰Runloopç¨‹åºä¼šä¸€ç›´è¿è¡Œï¼Œå¹¶ä¸”æ—¶æ—¶åˆ»åˆ»åœ¨ç­‰å¾…ç”¨æˆ·çš„è¾“å…¥æ“ä½œã€‚RunLoopå¯ä»¥åœ¨éœ€è¦çš„æ—¶å€™è‡ªå·±è·‘èµ·æ¥è¿è¡Œï¼Œåœ¨æ²¡æœ‰æ“ä½œçš„æ—¶å€™å°±åœä¸‹æ¥ä¼‘æ¯ã€‚èƒ½å¤Ÿå……åˆ†èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ã€‚ RunLoopåŸºæœ¬ä½œç”¨ 1.ä¿æŒç¨‹åºæŒç»­è¿è¡Œï¼Œç¨‹åºä¸€å¯åŠ¨å°±ä¼šå¼€ä¸€ä¸ªä¸»çº¿ç¨‹ï¼Œä¸»çº¿ç¨‹ä¸€å¼€èµ·æ¥å°±ä¼šè·‘ä¸€ä¸ªä¸»çº¿ç¨‹å¯¹åº”çš„RunLoop,RunLoopä¿è¯ä¸»çº¿ç¨‹ä¸ä¼šè¢«é”€æ¯ï¼Œä¹Ÿå°±ä¿è¯äº†ç¨‹åºçš„æŒç»­è¿è¡Œ 2.å¤„ç†Appä¸­çš„å„ç§äº‹ä»¶ï¼ˆæ¯”å¦‚ï¼šè§¦æ‘¸äº‹ä»¶ï¼Œå®šæ—¶å™¨äº‹ä»¶ï¼ŒSelectoräº‹ä»¶ç­‰ï¼‰ 3.èŠ‚çœCPUèµ„æºï¼Œæé«˜ç¨‹åºæ€§èƒ½ï¼Œç¨‹åºè¿è¡Œèµ·æ¥æ—¶ï¼Œå½“ä»€ä¹ˆæ“ä½œéƒ½æ²¡æœ‰åšçš„æ—¶å€™ï¼ŒRunLoopå°±å‘Šè¯‰CPUï¼Œç°åœ¨æ²¡æœ‰äº‹æƒ…åšï¼Œæˆ‘è¦å»ä¼‘æ¯ï¼Œè¿™æ—¶CPUå°±ä¼šå°†å…¶èµ„æºé‡Šæ”¾å‡ºæ¥å»åšå…¶ä»–çš„äº‹æƒ…ï¼Œå½“æœ‰äº‹æƒ…åšçš„æ—¶å€™RunLoopå°±ä¼šç«‹é©¬èµ·æ¥å»åšäº‹æƒ… æˆ‘ä»¬å…ˆé€šè¿‡APIå†…ä¸€å¼ å›¾ç‰‡æ¥ç®€å•çœ‹ä¸€ä¸‹RunLoopå†…éƒ¨è¿è¡ŒåŸç† é€šè¿‡å›¾ç‰‡å¯ä»¥çœ‹å‡ºï¼ŒRunLoopåœ¨è·‘åœˆè¿‡ç¨‹ä¸­ï¼Œå½“æ¥æ”¶åˆ°Input sources æˆ–è€… Timer sourcesæ—¶å°±ä¼šäº¤ç»™å¯¹åº”çš„å¤„ç†æ–¹å»å¤„ç†ã€‚å½“æ²¡æœ‰äº‹ä»¶æ¶ˆæ¯ä¼ å…¥çš„æ—¶å€™ï¼ŒRunLoopå°±ä¼‘æ¯äº†ã€‚è¿™é‡Œåªæ˜¯ç®€å•çš„ç†è§£ä¸€ä¸‹è¿™å¼ å›¾ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥äº†è§£RunLoopå¯¹è±¡å’Œå…¶ä¸€äº›ç›¸å…³ç±»ï¼Œæ¥æ›´æ·±å…¥çš„ç†è§£RunLoopè¿è¡Œæµç¨‹ã€‚ RunLoopåœ¨å“ªé‡Œå¼€å¯UIApplicationMainå‡½æ•°å†…å¯åŠ¨äº†Runloopï¼Œç¨‹åºä¸ä¼šé©¬ä¸Šé€€å‡ºï¼Œè€Œæ˜¯ä¿æŒè¿è¡ŒçŠ¶æ€ã€‚å› æ­¤æ¯ä¸€ä¸ªåº”ç”¨å¿…é¡»è¦æœ‰ä¸€ä¸ªrunloopï¼Œæˆ‘ä»¬çŸ¥é“ä¸»çº¿ç¨‹ä¸€å¼€èµ·æ¥ï¼Œå°±ä¼šè·‘ä¸€ä¸ªå’Œä¸»çº¿ç¨‹å¯¹åº”çš„RunLoopï¼Œé‚£ä¹ˆRunLoopä¸€å®šæ˜¯åœ¨ç¨‹åºçš„å…¥å£mainå‡½æ•°ä¸­å¼€å¯ã€‚ 12345int main(int argc, char * argv[]) &#123; @autoreleasepool &#123; return UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); &#125;&#125; è¿›å…¥UIApplicationMain 1UIKIT_EXTERN int UIApplicationMain(int argc, char *argv[], NSString * __nullable principalClassName, NSString * __nullable delegateClassName); æˆ‘ä»¬å‘ç°å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªintæ•°ï¼Œé‚£ä¹ˆæˆ‘ä»¬å¯¹mainå‡½æ•°åšä¸€äº›ä¿®æ”¹ 12345678int main(int argc, char * argv[]) &#123; @autoreleasepool &#123; NSLog(@\"å¼€å§‹\"); int re = UIApplicationMain(argc, argv, nil, NSStringFromClass([AppDelegate class])); NSLog(@\"ç»“æŸ\"); return re; &#125;&#125; è¿è¡Œç¨‹åºï¼Œæˆ‘ä»¬å‘ç°åªä¼šæ‰“å°å¼€å§‹ï¼Œå¹¶ä¸ä¼šæ‰“å°ç»“æŸï¼Œè¿™è¯´æ˜åœ¨UIApplicationMainå‡½æ•°ä¸­ï¼Œå¼€å¯äº†ä¸€ä¸ªå’Œä¸»çº¿ç¨‹ç›¸å…³çš„RunLoopï¼Œå¯¼è‡´UIApplicationMainä¸ä¼šè¿”å›ï¼Œä¸€ç›´åœ¨è¿è¡Œä¸­ï¼Œä¹Ÿå°±ä¿è¯äº†ç¨‹åºçš„æŒç»­è¿è¡Œã€‚æˆ‘ä»¬æ¥çœ‹åˆ°RunLoopçš„æºç  12345678// ç”¨DefaultModeå¯åŠ¨void CFRunLoopRun(void) &#123; /* DOES CALLOUT */ int32_t result; do &#123; result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false); CHECK_FOR_FORK(); &#125; while (kCFRunLoopRunStopped != result &amp;&amp; kCFRunLoopRunFinished != result);&#125; æˆ‘ä»¬å‘ç°RunLoopç¡®å®æ˜¯do whileé€šè¿‡åˆ¤æ–­resultçš„å€¼å®ç°çš„ã€‚å› æ­¤ï¼Œæˆ‘ä»¬å¯ä»¥æŠŠRunLoopçœ‹æˆä¸€ä¸ªæ­»å¾ªç¯ã€‚å¦‚æœæ²¡æœ‰RunLoopï¼ŒUIApplicationMainå‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åå°†ç›´æ¥è¿”å›ï¼Œä¹Ÿå°±æ²¡æœ‰ç¨‹åºæŒç»­è¿è¡Œä¸€è¯´äº†ã€‚ RunLoopå¯¹è±¡ Fundationæ¡†æ¶ï¼ˆåŸºäºCFRunLoopRefçš„å°è£…ï¼‰ NSRunLoop å¯¹è±¡ CoreFoundation CFRunLoopRef å¯¹è±¡ å› ä¸ºFundationæ¡†æ¶æ˜¯åŸºäºCFRunLoopRefçš„ä¸€å±‚OCå°è£…ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦ç ”ç©¶CFRunLoopRefæºç  å¦‚ä½•è·å¾—RunLoopå¯¹è±¡Foundation12[NSRunLoop currentRunLoop]; // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡[NSRunLoop mainRunLoop]; // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ Core Foundation12CFRunLoopGetCurrent(); // è·å¾—å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡CFRunLoopGetMain(); // è·å¾—ä¸»çº¿ç¨‹çš„RunLoopå¯¹è±¡ RunLoopå’Œçº¿ç¨‹é—´çš„å…³ç³» 1.æ¯æ¡çº¿ç¨‹éƒ½æœ‰å”¯ä¸€çš„ä¸€ä¸ªä¸ä¹‹å¯¹åº”çš„RunLoopå¯¹è±¡ 2.RunLoopä¿å­˜åœ¨ä¸€ä¸ªå…¨å±€çš„Dictionaryé‡Œï¼Œçº¿ç¨‹ä½œä¸ºkey,RunLoopä½œä¸ºvalue 3.ä¸»çº¿ç¨‹çš„RunLoopå·²ç»è‡ªåŠ¨åˆ›å»ºå¥½äº†ï¼Œå­çº¿ç¨‹çš„RunLoopéœ€è¦ä¸»åŠ¨åˆ›å»º 4.RunLoopåœ¨ç¬¬ä¸€æ¬¡è·å–æ—¶åˆ›å»ºï¼Œåœ¨çº¿ç¨‹ç»“æŸæ—¶é”€æ¯ é€šè¿‡æºç æŸ¥çœ‹ä¸Šè¿°å¯¹åº” 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455// æ‹¿åˆ°å½“å‰Runloop è°ƒç”¨_CFRunLoopGet0CFRunLoopRef CFRunLoopGetCurrent(void) &#123; CHECK_FOR_FORK(); CFRunLoopRef rl = (CFRunLoopRef)_CFGetTSD(__CFTSDKeyRunLoop); if (rl) return rl; return _CFRunLoopGet0(pthread_self());&#125;// æŸ¥çœ‹_CFRunLoopGet0æ–¹æ³•å†…éƒ¨CF_EXPORT CFRunLoopRef _CFRunLoopGet0(pthread_t t) &#123; if (pthread_equal(t, kNilPthreadT)) &#123; t = pthread_main_thread_np(); &#125; __CFLock(&amp;loopsLock); if (!__CFRunLoops) &#123; __CFUnlock(&amp;loopsLock); CFMutableDictionaryRef dict = CFDictionaryCreateMutable(kCFAllocatorSystemDefault, 0, NULL, &amp;kCFTypeDictionaryValueCallBacks); // æ ¹æ®ä¼ å…¥çš„ä¸»çº¿ç¨‹è·å–ä¸»çº¿ç¨‹å¯¹åº”çš„RunLoop CFRunLoopRef mainLoop = __CFRunLoopCreate(pthread_main_thread_np()); // ä¿å­˜ä¸»çº¿ç¨‹ å°†ä¸»çº¿ç¨‹-keyå’ŒRunLoop-Valueä¿å­˜åˆ°å­—å…¸ä¸­ CFDictionarySetValue(dict, pthreadPointer(pthread_main_thread_np()), mainLoop); if (!OSAtomicCompareAndSwapPtrBarrier(NULL, dict, (void * volatile *)&amp;__CFRunLoops)) &#123; CFRelease(dict); &#125; CFRelease(mainLoop); __CFLock(&amp;loopsLock); &#125; // ä»å­—å…¸é‡Œé¢æ‹¿ï¼Œå°†çº¿ç¨‹ä½œä¸ºkeyä»å­—å…¸é‡Œè·å–ä¸€ä¸ªloop CFRunLoopRef loop = (CFRunLoopRef)CFDictionaryGetValue(__CFRunLoops, pthreadPointer(t)); __CFUnlock(&amp;loopsLock); // å¦‚æœloopä¸ºç©ºï¼Œåˆ™åˆ›å»ºä¸€ä¸ªæ–°çš„loopï¼Œæ‰€ä»¥runloopä¼šåœ¨ç¬¬ä¸€æ¬¡è·å–çš„æ—¶å€™åˆ›å»º if (!loop) &#123; CFRunLoopRef newLoop = __CFRunLoopCreate(t); __CFLock(&amp;loopsLock); loop = (CFRunLoopRef)CFDictionaryGetValue(__CFRunLoops, pthreadPointer(t)); // åˆ›å»ºå¥½ä¹‹åï¼Œä»¥çº¿ç¨‹ä¸ºkey runloopä¸ºvalueï¼Œä¸€å¯¹ä¸€å­˜å‚¨åœ¨å­—å…¸ä¸­ï¼Œä¸‹æ¬¡è·å–çš„æ—¶å€™ï¼Œåˆ™ç›´æ¥è¿”å›å­—å…¸å†…çš„runloop if (!loop) &#123; CFDictionarySetValue(__CFRunLoops, pthreadPointer(t), newLoop); loop = newLoop; &#125; // don't release run loops inside the loopsLock, because CFRunLoopDeallocate may end up taking it __CFUnlock(&amp;loopsLock); CFRelease(newLoop); &#125; if (pthread_equal(t, pthread_self())) &#123; _CFSetTSD(__CFTSDKeyRunLoop, (void *)loop, NULL); if (0 == _CFGetTSD(__CFTSDKeyRunLoopCntr)) &#123; _CFSetTSD(__CFTSDKeyRunLoopCntr, (void *)(PTHREAD_DESTRUCTOR_ITERATIONS-1), (void (*)(void *))__CFFinalizeRunLoop); &#125; &#125; return loop;&#125; ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹å‡ºï¼Œçº¿ç¨‹å’Œ RunLoop ä¹‹é—´æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œå…¶å…³ç³»æ˜¯ä¿å­˜åœ¨ä¸€ä¸ª Dictionary é‡Œã€‚æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºå­çº¿ç¨‹RunLoopæ—¶ï¼Œåªéœ€åœ¨å­çº¿ç¨‹ä¸­è·å–å½“å‰çº¿ç¨‹çš„RunLoopå¯¹è±¡å³å¯ 1[NSRunLoop currentRunLoop]; å¦‚æœä¸è·å–ï¼Œé‚£å­çº¿ç¨‹å°±ä¸ä¼šåˆ›å»ºä¸ä¹‹ç›¸å…³è”çš„RunLoopï¼Œå¹¶ä¸”åªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹çš„å†…éƒ¨è·å–å…¶ RunLoop[NSRunLoop currentRunLoop];æ–¹æ³•è°ƒç”¨æ—¶ï¼Œä¼šå…ˆçœ‹ä¸€ä¸‹å­—å…¸é‡Œæœ‰æ²¡æœ‰å­˜å­çº¿ç¨‹ç›¸å¯¹ç”¨çš„RunLoopï¼Œå¦‚æœæœ‰åˆ™ç›´æ¥è¿”å›RunLoopï¼Œå¦‚æœæ²¡æœ‰åˆ™ä¼šåˆ›å»ºä¸€ä¸ªï¼Œå¹¶å°†ä¸ä¹‹å¯¹åº”çš„å­çº¿ç¨‹å­˜å…¥å­—å…¸ä¸­ã€‚å½“çº¿ç¨‹ç»“æŸæ—¶ï¼ŒRunLoopä¼šè¢«é”€æ¯ã€‚ RunLoopç»“æ„ä½“é€šè¿‡æºç æˆ‘ä»¬æ‰¾åˆ°__CFRunLoopç»“æ„ä½“123456789101112131415161718struct __CFRunLoop &#123; CFRuntimeBase _base; pthread_mutex_t _lock; /* locked for accessing mode list */ __CFPort _wakeUpPort; // used for CFRunLoopWakeUp Boolean _unused; volatile _per_run_data *_perRunData; // reset for runs of the run loop pthread_t _pthread; uint32_t _winthread; CFMutableSetRef _commonModes; CFMutableSetRef _commonModeItems; CFRunLoopModeRef _currentMode; CFMutableSetRef _modes; struct _block_item *_blocks_head; struct _block_item *_blocks_tail; CFAbsoluteTime _runTime; CFAbsoluteTime _sleepTime; CFTypeRef _counterpart;&#125;; é™¤ä¸€äº›è®°å½•æ€§å±æ€§å¤–ï¼Œä¸»è¦æ¥çœ‹ä¸€ä¸‹ä»¥ä¸‹ä¸¤ä¸ªæˆå‘˜å˜é‡12CFRunLoopModeRef _currentMode;CFMutableSetRef _modes; CFRunLoopModeRef å…¶å®æ˜¯æŒ‡å‘CFRunLoopModeç»“æ„ä½“çš„æŒ‡é’ˆï¼ŒCFRunLoopModeç»“æ„ä½“æºç å¦‚ä¸‹12345678910111213141516171819202122232425262728293031typedef struct __CFRunLoopMode *CFRunLoopModeRef;struct __CFRunLoopMode &#123; CFRuntimeBase _base; pthread_mutex_t _lock; /* must have the run loop locked before locking this */ CFStringRef _name; Boolean _stopped; char _padding[3]; CFMutableSetRef _sources0; CFMutableSetRef _sources1; CFMutableArrayRef _observers; CFMutableArrayRef _timers; CFMutableDictionaryRef _portToV1SourceMap; __CFPortSet _portSet; CFIndex _observerMask;#if USE_DISPATCH_SOURCE_FOR_TIMERS dispatch_source_t _timerSource; dispatch_queue_t _queue; Boolean _timerFired; // set to true by the source when a timer has fired Boolean _dispatchTimerArmed;#endif#if USE_MK_TIMER_TOO mach_port_t _timerPort; Boolean _mkTimerArmed;#endif#if DEPLOYMENT_TARGET_WINDOWS DWORD _msgQMask; void (*_msgPump)(void);#endif uint64_t _timerSoftDeadline; /* TSR */ uint64_t _timerHardDeadline; /* TSR */&#125;; ä¸»è¦æŸ¥çœ‹ä»¥ä¸‹æˆå‘˜å˜é‡1234CFMutableSetRef _sources0;CFMutableSetRef _sources1;CFMutableArrayRef _observers;CFMutableArrayRef _timers; é€šè¿‡ä¸Šé¢åˆ†ææˆ‘ä»¬çŸ¥é“ï¼ŒCFRunLoopModeRefä»£è¡¨RunLoopçš„è¿è¡Œæ¨¡å¼ï¼Œä¸€ä¸ªRunLoopåŒ…å«è‹¥å¹²ä¸ªModeï¼Œæ¯ä¸ªModeåˆåŒ…å«è‹¥å¹²ä¸ªSource0/Source1/Timer/Observerï¼Œè€ŒRunLoopå¯åŠ¨æ—¶åªèƒ½é€‰æ‹©å…¶ä¸­ä¸€ä¸ªModeä½œä¸ºcurrentModeã€‚ Source1/Source0/Timers/Observeråˆ†åˆ«ä»£è¡¨ä»€ä¹ˆ Source1 : åŸºäºPortçš„çº¿ç¨‹é—´é€šä¿¡Source0 : è§¦æ‘¸äº‹ä»¶ï¼ŒPerformSelectorsæˆ‘ä»¬é€šè¿‡ä»£ç éªŒè¯ä¸€ä¸‹ 123- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@\"ç‚¹å‡»äº†å±å¹•\");&#125; æ‰“æ–­ç‚¹ä¹‹åæ‰“å°å †æ ˆä¿¡æ¯ï¼Œå½“xcodeå·¥å…·åŒºæ‰“å°çš„å †æ ˆä¿¡æ¯ä¸å…¨æ—¶ï¼Œå¯ä»¥åœ¨æ§åˆ¶å°é€šè¿‡â€œbtâ€æŒ‡ä»¤æ‰“å°å®Œæ•´çš„å †æ ˆä¿¡æ¯ï¼Œç”±å †æ ˆä¿¡æ¯ä¸­å¯ä»¥å‘ç°ï¼Œè§¦æ‘¸äº‹ä»¶ç¡®å®æ˜¯ä¼šè§¦å‘Source0äº‹ä»¶ã€‚ åŒæ ·çš„æ–¹å¼éªŒè¯performSelectorå †æ ˆä¿¡æ¯ 123dispatch_async(dispatch_get_global_queue(0, 0), ^&#123; [self performSelectorOnMainThread:@selector(test) withObject:nil waitUntilDone:YES];&#125;); å¯ä»¥å‘ç°PerformSelectorsåŒæ ·æ˜¯è§¦å‘Source0äº‹ä»¶ å…¶å®ï¼Œå½“æˆ‘ä»¬è§¦å‘äº†äº‹ä»¶ï¼ˆè§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰ï¼‰åï¼Œç”±IOKit.frameworkç”Ÿæˆä¸€ä¸ª IOHIDEventäº‹ä»¶ IOKitæ˜¯è‹¹æœçš„ç¡¬ä»¶é©±åŠ¨æ¡†æ¶ï¼Œç”±å®ƒè¿›è¡Œåº•å±‚æ¥å£çš„æŠ½è±¡å°è£…ä¸ç³»ç»Ÿè¿›è¡Œäº¤äº’ä¼ é€’ç¡¬ä»¶æ„Ÿåº”çš„äº‹ä»¶ï¼Œå¹¶ä¸“é—¨å¤„ç†ç”¨æˆ·äº¤äº’è®¾å¤‡ï¼Œç”±IOHIDServiceså’ŒIOHIDDisplaysä¸¤éƒ¨åˆ†ç»„æˆï¼Œå…¶ä¸­IOHIDServicesæ˜¯ä¸“é—¨å¤„ç†ç”¨æˆ·äº¤äº’çš„ï¼Œå®ƒä¼šå°†äº‹ä»¶å°è£…æˆIOHIDEventså¯¹è±¡ æ¥ç€ç”¨mach portè½¬å‘ç»™éœ€è¦çš„Appè¿›ç¨‹ï¼Œéšå Source1å°±ä¼šæ¥æ”¶IOHIDEventï¼Œä¹‹åå†å›è°ƒIOHIDEventSystemClientQueueCallback()ï¼ŒIOHIDEventSystemClientQueueCallback()å†…è§¦å‘Source0ï¼ŒSource0 å†è§¦å‘ _UIApplicationHandleEventQueue()ã€‚æ‰€ä»¥è§¦æ‘¸äº‹ä»¶çœ‹åˆ°æ˜¯åœ¨ Source0 å†…çš„ã€‚ Timers : å®šæ—¶å™¨ï¼ŒNSTimeré€šè¿‡ä»£ç éªŒè¯123[NSTimer scheduledTimerWithTimeInterval:3.0 repeats:NO block:^(NSTimer * _Nonnull timer) &#123; NSLog(@\"NSTimer ---- timerè°ƒç”¨äº†\");&#125;]; æ‰“å°å®Œæ•´å †æ ˆä¿¡æ¯ Observer : ç›‘å¬å™¨ï¼Œç”¨äºç›‘å¬RunLoopçš„çŠ¶æ€è¯¦è§£RunLoopç›¸å…³ç±»åŠä½œç”¨é€šè¿‡ä¸Šé¢çš„åˆ†æï¼Œæˆ‘ä»¬å¯¹RunLoopå†…éƒ¨ç»“æ„æœ‰äº†å¤§è‡´çš„äº†è§£ï¼Œæ¥ä¸‹æ¥æ¥è¯¦ç»†åˆ†æRunLoopçš„ç›¸å…³ç±»ã€‚ä»¥ä¸‹ä¸ºCore Foundationä¸­å…³äºRunLoopçš„5ä¸ªç±» CFRunLoopRef - è·å¾—å½“å‰RunLoopå’Œä¸»RunLoop CFRunLoopModeRef - RunLoop è¿è¡Œæ¨¡å¼ï¼Œåªèƒ½é€‰æ‹©ä¸€ç§ï¼Œåœ¨ä¸åŒæ¨¡å¼ä¸­åšä¸åŒçš„æ“ä½œ CFRunLoopSourceRef - äº‹ä»¶æºï¼Œè¾“å…¥æº CFRunLoopTimerRef - å®šæ—¶å™¨æ—¶é—´ CFRunLoopObserverRef - è§‚å¯Ÿè€… 1ï¼‰CFRunLoopModeRefCFRunLoopModeRefä»£è¡¨RunLoopçš„è¿è¡Œæ¨¡å¼ä¸€ä¸ª RunLoop åŒ…å«è‹¥å¹²ä¸ª Modeï¼Œæ¯ä¸ªModeåˆåŒ…å«è‹¥å¹²ä¸ªSourceã€Timerã€Observeræ¯æ¬¡RunLoopå¯åŠ¨æ—¶ï¼Œåªèƒ½æŒ‡å®šå…¶ä¸­ä¸€ä¸ª Modeï¼Œè¿™ä¸ªModeè¢«ç§°ä½œ CurrentModeå¦‚æœéœ€è¦åˆ‡æ¢Modeï¼Œåªèƒ½é€€å‡ºRunLoopï¼Œå†é‡æ–°æŒ‡å®šä¸€ä¸ªModeè¿›å…¥ï¼Œè¿™æ ·åšä¸»è¦æ˜¯ä¸ºäº†åˆ†éš”å¼€ä¸åŒç»„çš„Sourceã€Timerã€Observerï¼Œè®©å…¶äº’ä¸å½±å“ã€‚å¦‚æœModeé‡Œæ²¡æœ‰ä»»ä½•Source0/Source1/Timer/Observerï¼ŒRunLoopä¼šç«‹é©¬é€€å‡ºå¦‚å›¾æ‰€ç¤ºï¼š æ³¨æ„ï¼šä¸€ç§Modeä¸­å¯ä»¥æœ‰å¤šä¸ªSource(äº‹ä»¶æºï¼Œè¾“å…¥æºï¼ŒåŸºäºç«¯å£äº‹ä»¶æºä¾‹é”®ç›˜è§¦æ‘¸ç­‰) Observer(è§‚å¯Ÿè€…ï¼Œè§‚å¯Ÿå½“å‰RunLoopè¿è¡ŒçŠ¶æ€) å’ŒTimer(å®šæ—¶å™¨äº‹ä»¶æº)ã€‚ä½†æ˜¯å¿…é¡»è‡³å°‘æœ‰ä¸€ä¸ªSourceæˆ–è€…Timerï¼Œå› ä¸ºå¦‚æœModeä¸ºç©ºï¼ŒRunLoopè¿è¡Œåˆ°ç©ºæ¨¡å¼ä¸ä¼šè¿›è¡Œç©ºè½¬ï¼Œå°±ä¼šç«‹åˆ»é€€å‡ºã€‚ ç³»ç»Ÿé»˜è®¤æ³¨å†Œçš„5ä¸ªMode: RunLoop æœ‰äº”ç§è¿è¡Œæ¨¡å¼ï¼Œå…¶ä¸­å¸¸è§çš„æœ‰1.2ä¸¤ç§ kCFRunLoopDefaultModeï¼šAppçš„é»˜è®¤Modeï¼Œé€šå¸¸ä¸»çº¿ç¨‹æ˜¯åœ¨è¿™ä¸ªModeä¸‹è¿è¡Œ UITrackingRunLoopModeï¼šç•Œé¢è·Ÿè¸ª Modeï¼Œç”¨äº ScrollView è¿½è¸ªè§¦æ‘¸æ»‘åŠ¨ï¼Œä¿è¯ç•Œé¢æ»‘åŠ¨æ—¶ä¸å—å…¶ä»– Mode å½±å“ UIInitializationRunLoopMode: åœ¨åˆšå¯åŠ¨ App æ—¶ç¬¬è¿›å…¥çš„ç¬¬ä¸€ä¸ª Modeï¼Œå¯åŠ¨å®Œæˆåå°±ä¸å†ä½¿ç”¨ï¼Œä¼šåˆ‡æ¢åˆ°kCFRunLoopDefaultMode GSEventReceiveRunLoopMode: æ¥å—ç³»ç»Ÿäº‹ä»¶çš„å†…éƒ¨ Modeï¼Œé€šå¸¸ç”¨ä¸åˆ° kCFRunLoopCommonModes: è¿™æ˜¯ä¸€ä¸ªå ä½ç”¨çš„Modeï¼Œä½œä¸ºæ ‡è®°kCFRunLoopDefaultModeå’ŒUITrackingRunLoopModeç”¨ï¼Œå¹¶ä¸æ˜¯ä¸€ç§çœŸæ­£çš„Mode Modeé—´çš„åˆ‡æ¢æˆ‘ä»¬å¹³æ—¶åœ¨å¼€å‘ä¸­ä¸€å®šé‡åˆ°è¿‡ï¼Œå½“æˆ‘ä»¬ä½¿ç”¨NSTimeræ¯ä¸€æ®µæ—¶é—´æ‰§è¡Œä¸€äº›äº‹æƒ…æ—¶æ»‘åŠ¨UIScrollViewï¼ŒNSTimerå°±ä¼šæš‚åœï¼Œå½“æˆ‘ä»¬åœæ­¢æ»‘åŠ¨ä»¥åï¼ŒNSTimeråˆä¼šé‡æ–°æ¢å¤çš„æƒ…å†µï¼Œæˆ‘ä»¬é€šè¿‡ä¸€æ®µä»£ç æ¥çœ‹ä¸€ä¸‹ä»£ç ä¸­çš„æ³¨é‡Šä¹Ÿå¾ˆé‡è¦ï¼Œå±•ç¤ºäº†æˆ‘ä»¬æ¢ç´¢çš„è¿‡ç¨‹ 123456789101112131415161718192021222324-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; // [NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(show) userInfo:nil repeats:YES]; NSTimer *timer = [NSTimer timerWithTimeInterval:2.0 target:self selector:@selector(show) userInfo:nil repeats:YES]; // åŠ å…¥åˆ°RunLoopä¸­æ‰å¯ä»¥è¿è¡Œ // 1. æŠŠå®šæ—¶å™¨æ·»åŠ åˆ°RunLoopä¸­ï¼Œå¹¶ä¸”é€‰æ‹©é»˜è®¤è¿è¡Œæ¨¡å¼NSDefaultRunLoopMode = kCFRunLoopDefaultMode // [[NSRunLoop mainRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode]; // å½“textFiledæ»‘åŠ¨çš„æ—¶å€™ï¼Œtimerå¤±æ•ˆï¼Œåœæ­¢æ»‘åŠ¨æ—¶ï¼Œtimeræ¢å¤ // åŸå› ï¼šå½“textFiledæ»‘åŠ¨çš„æ—¶å€™ï¼ŒRunLoopçš„Modeä¼šè‡ªåŠ¨åˆ‡æ¢æˆUITrackingRunLoopModeæ¨¡å¼ï¼Œå› æ­¤timerå¤±æ•ˆï¼Œå½“åœæ­¢æ»‘åŠ¨ï¼ŒRunLoopåˆä¼šåˆ‡æ¢å›NSDefaultRunLoopModeæ¨¡å¼ï¼Œå› æ­¤timeråˆä¼šé‡æ–°å¯åŠ¨äº† // 2. å½“æˆ‘ä»¬å°†timeræ·»åŠ åˆ°UITrackingRunLoopModeæ¨¡å¼ä¸­ï¼Œæ­¤æ—¶åªæœ‰æˆ‘ä»¬åœ¨æ»‘åŠ¨textFieldæ—¶timeræ‰ä¼šè¿è¡Œ // [[NSRunLoop mainRunLoop] addTimer:timer forMode:UITrackingRunLoopMode]; // 3. é‚£ä¸ªå¦‚ä½•è®©timeråœ¨ä¸¤ä¸ªæ¨¡å¼ä¸‹éƒ½å¯ä»¥è¿è¡Œå‘¢ï¼Ÿ // 3.1 åœ¨ä¸¤ä¸ªæ¨¡å¼ä¸‹éƒ½æ·»åŠ timer æ˜¯å¯ä»¥çš„ï¼Œä½†æ˜¯timeræ·»åŠ äº†ä¸¤æ¬¡ï¼Œå¹¶ä¸æ˜¯åŒä¸€ä¸ªtimer // 3.2 ä½¿ç”¨ç«™ä½çš„è¿è¡Œæ¨¡å¼ NSRunLoopCommonModesæ ‡è®°ï¼Œå‡¡æ˜¯è¢«æ‰“ä¸ŠNSRunLoopCommonModesæ ‡è®°çš„éƒ½å¯ä»¥è¿è¡Œï¼Œä¸‹é¢ä¸¤ç§æ¨¡å¼è¢«æ‰“ä¸Šæ ‡ç­¾ //0 : &lt;CFString 0x10b7fe210 [0x10a8c7a40]&gt;&#123;contents = \"UITrackingRunLoopMode\"&#125; //2 : &lt;CFString 0x10a8e85e0 [0x10a8c7a40]&gt;&#123;contents = \"kCFRunLoopDefaultMode\"&#125; // å› æ­¤ä¹Ÿå°±æ˜¯è¯´å¦‚æœæˆ‘ä»¬ä½¿ç”¨NSRunLoopCommonModesï¼Œtimerå¯ä»¥åœ¨UITrackingRunLoopModeï¼ŒkCFRunLoopDefaultModeä¸¤ç§æ¨¡å¼ä¸‹è¿è¡Œ [[NSRunLoop mainRunLoop] addTimer:timer forMode:NSRunLoopCommonModes]; NSLog(@\"%@\",[NSRunLoop mainRunLoop]);&#125;-(void)show &#123; NSLog(@\"-------\");&#125; ç”±ä¸Šè¿°ä»£ç å¯ä»¥çœ‹å‡ºï¼ŒNSTimerä¸ç®¡ç”¨æ˜¯å› ä¸ºModeçš„åˆ‡æ¢ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨å®šæ—¶å™¨ï¼Œæ­¤æ—¶RunLoopçš„Modeä¸ºkCFRunLoopDefaultModeï¼Œå³å®šæ—¶å™¨å±äºkCFRunLoopDefaultModeï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬æ»‘åŠ¨ScrollViewæ—¶ï¼ŒRunLoopçš„Modeä¼šåˆ‡æ¢åˆ°UITrackingRunLoopModeï¼Œå› æ­¤åœ¨ä¸»çº¿ç¨‹çš„å®šæ—¶å™¨å°±ä¸åœ¨ç®¡ç”¨äº†ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿå°±ä¸å†æ‰§è¡Œäº†ï¼Œå½“æˆ‘ä»¬åœæ­¢æ»‘åŠ¨æ—¶ï¼ŒRunLoopçš„Modeåˆ‡æ¢å›kCFRunLoopDefaultModeï¼Œæ‰€ä»¥NSTimerå°±åˆç®¡ç”¨äº†ã€‚åŒæ ·é“ç†çš„è¿˜æœ‰ImageViewçš„æ˜¾ç¤ºï¼Œæˆ‘ä»¬ç›´æ¥æ¥çœ‹ä»£ç ï¼Œä¸å†èµ˜è¿°äº† 1234567- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; NSLog(@\"%s\",__func__); // performSelectoré»˜è®¤æ˜¯åœ¨defaultæ¨¡å¼ä¸‹è¿è¡Œï¼Œå› æ­¤åœ¨æ»‘åŠ¨ScrollViewæ—¶ï¼Œå›¾ç‰‡ä¸ä¼šåŠ è½½ // [self.imageView performSelector:@selector(setImage:) withObject:[UIImage imageNamed:@\"abc\"] afterDelay:2.0 ]; // inModes: ä¼ å…¥Modeæ•°ç»„ [self.imageView performSelector:@selector(setImage:) withObject:[UIImage imageNamed:@\"abc\"] afterDelay:2.0 inModes:@[NSDefaultRunLoopMode,UITrackingRunLoopMode]];&#125; ä½¿ç”¨GCDä¹Ÿå¯æ˜¯åˆ›å»ºè®¡æ—¶å™¨ï¼Œè€Œä¸”æ›´ä¸ºç²¾ç¡®æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ä»£ç  123456789101112131415161718192021222324252627282930- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; //åˆ›å»ºé˜Ÿåˆ— dispatch_queue_t queue = dispatch_get_global_queue(0, 0); //1.åˆ›å»ºä¸€ä¸ªGCDå®šæ—¶å™¨ /* ç¬¬ä¸€ä¸ªå‚æ•°:è¡¨æ˜åˆ›å»ºçš„æ˜¯ä¸€ä¸ªå®šæ—¶å™¨ ç¬¬å››ä¸ªå‚æ•°:é˜Ÿåˆ— */ dispatch_source_t timer = dispatch_source_create(DISPATCH_SOURCE_TYPE_TIMER, 0, 0, queue); // éœ€è¦å¯¹timerè¿›è¡Œå¼ºå¼•ç”¨ï¼Œä¿è¯å…¶ä¸ä¼šè¢«é‡Šæ”¾æ‰ï¼Œæ‰ä¼šæŒ‰æ—¶è°ƒç”¨blockå— // å±€éƒ¨å˜é‡ï¼Œè®©æŒ‡é’ˆå¼ºå¼•ç”¨ self.timer = timer; //2.è®¾ç½®å®šæ—¶å™¨çš„å¼€å§‹æ—¶é—´,é—´éš”æ—¶é—´,ç²¾å‡†åº¦ /* ç¬¬1ä¸ªå‚æ•°:è¦ç»™å“ªä¸ªå®šæ—¶å™¨è®¾ç½® ç¬¬2ä¸ªå‚æ•°:å¼€å§‹æ—¶é—´ ç¬¬3ä¸ªå‚æ•°:é—´éš”æ—¶é—´ ç¬¬4ä¸ªå‚æ•°:ç²¾å‡†åº¦ ä¸€èˆ¬ä¸º0 åœ¨å…è®¸èŒƒå›´å†…å¢åŠ è¯¯å·®å¯æé«˜ç¨‹åºçš„æ€§èƒ½ GCDçš„å•ä½æ˜¯çº³ç§’ æ‰€ä»¥è¦*NSEC_PER_SEC */ dispatch_source_set_timer(timer, DISPATCH_TIME_NOW, 2.0 * NSEC_PER_SEC, 0 * NSEC_PER_SEC); //3.è®¾ç½®å®šæ—¶å™¨è¦æ‰§è¡Œçš„äº‹æƒ… dispatch_source_set_event_handler(timer, ^&#123; NSLog(@\"---%@--\",[NSThread currentThread]); &#125;); // å¯åŠ¨ dispatch_resume(timer);&#125; 2ï¼‰CFRunLoopSourceRefäº‹ä»¶æºï¼ˆè¾“å…¥æºï¼‰Sourceåˆ†ä¸ºä¸¤ç§ Source0ï¼šéåŸºäºPortçš„ ç”¨äºç”¨æˆ·ä¸»åŠ¨è§¦å‘çš„äº‹ä»¶ï¼ˆç‚¹å‡»button æˆ–ç‚¹å‡»å±å¹•ï¼‰ Source1ï¼šåŸºäºPortçš„ é€šè¿‡å†…æ ¸å’Œå…¶ä»–çº¿ç¨‹ç›¸äº’å‘é€æ¶ˆæ¯ï¼ˆä¸å†…æ ¸ç›¸å…³ï¼‰ è§¦æ‘¸äº‹ä»¶åŠPerformSelectorsä¼šè§¦å‘Source0äº‹ä»¶æºåœ¨å‰æ–‡å·²ç»éªŒè¯è¿‡ï¼Œè¿™é‡Œä¸åœ¨èµ˜è¿° 3ï¼‰CFRunLoopObserverRef CFRunLoopObserverRefæ˜¯è§‚å¯Ÿè€…ï¼Œèƒ½å¤Ÿç›‘å¬RunLoopçš„çŠ¶æ€æ”¹å˜ æˆ‘ä»¬ç›´æ¥æ¥çœ‹ä»£ç ï¼Œç»™RunLoopæ·»åŠ ç›‘å¬è€…ï¼Œç›‘å¬å…¶è¿è¡ŒçŠ¶æ€ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; //åˆ›å»ºç›‘å¬è€… /* ç¬¬ä¸€ä¸ªå‚æ•° CFAllocatorRef allocatorï¼šåˆ†é…å­˜å‚¨ç©ºé—´ CFAllocatorGetDefault()é»˜è®¤åˆ†é… ç¬¬äºŒä¸ªå‚æ•° CFOptionFlags activitiesï¼šè¦ç›‘å¬çš„çŠ¶æ€ kCFRunLoopAllActivities ç›‘å¬æ‰€æœ‰çŠ¶æ€ ç¬¬ä¸‰ä¸ªå‚æ•° Boolean repeatsï¼šYES:æŒç»­ç›‘å¬ NO:ä¸æŒç»­ ç¬¬å››ä¸ªå‚æ•° CFIndex orderï¼šä¼˜å…ˆçº§ï¼Œä¸€èˆ¬å¡«0å³å¯ ç¬¬äº”ä¸ªå‚æ•° å›è°ƒ ä¸¤ä¸ªå‚æ•°observer:ç›‘å¬è€… activity:ç›‘å¬çš„äº‹ä»¶ */ /* æ‰€æœ‰äº‹ä»¶ typedef CF_OPTIONS(CFOptionFlags, CFRunLoopActivity) &#123; kCFRunLoopEntry = (1UL &lt;&lt; 0), // å³å°†è¿›å…¥RunLoop kCFRunLoopBeforeTimers = (1UL &lt;&lt; 1), // å³å°†å¤„ç†Timer kCFRunLoopBeforeSources = (1UL &lt;&lt; 2), // å³å°†å¤„ç†Source kCFRunLoopBeforeWaiting = (1UL &lt;&lt; 5), //å³å°†è¿›å…¥ä¼‘çœ  kCFRunLoopAfterWaiting = (1UL &lt;&lt; 6),// åˆšä»ä¼‘çœ ä¸­å”¤é†’ kCFRunLoopExit = (1UL &lt;&lt; 7),// å³å°†é€€å‡ºRunLoop kCFRunLoopAllActivities = 0x0FFFFFFFU &#125;; */ CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(), kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123; switch (activity) &#123; case kCFRunLoopEntry: NSLog(@\"RunLoopè¿›å…¥\"); break; case kCFRunLoopBeforeTimers: NSLog(@\"RunLoopè¦å¤„ç†Timersäº†\"); break; case kCFRunLoopBeforeSources: NSLog(@\"RunLoopè¦å¤„ç†Sourcesäº†\"); break; case kCFRunLoopBeforeWaiting: NSLog(@\"RunLoopè¦ä¼‘æ¯äº†\"); break; case kCFRunLoopAfterWaiting: NSLog(@\"RunLoopé†’æ¥äº†\"); break; case kCFRunLoopExit: NSLog(@\"RunLoopé€€å‡ºäº†\"); break; default: break; &#125; &#125;); // ç»™RunLoopæ·»åŠ ç›‘å¬è€… /* ç¬¬ä¸€ä¸ªå‚æ•° CFRunLoopRef rlï¼šè¦ç›‘å¬å“ªä¸ªRunLoop,è¿™é‡Œç›‘å¬çš„æ˜¯ä¸»çº¿ç¨‹çš„RunLoop ç¬¬äºŒä¸ªå‚æ•° CFRunLoopObserverRef observer ç›‘å¬è€… ç¬¬ä¸‰ä¸ªå‚æ•° CFStringRef mode è¦ç›‘å¬RunLoopåœ¨å“ªç§è¿è¡Œæ¨¡å¼ä¸‹çš„çŠ¶æ€ */ CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode); /* CFçš„å†…å­˜ç®¡ç†ï¼ˆCore Foundationï¼‰ å‡¡æ˜¯å¸¦æœ‰Createã€Copyã€Retainç­‰å­—çœ¼çš„å‡½æ•°ï¼Œåˆ›å»ºå‡ºæ¥çš„å¯¹è±¡ï¼Œéƒ½éœ€è¦åœ¨æœ€ååšä¸€æ¬¡release GCDæœ¬æ¥åœ¨iOS6.0ä¹‹å‰ä¹Ÿæ˜¯éœ€è¦æˆ‘ä»¬é‡Šæ”¾çš„ï¼Œ6.0ä¹‹åGCDå·²ç»çº³å…¥åˆ°äº†ARCä¸­ï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸éœ€è¦ç®¡äº† */ CFRelease(observer);&#125; æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹è¾“å‡º ä»¥ä¸Šå¯ä»¥çœ‹å‡ºï¼ŒObserverç¡®å®ç”¨æ¥ç›‘å¬RunLoopçš„çŠ¶æ€ï¼ŒåŒ…æ‹¬å”¤é†’ï¼Œä¼‘æ¯ï¼Œä»¥åŠå¤„ç†å„ç§äº‹ä»¶ã€‚ RunLoopå¤„ç†é€»è¾‘è¿™æ—¶æˆ‘ä»¬å†æ¥åˆ†æRunLoopçš„å¤„ç†é€»è¾‘ï¼Œå°±ä¼šç®€å•æ˜äº†å¾ˆå¤šï¼Œç°åœ¨å›å¤´çœ‹å®˜æ–¹æ–‡æ¡£RunLoopçš„å¤„ç†é€»è¾‘ï¼Œå¯¹RunLoopçš„å¤„ç†é€»è¾‘æœ‰æ–°çš„è®¤è¯†ã€‚ æºç è§£æä¸‹é¢æºç ä»…ä¿ç•™äº†ä¸»æµç¨‹ä»£ç  123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596// å…±å¤–éƒ¨è°ƒç”¨çš„å…¬å¼€çš„CFRunLoopRunæ–¹æ³•ï¼Œå…¶å†…éƒ¨ä¼šè°ƒç”¨CFRunLoopRunSpecificvoid CFRunLoopRun(void) &#123; /* DOES CALLOUT */ int32_t result; do &#123; result = CFRunLoopRunSpecific(CFRunLoopGetCurrent(), kCFRunLoopDefaultMode, 1.0e10, false); CHECK_FOR_FORK(); &#125; while (kCFRunLoopRunStopped != result &amp;&amp; kCFRunLoopRunFinished != result);&#125;// ç»è¿‡ç²¾ç®€çš„ CFRunLoopRunSpecific å‡½æ•°ä»£ç ï¼Œå…¶å†…éƒ¨ä¼šè°ƒç”¨__CFRunLoopRunå‡½æ•°SInt32 CFRunLoopRunSpecific(CFRunLoopRef rl, CFStringRef modeName, CFTimeInterval seconds, Boolean returnAfterSourceHandled) &#123; /* DOES CALLOUT */ // é€šçŸ¥Observers : è¿›å…¥Loop // __CFRunLoopDoObserverså†…éƒ¨ä¼šè°ƒç”¨ __CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__å‡½æ•° if (currentMode-&gt;_observerMask &amp; kCFRunLoopEntry ) __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopEntry); // æ ¸å¿ƒçš„Loopé€»è¾‘ result = __CFRunLoopRun(rl, currentMode, seconds, returnAfterSourceHandled, previousMode); // é€šçŸ¥Observers : é€€å‡ºLoop if (currentMode-&gt;_observerMask &amp; kCFRunLoopExit ) __CFRunLoopDoObservers(rl, currentMode, kCFRunLoopExit); return result;&#125;// ç²¾ç®€åçš„ __CFRunLoopRunå‡½æ•°ï¼Œä¿ç•™äº†ä¸»è¦ä»£ç static int32_t __CFRunLoopRun(CFRunLoopRef rl, CFRunLoopModeRef rlm, CFTimeInterval seconds, Boolean stopAfterHandle, CFRunLoopModeRef previousMode) &#123; int32_t retVal = 0; do &#123; // é€šçŸ¥Observersï¼šå³å°†å¤„ç†Timers __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeTimers); // é€šçŸ¥Observersï¼šå³å°†å¤„ç†Sources __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeSources); // å¤„ç†Blocks __CFRunLoopDoBlocks(rl, rlm); // å¤„ç†Sources0 if (__CFRunLoopDoSources0(rl, rlm, stopAfterHandle)) &#123; // å¤„ç†Blocks __CFRunLoopDoBlocks(rl, rlm); &#125; // å¦‚æœæœ‰Sources1ï¼Œå°±è·³è½¬åˆ°handle_msgæ ‡è®°å¤„ if (__CFRunLoopServiceMachPort(dispatchPort, &amp;msg, sizeof(msg_buffer), &amp;livePort, 0, &amp;voucherState, NULL)) &#123; goto handle_msg; &#125; // é€šçŸ¥Observersï¼šå³å°†ä¼‘çœ  __CFRunLoopDoObservers(rl, rlm, kCFRunLoopBeforeWaiting); // è¿›å…¥ä¼‘çœ ï¼Œç­‰å¾…å…¶ä»–æ¶ˆæ¯å”¤é†’ __CFRunLoopSetSleeping(rl); __CFPortSetInsert(dispatchPort, waitSet); do &#123; __CFRunLoopServiceMachPort(waitSet, &amp;msg, sizeof(msg_buffer), &amp;livePort, poll ? 0 : TIMEOUT_INFINITY, &amp;voucherState, &amp;voucherCopy); &#125; while (1); // é†’æ¥ __CFPortSetRemove(dispatchPort, waitSet); __CFRunLoopUnsetSleeping(rl); // é€šçŸ¥Observersï¼šå·²ç»å”¤é†’ __CFRunLoopDoObservers(rl, rlm, kCFRunLoopAfterWaiting); handle_msg: // çœ‹çœ‹æ˜¯è°å”¤é†’äº†RunLoopï¼Œè¿›è¡Œç›¸åº”çš„å¤„ç† if (è¢«Timerå”¤é†’çš„) &#123; // å¤„ç†Timer __CFRunLoopDoTimers(rl, rlm, mach_absolute_time()); &#125; else if (è¢«GCDå”¤é†’çš„) &#123; __CFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE__(msg); &#125; else &#123; // è¢«Sources1å”¤é†’çš„ __CFRunLoopDoSource1(rl, rlm, rls, msg, msg-&gt;msgh_size, &amp;reply); &#125; // æ‰§è¡ŒBlocks __CFRunLoopDoBlocks(rl, rlm); // æ ¹æ®ä¹‹å‰çš„æ‰§è¡Œç»“æœï¼Œæ¥å†³å®šæ€ä¹ˆåšï¼Œä¸ºretValèµ‹ç›¸åº”çš„å€¼ if (sourceHandledThisLoop &amp;&amp; stopAfterHandle) &#123; retVal = kCFRunLoopRunHandledSource; &#125; else if (timeout_context-&gt;termTSR &lt; mach_absolute_time()) &#123; retVal = kCFRunLoopRunTimedOut; &#125; else if (__CFRunLoopIsStopped(rl)) &#123; __CFRunLoopUnsetStopped(rl); retVal = kCFRunLoopRunStopped; &#125; else if (rlm-&gt;_stopped) &#123; rlm-&gt;_stopped = false; retVal = kCFRunLoopRunStopped; &#125; else if (__CFRunLoopModeIsEmpty(rl, rlm, previousMode)) &#123; retVal = kCFRunLoopRunFinished; &#125; &#125; while (0 == retVal); return retVal;&#125; ä¸Šè¿°æºä»£ç ä¸­ï¼Œç›¸åº”å¤„ç†äº‹ä»¶å‡½æ•°å†…éƒ¨è¿˜ä¼šè°ƒç”¨æ›´åº•å±‚çš„å‡½æ•°ï¼Œå†…éƒ¨è°ƒç”¨æ‰æ˜¯çœŸæ­£å¤„ç†äº‹ä»¶çš„å‡½æ•°ï¼Œé€šè¿‡ä¸Šé¢btæ‰“å°å…¨éƒ¨å †æ ˆä¿¡æ¯ä¹Ÿå¯ä»¥å¾—åˆ°éªŒè¯ã€‚ 1ï¼‰CFRunLoopDoObservers å†…éƒ¨è°ƒç”¨ï¼š CFRUNLOOP_IS_CALLING_OUT_TO_AN_OBSERVER_CALLBACK_FUNCTION__ 2ï¼‰CFRunLoopDoBlocks å†…éƒ¨è°ƒç”¨ï¼š CFRUNLOOP_IS_CALLING_OUT_TO_A_BLOCK__ 3ï¼‰CFRunLoopDoSources0 å†…éƒ¨è°ƒç”¨ï¼š CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE0_PERFORM_FUNCTION__ 4ï¼‰CFRunLoopDoTimers å†…éƒ¨è°ƒç”¨ï¼š CFRUNLOOP_IS_CALLING_OUT_TO_A_TIMER_CALLBACK_FUNCTION__ 5ï¼‰GCD è°ƒç”¨ï¼šCFRUNLOOP_IS_SERVICING_THE_MAIN_DISPATCH_QUEUE 6ï¼‰CFRunLoopDoSource1 å†…éƒ¨è°ƒç”¨ï¼š CFRUNLOOP_IS_CALLING_OUT_TO_A_SOURCE1_PERFORM_FUNCTION__ RunLoopå¤„ç†é€»è¾‘æµç¨‹å›¾æ­¤æ—¶æˆ‘ä»¬æŒ‰ç…§æºç é‡æ–°æ•´ç†ä¸€ä¸‹RunLoopå¤„ç†é€»è¾‘å°±ä¼šå¾ˆæ¸…æ™° RunLoop é€€å‡º 1.ä¸»çº¿ç¨‹é”€æ¯RunLoopé€€å‡º 2.Modeä¸­æœ‰ä¸€äº›Timer ã€Sourceã€ Observerï¼Œè¿™äº›ä¿è¯Modeä¸ä¸ºç©ºæ—¶ä¿è¯RunLoopæ²¡æœ‰ç©ºè½¬å¹¶ä¸”æ˜¯åœ¨è¿è¡Œçš„ï¼Œå½“Modeä¸­ä¸ºç©ºçš„æ—¶å€™ï¼ŒRunLoopä¼šç«‹åˆ»é€€å‡º 3.æˆ‘ä»¬åœ¨å¯åŠ¨RunLoopçš„æ—¶å€™å¯ä»¥è®¾ç½®ä»€ä¹ˆæ—¶å€™åœæ­¢ 12[NSRunLoop currentRunLoop]runUntilDate:&lt;#(nonnull NSDate *)#&gt;[NSRunLoop currentRunLoop]runMode:&lt;#(nonnull NSString *)#&gt; beforeDate:&lt;#(nonnull NSDate *)#&gt; ç›¸å…³é—®é¢˜ä¸€äº›æœ‰å…³Runloopçš„é—®é¢˜ 1ï¼‰åŸºäºNSTimerçš„è½®æ’­å™¨ä»€ä¹ˆæƒ…å†µä¸‹ä¼šè¢«é¡µé¢æ»šåŠ¨æš‚åœï¼Œæ€æ ·å¯ä»¥ä¸è¢«æš‚åœï¼Œä¸ºä»€ä¹ˆï¼Ÿ NSTimerä¸ç®¡ç”¨æ˜¯å› ä¸ºModeçš„åˆ‡æ¢ï¼Œå› ä¸ºå¦‚æœæˆ‘ä»¬åœ¨ä¸»çº¿ç¨‹ä½¿ç”¨å®šæ—¶å™¨ï¼Œæ­¤æ—¶RunLoopçš„Modeä¸ºkCFRunLoopDefaultModeï¼Œå³å®šæ—¶å™¨å±äºkCFRunLoopDefaultModeï¼Œé‚£ä¹ˆæ­¤æ—¶æˆ‘ä»¬æ»‘åŠ¨ScrollViewæ—¶ï¼ŒRunLoopçš„Modeä¼šåˆ‡æ¢åˆ°UITrackingRunLoopModeï¼Œå› æ­¤åœ¨ä¸»çº¿ç¨‹çš„å®šæ—¶å™¨å°±ä¸åœ¨ç®¡ç”¨äº†ï¼Œè°ƒç”¨çš„æ–¹æ³•ä¹Ÿå°±ä¸å†æ‰§è¡Œäº†ï¼Œå½“æˆ‘ä»¬åœæ­¢æ»‘åŠ¨æ—¶ï¼ŒRunLoopçš„Modeåˆ‡æ¢å›kCFRunLoopDefaultModeï¼Œæ‰€æœ‰NSTimerå°±åˆç®¡ç”¨äº†ã€‚è‹¥æƒ³å®šæ—¶å™¨ç»§ç»­æ‰§è¡Œï¼Œéœ€è¦å°†NSTimer æ³¨å†Œä¸º kCFRunLoopCommonModes ã€‚ 2ï¼‰å»¶è¿Ÿæ‰§è¡ŒperformSelecterç›¸å…³æ–¹æ³•æ˜¯æ€æ ·è¢«æ‰§è¡Œçš„ï¼Ÿåœ¨å­çº¿ç¨‹ä¸­ä¹Ÿæ˜¯ä¸€æ ·çš„å—ï¼Ÿå½“è°ƒç”¨ NSObject çš„ performSelecter:afterDelay: åï¼Œå®é™…ä¸Šå…¶å†…éƒ¨ä¼šåˆ›å»ºä¸€ä¸ª Timer å¹¶æ·»åŠ åˆ°å½“å‰çº¿ç¨‹çš„ RunLoop ä¸­ã€‚æ‰€ä»¥å¦‚æœå½“å‰çº¿ç¨‹æ²¡æœ‰ RunLoopï¼Œåˆ™è¿™ä¸ªæ–¹æ³•ä¼šå¤±æ•ˆã€‚ å½“è°ƒç”¨ performSelector:onThread: æ—¶ï¼Œå®é™…ä¸Šå…¶ä¼šåˆ›å»ºä¸€ä¸ª Timer åŠ åˆ°å¯¹åº”çš„çº¿ç¨‹å»ï¼ŒåŒæ ·çš„ï¼Œå¦‚æœå¯¹åº”çº¿ç¨‹æ²¡æœ‰ RunLoop è¯¥æ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆã€‚ 3ï¼‰äº‹ä»¶å“åº”å’Œæ‰‹åŠ¿è¯†åˆ«åº•å±‚å¤„ç†æ˜¯ä¸€è‡´çš„å—ï¼Œä¸ºä»€ä¹ˆï¼Ÿ äº‹ä»¶å“åº”ï¼š è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª Source1 (åŸºäº mach port çš„) ç”¨æ¥æ¥æ”¶ç³»ç»Ÿäº‹ä»¶ï¼Œå…¶å›è°ƒå‡½æ•°ä¸º _IOHIDEventSystemClientQueueCallback()ã€‚å½“ä¸€ä¸ªç¡¬ä»¶äº‹ä»¶(è§¦æ‘¸/é”å±/æ‘‡æ™ƒç­‰)å‘ç”Ÿåï¼Œé¦–å…ˆç”± IOKit.framework ç”Ÿæˆä¸€ä¸ª IOHIDEvent äº‹ä»¶å¹¶ç”± SpringBoard æ¥æ”¶ã€‚SpringBoard åªæ¥æ”¶æŒ‰é”®(é”å±/é™éŸ³ç­‰)ï¼Œè§¦æ‘¸ï¼ŒåŠ é€Ÿï¼Œæ¥è¿‘ä¼ æ„Ÿå™¨ç­‰å‡ ç§ Eventï¼Œéšåç”¨ mach port è½¬å‘ç»™éœ€è¦çš„Appè¿›ç¨‹ã€‚éšåè‹¹æœæ³¨å†Œçš„é‚£ä¸ª Source1 å°±ä¼šè§¦å‘å›è°ƒï¼Œå¹¶è°ƒç”¨ _UIApplicationHandleEventQueue() è¿›è¡Œåº”ç”¨å†…éƒ¨çš„åˆ†å‘ã€‚ _UIApplicationHandleEventQueue() ä¼šæŠŠ IOHIDEvent å¤„ç†å¹¶åŒ…è£…æˆ UIEvent è¿›è¡Œå¤„ç†æˆ–åˆ†å‘ï¼Œå…¶ä¸­åŒ…æ‹¬è¯†åˆ« UIGesture/å¤„ç†å±å¹•æ—‹è½¬/å‘é€ç»™ UIWindow ç­‰ã€‚é€šå¸¸äº‹ä»¶æ¯”å¦‚ UIButton ç‚¹å‡»ã€touchesBegin/Move/End/Cancel äº‹ä»¶éƒ½æ˜¯åœ¨è¿™ä¸ªå›è°ƒä¸­å®Œæˆçš„ã€‚ æ‰‹åŠ¿è¯†åˆ«ï¼š å½“ä¸Šé¢çš„ _UIApplicationHandleEventQueue() è¯†åˆ«äº†ä¸€ä¸ªæ‰‹åŠ¿æ—¶ï¼Œå…¶é¦–å…ˆä¼šè°ƒç”¨ Cancel å°†å½“å‰çš„ touchesBegin/Move/End ç³»åˆ—å›è°ƒæ‰“æ–­ã€‚éšåç³»ç»Ÿå°†å¯¹åº”çš„ UIGestureRecognizer æ ‡è®°ä¸ºå¾…å¤„ç†ã€‚ è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª Observer ç›‘æµ‹ BeforeWaiting (Loopå³å°†è¿›å…¥ä¼‘çœ ) äº‹ä»¶ï¼Œè¿™ä¸ªObserverçš„å›è°ƒå‡½æ•°æ˜¯ _UIGestureRecognizerUpdateObserver()ï¼Œå…¶å†…éƒ¨ä¼šè·å–æ‰€æœ‰åˆšè¢«æ ‡è®°ä¸ºå¾…å¤„ç†çš„ GestureRecognizerï¼Œå¹¶æ‰§è¡ŒGestureRecognizerçš„å›è°ƒã€‚ å½“æœ‰ UIGestureRecognizer çš„å˜åŒ–(åˆ›å»º/é”€æ¯/çŠ¶æ€æ”¹å˜)æ—¶ï¼Œè¿™ä¸ªå›è°ƒéƒ½ä¼šè¿›è¡Œç›¸åº”å¤„ç†ã€‚ 4ï¼‰ç•Œé¢åˆ·æ–°æ—¶ï¼Œæ˜¯åœ¨ä»€ä¹ˆæ—¶å€™ä¼šçœŸæ­£æ‰§è¡Œåˆ·æ–°ï¼Œä¸ºä»€ä¹ˆä¼šåˆ·æ–°ä¸åŠæ—¶ï¼Ÿå½“åœ¨æ“ä½œ UI æ—¶ï¼Œæ¯”å¦‚æ”¹å˜äº† Frameã€æ›´æ–°äº† UIView/CALayer çš„å±‚æ¬¡æ—¶ï¼Œæˆ–è€…æ‰‹åŠ¨è°ƒç”¨äº† UIView/CALayer çš„ setNeedsLayout/setNeedsDisplayæ–¹æ³•åï¼Œè¿™ä¸ª UIView/CALayer å°±è¢«æ ‡è®°ä¸ºå¾…å¤„ç†ï¼Œå¹¶è¢«æäº¤åˆ°ä¸€ä¸ªå…¨å±€çš„å®¹å™¨å»ã€‚ è‹¹æœæ³¨å†Œäº†ä¸€ä¸ª Observer ç›‘å¬ BeforeWaiting(å³å°†è¿›å…¥ä¼‘çœ ) å’Œ Exit (å³å°†é€€å‡ºLoop) äº‹ä»¶ï¼Œå›è°ƒå»æ‰§è¡Œä¸€ä¸ªå¾ˆé•¿çš„å‡½æ•°ï¼š _ZN2CA11Transaction17observer_callbackEP19__CFRunLoopObservermPv()ã€‚è¿™ä¸ªå‡½æ•°é‡Œä¼šéå†æ‰€æœ‰å¾…å¤„ç†çš„ UIView/CAlayer ä»¥æ‰§è¡Œå®é™…çš„ç»˜åˆ¶å’Œè°ƒæ•´ï¼Œå¹¶æ›´æ–° UI ç•Œé¢ã€‚æ‰€ä»¥è¯´ç•Œé¢åˆ·æ–°å¹¶ä¸ä¸€å®šæ˜¯åœ¨setNeedsLayoutç›¸å…³çš„ä»£ç æ‰§è¡Œåç«‹åˆ»è¿›è¡Œçš„ã€‚ 5ï¼‰é¡¹ç›®ç¨‹åºè¿è¡Œä¸­ï¼Œæ€»æ˜¯ä¼´éšç€å¤šæ¬¡è‡ªåŠ¨é‡Šæ”¾æ± çš„åˆ›å»ºå’Œé”€æ¯ï¼Œè¿™äº›æ˜¯åœ¨ä»€ä¹ˆæ—¶å€™å‘ç”Ÿçš„å‘¢ï¼Ÿ ç³»ç»Ÿå°±æ˜¯é€šè¿‡@autoreleasepool {}è¿™ç§æ–¹å¼æ¥ä¸ºæˆ‘ä»¬åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± çš„ï¼Œä¸€ä¸ªçº¿ç¨‹å¯¹åº”ä¸€ä¸ªrunloopï¼Œç³»ç»Ÿä¼šä¸ºæ¯ä¸€ä¸ªrunloopéšå¼çš„åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œæ‰€æœ‰çš„autoreleasePoolæ„æˆä¸€ä¸ªæ ˆå¼ç»“æ„ï¼Œåœ¨æ¯ä¸ªrunloopç»“æŸæ—¶ï¼Œå½“å‰æ ˆé¡¶çš„autoreleasePoolä¼šè¢«é”€æ¯ï¼Œè€Œä¸”ä¼šå¯¹å…¶ä¸­çš„æ¯ä¸€ä¸ªå¯¹è±¡åšä¸€æ¬¡releaseï¼ˆä¸¥æ ¼æ¥è¯´ï¼Œæ˜¯ä½ å¯¹è¿™ä¸ªå¯¹è±¡åšäº†å‡ æ¬¡autoreleaseå°±ä¼šåšå‡ æ¬¡releaseï¼Œä¸ä¸€å®šæ˜¯ä¸€æ¬¡)ï¼Œç‰¹åˆ«æŒ‡å‡ºï¼Œä½¿ç”¨å®¹å™¨çš„blockç‰ˆæœ¬çš„æšä¸¾å™¨çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ·»åŠ ä¸€ä¸ªautoreleasePool 123[array enumerateObjectsUsingBlock:^(id obj, NSUInteger idx, BOOL *stop) &#123; // è¿™é‡Œè¢«ä¸€ä¸ªå±€éƒ¨@autoreleasepoolåŒ…å›´ç€ &#125;]; 6ï¼‰å½“æˆ‘ä»¬åœ¨å­çº¿ç¨‹ä¸Šéœ€è¦æ‰§è¡Œä»£ç†æ–¹æ³•æˆ–è€…å›è°ƒæ—¶ï¼Œæ€ä¹ˆç¡®ä¿å½“å‰çº¿ç¨‹æ²¡æœ‰è¢«é”€æ¯ï¼Ÿé¦–å…ˆå¼•å…¥ä¸€ä¸ªæ¦‚å¿µï¼šEvent_loopï¼Œä¸€èˆ¬ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡åå°±ä¼šé€€å‡ºï¼Œå½“éœ€è¦ä¿è¯è¯¥çº¿ç¨‹ä¸é€€å‡ºï¼Œå¯ä»¥é€šè¿‡ç±»ä¼¼ä»¥ä¸‹æ–¹å¼ï¼š 1234567function do_loop() &#123; initialize(); do &#123; var message = get_next_message(); process_message(message); &#125; while (message != quit);&#125; å¼€å¯ä¸€ä¸ªå¾ªç¯ï¼Œä¿è¯çº¿ç¨‹ä¸é€€å‡ºï¼Œè¿™å°±æ˜¯Event_loopæ¨¡å‹ã€‚è¿™æ˜¯åœ¨å¾ˆå¤šæ“ä½œç³»ç»Ÿä¸­éƒ½ä½¿ç”¨çš„æ¨¡å‹ï¼Œä¾‹å¦‚OS/iOSä¸­çš„RunLoopã€‚è¿™ç§æ¨¡å‹æœ€å¤§çš„ä½œç”¨å°±æ˜¯ç®¡ç†äº‹ä»¶/æ¶ˆæ¯ï¼Œåœ¨æœ‰æ–°æ¶ˆæ¯åˆ°æ¥æ—¶ç«‹åˆ»å”¤é†’å¤„ç†ï¼Œæ²¡æœ‰å¾…å¤„ç†æ¶ˆæ¯æ—¶çº¿ç¨‹ä¼‘çœ ï¼Œé¿å…èµ„æºæµªè´¹ã€‚ RunLoop ä½¿ç”¨åœºæ™¯1ï¼‰å¸¸é©»çº¿ç¨‹ å¸¸é©»çº¿ç¨‹çš„ä½œç”¨ï¼šæˆ‘ä»¬çŸ¥é“ï¼Œå½“å­çº¿ç¨‹ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•ä¹‹åå°±è¢«é”€æ¯äº†ï¼Œé‚£ä¹ˆå¦‚æœæˆ‘ä»¬éœ€è¦å¼€å¯ä¸€ä¸ªå­çº¿ç¨‹ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­æ°¸è¿œéƒ½å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ä¼šé¢ä¸´ä¸€ä¸ªé—®é¢˜ï¼Œå¦‚ä½•è®©å­çº¿ç¨‹æ°¸è¿œæ´»ç€ï¼Œè¿™æ—¶å°±è¦ç”¨åˆ°å¸¸é©»çº¿ç¨‹ï¼šç»™å­çº¿ç¨‹å¼€å¯ä¸€ä¸ªRunLoop æ³¨æ„ï¼šå­çº¿ç¨‹æ‰§è¡Œå®Œæ“ä½œä¹‹åå°±ä¼šç«‹å³é‡Šæ”¾ï¼Œå³ä½¿æˆ‘ä»¬ä½¿ç”¨å¼ºå¼•ç”¨å¼•ç”¨å­çº¿ç¨‹ä½¿å­çº¿ç¨‹ä¸è¢«é‡Šæ”¾ï¼Œä¹Ÿä¸èƒ½ç»™å­çº¿ç¨‹å†æ¬¡æ·»åŠ æ“ä½œï¼Œæˆ–è€…å†æ¬¡å¼€å¯ã€‚ å­çº¿ç¨‹å¼€å¯RunLoopçš„ä»£ç ï¼Œå…ˆç‚¹å‡»å±å¹•å¼€å¯å­çº¿ç¨‹å¹¶å¼€å¯å­çº¿ç¨‹RunLoopï¼Œç„¶åç‚¹å‡»buttonã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354- (void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event &#123; // åˆ›å»ºå­çº¿ç¨‹å¹¶å¼€å¯ NSThread *thread = [[NSThread alloc]initWithTarget:self selector:@selector(show) object:nil]; self.thread = thread; [thread start];&#125;- (void)show &#123; // æ³¨æ„ï¼šæ‰“å°æ–¹æ³•ä¸€å®šè¦åœ¨RunLoopåˆ›å»ºå¼€å§‹è¿è¡Œä¹‹å‰ï¼Œå¦‚æœåœ¨RunLoopè·‘èµ·æ¥ä¹‹åæ‰“å°ï¼ŒRunLoopå…ˆè¿è¡Œèµ·æ¥ï¼Œå·²ç»åœ¨è·‘åœˆäº†å°±å‡ºä¸æ¥äº†ï¼Œè¿›å…¥æ­»å¾ªç¯ä¹Ÿå°±æ— æ³•æ‰§è¡Œåé¢çš„æ“ä½œäº†ã€‚ // ä½†æ˜¯æ­¤æ—¶ç‚¹å‡»Buttonè¿˜æ˜¯æœ‰æ“ä½œçš„ï¼Œå› ä¸ºButtonæ˜¯åœ¨RunLoopè·‘èµ·æ¥ä¹‹ååŠ å…¥åˆ°å­çº¿ç¨‹çš„ï¼Œå½“ButtonåŠ å…¥åˆ°å­çº¿ç¨‹RunLoopå°±ä¼šè·‘èµ·æ¥ NSLog(@\"%s\",__func__); // 1.åˆ›å»ºå­çº¿ç¨‹ç›¸å…³çš„RunLoopï¼Œåœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºå³å¯ï¼Œå¹¶ä¸”RunLoopä¸­è¦è‡³å°‘æœ‰ä¸€ä¸ªTimer æˆ– ä¸€ä¸ªSource ä¿è¯RunLoopä¸ä¼šå› ä¸ºç©ºè½¬è€Œé€€å‡ºï¼Œå› æ­¤åœ¨åˆ›å»ºçš„æ—¶å€™ç›´æ¥åŠ å…¥ // æ·»åŠ Source [NSMachPort port] æ·»åŠ ä¸€ä¸ªç«¯å£ [[NSRunLoop currentRunLoop] addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode]; // æ·»åŠ ä¸€ä¸ªTimer NSTimer *timer = [NSTimer scheduledTimerWithTimeInterval:2.0 target:self selector:@selector(test) userInfo:nil repeats:YES]; [[NSRunLoop currentRunLoop] addTimer:timer forMode:NSDefaultRunLoopMode]; //åˆ›å»ºç›‘å¬è€… CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(CFAllocatorGetDefault(), kCFRunLoopAllActivities, YES, 0, ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123; switch (activity) &#123; case kCFRunLoopEntry: NSLog(@\"RunLoopè¿›å…¥\"); break; case kCFRunLoopBeforeTimers: NSLog(@\"RunLoopè¦å¤„ç†Timersäº†\"); break; case kCFRunLoopBeforeSources: NSLog(@\"RunLoopè¦å¤„ç†Sourcesäº†\"); break; case kCFRunLoopBeforeWaiting: NSLog(@\"RunLoopè¦ä¼‘æ¯äº†\"); break; case kCFRunLoopAfterWaiting: NSLog(@\"RunLoopé†’æ¥äº†\"); break; case kCFRunLoopExit: NSLog(@\"RunLoopé€€å‡ºäº†\"); break; default: break; &#125; &#125;); // ç»™RunLoopæ·»åŠ ç›‘å¬è€… CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode); // 2.å­çº¿ç¨‹éœ€è¦å¼€å¯RunLoop [[NSRunLoop currentRunLoop]run]; CFRelease(observer);&#125;- (IBAction)btnClick:(id)sender &#123; [self performSelector:@selector(test) onThread:self.thread withObject:nil waitUntilDone:NO];&#125;- (void)test &#123; NSLog(@\"%@\",[NSThread currentThread]);&#125; æ³¨æ„ï¼šåˆ›å»ºå­çº¿ç¨‹ç›¸å…³çš„RunLoopï¼Œåœ¨å­çº¿ç¨‹ä¸­åˆ›å»ºå³å¯ï¼Œå¹¶ä¸”RunLoopä¸­è¦è‡³å°‘æœ‰ä¸€ä¸ªTimer æˆ– ä¸€ä¸ªSource ä¿è¯RunLoopä¸ä¼šå› ä¸ºç©ºè½¬è€Œé€€å‡ºï¼Œå› æ­¤åœ¨åˆ›å»ºçš„æ—¶å€™ç›´æ¥åŠ å…¥ï¼Œå¦‚æœæ²¡æœ‰åŠ å…¥Timeræˆ–è€…Sourceï¼Œæˆ–è€…åªåŠ å…¥ä¸€ä¸ªç›‘å¬è€…ï¼Œè¿è¡Œç¨‹åºä¼šå´©æºƒ 2ï¼‰è‡ªåŠ¨é‡Šæ”¾æ± Timerå’ŒSourceä¹Ÿæ˜¯ä¸€äº›å˜é‡ï¼Œéœ€è¦å ç”¨ä¸€éƒ¨åˆ†å­˜å‚¨ç©ºé—´ï¼Œæ‰€ä»¥è¦é‡Šæ”¾æ‰ï¼Œå¦‚æœä¸é‡Šæ”¾æ‰ï¼Œå°±ä¼šä¸€ç›´ç§¯ç´¯ï¼Œå ç”¨çš„å†…å­˜ä¹Ÿå°±è¶Šæ¥è¶Šå¤§ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚ é‚£ä¹ˆä»€ä¹ˆæ—¶å€™é‡Šæ”¾ï¼Œæ€ä¹ˆé‡Šæ”¾å‘¢ï¼Ÿ RunLoopå†…éƒ¨æœ‰ä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå½“RunLoopå¼€å¯æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨åˆ›å»ºä¸€ä¸ªè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå½“RunLoopåœ¨ä¼‘æ¯ä¹‹å‰ä¼šé‡Šæ”¾æ‰è‡ªåŠ¨é‡Šæ”¾æ± çš„ä¸œè¥¿ï¼Œç„¶åé‡æ–°åˆ›å»ºä¸€ä¸ªæ–°çš„ç©ºçš„è‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå½“RunLoopè¢«å”¤é†’é‡æ–°å¼€å§‹è·‘åœˆæ—¶ï¼ŒTimer,Sourceç­‰æ–°çš„äº‹ä»¶å°±ä¼šæ”¾åˆ°æ–°çš„è‡ªåŠ¨é‡Šæ”¾æ± ä¸­ï¼Œå½“RunLoopé€€å‡ºçš„æ—¶å€™ä¹Ÿä¼šè¢«é‡Šæ”¾ã€‚ æ³¨æ„ï¼šåªæœ‰ä¸»çº¿ç¨‹çš„RunLoopä¼šé»˜è®¤å¯åŠ¨ã€‚ä¹Ÿå°±æ„å‘³ç€ä¼šè‡ªåŠ¨åˆ›å»ºè‡ªåŠ¨é‡Šæ”¾æ± ï¼Œå­çº¿ç¨‹éœ€è¦åœ¨çº¿ç¨‹è°ƒåº¦æ–¹æ³•ä¸­æ‰‹åŠ¨æ·»åŠ è‡ªåŠ¨é‡Šæ”¾æ± ã€‚ 123@autorelease&#123; // æ‰§è¡Œä»£ç  &#125; 3ï¼‰AFNetworkingä½¿ç”¨NSOperation+NSURLConnectionå¹¶å‘æ¨¡å‹éƒ½ä¼šé¢ä¸´NSURLConnectionä¸‹è½½å®Œæˆå‰çº¿ç¨‹é€€å‡ºå¯¼è‡´NSOperationå¯¹è±¡æ¥æ”¶ä¸åˆ°å›è°ƒçš„é—®é¢˜ã€‚AFNetWorkingè§£å†³è¿™ä¸ªé—®é¢˜çš„æ–¹æ³•æ˜¯æŒ‰ç…§å®˜æ–¹çš„guid NSURLConnection ä¸Šå†™çš„NSURLConnectionçš„delegateæ–¹æ³•éœ€è¦åœ¨connectionå‘èµ·çš„çº¿ç¨‹runloopä¸­è°ƒç”¨ï¼Œäºæ˜¯AFNetWorkingç›´æ¥å€Ÿé‰´äº†Appleè‡ªå·±çš„ä¸€ä¸ªDemoçš„å®ç°æ–¹æ³•å•ç‹¬èµ·ä¸€ä¸ªglobal threadï¼Œå†…ç½®ä¸€ä¸ªrunloopï¼Œæ‰€æœ‰çš„connectionéƒ½ç”±è¿™ä¸ªrunloopå‘èµ·ï¼Œå›è°ƒä¹Ÿæ˜¯å®ƒæ¥æ”¶ï¼Œä¸å ç”¨ä¸»çº¿ç¨‹ï¼Œä¹Ÿä¸è€—CPUèµ„æºã€‚ 12345678910111213141516171819202122+ (void)networkRequestThreadEntryPoint:(id)__unused object &#123; @autoreleasepool &#123; [[NSThread currentThread] setName:@\"AFNetworking\"]; NSRunLoop *runLoop = [NSRunLoop currentRunLoop]; [runLoop addPort:[NSMachPort port] forMode:NSDefaultRunLoopMode]; [runLoop run]; &#125;&#125;+ (NSThread *)networkRequestThread &#123; static NSThread *_networkRequestThread = nil; static dispatch_once_t oncePredicate; dispatch_once(&amp;oncePredicate, ^&#123; _networkRequestThread = [[NSThread alloc] initWithTarget:self selector:@selector(networkRequestThreadEntryPoint:) object:nil]; [_networkRequestThread start]; &#125;); return _networkRequestThread;&#125; ç±»ä¼¼çš„å¯ä»¥ç”¨è¿™ä¸ªæ–¹æ³•åˆ›å»ºä¸€ä¸ªå¸¸é©»æœåŠ¡çš„çº¿ç¨‹ã€‚ 4ï¼‰TableViewä¸­å®ç°å¹³æ»‘æ»šåŠ¨å»¶è¿ŸåŠ è½½å›¾ç‰‡ åˆ©ç”¨CFRunLoopModeçš„ç‰¹æ€§ï¼Œå¯ä»¥å°†å›¾ç‰‡çš„åŠ è½½æ”¾åˆ°NSDefaultRunLoopModeçš„modeé‡Œï¼Œè¿™æ ·åœ¨æ»šåŠ¨UITrackingRunLoopModeè¿™ä¸ªmodeæ—¶ä¸ä¼šè¢«åŠ è½½è€Œå½±å“åˆ°ã€‚12345UIImage *downloadedImage = ...;[self.imageView performSelector:@selector(setImage:) withObject:downloadedImage afterDelay:0 inModes:@[NSDefaultRunLoopMode]]; 5ï¼‰æ¥åˆ°ç¨‹åºå´©æºƒæ—¶çš„ä¿¡å·è¿›è¡Œè‡ªä¸»å¤„ç†ä¾‹å¦‚å¼¹å‡ºæç¤ºç­‰1234567CFRunLoopRef runLoop = CFRunLoopGetCurrent();NSArray *allModes = CFBridgingRelease(CFRunLoopCopyAllModes(runLoop));while (1) &#123; for (NSString *mode in allModes) &#123; CFRunLoopRunInMode((CFStringRef)mode, 0.001, false); &#125;&#125; 6ï¼‰å¼‚æ­¥æµ‹è¯•12345678910111213141516171819202122- (BOOL)runUntilBlock:(BOOL(^)())block timeout:(NSTimeInterval)timeout&#123; __block Boolean fulfilled = NO; void (^beforeWaiting) (CFRunLoopObserverRef observer, CFRunLoopActivity activity) = ^(CFRunLoopObserverRef observer, CFRunLoopActivity activity) &#123; fulfilled = block(); if (fulfilled) &#123; CFRunLoopStop(CFRunLoopGetCurrent()); &#125; &#125;; CFRunLoopObserverRef observer = CFRunLoopObserverCreateWithHandler(NULL, kCFRunLoopBeforeWaiting, true, 0, beforeWaiting); CFRunLoopAddObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode); // Run! CFRunLoopRunInMode(kCFRunLoopDefaultMode, timeout, false); CFRunLoopRemoveObserver(CFRunLoopGetCurrent(), observer, kCFRunLoopDefaultMode); CFRelease(observer); return fulfilled;&#125; NSTimerã€ImageViewæ˜¾ç¤ºã€PerformSelectorç­‰åœ¨ä¸Šé¢å·²ç»æœ‰è¿‡ä¾‹å­ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://juejin.im/post/5add46606fb9a07abf721d1d","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šKVO","slug":"iOS Principle KVO","date":"2018-06-06T13:56:27.000Z","updated":"2018-11-18T05:15:15.406Z","comments":true,"path":"2018/06/06/iOS Principle KVO/","link":"","permalink":"https://reversescale.github.io/2018/06/06/iOS Principle KVO/","excerpt":"KVO çš„å…¨ç§° Key-Value Observingï¼Œä¿—ç§°â€œé”®å€¼ç›‘å¬â€ï¼Œå¯ä»¥ç”¨äºç›‘å¬æŸä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜~","text":"KVO çš„å…¨ç§° Key-Value Observingï¼Œä¿—ç§°â€œé”®å€¼ç›‘å¬â€ï¼Œå¯ä»¥ç”¨äºç›‘å¬æŸä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿†ï¼š ä½œç”¨ï¼šâ€œé”®å€¼ç›‘å¬â€ï¼Œå¯ä»¥ç”¨äºç›‘å¬æŸä¸ªå¯¹è±¡å±æ€§å€¼çš„æ”¹å˜ å®ç°åŸç†ï¼š å°†ç›‘å¬å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘NSKVONotifyin_ç±»ï¼ˆruntimeåŠ¨æ€åˆ›å»ºçš„å­ç±»ï¼‰ å…ˆå®ç°NSKVONotifyin_ç±»çš„setæ–¹æ³•ï¼Œå…ˆwillChangeValueForKeyèµ‹å€¼ å†didChangeValueForKeyè°ƒç”¨ç›‘å¬å™¨ï¼Œåˆ°observeValueForKeyPathçš„æ–¹æ³• å¼•å­ 123@interface Person : NSObject@property (nonatomic, assign) int age;@end å¯¹ Person çš„ age è¿›è¡Œç›‘å¬çš„ä½¿ç”¨æ–¹æ³•ï¼š 123456789101112131415161718- (void)test_kvo &#123; Person *p1 = [[Person alloc] init]; Person *p2 = [[Person alloc] init]; p1.age = 1; p2.age = 2; NSKeyValueObservingOptions options = NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld; [p1 addObserver:self forKeyPath:@\"age\" options:options context:nil]; p1.age = 10; [p1 removeObserver:self forKeyPath:@\"age\"];&#125;// kvo action- (void)observeValueForKeyPath:(NSString *)keyPath ofObject:(id)object change:(NSDictionary&lt;NSKeyValueChangeKey,id&gt; *)change context:(void *)context &#123; NSLog(@\"ç›‘å¬åˆ°%@çš„%@æ”¹å˜äº†%@\", object, keyPath,change);&#125; åœ¨æ·»åŠ ç›‘å¬ä¹‹åï¼Œageå±æ€§çš„å€¼åœ¨å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°ç›‘å¬è€…ï¼Œæ‰§è¡Œç›‘å¬è€…çš„observeValueForKeyPathæ–¹æ³•ã€‚ æ¢å¯»KVOåº•å±‚å®ç°åŸç†é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å‘ç°ï¼Œä¸€æ—¦ageå±æ€§çš„å€¼å‘ç”Ÿæ”¹å˜æ—¶ï¼Œå°±ä¼šé€šçŸ¥åˆ°ç›‘å¬è€…ï¼Œå¹¶ä¸”æˆ‘ä»¬çŸ¥é“èµ‹å€¼æ“ä½œéƒ½æ˜¯è°ƒç”¨ setæ–¹æ³•ï¼Œæˆ‘ä»¬å¯ä»¥æ¥åˆ°Personç±»ä¸­é‡å†™ageçš„setæ–¹æ³•ï¼Œè§‚å¯Ÿæ˜¯å¦æ˜¯KVOåœ¨setæ–¹æ³•å†…éƒ¨åšäº†ä¸€äº›æ“ä½œæ¥é€šçŸ¥ç›‘å¬è€…ã€‚ æˆ‘ä»¬å‘ç°å³ä½¿é‡å†™äº†setæ–¹æ³•ï¼Œp1å¯¹è±¡å’Œp2å¯¹è±¡è°ƒç”¨åŒæ ·çš„setæ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬å‘ç°p1é™¤äº†è°ƒç”¨setæ–¹æ³•ä¹‹å¤–è¿˜ä¼šå¦å¤–æ‰§è¡Œç›‘å¬å™¨çš„observeValueForKeyPathæ–¹æ³•ã€‚ è¯´æ˜KVOåœ¨è¿è¡Œæ—¶è·å–å¯¹p1å¯¹è±¡åšäº†ä¸€äº›æ”¹å˜ã€‚ç›¸å½“äºåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ï¼Œå¯¹p1å¯¹è±¡åšäº†ä¸€äº›å˜åŒ–ï¼Œä½¿å¾—p1å¯¹è±¡åœ¨è°ƒç”¨setageæ–¹æ³•çš„æ—¶å€™å¯èƒ½åšäº†ä¸€äº›é¢å¤–çš„æ“ä½œï¼Œæ‰€ä»¥é—®é¢˜å‡ºåœ¨å¯¹è±¡èº«ä¸Šï¼Œä¸¤ä¸ªå¯¹è±¡åœ¨å†…å­˜ä¸­è‚¯å®šä¸ä¸€æ ·ï¼Œä¸¤ä¸ªå¯¹è±¡å¯èƒ½æœ¬è´¨ä¸Šå¹¶ä¸ä¸€æ ·ã€‚æ¥ä¸‹æ¥æ¥æ¢ç´¢KVOå†…éƒ¨æ˜¯æ€ä¹ˆå®ç°çš„ã€‚ KVOåº•å±‚å®ç°åˆ†æé¦–å…ˆæˆ‘ä»¬å¯¹ä¸Šè¿°ä»£ç ä¸­æ·»åŠ ç›‘å¬çš„åœ°æ–¹æ‰“æ–­ç‚¹ï¼Œçœ‹è§‚å¯Ÿä¸€ä¸‹ï¼ŒaddObserveræ–¹æ³•å¯¹p1å¯¹è±¡åšäº†ä»€ä¹ˆå¤„ç†ï¼Ÿä¹Ÿå°±æ˜¯è¯´p1å¯¹è±¡åœ¨ç»è¿‡addObserveræ–¹æ³•ä¹‹åå‘ç”Ÿäº†ä»€ä¹ˆæ”¹å˜ï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å°isaæŒ‡é’ˆå¦‚ä¸‹å›¾æ‰€ç¤º é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å‘ç°ï¼Œp1å¯¹è±¡æ‰§è¡Œè¿‡addObserveræ“ä½œä¹‹åï¼Œp1å¯¹è±¡çš„isaæŒ‡é’ˆç”±ä¹‹å‰çš„æŒ‡å‘ç±»å¯¹è±¡Personå˜ä¸ºæŒ‡å‘NSKVONotifyin_Personç±»å¯¹è±¡ï¼Œè€Œp2å¯¹è±¡æ²¡æœ‰ä»»ä½•æ”¹å˜ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€æ—¦p1å¯¹è±¡æ·»åŠ äº†KVOç›‘å¬ä»¥åï¼Œå…¶isaæŒ‡é’ˆå°±ä¼šå‘ç”Ÿå˜åŒ–ï¼Œå› æ­¤setæ–¹æ³•çš„æ‰§è¡Œæ•ˆæœå°±ä¸ä¸€æ ·äº†ã€‚ é‚£ä¹ˆæˆ‘ä»¬å…ˆæ¥è§‚å¯Ÿp2å¯¹è±¡åœ¨å†…å®¹ä¸­æ˜¯å¦‚ä½•å­˜å‚¨çš„ï¼Œç„¶åå¯¹æ¯”p2æ¥è§‚å¯Ÿp1ã€‚ é¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼Œp2åœ¨è°ƒç”¨setageæ–¹æ³•çš„æ—¶å€™ï¼Œé¦–å…ˆä¼šé€šè¿‡p2å¯¹è±¡ä¸­çš„isaæŒ‡é’ˆæ‰¾åˆ°Personç±»å¯¹è±¡ï¼Œç„¶ååœ¨ç±»å¯¹è±¡ä¸­æ‰¾åˆ°setageæ–¹æ³•ã€‚ç„¶åæ‰¾åˆ°æ–¹æ³•å¯¹åº”çš„å®ç°ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º ä½†æ˜¯åˆšæ‰æˆ‘ä»¬å‘ç°p1å¯¹è±¡çš„isaæŒ‡é’ˆåœ¨ç»è¿‡KVOç›‘å¬ä¹‹åå·²ç»æŒ‡å‘äº†NSKVONotifyin_Personç±»å¯¹è±¡ï¼ŒNSKVONotifyin_Personå…¶å®æ˜¯Personçš„å­ç±»ï¼Œé‚£ä¹ˆä¹Ÿå°±æ˜¯è¯´å…¶superclassæŒ‡é’ˆæ˜¯æŒ‡å‘Personç±»å¯¹è±¡çš„ï¼ŒNSKVONotifyin_Personæ˜¯runtimeåœ¨è¿è¡Œæ—¶ç”Ÿæˆçš„ã€‚é‚£ä¹ˆp1å¯¹è±¡åœ¨è°ƒç”¨setageæ–¹æ³•çš„æ—¶å€™ï¼Œè‚¯å®šä¼šæ ¹æ®p1çš„isaæ‰¾åˆ°NSKVONotifyin_Personï¼Œåœ¨NSKVONotifyin_Personä¸­æ‰¾setageçš„æ–¹æ³•åŠå®ç°ã€‚ ç»è¿‡æŸ¥é˜…èµ„æ–™æˆ‘ä»¬å¯ä»¥äº†è§£åˆ°ï¼ŒNSKVONotifyin_Personä¸­çš„setageæ–¹æ³•ä¸­å…¶å®è°ƒç”¨äº† Fundationæ¡†æ¶ä¸­Cè¯­è¨€å‡½æ•° _NSsetIntValueAndNotifyï¼Œ_NSsetIntValueAndNotifyå†…éƒ¨åšçš„æ“ä½œç›¸å½“äºï¼Œé¦–å…ˆè°ƒç”¨willChangeValueForKey å°†è¦æ”¹å˜æ–¹æ³•ï¼Œä¹‹åè°ƒç”¨çˆ¶ç±»çš„setageæ–¹æ³•å¯¹æˆå‘˜å˜é‡èµ‹å€¼ï¼Œæœ€åè°ƒç”¨didChangeValueForKeyå·²ç»æ”¹å˜æ–¹æ³•ã€‚didChangeValueForKeyä¸­ä¼šè°ƒç”¨ç›‘å¬å™¨çš„ç›‘å¬æ–¹æ³•ï¼Œæœ€ç»ˆæ¥åˆ°ç›‘å¬è€…çš„observeValueForKeyPathæ–¹æ³•ä¸­ã€‚ é‚£ä¹ˆå¦‚ä½•éªŒè¯KVOçœŸçš„å¦‚ä¸Šé¢æ‰€è®²çš„æ–¹å¼å®ç°ï¼Ÿé¦–å…ˆç»è¿‡ä¹‹å‰æ‰“æ–­ç‚¹æ‰“å°isaæŒ‡é’ˆï¼Œæˆ‘ä»¬å·²ç»éªŒè¯äº†ï¼Œåœ¨æ‰§è¡Œæ·»åŠ ç›‘å¬çš„æ–¹æ³•æ—¶ï¼Œä¼šå°†isaæŒ‡é’ˆæŒ‡å‘ä¸€ä¸ªé€šè¿‡runtimeåˆ›å»ºçš„Personçš„å­ç±»NSKVONotifyin_Personã€‚å¦å¤–æˆ‘ä»¬å¯ä»¥é€šè¿‡æ‰“å°æ–¹æ³•å®ç°çš„åœ°å€æ¥çœ‹ä¸€ä¸‹p1å’Œp2çš„setageçš„æ–¹æ³•å®ç°çš„åœ°å€åœ¨æ·»åŠ KVOå‰åæœ‰ä»€ä¹ˆå˜åŒ–ã€‚ 12345678910111213&#123; [self methodForSelectorLogWithP1:p1 P2:p2]; NSKeyValueObservingOptions options = NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld; [p1 addObserver:self forKeyPath:@\"age\" options:options context:nil]; [self methodForSelectorLogWithP1:p1 P2:p2];&#125;// kvo func to show working- (void)methodForSelectorLogWithP1:(NSObject *)p1 P2:(NSObject *)p2 &#123; NSLog(@\"æ·»åŠ KVOç›‘å¬ä¹‹å‰ - p1 = %p, p2 = %p\", [p1 methodForSelector: @selector(setAge:)],[p2 methodForSelector: @selector(setAge:)]);&#125; æˆ‘ä»¬å‘ç°åœ¨æ·»åŠ KVOç›‘å¬ä¹‹å‰ï¼Œp1å’Œp2çš„setAgeæ–¹æ³•å®ç°çš„åœ°å€ç›¸åŒï¼Œè€Œç»è¿‡KVOç›‘å¬ä¹‹åï¼Œp1çš„setAgeæ–¹æ³•å®ç°çš„åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œæˆ‘ä»¬é€šè¿‡æ‰“å°æ–¹æ³•å®ç°æ¥çœ‹ä¸€ä¸‹å‰åçš„å˜åŒ–å‘ç°ï¼Œç¡®å®å¦‚æˆ‘ä»¬ä¸Šé¢æ‰€è®²çš„ä¸€æ ·ï¼Œp1çš„setAgeæ–¹æ³•çš„å®ç°ç”±Personç±»æ–¹æ³•ä¸­çš„setAgeæ–¹æ³•è½¬æ¢ä¸ºäº†Cè¯­è¨€çš„Foundationæ¡†æ¶çš„_NSsetIntValueAndNotifyå‡½æ•°ã€‚ Foundationæ¡†æ¶ä¸­ä¼šæ ¹æ®å±æ€§çš„ç±»å‹ï¼Œè°ƒç”¨ä¸åŒçš„æ–¹æ³•ã€‚ä¾‹å¦‚æˆ‘ä»¬ä¹‹å‰å®šä¹‰çš„intç±»å‹çš„ageå±æ€§ï¼Œé‚£ä¹ˆæˆ‘ä»¬çœ‹åˆ°Foundationæ¡†æ¶ä¸­è°ƒç”¨çš„_NSsetIntValueAndNotifyå‡½æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬æŠŠageçš„å±æ€§ç±»å‹å˜ä¸ºdoubleé‡æ–°æ‰“å°ä¸€é æˆ‘ä»¬å‘ç°è°ƒç”¨çš„å‡½æ•°å˜ä¸ºäº†_NSSetDoubleValueAndNotifyï¼Œé‚£ä¹ˆè¿™è¯´æ˜Foundationæ¡†æ¶ä¸­æœ‰è®¸å¤šæ­¤ç±»å‹çš„å‡½æ•°ï¼Œé€šè¿‡å±æ€§çš„ä¸åŒç±»å‹è°ƒç”¨ä¸åŒçš„å‡½æ•°ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥æ¨æµ‹Foundationæ¡†æ¶ä¸­è¿˜æœ‰å¾ˆå¤šä¾‹å¦‚_NSSetBoolValueAndNotifyã€_NSSetCharValueAndNotifyã€_NSSetFloatValueAndNotifyã€_NSSetLongValueAndNotifyç­‰ç­‰å‡½æ•°ã€‚æˆ‘ä»¬å¯ä»¥æ‰¾åˆ°Foundationæ¡†æ¶æ–‡ä»¶ï¼Œé€šè¿‡å‘½ä»¤è¡ŒæŸ¥è¯¢å…³é”®å­—æ‰¾åˆ°ç›¸å…³å‡½æ•° NSKVONotifyin_Personå†…éƒ¨ç»“æ„æ˜¯æ€æ ·çš„ï¼Ÿé¦–å…ˆæˆ‘ä»¬çŸ¥é“ï¼ŒNSKVONotifyin_Personä½œä¸ºPersonçš„å­ç±»ï¼Œå…¶superclassæŒ‡é’ˆæŒ‡å‘Personç±»ï¼Œå¹¶ä¸”NSKVONotifyin_Personå†…éƒ¨ä¸€å®šå¯¹setAgeæ–¹æ³•åšäº†å•ç‹¬çš„å®ç°ï¼Œé‚£ä¹ˆNSKVONotifyin_PersonåŒPersonç±»çš„å·®åˆ«å¯èƒ½å°±åœ¨äºå…¶å†…å­˜å‚¨çš„å¯¹è±¡æ–¹æ³•åŠå®ç°ä¸åŒã€‚æˆ‘ä»¬é€šè¿‡runtimeåˆ†åˆ«æ‰“å°Personç±»å¯¹è±¡å’ŒNSKVONotifyin_Personç±»å¯¹è±¡å†…å­˜å‚¨çš„å¯¹è±¡æ–¹æ³• 12345678910111213141516171819202122232425&#123; p1.age = 10; [self printMethods: object_getClass(p2)]; [self printMethods: object_getClass(p1)]; [p1 removeObserver:self forKeyPath:@\"age\"];&#125;// runtime to print class methods- (void)printMethods:(Class)cls &#123; unsigned int count ; Method *methods = class_copyMethodList(cls, &amp;count); NSMutableString *methodNames = [NSMutableString string]; [methodNames appendFormat:@\"%@ method list: \", cls]; for (int i = 0 ; i &lt; count; i++) &#123; Method method = methods[i]; NSString *methodName = NSStringFromSelector(method_getName(method)); [methodNames appendString:@\"\\n\"]; [methodNames appendString: methodName]; &#125; NSLog(@\"%@\",methodNames); free(methods);&#125; ä¸Šè¿°æ‰“å°å†…å®¹å¦‚ä¸‹ é€šè¿‡ä¸Šè¿°ä»£ç æˆ‘ä»¬å‘ç°NSKVONotifyin_Personä¸­æœ‰4ä¸ªå¯¹è±¡æ–¹æ³•ã€‚åˆ†åˆ«ä¸ºsetAge: class dealloc _isKVOAï¼Œé‚£ä¹ˆè‡³æ­¤æˆ‘ä»¬å¯ä»¥ç”»å‡ºNSKVONotifyin_Personçš„å†…å­˜ç»“æ„ä»¥åŠæ–¹æ³•è°ƒç”¨é¡ºåºã€‚ è¿™é‡ŒNSKVONotifyin_Personé‡å†™classæ–¹æ³•æ˜¯ä¸ºäº†éšè—NSKVONotifyin_Personã€‚ä¸è¢«å¤–ç•Œæ‰€çœ‹åˆ°ã€‚æˆ‘ä»¬åœ¨p1æ·»åŠ è¿‡KVOç›‘å¬ä¹‹åï¼Œåˆ†åˆ«æ‰“å°p1å’Œp2å¯¹è±¡çš„classå¯ä»¥å‘ç°ä»–ä»¬éƒ½è¿”å›Personã€‚ 1NSLog(@\"%@,%@\",[p1 class],[p2 class]); å¦‚æœNSKVONotifyin_Personä¸é‡å†™classæ–¹æ³•ï¼Œé‚£ä¹ˆå½“å¯¹è±¡è¦è°ƒç”¨classå¯¹è±¡æ–¹æ³•çš„æ—¶å€™å°±ä¼šä¸€ç›´å‘ä¸Šæ‰¾æ¥åˆ°nsobjectï¼Œè€Œnsobectçš„classçš„å®ç°å¤§è‡´ä¸ºè¿”å›è‡ªå·±isaæŒ‡å‘çš„ç±»ï¼Œè¿”å›p1çš„isaæŒ‡å‘çš„ç±»é‚£ä¹ˆæ‰“å°å‡ºæ¥çš„ç±»å°±æ˜¯NSKVONotifyin_Personï¼Œä½†æ˜¯appleä¸å¸Œæœ›å°†NSKVONotifyin_Personç±»æš´éœ²å‡ºæ¥ï¼Œå¹¶ä¸”ä¸å¸Œæœ›æˆ‘ä»¬çŸ¥é“NSKVONotifyin_Personå†…éƒ¨å®ç°ï¼Œæ‰€ä»¥åœ¨å†…éƒ¨é‡å†™äº†classç±»ï¼Œç›´æ¥è¿”å›Personç±»ï¼Œæ‰€ä»¥å¤–ç•Œåœ¨è°ƒç”¨p1çš„classå¯¹è±¡æ–¹æ³•æ—¶ï¼Œæ˜¯Personç±»ã€‚è¿™æ ·p1ç»™å¤–ç•Œçš„æ„Ÿè§‰p1è¿˜æ˜¯Personç±»ï¼Œå¹¶ä¸çŸ¥é“NSKVONotifyin_Personå­ç±»çš„å­˜åœ¨ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥çŒœæµ‹NSKVONotifyin_Personå†…é‡å†™çš„classå†…éƒ¨å®ç°å¤§è‡´ä¸º 1234- (Class) class &#123;// å¾—åˆ°ç±»å¯¹è±¡ï¼Œåœ¨æ‰¾åˆ°ç±»å¯¹è±¡çˆ¶ç±» return class_getSuperclass(object_getClass(self));&#125; éªŒè¯éªŒè¯ didChangeValueForKey:å†…éƒ¨ä¼šè°ƒç”¨observerçš„observeValueForKeyPath:ofObject:change:context:æ–¹æ³•æˆ‘ä»¬åœ¨Personç±»ä¸­é‡å†™willChangeValueForKey:å’ŒdidChangeValueForKey:æ–¹æ³•ï¼Œæ¨¡æ‹Ÿä»–ä»¬çš„å®ç°ã€‚ 1234567891011121314- (void)setAge:(int)age &#123; NSLog(@\"setAge:\"); _age = age;&#125;- (void)willChangeValueForKey:(NSString *)key &#123; NSLog(@\"willChangeValueForKey: - begin\"); [super willChangeValueForKey:key]; NSLog(@\"willChangeValueForKey: - end\");&#125;- (void)didChangeValueForKey:(NSString *)key &#123; NSLog(@\"didChangeValueForKey: - begin\"); [super didChangeValueForKey:key]; NSLog(@\"didChangeValueForKey: - end\");&#125; å†æ¬¡è¿è¡Œæ¥æŸ¥çœ‹didChangeValueForKeyçš„æ–¹æ³•å†…è¿è¡Œè¿‡ç¨‹ï¼Œé€šè¿‡æ‰“å°å†…å®¹å¯ä»¥çœ‹åˆ°ï¼Œç¡®å®åœ¨didChangeValueForKeyæ–¹æ³•å†…éƒ¨å·²ç»è°ƒç”¨äº†observerçš„observeValueForKeyPath:ofObject:change:context:æ–¹æ³•ã€‚ å¦‚ä½•æ‰‹åŠ¨è°ƒç”¨ KVOè¢«ç›‘å¬çš„å±æ€§çš„å€¼è¢«ä¿®æ”¹æ—¶ï¼Œå°±ä¼šè‡ªåŠ¨è§¦å‘KVOã€‚å¦‚æœæƒ³è¦æ‰‹åŠ¨è§¦å‘KVOï¼Œåˆ™éœ€è¦æˆ‘ä»¬è‡ªå·±è°ƒç”¨willChangeValueForKeyå’ŒdidChangeValueForKeyæ–¹æ³•å³å¯åœ¨ä¸æ”¹å˜å±æ€§å€¼çš„æƒ…å†µä¸‹æ‰‹åŠ¨è§¦å‘KVOï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªæ–¹æ³•ç¼ºä¸€ä¸å¯ã€‚ 123456789101112&#123; Person *p1 = [[Person alloc] init]; p1.age = 1.0; NSKeyValueObservingOptions options = NSKeyValueObservingOptionNew | NSKeyValueObservingOptionOld; [p1 addObserver:self forKeyPath:@\"age\" options:options context:nil]; [p1 willChangeValueForKey:@\"age\"]; [p1 didChangeValueForKey:@\"age\"]; [p1 removeObserver:self forKeyPath:@\"age\"];&#125; é€šè¿‡æ‰“å°æˆ‘ä»¬å¯ä»¥å‘ç°ï¼ŒdidChangeValueForKeyæ–¹æ³•å†…éƒ¨æˆåŠŸè°ƒç”¨äº†observeValueForKeyPath:ofObject:change:context:ï¼Œå¹¶ä¸”ageçš„å€¼å¹¶æ²¡æœ‰å‘ç”Ÿæ”¹å˜ã€‚ å°ç»“å½“ä¸€ä¸ªå¯¹è±¡ä½¿ç”¨äº†KVOç›‘å¬ï¼ŒiOSç³»ç»Ÿä¼šä¿®æ”¹è¿™ä¸ªå¯¹è±¡çš„isaæŒ‡é’ˆï¼Œæ”¹ä¸ºæŒ‡å‘ä¸€ä¸ªå…¨æ–°çš„é€šè¿‡RuntimeåŠ¨æ€åˆ›å»ºçš„å­ç±»ï¼Œå­ç±»æ‹¥æœ‰è‡ªå·±çš„setæ–¹æ³•å®ç°ï¼Œsetæ–¹æ³•å®ç°å†…éƒ¨ä¼šé¡ºåºè°ƒç”¨willChangeValueForKeyæ–¹æ³•ã€åŸæ¥çš„setteræ–¹æ³•å®ç°ã€didChangeValueForKeyæ–¹æ³•ï¼Œè€ŒdidChangeValueForKeyæ–¹æ³•å†…éƒ¨åˆä¼šè°ƒç”¨ç›‘å¬å™¨çš„observeValueForKeyPath:ofObject:change:context:ç›‘å¬æ–¹æ³•ã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://juejin.im/post/5adab70cf265da0b736d37a8","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šRuntime","slug":"iOS Principle Runtime","date":"2018-06-05T13:56:27.000Z","updated":"2018-11-16T13:15:05.076Z","comments":true,"path":"2018/06/05/iOS Principle Runtime/","link":"","permalink":"https://reversescale.github.io/2018/06/05/iOS Principle Runtime/","excerpt":"Objective-C æ‰©å±•äº† C è¯­è¨€ï¼Œå¹¶åŠ å…¥äº†é¢å‘å¯¹è±¡ç‰¹æ€§å’Œ Smalltalk å¼çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚è€Œè¿™ä¸ªæ‰©å±•çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç”¨ C å’Œ ç¼–è¯‘è¯­è¨€ å†™çš„ Runtime åº“ã€‚å®ƒæ˜¯ Objective-C é¢å‘å¯¹è±¡å’ŒåŠ¨æ€æœºåˆ¶çš„åŸºçŸ³~","text":"Objective-C æ‰©å±•äº† C è¯­è¨€ï¼Œå¹¶åŠ å…¥äº†é¢å‘å¯¹è±¡ç‰¹æ€§å’Œ Smalltalk å¼çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ã€‚è€Œè¿™ä¸ªæ‰©å±•çš„æ ¸å¿ƒæ˜¯ä¸€ä¸ªç”¨ C å’Œ ç¼–è¯‘è¯­è¨€ å†™çš„ Runtime åº“ã€‚å®ƒæ˜¯ Objective-C é¢å‘å¯¹è±¡å’ŒåŠ¨æ€æœºåˆ¶çš„åŸºçŸ³~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿† å®è´¨ä½œç”¨ï¼šä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡ æ¶ˆæ¯ä¼ é€’æ–¹æ³•ï¼šobjec_msgSend æ–¹æ³• objc_method ç»“æ„ä½“å†…å®¹ï¼šSEL method_name æ–¹æ³•åã€char *method_types æ–¹æ³•ç±»å‹ã€IMP method_imp æ–¹æ³•å®ç°ï¼ˆæ–¹æ³•æŒ‡é’ˆï¼‰ æ¶ˆæ¯è½¬å‘ï¼šunrecognized selector ä¸‰æ¬¡æœºä¼š åŠ¨æ€æ–¹æ³•è§£æï¼šå¯¹è±¡åœ¨æ¥æ”¶åˆ°æœªçŸ¥çš„æ¶ˆæ¯æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨æ‰€å±ç±»çš„ç±»æ–¹æ³•+resolveInstanceMethod:(å®ä¾‹æ–¹æ³•)æˆ–è€…+resolveClassMethod:(ç±»æ–¹æ³•)ã€‚ å¤‡ç”¨æ¥æ”¶è€…ï¼š- (id)forwardingTargetForSelector:(SEL)aSelector;è¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå› ä¸ºæ˜¯è¯¢é—®è¯¥å®ä¾‹å¯¹è±¡æ˜¯å¦æœ‰å…¶ä»–å®ä¾‹å¯¹è±¡å¯ä»¥æ¥æ”¶è¿™ä¸ªæœªçŸ¥çš„selectorï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›nil å®Œæ•´è½¬å‘ï¼š- (void)forwardInvocation: (NSInvocation*)invocation;è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¦‚æœä¸èƒ½å¤„ç†å°±ä¼šè°ƒç”¨çˆ¶ç±»çš„ç›¸å…³æ–¹æ³•ï¼Œä¸€ç›´åˆ°NSObjectçš„è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœNSObjectéƒ½æ— æ³•å¤„ç†å°±ä¼šè°ƒç”¨doesNotRecognizeSelector:æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ã€‚ ç”¨é€”ï¼šåšå¼‚å¸¸å¤„ç†æ”¶é›†ï¼Œé¿å…crashï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒ å¸¸è§çš„åº”ç”¨åœºæ™¯ï¼š å…³è”å¯¹è±¡(Objective-C Associated Objects)ï¼šç»™åˆ†ç±»å¢åŠ å±æ€§ æ–¹æ³•é­”æ³•(Method Swizzling)ï¼šæ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç° æ¶ˆæ¯è½¬å‘(çƒ­æ›´æ–°)ï¼šè§£å†³Bug(JSPatch) å®ç°NSCodingçš„è‡ªåŠ¨å½’æ¡£å’Œè‡ªåŠ¨è§£æ¡£ å®ç°å­—å…¸å’Œæ¨¡å‹çš„è‡ªåŠ¨è½¬æ¢(MJExtension) Runtime ç›¸å…³ä»‹ç»Objective-C æ˜¯ä¸€ä¸ªåŠ¨æ€è¯­è¨€ï¼Œè¿™æ„å‘³ç€å®ƒä¸ä»…éœ€è¦ä¸€ä¸ªç¼–è¯‘å™¨ï¼Œä¹Ÿéœ€è¦ä¸€ä¸ªè¿è¡Œæ—¶ç³»ç»Ÿæ¥åŠ¨æ€å¾—åˆ›å»ºç±»å’Œå¯¹è±¡ã€è¿›è¡Œæ¶ˆæ¯ä¼ é€’å’Œè½¬å‘ã€‚ç†è§£ Objective-C çš„ Runtime æœºåˆ¶å¯ä»¥å¸®æˆ‘ä»¬æ›´å¥½çš„äº†è§£è¿™ä¸ªè¯­è¨€ï¼Œé€‚å½“çš„æ—¶å€™è¿˜èƒ½å¯¹è¯­è¨€è¿›è¡Œæ‰©å±•ï¼Œä»ç³»ç»Ÿå±‚é¢è§£å†³é¡¹ç›®ä¸­çš„ä¸€äº›è®¾è®¡æˆ–æŠ€æœ¯é—®é¢˜ã€‚ Runtime ç‰ˆæœ¬æ¼”åŒ–Runtimeå…¶å®æœ‰ä¸¤ä¸ªç‰ˆæœ¬: â€œmodernâ€ å’Œ â€œlegacyâ€ã€‚ æˆ‘ä»¬ç°åœ¨ç”¨çš„ Objective-C 2.0 é‡‡ç”¨çš„æ˜¯ç°è¡Œ (Modern) ç‰ˆçš„ Runtime ç³»ç»Ÿï¼Œåªèƒ½è¿è¡Œåœ¨ iOS å’Œ macOS 10.5 ä¹‹åçš„ 64 ä½ç¨‹åºä¸­ã€‚ è€Œ macOS è¾ƒè€çš„32ä½ç¨‹åºä»é‡‡ç”¨ Objective-C 1.0 ä¸­çš„ï¼ˆæ—©æœŸï¼‰Legacy ç‰ˆæœ¬çš„ Runtime ç³»ç»Ÿã€‚ è¿™ä¸¤ä¸ªç‰ˆæœ¬æœ€å¤§çš„åŒºåˆ«åœ¨äºå½“ä½ æ›´æ”¹ä¸€ä¸ªç±»çš„å®ä¾‹å˜é‡çš„å¸ƒå±€æ—¶ï¼Œåœ¨æ—©æœŸç‰ˆæœ¬ä¸­ä½ éœ€è¦é‡æ–°ç¼–è¯‘å®ƒçš„å­ç±»ï¼Œè€Œç°è¡Œç‰ˆå°±ä¸éœ€è¦ã€‚ Runtime å®è´¨ä½œç”¨é«˜çº§ç¼–ç¨‹è¯­è¨€æƒ³è¦æˆä¸ºå¯æ‰§è¡Œæ–‡ä»¶éœ€è¦å…ˆç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€å†æ±‡ç¼–ä¸ºæœºå™¨è¯­è¨€ï¼Œæœºå™¨è¯­è¨€ä¹Ÿæ˜¯è®¡ç®—æœºèƒ½å¤Ÿè¯†åˆ«çš„å”¯ä¸€è¯­è¨€ï¼Œä½†æ˜¯OCå¹¶ä¸èƒ½ç›´æ¥ç¼–è¯‘ä¸ºæ±‡ç¼–è¯­è¨€ï¼Œè€Œæ˜¯è¦å…ˆè½¬å†™ä¸ºçº¯Cè¯­è¨€å†è¿›è¡Œç¼–è¯‘å’Œæ±‡ç¼–çš„æ“ä½œï¼Œä»OCåˆ°Cè¯­è¨€çš„è¿‡æ¸¡å°±æ˜¯ç”±runtimeæ¥å®ç°çš„ã€‚ ç„¶è€Œæˆ‘ä»¬ä½¿ç”¨OCè¿›è¡Œé¢å‘å¯¹è±¡å¼€å‘ï¼Œè€ŒCè¯­è¨€æ›´å¤šçš„æ˜¯é¢å‘è¿‡ç¨‹å¼€å‘ï¼Œè¿™å°±éœ€è¦å°†é¢å‘å¯¹è±¡çš„ç±»è½¬å˜ä¸ºé¢å‘è¿‡ç¨‹çš„ç»“æ„ä½“ã€‚ OC ä¸­ä¸€ä¸ªå¯¹è±¡æ–¹æ³•1[obj foo]; ç¼–è¯‘å™¨è½¬æˆæ¶ˆæ¯å‘é€1objc_msgSend(obj, foo) åœ¨ä¸Šæ®µä»£ç ä¸­ Runtime çš„æ‰§è¡Œæµç¨‹ï¼š é¦–å…ˆï¼Œé€šè¿‡objçš„isaæŒ‡é’ˆæ‰¾åˆ°å®ƒçš„ class ; åœ¨ class çš„ method list æ‰¾ foo ; å¦‚æœ class ä¸­æ²¡åˆ° fooï¼Œç»§ç»­å¾€å®ƒçš„ superclass ä¸­æ‰¾ ; ä¸€æ—¦æ‰¾åˆ° foo è¿™ä¸ªå‡½æ•°ï¼Œå°±å»æ‰§è¡Œå®ƒçš„å®ç°IMP ã€‚ objc_cache ç¼“å­˜æœºåˆ¶ä½†æ˜¯ï¼Œä¸Šé¢è¿™ç§å®ç°æœ‰ä¸ªé—®é¢˜ï¼Œæ•ˆç‡ä½ã€‚ ä¸€ä¸ªclass å¾€å¾€åªæœ‰ 20% çš„å‡½æ•°ä¼šè¢«ç»å¸¸è°ƒç”¨ï¼Œå¯èƒ½å æ€»è°ƒç”¨æ¬¡æ•°çš„ 80% ã€‚æ¯ä¸ªæ¶ˆæ¯éƒ½éœ€è¦éå†ä¸€æ¬¡objc_method_list å¹¶ä¸åˆç†ã€‚å¦‚æœæŠŠç»å¸¸è¢«è°ƒç”¨çš„å‡½æ•°ç¼“å­˜ä¸‹æ¥ï¼Œé‚£å¯ä»¥å¤§å¤§æé«˜å‡½æ•°æŸ¥è¯¢çš„æ•ˆç‡ã€‚ è¿™ä¹Ÿå°±æ˜¯ objc_class ä¸­å¦ä¸€ä¸ªé‡è¦æˆå‘˜ objc_cache åšçš„äº‹æƒ…ï¼Œå†æ‰¾åˆ° foo ä¹‹åï¼ŒæŠŠ foo çš„ method_name ä½œä¸ºkeyï¼Œmethod_imp ä½œä¸º value ç»™å­˜èµ·æ¥ã€‚å½“å†æ¬¡æ”¶åˆ° foo æ¶ˆæ¯çš„æ—¶å€™ï¼Œå¯ä»¥ç›´æ¥åœ¨ cache é‡Œæ‰¾åˆ°ï¼Œé¿å…å»éå† objc_method_listã€‚ ä»å‰é¢çš„æºä»£ç å¯ä»¥çœ‹åˆ°objc_cacheæ˜¯å­˜åœ¨objc_class ç»“æ„ä½“ä¸­çš„ã€‚ objec_msgSend æ–¹æ³•objec_msgSendçš„æ–¹æ³•å®šä¹‰å¦‚ä¸‹ï¼š1OBJC_EXPORT id objc_msgSend(id self, SEL op, ...) é‚£æ¶ˆæ¯ä¼ é€’æ˜¯æ€ä¹ˆå®ç°çš„å‘¢ï¼Ÿæˆ‘ä»¬çœ‹çœ‹å¯¹è±¡(object)ï¼Œç±»(class)ï¼Œæ–¹æ³•(method)è¿™å‡ ä¸ªçš„ç»“æ„ä½“ï¼š1234567891011121314151617181920212223242526272829303132333435//å¯¹è±¡struct objc_object &#123; Class isa OBJC_ISA_AVAILABILITY;&#125;;//ç±»struct objc_class &#123; Class isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class super_class OBJC2_UNAVAILABLE; const char *name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list *ivars OBJC2_UNAVAILABLE; struct objc_method_list **methodLists OBJC2_UNAVAILABLE; struct objc_cache *cache OBJC2_UNAVAILABLE; struct objc_protocol_list *protocols OBJC2_UNAVAILABLE;#endif&#125; OBJC2_UNAVAILABLE;//æ–¹æ³•åˆ—è¡¨struct objc_method_list &#123; struct objc_method_list *obsolete OBJC2_UNAVAILABLE; int method_count OBJC2_UNAVAILABLE;#ifdef __LP64__ int space OBJC2_UNAVAILABLE;#endif /* variable length structure */ struct objc_method method_list[1] OBJC2_UNAVAILABLE;&#125; OBJC2_UNAVAILABLE;//æ–¹æ³•struct objc_method &#123; SEL method_name OBJC2_UNAVAILABLE; char *method_types OBJC2_UNAVAILABLE; IMP method_imp OBJC2_UNAVAILABLE;&#125; 1.ç³»ç»Ÿé¦–å…ˆæ‰¾åˆ°æ¶ˆæ¯çš„æ¥æ”¶å¯¹è±¡ï¼Œç„¶åé€šè¿‡å¯¹è±¡çš„isaæ‰¾åˆ°å®ƒçš„ç±»ã€‚ 2.åœ¨å®ƒçš„ç±»ä¸­æŸ¥æ‰¾method_listï¼Œæ˜¯å¦æœ‰selectoræ–¹æ³•ã€‚ 3.æ²¡æœ‰åˆ™æŸ¥æ‰¾çˆ¶ç±»çš„method_listã€‚ 4.æ‰¾åˆ°å¯¹åº”çš„methodï¼Œæ‰§è¡Œå®ƒçš„IMPã€‚ 5.è½¬å‘IMPçš„returnå€¼ã€‚ æ¶ˆæ¯ä¼ é€’ç”¨åˆ°çš„æ¦‚å¿µï¼šç±»å¯¹è±¡(objc_class)Objective-Cç±»æ˜¯ç”±Classç±»å‹æ¥è¡¨ç¤ºçš„ï¼Œå®ƒå®é™…ä¸Šæ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆã€‚1typedef struct objc_class *Class; æŸ¥çœ‹objc/runtime.hä¸­objc_classç»“æ„ä½“çš„å®šä¹‰å¦‚ä¸‹ï¼š1234567891011121314struct objc_class &#123; Class _Nonnull isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class _Nullable super_class OBJC2_UNAVAILABLE; const char * _Nonnull name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list * _Nullable ivars OBJC2_UNAVAILABLE; struct objc_method_list * _Nullable * _Nullable methodLists OBJC2_UNAVAILABLE; struct objc_cache * _Nonnull cache OBJC2_UNAVAILABLE; struct objc_protocol_list * _Nullable protocols OBJC2_UNAVAILABLE;#endif&#125; OBJC2_UNAVAILABLE; struct objc_classç»“æ„ä½“å®šä¹‰äº†å¾ˆå¤šå˜é‡ï¼Œé€šè¿‡å‘½åä¸éš¾å‘ç°ï¼Œç»“æ„ä½“é‡Œä¿å­˜äº†æŒ‡å‘çˆ¶ç±»çš„æŒ‡é’ˆã€ç±»çš„åå­—ã€ç‰ˆæœ¬ã€å®ä¾‹å¤§å°ã€å®ä¾‹å˜é‡åˆ—è¡¨ã€æ–¹æ³•åˆ—è¡¨ã€ç¼“å­˜ã€éµå®ˆçš„åè®®åˆ—è¡¨ç­‰ï¼Œä¸€ä¸ªç±»åŒ…å«çš„ä¿¡æ¯ä¹Ÿä¸å°±æ­£æ˜¯è¿™äº›å—ï¼Ÿ æ²¡é”™ï¼Œç±»å¯¹è±¡å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“struct objc_classï¼Œè¿™ä¸ªç»“æ„ä½“å­˜æ”¾çš„æ•°æ®ç§°ä¸ºå…ƒæ•°æ®(metadata)ï¼Œè¯¥ç»“æ„ä½“çš„ç¬¬ä¸€ä¸ªæˆå‘˜å˜é‡ä¹Ÿæ˜¯isaæŒ‡é’ˆï¼Œè¿™å°±è¯´æ˜äº†Classæœ¬èº«å…¶å®ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå› æ­¤æˆ‘ä»¬ç§°ä¹‹ä¸ºç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡åœ¨ç¼–è¯‘æœŸäº§ç”Ÿç”¨äºåˆ›å»ºå®ä¾‹å¯¹è±¡ï¼Œæ˜¯å•ä¾‹ã€‚ å®ä¾‹(objc_object)123456/// Represents an instance of a class.struct objc_object &#123; Class isa OBJC_ISA_AVAILABILITY;&#125;;/// A pointer to an instance of a class.typedef struct objc_object *id; ç±»å¯¹è±¡ä¸­çš„å…ƒæ•°æ®å­˜å‚¨çš„éƒ½æ˜¯å¦‚ä½•åˆ›å»ºä¸€ä¸ªå®ä¾‹çš„ç›¸å…³ä¿¡æ¯ï¼Œé‚£ä¹ˆç±»å¯¹è±¡å’Œç±»æ–¹æ³•åº”è¯¥ä»å“ªé‡Œåˆ›å»ºå‘¢ï¼Ÿ å°±æ˜¯ä»isaæŒ‡é’ˆæŒ‡å‘çš„ç»“æ„ä½“åˆ›å»ºï¼Œç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘çš„æˆ‘ä»¬ç§°ä¹‹ä¸ºå…ƒç±»(metaclass)ï¼Œå…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ä»¥åŠç±»æ–¹æ³•æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ï¼Œå› æ­¤æ•´ä¸ªç»“æ„åº”è¯¥å¦‚ä¸‹å›¾æ‰€ç¤º: å…ƒç±»(Meta Class)é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ•´ä¸ªä½“ç³»æ„æˆäº†ä¸€ä¸ªè‡ªé—­ç¯ï¼Œstruct objc_objectç»“æ„ä½“å®ä¾‹å®ƒçš„isaæŒ‡é’ˆæŒ‡å‘ç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘äº†å…ƒç±»ï¼Œsuper_classæŒ‡é’ˆæŒ‡å‘äº†çˆ¶ç±»çš„ç±»å¯¹è±¡ï¼Œè€Œå…ƒç±»çš„super_classæŒ‡é’ˆæŒ‡å‘äº†çˆ¶ç±»çš„å…ƒç±»ï¼Œé‚£å…ƒç±»çš„isaæŒ‡é’ˆåˆæŒ‡å‘äº†è‡ªå·±ã€‚ å…ƒç±»(Meta Class)æ˜¯ä¸€ä¸ªç±»å¯¹è±¡çš„ç±»ã€‚åœ¨ä¸Šé¢æˆ‘ä»¬æåˆ°ï¼Œæ‰€æœ‰çš„ç±»è‡ªèº«ä¹Ÿæ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œæˆ‘ä»¬å¯ä»¥å‘è¿™ä¸ªå¯¹è±¡å‘é€æ¶ˆæ¯(å³è°ƒç”¨ç±»æ–¹æ³•)ã€‚ä¸ºäº†è°ƒç”¨ç±»æ–¹æ³•ï¼Œè¿™ä¸ªç±»çš„isaæŒ‡é’ˆå¿…é¡»æŒ‡å‘ä¸€ä¸ªåŒ…å«è¿™äº›ç±»æ–¹æ³•çš„ä¸€ä¸ªobjc_classç»“æ„ä½“ã€‚è¿™å°±å¼•å‡ºäº†meta-classçš„æ¦‚å¿µï¼Œå…ƒç±»ä¸­ä¿å­˜äº†åˆ›å»ºç±»å¯¹è±¡ä»¥åŠç±»æ–¹æ³•æ‰€éœ€çš„æ‰€æœ‰ä¿¡æ¯ã€‚ä»»ä½•NSObjectç»§æ‰¿ä½“ç³»ä¸‹çš„meta-classéƒ½ä½¿ç”¨NSObjectçš„meta-classä½œä¸ºè‡ªå·±çš„æ‰€å±ç±»ï¼Œè€ŒåŸºç±»çš„meta-classçš„isaæŒ‡é’ˆæ˜¯æŒ‡å‘å®ƒè‡ªå·±ã€‚ Method(objc_method)å…ˆçœ‹ä¸‹å®šä¹‰ 12345678runtime.h/// An opaque type that represents a method in a class definition.ä»£è¡¨ç±»å®šä¹‰ä¸­ä¸€ä¸ªæ–¹æ³•çš„ä¸é€æ˜ç±»å‹typedef struct objc_method *Method;struct objc_method &#123; SEL method_name OBJC2_UNAVAILABLE; // æ–¹æ³•å char *method_types OBJC2_UNAVAILABLE; // æ–¹æ³•ç±»å‹ IMP method_imp OBJC2_UNAVAILABLE; // æ–¹æ³•å®ç°&#125; Methodå’Œæˆ‘ä»¬å¹³æ—¶ç†è§£çš„å‡½æ•°æ˜¯ä¸€è‡´çš„ï¼Œå°±æ˜¯è¡¨ç¤ºèƒ½å¤Ÿç‹¬ç«‹å®Œæˆä¸€ä¸ªåŠŸèƒ½çš„ä¸€æ®µä»£ç ï¼Œæ¯”å¦‚ï¼š123- (void)logName &#123; NSLog(@\"name\");&#125; è¿™æ®µä»£ç ï¼Œå°±æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚æˆ‘ä»¬æ¥çœ‹ä¸‹objc_methodè¿™ä¸ªç»“æ„ä½“çš„å†…å®¹ï¼š SEL method_name æ–¹æ³•å char *method_types æ–¹æ³•ç±»å‹ IMP method_imp æ–¹æ³•å®ç° åœ¨è¿™ä¸ªç»“æ„ä½“é‡ï¼Œæˆ‘ä»¬å·²ç»çœ‹åˆ°äº†SELå’ŒIMPï¼Œè¯´æ˜SELå’ŒIMPå…¶å®éƒ½æ˜¯Methodçš„å±æ€§ã€‚æˆ‘ä»¬æ¥ç€æ¥çœ‹SELã€‚ SEL(objc_selector)å…ˆçœ‹ä¸‹å®šä¹‰123Objc.h/// An opaque type that represents a method selector.ä»£è¡¨ä¸€ä¸ªæ–¹æ³•çš„ä¸é€æ˜ç±»å‹typedef struct objc_selector *SEL; objc_msgSendå‡½æ•°ç¬¬äºŒä¸ªå‚æ•°ç±»å‹ä¸ºSELï¼Œå®ƒæ˜¯selectoråœ¨Objective-Cä¸­çš„è¡¨ç¤ºç±»å‹ï¼ˆSwiftä¸­æ˜¯Selectorç±»ï¼‰ã€‚selectoræ˜¯æ–¹æ³•é€‰æ‹©å™¨ï¼Œå¯ä»¥ç†è§£ä¸ºåŒºåˆ†æ–¹æ³•çš„ IDï¼Œè€Œè¿™ä¸ª ID çš„æ•°æ®ç»“æ„æ˜¯SEL:1@property SEL selector; å¯ä»¥çœ‹åˆ°selectoræ˜¯SELçš„ä¸€ä¸ªå®ä¾‹ã€‚1A method selector is a C string that has been registered (or â€œmappedâ€œ) with the Objective-C runtime. Selectors generated by the compiler are automatically mapped by the runtime when the class is loaded. å…¶å®selectorå°±æ˜¯ä¸ªæ˜ å°„åˆ°æ–¹æ³•çš„Cå­—ç¬¦ä¸²ï¼Œä½ å¯ä»¥ç”¨ Objective-C ç¼–è¯‘å™¨å‘½ä»¤@selector()æˆ–è€… Runtime ç³»ç»Ÿçš„sel_registerNameå‡½æ•°æ¥è·å¾—ä¸€ä¸ª SEL ç±»å‹çš„æ–¹æ³•é€‰æ‹©å™¨ã€‚ selectoræ—¢ç„¶æ˜¯ä¸€ä¸ªstringï¼Œæˆ‘è§‰å¾—åº”è¯¥æ˜¯ç±»ä¼¼className+methodçš„ç»„åˆï¼Œå‘½åè§„åˆ™æœ‰ä¸¤æ¡ï¼š åŒä¸€ä¸ªç±»ï¼Œselectorä¸èƒ½é‡å¤ ä¸åŒçš„ç±»ï¼Œselectorå¯ä»¥é‡å¤ è¿™ä¹Ÿå¸¦æ¥äº†ä¸€ä¸ªå¼Šç«¯ï¼Œæˆ‘ä»¬åœ¨å†™Cä»£ç çš„æ—¶å€™ï¼Œç»å¸¸ä¼šç”¨åˆ°å‡½æ•°é‡è½½ï¼Œå°±æ˜¯å‡½æ•°åç›¸åŒï¼Œå‚æ•°ä¸åŒï¼Œä½†æ˜¯è¿™åœ¨Objective-Cä¸­æ˜¯è¡Œä¸é€šçš„ï¼Œå› ä¸ºselectoråªè®°äº†methodçš„nameï¼Œæ²¡æœ‰å‚æ•°ï¼Œæ‰€ä»¥æ²¡æ³•åŒºåˆ†ä¸åŒçš„methodã€‚æ¯”å¦‚ï¼š12- (void)caculate(NSInteger)num;- (void)caculate(CGFloat)num; æ˜¯ä¼šæŠ¥é”™çš„ã€‚ æˆ‘ä»¬åªèƒ½é€šè¿‡å‘½åæ¥åŒºåˆ«ï¼š12- (void)caculateWithInt(NSInteger)num;- (void)caculateWithFloat(CGFloat)num; åœ¨ä¸åŒç±»ä¸­ç›¸åŒåå­—çš„æ–¹æ³•æ‰€å¯¹åº”çš„æ–¹æ³•é€‰æ‹©å™¨æ˜¯ç›¸åŒçš„ï¼Œå³ä½¿æ–¹æ³•åå­—ç›¸åŒè€Œå˜é‡ç±»å‹ä¸åŒä¹Ÿä¼šå¯¼è‡´å®ƒä»¬å…·æœ‰ç›¸åŒçš„æ–¹æ³•é€‰æ‹©å™¨ã€‚ IMPçœ‹ä¸‹IMPçš„å®šä¹‰ 12/// A pointer to the function of a method implementation. æŒ‡å‘ä¸€ä¸ªæ–¹æ³•å®ç°çš„æŒ‡é’ˆtypedef id (*IMP)(id, SEL, ...); å°±æ˜¯æŒ‡å‘æœ€ç»ˆå®ç°ç¨‹åºçš„å†…å­˜åœ°å€çš„æŒ‡é’ˆã€‚ åœ¨iOSçš„Runtimeä¸­ï¼ŒMethodé€šè¿‡selectorå’ŒIMPä¸¤ä¸ªå±æ€§ï¼Œå®ç°äº†å¿«é€ŸæŸ¥è¯¢æ–¹æ³•åŠå®ç°ï¼Œç›¸å¯¹æé«˜äº†æ€§èƒ½ï¼Œåˆä¿æŒäº†çµæ´»æ€§ã€‚ ç±»ç¼“å­˜(objc_cache)å½“Objective-Cè¿è¡Œæ—¶é€šè¿‡è·Ÿè¸ªå®ƒçš„isaæŒ‡é’ˆæ£€æŸ¥å¯¹è±¡æ—¶ï¼Œå®ƒå¯ä»¥æ‰¾åˆ°ä¸€ä¸ªå®ç°è®¸å¤šæ–¹æ³•çš„å¯¹è±¡ã€‚ç„¶è€Œï¼Œä½ å¯èƒ½åªè°ƒç”¨å®ƒä»¬çš„ä¸€å°éƒ¨åˆ†ï¼Œå¹¶ä¸”æ¯æ¬¡æŸ¥æ‰¾æ—¶ï¼Œæœç´¢æ‰€æœ‰é€‰æ‹©å™¨çš„ç±»åˆ†æ´¾è¡¨æ²¡æœ‰æ„ä¹‰ã€‚æ‰€ä»¥ç±»å®ç°ä¸€ä¸ªç¼“å­˜ï¼Œæ¯å½“ä½ æœç´¢ä¸€ä¸ªç±»åˆ†æ´¾è¡¨ï¼Œå¹¶æ‰¾åˆ°ç›¸åº”çš„é€‰æ‹©å™¨ï¼Œå®ƒæŠŠå®ƒæ”¾å…¥å®ƒçš„ç¼“å­˜ã€‚æ‰€ä»¥å½“objc_msgSendæŸ¥æ‰¾ä¸€ä¸ªç±»çš„é€‰æ‹©å™¨ï¼Œå®ƒé¦–å…ˆæœç´¢ç±»ç¼“å­˜ã€‚è¿™æ˜¯åŸºäºè¿™æ ·çš„ç†è®ºï¼šå¦‚æœä½ åœ¨ç±»ä¸Šè°ƒç”¨ä¸€ä¸ªæ¶ˆæ¯ï¼Œä½ å¯èƒ½ä»¥åå†æ¬¡è°ƒç”¨è¯¥æ¶ˆæ¯ã€‚ ä¸ºäº†åŠ é€Ÿæ¶ˆæ¯åˆ†å‘ï¼Œ ç³»ç»Ÿä¼šå¯¹æ–¹æ³•å’Œå¯¹åº”çš„åœ°å€è¿›è¡Œç¼“å­˜ï¼Œå°±æ”¾åœ¨ä¸Šè¿°çš„objc_cacheï¼Œæ‰€ä»¥åœ¨å®é™…è¿è¡Œä¸­ï¼Œå¤§éƒ¨åˆ†å¸¸ç”¨çš„æ–¹æ³•éƒ½æ˜¯ä¼šè¢«ç¼“å­˜èµ·æ¥çš„ï¼ŒRuntimeç³»ç»Ÿå®é™…ä¸Šéå¸¸å¿«ï¼Œæ¥è¿‘ç›´æ¥æ‰§è¡Œå†…å­˜åœ°å€çš„ç¨‹åºé€Ÿåº¦ã€‚ Category(objc_category)Categoryæ˜¯è¡¨ç¤ºä¸€ä¸ªæŒ‡å‘åˆ†ç±»çš„ç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå…¶å®šä¹‰å¦‚ä¸‹ï¼š12345678struct category_t &#123; const char *name; classref_t cls; struct method_list_t *instanceMethods; struct method_list_t *classMethods; struct protocol_list_t *protocols; struct property_list_t *instanceProperties;&#125;; nameï¼šæ˜¯æŒ‡ class_name è€Œä¸æ˜¯ category_nameã€‚ clsï¼šè¦æ‰©å±•çš„ç±»å¯¹è±¡ï¼Œç¼–è¯‘æœŸé—´æ˜¯ä¸ä¼šå®šä¹‰çš„ï¼Œè€Œæ˜¯åœ¨Runtimeé˜¶æ®µé€šè¿‡nameå¯¹åº”åˆ°å¯¹åº”çš„ç±»å¯¹è±¡ã€‚ instanceMethodsï¼šcategoryä¸­æ‰€æœ‰ç»™ç±»æ·»åŠ çš„å®ä¾‹æ–¹æ³•çš„åˆ—è¡¨ã€‚ classMethodsï¼šcategoryä¸­æ‰€æœ‰æ·»åŠ çš„ç±»æ–¹æ³•çš„åˆ—è¡¨ã€‚ protocolsï¼šcategoryå®ç°çš„æ‰€æœ‰åè®®çš„åˆ—è¡¨ã€‚ instancePropertiesï¼šè¡¨ç¤ºCategoryé‡Œæ‰€æœ‰çš„propertiesï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡objc_setAssociatedObjectå’Œobjc_getAssociatedObjectå¢åŠ å®ä¾‹å˜é‡çš„åŸå› ï¼Œä¸è¿‡è¿™ä¸ªå’Œä¸€èˆ¬çš„å®ä¾‹å˜é‡æ˜¯ä¸ä¸€æ ·çš„ã€‚ ä»ä¸Šé¢çš„category_tçš„ç»“æ„ä½“ä¸­å¯ä»¥çœ‹å‡ºï¼Œåˆ†ç±»ä¸­å¯ä»¥æ·»åŠ å®ä¾‹æ–¹æ³•ï¼Œç±»æ–¹æ³•ï¼Œç”šè‡³å¯ä»¥å®ç°åè®®ï¼Œæ·»åŠ å±æ€§ï¼Œä¸å¯ä»¥æ·»åŠ æˆå‘˜å˜é‡ã€‚ Runtimeæ¶ˆæ¯è½¬å‘å‰æ–‡ä»‹ç»äº†è¿›è¡Œä¸€æ¬¡å‘é€æ¶ˆæ¯ä¼šåœ¨ç›¸å…³çš„ç±»å¯¹è±¡ä¸­æœç´¢æ–¹æ³•åˆ—è¡¨ï¼Œå¦‚æœæ‰¾ä¸åˆ°åˆ™ä¼šæ²¿ç€ç»§æ‰¿æ ‘å‘ä¸Šä¸€ç›´æœç´¢çŸ¥é“ç»§æ‰¿æ ‘æ ¹éƒ¨ï¼ˆé€šå¸¸ä¸ºNSObjectï¼‰ï¼Œå¦‚æœè¿˜æ˜¯æ‰¾ä¸åˆ°å¹¶ä¸”æ¶ˆæ¯è½¬å‘éƒ½å¤±è´¥äº†å°±å›æ‰§è¡ŒdoesNotRecognizeSelector:æ–¹æ³•æŠ¥unrecognized selectoré”™ã€‚é‚£ä¹ˆæ¶ˆæ¯è½¬å‘åˆ°åº•æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæ¥ä¸‹æ¥å°†ä¼šé€ä¸€ä»‹ç»æœ€åçš„ä¸‰æ¬¡æœºä¼šã€‚ ç¬¬ä¸€æ¬¡æœºä¼š: æ‰€å±ç±»åŠ¨æ€æ–¹æ³•è§£æå¯¹è±¡åœ¨æ¥æ”¶åˆ°æœªçŸ¥çš„æ¶ˆæ¯æ—¶ï¼Œé¦–å…ˆä¼šè°ƒç”¨æ‰€å±ç±»çš„ç±»æ–¹æ³•+resolveInstanceMethod:(å®ä¾‹æ–¹æ³•)æˆ–è€…+resolveClassMethod:(ç±»æ–¹æ³•)ã€‚1+(BOOL)resolveInstanceMethod:(SEL)name åŠ¨æ€è½¬å‘1BOOL class_addMethod(Class cls, SEL name, IMP imp, const char *types); ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯éœ€è¦æ·»åŠ æ–¹æ³•çš„ç±»ï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªselectorï¼Œä¹Ÿå°±æ˜¯å®ä¾‹æ–¹æ³•çš„åå­—ï¼Œç¬¬ä¸‰ä¸ªå‚æ•°æ˜¯ä¸€ä¸ªIMPç±»å‹çš„å˜é‡ä¹Ÿå°±æ˜¯å‡½æ•°å®ç°ï¼Œéœ€è¦ä¼ å…¥ä¸€ä¸ªCå‡½æ•°ï¼Œè¿™ä¸ªå‡½æ•°è‡³å°‘æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯id selfä¸€ä¸ªæ˜¯SEL _cmdï¼Œç¬¬å››ä¸ªå‚æ•°æ˜¯å‡½æ•°ç±»å‹ã€‚ å®ç°ä¸€ä¸ªåŠ¨æ€æ–¹æ³•è§£æçš„ä¾‹å­å¦‚ä¸‹ï¼š12345678910111213141516- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. //æ‰§è¡Œfooå‡½æ•° [self performSelector:@selector(foo:)];&#125;+ (BOOL)resolveInstanceMethod:(SEL)sel &#123; if (sel == @selector(foo:)) &#123;//å¦‚æœæ˜¯æ‰§è¡Œfooå‡½æ•°ï¼Œå°±åŠ¨æ€è§£æï¼ŒæŒ‡å®šæ–°çš„IMP class_addMethod([self class], sel, (IMP)fooMethod, \"v@:\"); return YES; &#125; return [super resolveInstanceMethod:sel];&#125;void fooMethod(id obj, SEL _cmd) &#123; NSLog(@\"Doing foo\");//æ–°çš„fooå‡½æ•°&#125; æ‰“å°ç»“æœï¼š 2018-04-01 12:23:35.952670+0800 ocram[87546:23235469] Doing foo å¯ä»¥çœ‹åˆ°è™½ç„¶æ²¡æœ‰å®ç°foo:è¿™ä¸ªå‡½æ•°ï¼Œä½†æ˜¯æˆ‘ä»¬é€šè¿‡class_addMethodåŠ¨æ€æ·»åŠ fooMethodå‡½æ•°ï¼Œå¹¶æ‰§è¡ŒfooMethodè¿™ä¸ªå‡½æ•°çš„IMPã€‚ä»æ‰“å°ç»“æœçœ‹ï¼ŒæˆåŠŸå®ç°äº†ã€‚ å¦‚æœresolveæ–¹æ³•è¿”å› NO ï¼Œè¿è¡Œæ—¶å°±ä¼šç§»åˆ°ä¸‹ä¸€æ­¥ï¼šforwardingTargetForSelectorã€‚ ç¬¬äºŒæ¬¡æœºä¼š: å¤‡æ´æ¥æ”¶è€…åŠ¨æ€æ–¹æ³•è§£ææ— æ³•å¤„ç†æ¶ˆæ¯ï¼Œåˆ™ä¼šèµ°å¤‡ç”¨æ¥å—è€…ã€‚è¿™ä¸ªå¤‡ç”¨æ¥å—è€…åªèƒ½æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œä¸èƒ½æ˜¯selfæœ¬èº«ï¼Œå¦åˆ™å°±ä¼šå‡ºç°æ— é™å¾ªç¯ã€‚å¦‚æœæˆ‘ä»¬æ²¡æœ‰æŒ‡å®šç›¸åº”çš„å¯¹è±¡æ¥å¤„ç†aSelectorï¼Œåˆ™åº”è¯¥è°ƒç”¨çˆ¶ç±»çš„å®ç°æ¥è¿”å›ç»“æœã€‚1- (id)forwardingTargetForSelector:(SEL)aSelector; è¯¥æ–¹æ³•çš„å‚æ•°å°±æ˜¯é‚£ä¸ªæœªçŸ¥çš„selectorï¼Œè¿™æ˜¯ä¸€ä¸ªå®ä¾‹æ–¹æ³•ï¼Œå› ä¸ºæ˜¯è¯¢é—®è¯¥å®ä¾‹å¯¹è±¡æ˜¯å¦æœ‰å…¶ä»–å®ä¾‹å¯¹è±¡å¯ä»¥æ¥æ”¶è¿™ä¸ªæœªçŸ¥çš„selectorï¼Œå¦‚æœæ²¡æœ‰å°±è¿”å›nilï¼Œå¯ä»¥è‡ªè¡Œå®éªŒã€‚ å®ç°ä¸€ä¸ªå¤‡ç”¨æ¥æ”¶è€…çš„ä¾‹å­å¦‚ä¸‹ï¼š12345678910111213141516171819202122232425262728293031323334353637#import \"ViewController.h\"#import \"objc/runtime.h\"@interface Person: NSObject@end@implementation Person- (void)foo &#123; NSLog(@\"Doing foo\");//Personçš„fooå‡½æ•°&#125;@end@interface ViewController ()@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. //æ‰§è¡Œfooå‡½æ•° [self performSelector:@selector(foo)];&#125;+ (BOOL)resolveInstanceMethod:(SEL)sel &#123; return YES;//è¿”å›YESï¼Œè¿›å…¥ä¸‹ä¸€æ­¥è½¬å‘&#125;- (id)forwardingTargetForSelector:(SEL)aSelector &#123; if (aSelector == @selector(foo)) &#123; return [Person new];//è¿”å›Personå¯¹è±¡ï¼Œè®©Personå¯¹è±¡æ¥æ”¶è¿™ä¸ªæ¶ˆæ¯ &#125; return [super forwardingTargetForSelector:aSelector];&#125;@end æ‰“å°ç»“æœï¼š 2018-04-01 12:45:04.757929+0800 ocram[88023:23260346] Doing foo å¯ä»¥çœ‹åˆ°æˆ‘ä»¬é€šè¿‡forwardingTargetForSelectoræŠŠå½“å‰ViewControllerçš„æ–¹æ³•è½¬å‘ç»™äº†Personå»æ‰§è¡Œäº†ã€‚æ‰“å°ç»“æœä¹Ÿè¯æ˜æˆ‘ä»¬æˆåŠŸå®ç°äº†è½¬å‘ã€‚ å¦‚æœåœ¨è¿™ä¸€æ­¥è¿˜ä¸èƒ½å¤„ç†æœªçŸ¥æ¶ˆæ¯ï¼Œåˆ™å”¯ä¸€èƒ½åšçš„å°±æ˜¯å¯ç”¨å®Œæ•´çš„æ¶ˆæ¯è½¬å‘æœºåˆ¶äº†ã€‚ ç¬¬ä¸‰æ¬¡æœºä¼š: æ¶ˆæ¯é‡å®šå‘å¦‚æœåŠ¨æ€æ–¹æ³•è§£æå’Œå¤‡ç”¨æ¥å—è€…éƒ½æ²¡æœ‰å¤„ç†è¿™ä¸ªæ¶ˆæ¯ï¼Œé‚£ä¹ˆå°±ä¼šèµ°å®Œæ•´æ¶ˆæ¯è½¬å‘ã€‚ é¦–å…ˆå®ƒä¼šå‘é€-methodSignatureForSelector:æ¶ˆæ¯è·å¾—å‡½æ•°çš„å‚æ•°å’Œè¿”å›å€¼ç±»å‹ã€‚ å¦‚æœ-methodSignatureForSelector:è¿”å›nil ï¼ŒRuntimeåˆ™ä¼šå‘å‡º -doesNotRecognizeSelector: æ¶ˆæ¯ï¼Œç¨‹åºè¿™æ—¶ä¹Ÿå°±æŒ‚æ‰äº†ã€‚ å¦‚æœè¿”å›äº†ä¸€ä¸ªå‡½æ•°ç­¾åï¼ŒRuntimeå°±ä¼šåˆ›å»ºä¸€ä¸ªNSInvocation å¯¹è±¡å¹¶å‘é€ -forwardInvocation:æ¶ˆæ¯ç»™ç›®æ ‡å¯¹è±¡ã€‚ 1- (void)forwardInvocation: (NSInvocation*)invocation; è°ƒç”¨è¿™ä¸ªæ–¹æ³•å¦‚æœä¸èƒ½å¤„ç†å°±ä¼šè°ƒç”¨çˆ¶ç±»çš„ç›¸å…³æ–¹æ³•ï¼Œä¸€ç›´åˆ°NSObjectçš„è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚æœNSObjectéƒ½æ— æ³•å¤„ç†å°±ä¼šè°ƒç”¨doesNotRecognizeSelector:æ–¹æ³•æŠ›å‡ºå¼‚å¸¸ã€‚ å®ç°ä¸€ä¸ªå®Œæ•´è½¬å‘çš„ä¾‹å­å¦‚ä¸‹ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142#import \"ViewController.h\"#import \"objc/runtime.h\"@interface Person: NSObject@end@implementation Person- (void)foo &#123; NSLog(@\"Doing foo\");//Personçš„fooå‡½æ•°&#125;@end@interface ViewController ()@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. //æ‰§è¡Œfooå‡½æ•° [self performSelector:@selector(foo)];&#125;+ (BOOL)resolveInstanceMethod:(SEL)sel &#123; return YES;//è¿”å›YESï¼Œè¿›å…¥ä¸‹ä¸€æ­¥è½¬å‘&#125;- (id)forwardingTargetForSelector:(SEL)aSelector &#123; return nil;//è¿”å›nilï¼Œè¿›å…¥ä¸‹ä¸€æ­¥è½¬å‘&#125;- (NSMethodSignature *)methodSignatureForSelector:(SEL)aSelector &#123; if ([NSStringFromSelector(aSelector) isEqualToString:@\"foo\"]) &#123; return [NSMethodSignature signatureWithObjCTypes:\"v@:\"];//ç­¾åï¼Œè¿›å…¥forwardInvocation &#125; return [super methodSignatureForSelector:aSelector];&#125;- (void)forwardInvocation:(NSInvocation *)anInvocation &#123; SEL sel = anInvocation.selector; Person *p = [Person new]; if([p respondsToSelector:sel]) &#123; [anInvocation invokeWithTarget:p]; &#125; else &#123; [self doesNotRecognizeSelector:sel]; &#125;&#125;@end æ‰“å°ç»“æœï¼š2018-04-01 13:00:45.423385+0800 ocram[88353:23279961] Doing foo ä»æ‰“å°ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬å®ç°äº†å®Œæ•´çš„è½¬å‘ã€‚é€šè¿‡ç­¾åï¼ŒRuntimeç”Ÿæˆäº†ä¸€ä¸ªå¯¹è±¡anInvocationï¼Œå‘é€ç»™äº†forwardInvocationï¼Œæˆ‘ä»¬åœ¨forwardInvocationæ–¹æ³•é‡Œé¢è®©Personå¯¹è±¡å»æ‰§è¡Œäº†fooå‡½æ•°ã€‚ ç­¾åå‚æ•°v@:æ€ä¹ˆè§£é‡Šå‘¢ï¼Œè¿™é‡Œè‹¹æœæ–‡æ¡£Type Encodingsæœ‰è¯¦ç»†çš„è§£é‡Šã€‚Type Encodings: https://developer.apple.com/library/content/documentation/Cocoa/Conceptual/ObjCRuntimeGuide/Articles/ocrtTypeEncodings.html#//apple_ref/doc/uid/TP40008048-CH100-SW1 ä»¥ä¸Šå°±æ˜¯Runtimeçš„ä¸‰æ¬¡è½¬å‘æµç¨‹ã€‚ä¸‹é¢æˆ‘ä»¬è®²è®²Runtimeçš„å®é™…åº”ç”¨ã€‚ Runtimeåº”ç”¨Runtimeç®€ç›´å°±æ˜¯åšå¤§å‹æ¡†æ¶çš„åˆ©å™¨ã€‚å®ƒçš„åº”ç”¨åœºæ™¯éå¸¸å¤šï¼Œä¸‹é¢å°±ä»‹ç»ä¸€äº›å¸¸è§çš„åº”ç”¨åœºæ™¯ã€‚ å…³è”å¯¹è±¡(Objective-C Associated Objects)ï¼šç»™åˆ†ç±»å¢åŠ å±æ€§ æ–¹æ³•é­”æ³•(Method Swizzling)ï¼šæ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç° æ¶ˆæ¯è½¬å‘(çƒ­æ›´æ–°)ï¼šè§£å†³Bug(JSPatch) å®ç°NSCodingçš„è‡ªåŠ¨å½’æ¡£å’Œè‡ªåŠ¨è§£æ¡£ å®ç°å­—å…¸å’Œæ¨¡å‹çš„è‡ªåŠ¨è½¬æ¢(MJExtension) 1ï¼‰å…³è”å¯¹è±¡(Objective-C Associated Objects)ï¼šç»™åˆ†ç±»å¢åŠ å±æ€§ æˆ‘ä»¬éƒ½æ˜¯çŸ¥é“åˆ†ç±»æ˜¯ä¸èƒ½è‡ªå®šä¹‰å±æ€§å’Œå˜é‡çš„ã€‚ä¸‹é¢é€šè¿‡å…³è”å¯¹è±¡å®ç°ç»™åˆ†ç±»æ·»åŠ å±æ€§ã€‚å…³è”å¯¹è±¡Runtimeæä¾›äº†ä¸‹é¢å‡ ä¸ªæ¥å£ï¼š123456//å…³è”å¯¹è±¡void objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy)//è·å–å…³è”çš„å¯¹è±¡id objc_getAssociatedObject(id object, const void *key)//ç§»é™¤å…³è”çš„å¯¹è±¡void objc_removeAssociatedObjects(id object) å‚æ•°è§£é‡Š1234id objectï¼šè¢«å…³è”çš„å¯¹è±¡const void *keyï¼šå…³è”çš„keyï¼Œè¦æ±‚å”¯ä¸€id valueï¼šå…³è”çš„å¯¹è±¡objc_AssociationPolicy policyï¼šå†…å­˜ç®¡ç†çš„ç­–ç•¥ è¿™é‡Œæ’ä¸€ä¸‹å†…å­˜ç®¡ç†çš„ç­–ç•¥ç›¸å…³çŸ¥è¯†ï¼Œé˜²æ‡µé€¼ ğŸ˜³1234567891011typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123; OBJC_ASSOCIATION_ASSIGN = 0, /**&lt; Specifies a weak reference to the associated object. */ OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, /**&lt; Specifies a strong reference to the associated object. * The association is not made atomically. */ OBJC_ASSOCIATION_COPY_NONATOMIC = 3, /**&lt; Specifies that the associated object is copied. * The association is not made atomically. */ OBJC_ASSOCIATION_RETAIN = 01401, /**&lt; Specifies a strong reference to the associated object. * The association is made atomically. */ OBJC_ASSOCIATION_COPY = 01403 /**&lt; Specifies that the associated object is copied. * The association is made atomically. */&#125;; æˆ‘ä»¬çœ‹çœ‹å†…å­˜æµ‹é‡å¯¹äºçš„å±æ€§ä¿®é¥° ä¸‹é¢å®ç°ä¸€ä¸ªUIViewçš„Categoryæ·»åŠ è‡ªå®šä¹‰å±æ€§defaultColor12345678910111213141516171819202122232425262728293031323334#import \"ViewController.h\"#import \"objc/runtime.h\"@interface UIView (DefaultColor)@property (nonatomic, strong) UIColor *defaultColor;@end@implementation UIView (DefaultColor)@dynamic defaultColor;static char kDefaultColorKey;- (void)setDefaultColor:(UIColor *)defaultColor &#123; objc_setAssociatedObject(self, &amp;kDefaultColorKey, defaultColor, OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;- (id)defaultColor &#123; return objc_getAssociatedObject(self, &amp;kDefaultColorKey);&#125;@end@interface ViewController ()@end@implementation ViewController- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. UIView *test = [UIView new]; test.defaultColor = [UIColor blackColor]; NSLog(@\"%@\", test.defaultColor);&#125;@end æ‰“å°ç»“æœï¼š 2018-04-01 15:41:44.977732+0800 ocram[2053:63739] UIExtendedGrayColorSpace 0 1 æ‰“å°ç»“æœæ¥çœ‹ï¼Œæˆ‘ä»¬æˆåŠŸåœ¨åˆ†ç±»ä¸Šæ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œå®ç°äº†å®ƒçš„setterå’Œgetteræ–¹æ³•ã€‚ é€šè¿‡å…³è”å¯¹è±¡å®ç°çš„å±æ€§çš„å†…å­˜ç®¡ç†ä¹Ÿæ˜¯æœ‰ARCç®¡ç†çš„ï¼Œæ‰€ä»¥æˆ‘ä»¬åªéœ€è¦ç»™å®šé€‚å½“çš„å†…å­˜ç­–ç•¥å°±è¡Œäº†ï¼Œä¸éœ€è¦æ“å¿ƒå¯¹è±¡çš„é‡Šæ”¾ã€‚ 2ï¼‰æ–¹æ³•é­”æ³•(Method Swizzling)ï¼šæ–¹æ³•æ·»åŠ å’Œæ›¿æ¢å’ŒKVOå®ç° æ–¹æ³•æ·»åŠ  å®é™…ä¸Šæ·»åŠ æ–¹æ³•åˆšæ‰åœ¨è®²æ¶ˆæ¯è½¬å‘çš„æ—¶å€™ï¼ŒåŠ¨æ€æ–¹æ³•è§£æçš„æ—¶å€™å°±æåˆ°äº†ã€‚ 12//class_addMethod(Class _Nullable __unsafe_unretained cls, SEL _Nonnull name, IMP _Nonnull imp, const char * _Nullable types)class_addMethod([self class], sel, (IMP)fooMethod, \"v@:\"); cls è¢«æ·»åŠ æ–¹æ³•çš„ç±» name æ·»åŠ çš„æ–¹æ³•çš„åç§°çš„SEL imp æ–¹æ³•çš„å®ç°ã€‚è¯¥å‡½æ•°å¿…é¡»è‡³å°‘è¦æœ‰ä¸¤ä¸ªå‚æ•°ï¼Œself,_cmd ç±»å‹ç¼–ç  æ–¹æ³•æ›¿æ¢ ä¸‹é¢å®ç°ä¸€ä¸ªæ›¿æ¢ViewControllerçš„viewDidLoadæ–¹æ³•çš„ä¾‹å­ã€‚ 123456789101112131415161718192021222324252627282930@implementation ViewController+ (void)load &#123; static dispatch_once_t onceToken; dispatch_once(&amp;onceToken, ^&#123; Class class = [self class]; SEL originalSelector = @selector(viewDidLoad); SEL swizzledSelector = @selector(jkviewDidLoad); Method originalMethod = class_getInstanceMethod(class,originalSelector); Method swizzledMethod = class_getInstanceMethod(class,swizzledSelector); //judge the method named swizzledMethod is already existed. BOOL didAddMethod = class_addMethod(class, originalSelector, method_getImplementation(swizzledMethod), method_getTypeEncoding(swizzledMethod)); // if swizzledMethod is already existed. if (didAddMethod) &#123; class_replaceMethod(class, swizzledSelector, method_getImplementation(originalMethod), method_getTypeEncoding(originalMethod)); &#125; else &#123; method_exchangeImplementations(originalMethod, swizzledMethod); &#125; &#125;);&#125;- (void)jkviewDidLoad &#123; NSLog(@\"æ›¿æ¢çš„æ–¹æ³•\"); [self jkviewDidLoad];&#125;- (void)viewDidLoad &#123; NSLog(@\"è‡ªå¸¦çš„æ–¹æ³•\"); [super viewDidLoad];&#125;@end swizzlingåº”è¯¥åªåœ¨+loadä¸­å®Œæˆã€‚ åœ¨ Objective-C çš„è¿è¡Œæ—¶ä¸­ï¼Œæ¯ä¸ªç±»æœ‰ä¸¤ä¸ªæ–¹æ³•éƒ½ä¼šè‡ªåŠ¨è°ƒç”¨ã€‚+load æ˜¯åœ¨ä¸€ä¸ªç±»è¢«åˆå§‹è£…è½½æ—¶è°ƒç”¨ï¼Œ+initialize æ˜¯åœ¨åº”ç”¨ç¬¬ä¸€æ¬¡è°ƒç”¨è¯¥ç±»çš„ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•å‰è°ƒç”¨çš„ã€‚ä¸¤ä¸ªæ–¹æ³•éƒ½æ˜¯å¯é€‰çš„ï¼Œå¹¶ä¸”åªæœ‰åœ¨æ–¹æ³•è¢«å®ç°çš„æƒ…å†µä¸‹æ‰ä¼šè¢«è°ƒç”¨ã€‚ swizzlingåº”è¯¥åªåœ¨dispatch_once ä¸­å®Œæˆ,ç”±äºswizzling æ”¹å˜äº†å…¨å±€çš„çŠ¶æ€ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦ç¡®ä¿æ¯ä¸ªé¢„é˜²æªæ–½åœ¨è¿è¡Œæ—¶éƒ½æ˜¯å¯ç”¨çš„ã€‚åŸå­æ“ä½œå°±æ˜¯è¿™æ ·ä¸€ä¸ªç”¨äºç¡®ä¿ä»£ç åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡çš„é¢„é˜²æªæ–½ï¼Œå°±ç®—æ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­ä¹Ÿèƒ½ç¡®ä¿ä»£ç åªæ‰§è¡Œä¸€æ¬¡ã€‚Grand Central Dispatch çš„ dispatch_onceæ»¡è¶³äº†æ‰€éœ€è¦çš„éœ€æ±‚ï¼Œå¹¶ä¸”åº”è¯¥è¢«å½“åšä½¿ç”¨swizzling çš„åˆå§‹åŒ–å•ä¾‹æ–¹æ³•çš„æ ‡å‡†ã€‚ å®ç°å›¾è§£å¦‚ä¸‹å›¾ ä»å›¾ä¸­å¯ä»¥çœ‹å‡ºï¼Œæˆ‘ä»¬é€šè¿‡swizzlingç‰¹æ€§ï¼Œå°†selectorCçš„æ–¹æ³•å®ç°IMPcä¸selectorNçš„æ–¹æ³•å®ç°IMPnäº¤æ¢äº†ï¼Œå½“æˆ‘ä»¬è°ƒç”¨selectorCï¼Œä¹Ÿå°±æ˜¯ç»™å¯¹è±¡å‘é€selectorCæ¶ˆæ¯æ—¶ï¼Œæ‰€æŸ¥æ‰¾åˆ°çš„å¯¹åº”çš„æ–¹æ³•å®ç°å°±æ˜¯IMPnè€Œä¸æ˜¯IMPcäº†ã€‚ KVO å®ç° å…¨ç§°æ˜¯Key-value observingï¼Œç¿»è¯‘æˆé”®å€¼è§‚å¯Ÿã€‚æä¾›äº†ä¸€ç§å½“å…¶å®ƒå¯¹è±¡å±æ€§è¢«ä¿®æ”¹çš„æ—¶å€™èƒ½é€šçŸ¥å½“å‰å¯¹è±¡çš„æœºåˆ¶ã€‚å†MVCå¤§è¡Œå…¶é“çš„Cocoaä¸­ï¼ŒKVOæœºåˆ¶å¾ˆé€‚åˆå®ç°modelå’Œcontrollerç±»ä¹‹é—´çš„é€šè®¯ã€‚ KVOçš„å®ç°ä¾èµ–äº Objective-C å¼ºå¤§çš„ Runtimeï¼Œå½“è§‚å¯ŸæŸå¯¹è±¡ A æ—¶ï¼ŒKVO æœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªå¯¹è±¡Aå½“å‰ç±»çš„å­ç±»ï¼Œå¹¶ä¸ºè¿™ä¸ªæ–°çš„å­ç±»é‡å†™äº†è¢«è§‚å¯Ÿå±æ€§ keyPath çš„ setter æ–¹æ³•ã€‚setter æ–¹æ³•éšåè´Ÿè´£é€šçŸ¥è§‚å¯Ÿå¯¹è±¡å±æ€§çš„æ”¹å˜çŠ¶å†µã€‚ Apple ä½¿ç”¨äº† isa-swizzling æ¥å®ç° KVO ã€‚å½“è§‚å¯Ÿå¯¹è±¡Aæ—¶ï¼ŒKVOæœºåˆ¶åŠ¨æ€åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºï¼šNSKVONotifying_Açš„æ–°ç±»ï¼Œè¯¥ç±»ç»§æ‰¿è‡ªå¯¹è±¡Açš„æœ¬ç±»ï¼Œä¸” KVO ä¸º NSKVONotifying_A é‡å†™è§‚å¯Ÿå±æ€§çš„ setter æ–¹æ³•ï¼Œsetter æ–¹æ³•ä¼šè´Ÿè´£åœ¨è°ƒç”¨åŸ setter æ–¹æ³•ä¹‹å‰å’Œä¹‹åï¼Œé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿå¯¹è±¡å±æ€§å€¼çš„æ›´æ”¹æƒ…å†µã€‚ NSKVONotifying_A ç±»å‰–æ 12NSLog(@\"self-&gt;isa:%@\",self-&gt;isa); NSLog(@\"self class:%@\",[self class]); åœ¨å»ºç«‹KVOç›‘å¬å‰ï¼Œæ‰“å°ç»“æœä¸ºï¼š 12self-&gt;isa:Aself class:A åœ¨å»ºç«‹KVOç›‘å¬ä¹‹åï¼Œæ‰“å°ç»“æœä¸ºï¼š 12self-&gt;isa:NSKVONotifying_Aself class:A åœ¨è¿™ä¸ªè¿‡ç¨‹ï¼Œè¢«è§‚å¯Ÿå¯¹è±¡çš„ isa æŒ‡é’ˆä»æŒ‡å‘åŸæ¥çš„ A ç±»ï¼Œè¢«KVO æœºåˆ¶ä¿®æ”¹ä¸ºæŒ‡å‘ç³»ç»Ÿæ–°åˆ›å»ºçš„å­ç±»NSKVONotifying_A ç±»ï¼Œæ¥å®ç°å½“å‰ç±»å±æ€§å€¼æ”¹å˜çš„ç›‘å¬ï¼›æ‰€ä»¥å½“æˆ‘ä»¬ä»åº”ç”¨å±‚é¢ä¸Šçœ‹æ¥ï¼Œå®Œå…¨æ²¡æœ‰æ„è¯†åˆ°æœ‰æ–°çš„ç±»å‡ºç°ï¼Œè¿™æ˜¯ç³»ç»Ÿâ€œéšç’â€äº†å¯¹ KVO çš„åº•å±‚å®ç°è¿‡ç¨‹ï¼Œè®©æˆ‘ä»¬è¯¯ä»¥ä¸ºè¿˜æ˜¯åŸæ¥çš„ç±»ã€‚ä½†æ˜¯æ­¤æ—¶å¦‚æœæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ–°çš„åä¸ºâ€œNSKVONotifying_Aâ€çš„ç±»ï¼Œå°±ä¼šå‘ç°ç³»ç»Ÿè¿è¡Œåˆ°æ³¨å†Œ KVO çš„é‚£æ®µä»£ç æ—¶ç¨‹åºå°±å´©æºƒï¼Œå› ä¸ºç³»ç»Ÿåœ¨æ³¨å†Œç›‘å¬çš„æ—¶å€™åŠ¨æ€åˆ›å»ºäº†åä¸º NSKVONotifying_A çš„ä¸­é—´ç±»ï¼Œå¹¶æŒ‡å‘è¿™ä¸ªä¸­é—´ç±»äº†ã€‚ å­ç±»setteræ–¹æ³•å‰–æ KVO çš„é”®å€¼è§‚å¯Ÿé€šçŸ¥ä¾èµ–äº NSObject çš„ä¸¤ä¸ªæ–¹æ³•:willChangeValueForKey:å’Œ didChangeValueForKey: ï¼Œåœ¨å­˜å–æ•°å€¼çš„å‰ååˆ†åˆ«è°ƒç”¨ 2 ä¸ªæ–¹æ³•ï¼š è¢«è§‚å¯Ÿå±æ€§å‘ç”Ÿæ”¹å˜ä¹‹å‰ï¼ŒwillChangeValueForKey:è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥ keyPath çš„å±æ€§å€¼å³å°†å˜æ›´ å½“æ”¹å˜å‘ç”Ÿåï¼Œ didChangeValueForKey: è¢«è°ƒç”¨ï¼Œé€šçŸ¥ç³»ç»Ÿè¯¥keyPath çš„å±æ€§å€¼å·²ç»å˜æ›´ ä¹‹åï¼Œ observeValueForKey:ofObject:change:context:ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚ä¸”é‡å†™è§‚å¯Ÿå±æ€§çš„setter æ–¹æ³•è¿™ç§ç»§æ‰¿æ–¹å¼çš„æ³¨å…¥æ˜¯åœ¨è¿è¡Œæ—¶è€Œä¸æ˜¯ç¼–è¯‘æ—¶å®ç°çš„ã€‚ KVO ä¸ºå­ç±»çš„è§‚å¯Ÿè€…å±æ€§é‡å†™è°ƒç”¨å­˜å–æ–¹æ³•çš„å·¥ä½œåŸç†åœ¨ä»£ç ä¸­ç›¸å½“äºï¼š 12345- (void)setName:(NSString *)newName &#123; [self willChangeValueForKey:@\"name\"]; //KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹å‰æ€»è°ƒç”¨ [super setValue:newName forKey:@\"name\"]; //è°ƒç”¨çˆ¶ç±»çš„å­˜å–æ–¹æ³• [self didChangeValueForKey:@\"name\"]; //KVO åœ¨è°ƒç”¨å­˜å–æ–¹æ³•ä¹‹åæ€»è°ƒç”¨&#125; 3ï¼‰æ¶ˆæ¯è½¬å‘(çƒ­æ›´æ–°)ï¼šè§£å†³Bug(JSPatch) JSPatch æ˜¯ä¸€ä¸ª iOS åŠ¨æ€æ›´æ–°æ¡†æ¶ï¼Œåªéœ€åœ¨é¡¹ç›®ä¸­å¼•å…¥æå°çš„å¼•æ“ï¼Œå°±å¯ä»¥ä½¿ç”¨ JavaScript è°ƒç”¨ä»»ä½• Objective-C åŸç”Ÿæ¥å£ï¼Œè·å¾—è„šæœ¬è¯­è¨€çš„ä¼˜åŠ¿ï¼šä¸ºé¡¹ç›®åŠ¨æ€æ·»åŠ æ¨¡å—ï¼Œæˆ–æ›¿æ¢é¡¹ç›®åŸç”Ÿä»£ç åŠ¨æ€ä¿®å¤ bugã€‚ å…³äºæ¶ˆæ¯è½¬å‘ï¼Œå‰é¢å·²ç»è®²åˆ°è¿‡äº†ï¼Œæ¶ˆæ¯è½¬å‘åˆ†ä¸ºä¸‰çº§ï¼Œæˆ‘ä»¬å¯ä»¥åœ¨æ¯çº§å®ç°æ›¿æ¢åŠŸèƒ½ï¼Œå®ç°æ¶ˆæ¯è½¬å‘ï¼Œä»è€Œä¸ä¼šé€ æˆå´©æºƒã€‚JSPatchä¸ä»…èƒ½å¤Ÿå®ç°æ¶ˆæ¯è½¬å‘ï¼Œè¿˜å¯ä»¥å®ç°æ–¹æ³•æ·»åŠ ã€æ›¿æ¢èƒ½ä¸€ç³»åˆ—åŠŸèƒ½ã€‚ 4ï¼‰å®ç°NSCodingçš„è‡ªåŠ¨å½’æ¡£å’Œè‡ªåŠ¨è§£æ¡£ åŸç†æè¿°ï¼šç”¨runtimeæä¾›çš„å‡½æ•°éå†Modelè‡ªèº«æ‰€æœ‰å±æ€§ï¼Œå¹¶å¯¹å±æ€§è¿›è¡Œencodeå’Œdecodeæ“ä½œã€‚ æ ¸å¿ƒæ–¹æ³•ï¼šåœ¨Modelçš„åŸºç±»ä¸­é‡å†™æ–¹æ³•ï¼š 123456789101112131415161718192021- (id)initWithCoder:(NSCoder *)aDecoder &#123; if (self = [super init]) &#123; unsigned int outCount; Ivar * ivars = class_copyIvarList([self class], &amp;outCount); for (int i = 0; i &lt; outCount; i ++) &#123; Ivar ivar = ivars[i]; NSString * key = [NSString stringWithUTF8String:ivar_getName(ivar)]; [self setValue:[aDecoder decodeObjectForKey:key] forKey:key]; &#125; &#125; return self;&#125;- (void)encodeWithCoder:(NSCoder *)aCoder &#123; unsigned int outCount; Ivar * ivars = class_copyIvarList([self class], &amp;outCount); for (int i = 0; i &lt; outCount; i ++) &#123; Ivar ivar = ivars[i]; NSString * key = [NSString stringWithUTF8String:ivar_getName(ivar)]; [aCoder encodeObject:[self valueForKey:key] forKey:key]; &#125;&#125; 5ï¼‰å®ç°å­—å…¸å’Œæ¨¡å‹çš„è‡ªåŠ¨è½¬æ¢(MJExtension) åŸç†æè¿°ï¼šç”¨runtimeæä¾›çš„å‡½æ•°éå†Modelè‡ªèº«æ‰€æœ‰å±æ€§ï¼Œå¦‚æœå±æ€§åœ¨jsonä¸­æœ‰å¯¹åº”çš„å€¼ï¼Œåˆ™å°†å…¶èµ‹å€¼ã€‚ æ ¸å¿ƒæ–¹æ³•ï¼šåœ¨NSObjectçš„åˆ†ç±»ä¸­æ·»åŠ æ–¹æ³• 1234567891011121314151617181920212223242526272829303132- (instancetype)initWithDict:(NSDictionary *)dict &#123; if (self = [self init]) &#123; //(1)è·å–ç±»çš„å±æ€§åŠå±æ€§å¯¹åº”çš„ç±»å‹ NSMutableArray * keys = [NSMutableArray array]; NSMutableArray * attributes = [NSMutableArray array]; /* * ä¾‹å­ * name = value3 attribute = T@\"NSString\",C,N,V_value3 * name = value4 attribute = T^i,N,V_value4 */ unsigned int outCount; objc_property_t * properties = class_copyPropertyList([self class], &amp;outCount); for (int i = 0; i &lt; outCount; i ++) &#123; objc_property_t property = properties[i]; //é€šè¿‡property_getNameå‡½æ•°è·å¾—å±æ€§çš„åå­— NSString * propertyName = [NSString stringWithCString:property_getName(property) encoding:NSUTF8StringEncoding]; [keys addObject:propertyName]; //é€šè¿‡property_getAttributeså‡½æ•°å¯ä»¥è·å¾—å±æ€§çš„åå­—å’Œ@encodeç¼–ç  NSString * propertyAttribute = [NSString stringWithCString:property_getAttributes(property) encoding:NSUTF8StringEncoding]; [attributes addObject:propertyAttribute]; &#125; //ç«‹å³é‡Šæ”¾propertiesæŒ‡å‘çš„å†…å­˜ free(properties); //(2)æ ¹æ®ç±»å‹ç»™å±æ€§èµ‹å€¼ for (NSString * key in keys) &#123; if ([dict valueForKey:key] == nil) continue; [self setValue:[dict valueForKey:key] forKey:key]; &#125; &#125; return self;&#125; ä»¥ä¸Šå°±æ˜¯ Runtime çš„åº•å±‚åŸç†ï¼ŒRuntime ä¹Ÿå¯ä»¥è¯´æ˜¯å¾ˆå¤š iOS ç‰¹æ€§çš„åŠ¨æ•ˆæ”¯æ’‘ã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://juejin.im/post/5ac0a6116fb9a028de44d717","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šNamedTypes","slug":"iOS Principle NamedTypes","date":"2018-06-04T13:56:27.000Z","updated":"2018-11-16T13:10:20.545Z","comments":true,"path":"2018/06/04/iOS Principle NamedTypes/","link":"","permalink":"https://reversescale.github.io/2018/06/04/iOS Principle NamedTypes/","excerpt":"åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¸¸å¸¸éœ€è¦ç”¨åˆ°ç³»ç»Ÿæä¾›çš„åŸºç¡€ç±»å‹ä¹‹å¤–çš„çš„ç±»å‹ï¼ŒSwift ä½œä¸ºä¸€æ¬¾æˆé•¿ä¸­çš„è¯­è¨€ï¼Œè‡ªç„¶æ•é”çš„æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥ Swift å…è®¸æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„éœ€è¦æ„å»ºå±äºè‡ªå·±çš„ç±»å‹ç³»ç»Ÿï¼Œä»¥ä¾¿äºæ›´åŠ çµæ´»å’Œæ–¹ä¾¿çš„å¼€å‘ç¨‹åºå¹¶å…¶ç§°ä¹‹ä¸ºnamed types~","text":"åœ¨å¼€å‘è¿‡ç¨‹ä¸­å¸¸å¸¸éœ€è¦ç”¨åˆ°ç³»ç»Ÿæä¾›çš„åŸºç¡€ç±»å‹ä¹‹å¤–çš„çš„ç±»å‹ï¼ŒSwift ä½œä¸ºä¸€æ¬¾æˆé•¿ä¸­çš„è¯­è¨€ï¼Œè‡ªç„¶æ•é”çš„æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œæ‰€ä»¥ Swift å…è®¸æˆ‘ä»¬æ ¹æ®è‡ªå·±çš„éœ€è¦æ„å»ºå±äºè‡ªå·±çš„ç±»å‹ç³»ç»Ÿï¼Œä»¥ä¾¿äºæ›´åŠ çµæ´»å’Œæ–¹ä¾¿çš„å¼€å‘ç¨‹åºå¹¶å…¶ç§°ä¹‹ä¸ºnamed types~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿† Named types çš„å››ç§ç±»å‹ï¼šenumã€structã€classã€protocol enumï¼šå€¼ç±»å‹ï¼Œä¸€ç»„æœ‰é™ç§å¯èƒ½æ€§çš„ç›¸å…³å€¼æä¾›çš„é€šç”¨ç±»å‹ structï¼šå€¼ç±»å‹ï¼Œä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç±»å‹æˆ–ä¸åŒç±»å‹çš„æ•°æ®æ„æˆçš„æ•°æ®é›†åˆ classï¼šå¼•ç”¨ç±»å‹ï¼Œç±»å¯ç»§æ‰¿ï¼Œå…è®¸ç±»å‹è½¬æ¢ï¼Œæœ‰å¼•ç”¨è®¡æ•°ï¼Œææ„æ–¹æ³•é‡Šæ”¾èµ„æº protocolï¼šå¼•ç”¨ç±»å‹ï¼Œåè®®ä¸­æ²¡æœ‰å±æ€§å’Œæ–¹æ³•çš„å®ç°ï¼Œå¯ä»¥å½“åšç±»å‹æ¥ä½¿ç”¨ Named types çš„å››ç§ç±»å‹ enum struct class protocol ç›¸æ¯”äº Objective-C ä¸­çš„è¿™ä¸‰è€…ï¼ŒSwift å°† enum å’Œ struct å˜å¾—æ›´åŠ çµæ´»ä¸”å¼ºå¤§ï¼Œå¹¶ä¸”èµ‹äºˆäº†ä»–ä»¬å¾ˆå¤šå’Œclass ç›¸ä¼¼çš„å±æ€§å®ç°æ›´åŠ ä¸°å¯Œå¤šå½©çš„åŠŸèƒ½ã€‚ æœ¬æ–‡é‡ç‚¹ä»‹ç»åœ¨ Swift ä¸­ enum å’Œ struct çš„å®šä¹‰å’Œæ–°ç‰¹æ€§ä»¥åŠä¸¤è€…ä¸ class ä¹‹é—´çš„å¼‚åŒã€‚ æšä¸¾ï¼ˆenumï¼‰Swift ä¸­çš„æšä¸¾çš„å®šä¹‰ä¸Cå®¶æ—æœ‰äº›è®¸ä¸åŒï¼ŒSwift ä¸­æšä¸¾å®šä¹‰æ˜¯â€œä¸ºä¸€ç»„æœ‰é™ç§å¯èƒ½æ€§çš„ç›¸å…³å€¼æä¾›çš„é€šç”¨ç±»å‹â€ï¼Œè€Œåœ¨ C/C++/C# ä¸­ï¼Œâ€œæšä¸¾æ˜¯ä¸€ä¸ªè¢«å‘½åçš„æ•´å‹å¸¸æ•°çš„é›†åˆâ€ã€‚ ä½¿ç”¨æšä¸¾å¯ä»¥ç±»å‹å®‰å…¨å¹¶ä¸”æœ‰æç¤ºæ€§åœ°æ“ä½œè¿™äº›å€¼ã€‚ä¸ç»“æ„ä½“ã€ç±»ç›¸ä¼¼ï¼Œä½¿ç”¨å…³é”®è¯enumæ¥å®šä¹‰æšä¸¾ï¼Œå¹¶åœ¨ä¸€å¯¹å¤§æ‹¬å·å†…å®šä¹‰å…·ä½“å†…å®¹åŒ…æ‹¬ä½¿ç”¨caseå…³é”®å­—åˆ—ä¸¾æˆå‘˜ã€‚ å°±åƒä¸‹é¢ä¸€æ ·ï¼š 12345enum StudentType &#123; case pupils case middleSchoolStudent case collegeStudent&#125; ä¸Šé¢çš„ä»£ç å¯ä»¥è¯»ä½œï¼šå¦‚æœå­˜åœ¨ä¸€ä¸ªStudentTypeçš„å®ä¾‹ï¼Œä»–è¦ä¹ˆæ˜¯pupils ï¼ˆå°å­¦ç”Ÿï¼‰ã€è¦ä¹ˆæ˜¯middleSchoolStudentï¼ˆä¸­å­¦ç”Ÿï¼‰ã€è¦ä¹ˆæ˜¯collegeStudentï¼ˆå¤§å­¦ç”Ÿï¼‰ã€‚ å’ŒCã€objective-cä¸­æšä¸¾çš„ä¸åŒï¼ŒSwift ä¸­çš„æšä¸¾æˆå‘˜åœ¨è¢«åˆ›å»ºæ—¶ä¸ä¼šåˆ†é…ä¸€ä¸ªé»˜è®¤çš„æ•´æ•°å€¼ã€‚è€Œä¸”ä¸å¼ºåˆ¶è¦æ±‚ç»™æšä¸¾ä¸­çš„æ¯ä¸€ä¸ªæˆå‘˜éƒ½æä¾›å€¼ã€‚ å¦‚æœä¸€ä¸ªå€¼ï¼ˆæ‰€è°“â€œåŸå§‹å€¼â€ï¼‰è¦è¢«æä¾›ç»™æ¯ä¸€ä¸ªæšä¸¾æˆå‘˜ï¼Œé‚£ä¹ˆè¿™ä¸ªå€¼å¯ä»¥æ˜¯å­—ç¬¦ä¸²ã€å­—ç¬¦ã€ä»»æ„çš„æ•´æ•°å€¼ï¼Œæˆ–è€…æ˜¯æµ®ç‚¹ç±»å‹ã€‚ Swiftä¸­å®šä¹‰çš„æšä¸¾åªéœ€è¦å¸®åŠ©æˆ‘ä»¬è¡¨æ˜ä¸åŒçš„æƒ…å†µå°±å¤Ÿäº†ï¼Œä»–çš„æˆå‘˜å¯ä»¥æ²¡æœ‰å€¼ï¼Œä¹Ÿå¯ä»¥æœ‰å…¶ä»–ç±»å‹çš„å€¼ï¼Œä¸åƒ OC ä¸­æšä¸¾å€¼åªå±€é™äºæ•´æ•°ç±»å‹ï¼Œç¼ºç‚¹å°±æ˜¯ä½ å†å›å»å†™ OC æ—¶å¯èƒ½ä¼šä¸ä¹ æƒ¯ã€‚ æšä¸¾ä¸­æœ‰ä¸¤ä¸ªå¾ˆå®¹æ˜“æ··æ·†çš„æ¦‚å¿µï¼šåŸå§‹å€¼(raw value)ã€å…³è”å€¼(associated value)ï¼Œä¸¤ä¸ªè¯å¬èµ·æ¥æ¯”è¾ƒæ¨¡ç³Šï¼Œä¸‹é¢ç®€å•ä»‹ç»ä¸€ä¸‹ï¼š æšä¸¾çš„åŸå§‹å€¼(raw value) æšä¸¾æˆå‘˜å¯ä»¥ç”¨ç›¸åŒç±»å‹çš„é»˜è®¤å€¼é¢„å…ˆå¡«å……ï¼Œè¿™æ ·çš„å€¼æˆ‘ä»¬ç§°ä¸ºåŸå§‹å€¼(raw value)ã€‚ 123456//æšä¸¾çš„åŸå§‹å€¼(raw value)enum StudentType: Int&#123; case pupil = 10 case middleSchoolStudent = 15 case collegeStudents = 20&#125; ä¸Šé¢çš„StudentTypeä¸­ä¸‰ä¸ªæˆå‘˜åˆ†åˆ«è¢«Intç±»å‹çš„10 ã€15ã€ 20å¡«å……è¡¨ç¤ºä¸åŒé˜¶æ®µå­¦ç”Ÿçš„å¹´é¾„ã€‚ æ³¨æ„ï¼šIntä¿®é¥°çš„æ˜¯StudentTypeæˆå‘˜åŸå§‹å€¼çš„ç±»å‹è€Œä¸æ˜¯StudentTypeçš„ç±»å‹ï¼ŒStudentTypeç±»å‹ä»å®šä¹‰å¼€å§‹å°±æ˜¯ä¸€ä¸ªå…¨æ–°çš„æšä¸¾ç±»å‹ã€‚ 12345678910111213// å¸¸é‡student1å€¼æ˜¯ 10let student1 = StudentType.pupils.rawValueprint(\"student1:\\(student1)\")// å˜é‡student2å€¼æ˜¯ 15let student2 = StudentType.middleSchoolStudent.rawValueprint(\"student2:\\(student2)\")// ä½¿ç”¨æˆå‘˜rawValueå±æ€§åˆ›å»ºä¸€ä¸ª`StudentType`æšä¸¾çš„æ–°å®ä¾‹let student3 = StudentType.init(rawValue: 15)// student3çš„å€¼æ˜¯ Optional&lt;senson&gt;.Typeprint(\"student3:\\(type(of: student3))\")// student4çš„å€¼æ˜¯nilï¼Œå› ä¸ºå¹¶ä¸èƒ½é€šè¿‡æ•´æ•°30å¾—åˆ°ä¸€ä¸ªStudentTypeå®ä¾‹çš„å€¼let student4 = StudentType.init(rawValue: 30)print(\"student4:\\(student4)\") ä½¿ç”¨åŸå§‹å€¼åˆå§‹åŒ–å™¨è¿™ç§æ–¹å¼åˆå§‹åŒ–åˆ›å»ºå¾—åˆ°StudentTypeçš„å®ä¾‹student4æ˜¯ä¸€ä¸ªStudentTypeçš„å¯é€‰ç±»å‹ï¼Œå› ä¸ºå¹¶ä¸æ˜¯ç»™å®šä¸€ä¸ªå¹´é¾„å°±èƒ½æ‰¾åˆ°å¯¹åº”çš„å­¦ç”Ÿç±»å‹ï¼Œæ¯”å¦‚åœ¨StudentTypeä¸­ç»™å®šå¹´é¾„ä¸º30å°±æ‰¾ä¸åˆ°å¯¹åº”çš„å­¦ç”Ÿç±»å‹ï¼ˆå¾ˆå¯èƒ½30å²çš„äººå·²ç»æ˜¯åšå£«äº†ï¼‰ æ€»ä¹‹ï¼ŒåŸå§‹å€¼æ˜¯ä¸ºæšä¸¾çš„æˆå‘˜ä»¬ç»‘å®šäº†ä¸€ç»„ç±»å‹å¿…é¡»ç›¸åŒå€¼ä¸åŒçš„å›ºå®šçš„å€¼ï¼ˆå¯èƒ½æ˜¯æ•´å‹ï¼Œæµ®ç‚¹å‹ï¼Œå­—ç¬¦ç±»å‹ç­‰ç­‰ï¼‰ã€‚è¿™æ ·å¾ˆå¥½è§£é‡Šä¸ºä»€ä¹ˆæä¾›åŸå§‹å€¼çš„æ—¶å€™ç”¨çš„æ˜¯ç­‰å·ã€‚ æšä¸¾çš„å…³è”å€¼(associated value) å…³è”å€¼å’ŒåŸå§‹å€¼ä¸åŒï¼Œå…³è”å€¼æ›´åƒæ˜¯ä¸ºæšä¸¾çš„æˆå‘˜ä»¬ç»‘å®šäº†ä¸€ç»„ç±»å‹ï¼Œä¸åŒçš„æˆå‘˜å¯ä»¥æ˜¯ä¸åŒçš„ç±»å‹(æä¾›å…³è”å€¼æ—¶ç”¨çš„æ˜¯æ‹¬å·)ã€‚ä¾‹å¦‚ä¸‹é¢çš„ä»£ç ï¼š 1234567//æšä¸¾çš„å…³è”å€¼(associated value)//å®šä¹‰ä¸€ä¸ªè¡¨ç¤ºå­¦ç”Ÿç±»å‹çš„æšä¸¾ç±»å‹ StudentTypeï¼Œä»–æœ‰ä¸‰ä¸ªæˆå‘˜åˆ†åˆ«æ˜¯pupilsã€middleSchoolStudentã€collegeStudentsenum StudentTypeAssociated &#123; case pupils(String) case middleSchoolStudent(Int, String) case collegeStudents(Int, String)&#125; è¿™é‡Œæˆ‘ä»¬å¹¶æ²¡æœ‰ä¸ºStudentTypeçš„æˆå‘˜æä¾›å…·ä½“çš„å€¼ï¼Œè€Œæ˜¯ä¸ºä»–ä»¬ç»‘å®šäº†ä¸åŒçš„ç±»å‹ï¼Œåˆ†åˆ«æ˜¯pupilç»‘å®šStringç±»å‹ã€middleSchoolStudentå’ŒcollegeStudentsç»‘å®šï¼ˆIntï¼Œ Stringï¼‰å…ƒç¥–ç±»å‹ã€‚æ¥ä¸‹æ¥å°±å¯ä»¥åˆ›å»ºä¸åŒStudentTypeæšä¸¾å®ä¾‹å¹¶ä¸ºå¯¹åº”çš„æˆå‘˜èµ‹å€¼äº†ã€‚ 123456789//student1 æ˜¯ä¸€ä¸ªStudentTypeç±»å‹çš„å¸¸é‡ï¼Œå…¶å€¼ä¸ºpupilï¼ˆå°å­¦ç”Ÿï¼‰ï¼Œç‰¹å¾æ˜¯\"have fun\"ï¼ˆæ€»æ˜¯åœ¨ç©è€ï¼‰let student1 = StudentTypeAssociated.pupils(\"have fun\")print(\"student1:\\(student1)\")//student2 æ˜¯ä¸€ä¸ªStudentTypeç±»å‹çš„å¸¸é‡ï¼Œå…¶å€¼ä¸ºmiddleSchoolStudentï¼ˆä¸­å­¦ç”Ÿï¼‰ï¼Œç‰¹å¾æ˜¯ 7, \"always study\"ï¼ˆä¸€å‘¨7å¤©æ€»æ˜¯åœ¨å­¦ä¹ ï¼‰let student2 = StudentTypeAssociated.middleSchoolStudent(7, \"always study\")print(\"student2:\\(student2)\")//student3 æ˜¯ä¸€ä¸ªStudentTypeç±»å‹çš„å¸¸é‡ï¼Œå…¶å€¼ä¸ºcollegeStudentï¼ˆå¤§å­¦ç”Ÿï¼‰ï¼Œç‰¹å¾æ˜¯ 7, \"always LOL\"ï¼ˆä¸€å‘¨7å¤©æ€»æ˜¯åœ¨æ’¸å•Šæ’¸ï¼‰let student3 = StudentTypeAssociated.middleSchoolStudent(7, \"always LOL\")print(\"student3:\\(student3)\") è¿™ä¸ªæ—¶å€™å¦‚æœéœ€è¦åˆ¤æ–­æŸä¸ªStudentTypeå®ä¾‹çš„å…·ä½“çš„å€¼å°±éœ€è¦è¿™æ ·åšäº†ï¼š 12345678switch student3 &#123; case .pupils(let things): print(\"is a pupil and \\(things)\") case .middleSchoolStudent(let day, let things): print(\"is a middleSchoolStudent and \\(day) days \\(things)\") case .collegeStudents(let day, let things): print(\"is a collegeStudent and \\(day) days \\(things)\")&#125; æ§åˆ¶å°è¾“å‡ºï¼šis a collegeStudent and 7 days always LOLï¼Œçœ‹åˆ°è¿™ä½ å¯èƒ½ä¼šæƒ³ï¼Œæ˜¯å¦å¯ä»¥ä¸ºä¸€ä¸ªæšä¸¾æˆå‘˜æä¾›åŸå§‹å€¼å¹¶ä¸”ç»‘å®šç±»å‹å‘¢ï¼Œç­”æ¡ˆæ˜¯ä¸èƒ½çš„ï¼å› ä¸ºé¦–å…ˆç»™æˆå‘˜æä¾›äº†å›ºå®šçš„åŸå§‹å€¼ï¼Œé‚£ä»–ä»¥åå°±ä¸èƒ½æ”¹å˜äº†ï¼›è€Œä¸ºæˆå‘˜æä¾›å…³è”å€¼(ç»‘å®šç±»å‹)å°±æ˜¯ä¸ºäº†åˆ›å»ºæšä¸¾å®ä¾‹çš„æ—¶å€™èµ‹å€¼ã€‚ é€’å½’æšä¸¾ é€’å½’æšä¸¾æ˜¯æ‹¥æœ‰å¦ä¸€ä¸ªæšä¸¾ä½œä¸ºæšä¸¾æˆå‘˜å…³è”å€¼çš„æšä¸¾ã€‚ å…³äºé€’å½’æšä¸¾æˆ‘ä»¬å¯ä»¥æ‹†å°æˆä¸¤ä¸ªæ¦‚å¿µæ¥çœ‹ï¼šé€’å½’ + æšä¸¾ã€‚é€’å½’æ˜¯æŒ‡åœ¨ç¨‹åºè¿è¡Œä¸­å‡½æ•°ï¼ˆæˆ–æ–¹æ³•ï¼‰ç›´æ¥æˆ–é—´æ¥è°ƒç”¨è‡ªå·±çš„è¿™æ ·ä¸€ç§æ–¹å¼ï¼Œå…¶ç‰¹ç‚¹ä¸ºé‡å¤æœ‰é™ä¸ªæ­¥éª¤ã€æ ¼å¼è¾ƒä¸ºç®€å•ã€‚ ä¸‹é¢æ˜¯ä¸€ä¸ªç»å…¸çš„é€šè¿‡é€’å½’ç®—æ³•æ±‚è§£n!ï¼ˆé˜¶ä¹˜ï¼‰çš„å‡½æ•°ã€‚ 123456789func factorial(n: Int)-&gt;Int &#123; if n &gt; 0 &#123; return n * factorial(n: n - 1) &#125; else &#123; return 1 &#125;&#125; //1 * 2 * 3 * 4 * 5 * 6 = 720 let sum = factorial(n: 6) å‡½æ•°factorial (n: int)-&gt; Intåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¾ˆæ˜æ˜¾çš„è°ƒç”¨äº†è‡ªèº«ã€‚ç»“åˆæšä¸¾çš„æ¦‚å¿µæˆ‘ä»¬è¿™é‡Œå¯ä»¥ç®€å•çš„ç†è§£ä¸ºé€’å½’æšä¸¾ç±»ä¼¼ä¸Šé¢å°†æšä¸¾å€¼æœ¬èº«ä¼ å…¥ç»™æˆå‘˜å»åˆ¤æ–­çš„æƒ…å†µã€‚ å¯ä»¥çœ‹å‡ºSwiftä¸­æšä¸¾å˜å¾—æ›´åŠ çµæ´»å’Œå¤æ‚ï¼Œæœ‰é€’å½’æšä¸¾çš„æ¦‚å¿µï¼Œè¿˜æœ‰å¾ˆå¤šå’Œç±»ç±»ä¼¼çš„ç‰¹æ€§ï¼Œæ¯”å¦‚ï¼šè®¡ç®—å±æ€§ç”¨æ¥æä¾›å…³äºæšä¸¾å½“å‰å€¼çš„é¢å¤–ä¿¡æ¯ï¼›å®ä¾‹æ–¹æ³•æä¾›ä¸æšä¸¾è¡¨ç¤ºå€¼ç›¸å…³çš„åŠŸèƒ½ï¼›å®šä¹‰åˆå§‹åŒ–å™¨æ¥åˆå§‹åŒ–æˆå‘˜å€¼ï¼›è€Œä¸”èƒ½å¤Ÿéµå¾ªåè®®æ¥æä¾›æ ‡å‡†åŠŸèƒ½ç­‰ç­‰ã€‚ ç»“æ„ä½“ï¼ˆstructï¼‰ç»“æ„ä½“æ˜¯ç”±ä¸€ç³»åˆ—å…·æœ‰ç›¸åŒç±»å‹æˆ–ä¸åŒç±»å‹çš„æ•°æ®æ„æˆçš„æ•°æ®é›†åˆã€‚ç»“æ„ä½“æ˜¯ä¸€ç§å€¼ç±»å‹çš„æ•°æ®ç»“æ„ï¼Œåœ¨Swiftä¸­å¸¸å¸¸ä½¿ç”¨ç»“æ„ä½“å°è£…ä¸€äº›å±æ€§ç”šè‡³æ˜¯æ–¹æ³•æ¥ç»„æˆæ–°çš„å¤æ‚ç±»å‹ï¼Œç›®çš„æ˜¯ç®€åŒ–è¿ç®—ã€‚ å®šä¹‰å¥½çš„ç»“æ„ä½“å­˜åœ¨ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜åˆå§‹åŒ–å™¨ï¼Œä½¿ç”¨å®ƒæ¥åˆå§‹åŒ–ç»“æ„ä½“å®ä¾‹çš„æˆå‘˜å±æ€§ã€‚ 12345struct Student &#123; var chinese: Int var math: Int var english: Int&#125; çœ‹åˆ°æœ¨æœ‰ï¼Œå®šä¹‰ç»“æ„ä½“ç±»å‹æ—¶å…¶æˆå‘˜å¯ä»¥æ²¡æœ‰åˆå§‹å€¼ï¼Œè¦æ˜¯ç±»é‚£ä¸ªå‘è´§æ—©æŠ¥é”™äº†â€¦(æé†’è¿™ä¸ªç±»æ²¡æœ‰è¢«åˆå§‹åŒ–) ç»“æ„ä½“å®ä¾‹çš„åˆ›å»º åˆ›å»ºç»“æ„ä½“å’Œç±»çš„å®ä¾‹çš„è¯­æ³•éå¸¸ç›¸ä¼¼ï¼Œç»“æ„ä½“å’Œç±»ä¸¤è€…éƒ½èƒ½ä½¿ç”¨åˆå§‹åŒ–å™¨è¯­æ³•æ¥ç”Ÿæˆæ–°çš„å®ä¾‹ã€‚ æœ€ç®€å•çš„è¯­æ³•æ˜¯åœ¨ç±»æˆ–ç»“æ„ä½“åå­—åé¢æ¥ä¸€ä¸ªç©ºçš„åœ†æ‹¬å·ï¼Œä¾‹å¦‚: 1let student1 = Student() è¿™æ ·å°±åˆ›å»ºäº†ä¸€ä¸ªæ–°çš„ç±»æˆ–è€…ç»“æ„ä½“çš„å®ä¾‹ï¼Œä»»ä½•æˆå‘˜éƒ½è¢«åˆå§‹åŒ–ä¸ºå®ƒä»¬çš„é»˜è®¤å€¼ï¼ˆå‰ææ˜¯æˆå‘˜å‡æœ‰é»˜è®¤å€¼ï¼‰ã€‚ ä½†æ˜¯å¦‚æœå®šä¹‰ç»“æ„ä½“æ—¶æ²¡æœ‰è®¾ç½®åˆå§‹å€¼ï¼Œåƒä¸Šé¢ç›´æ¥()çš„å†™æ³•ç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼ˆå‡ºæ¥æ··è¿Ÿæ—©æ˜¯è¦ç»™åˆå§‹å€¼çš„ï¼‰ 12//ä½¿ç”¨Studentç±»å‹çš„ç»“æ„ä½“åˆ›å»ºStudentç±»å‹çš„å®ä¾‹ï¼ˆå˜é‡æˆ–å¸¸é‡ï¼‰å¹¶åˆå§‹åŒ–ä¸‰ä¸ªæˆå‘˜ï¼ˆè¿™ä¸ªå­¦ç”Ÿçš„æˆç»©ä¼šä¸ä¼šå¤ªå¥½äº†ç‚¹ï¼‰let student2 = Student(chinese: 90, math: 80, english: 70) æ‰€æœ‰çš„ç»“æ„ä½“éƒ½æœ‰ä¸€ä¸ªè‡ªåŠ¨ç”Ÿæˆçš„æˆå‘˜åˆå§‹åŒ–å™¨ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒæ¥åˆå§‹åŒ–æ–°ç»“æ„ä½“å®ä¾‹çš„æˆå‘˜å°±åƒä¸Šé¢ä¸€æ ·ï¼ˆå‰ææ˜¯æ²¡æœ‰è‡ªå®šä¹‰çš„åˆå§‹åŒ–å™¨ï¼‰ã€‚å¦‚æœæˆ‘ä»¬åœ¨å®šä¹‰Studentæ—¶ä¸ºä»–çš„æˆå‘˜èµ‹ä¸Šåˆå€¼ï¼Œé‚£ä¹ˆä¸‹é¢çš„ä»£ç æ˜¯ç¼–è¯‘é€šè¿‡çš„ï¼š 1234567struct Students &#123; var chinese: Int = 50 var math: Int = 50 var english: Int = 50&#125;let student3 = Students()print(\"student3:\\(student3)\") æ€»ä¹‹ï¼Œå®šä¹‰ç»“æ„ä½“ç±»å‹æ—¶å…¶æˆå‘˜å¯ä»¥æ²¡æœ‰åˆå§‹å€¼ï¼Œä½†æ˜¯åˆ›å»ºç»“æ„ä½“å®ä¾‹æ—¶è¯¥å®ä¾‹çš„æˆå‘˜å¿…é¡»æœ‰åˆå€¼ã€‚ è‡ªå®šä¹‰çš„åˆå§‹åŒ–å™¨ å½“æˆ‘ä»¬æƒ³è¦ä½¿ç”¨è‡ªå·±çš„æ–¹å¼å»åˆå§‹åŒ–åˆ›å»ºä¸€ä¸ªStudentç±»å‹çš„å®ä¾‹æ—¶ï¼Œç³»ç»Ÿæä¾›çš„æˆå‘˜åˆå§‹åŒ–å™¨å¯èƒ½å°±ä¸å¤Ÿç”¨äº†ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¸Œæœ›é€šè¿‡å¦‚ä¸‹æ–¹å¼åˆ›å»ºå®ä¾‹æ—¶ï¼Œå°±éœ€è¦è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³•äº†ï¼š 1let student5 = Student(stringScore: \"70,80,90\") è‡ªå®šä¹‰åˆå§‹åŒ–æ–¹æ³• 1234567891011121314151617181920struct Student &#123; var chinese: Int = 50 var math: Int = 50 var english: Int = 50 init() &#123;&#125; init(chinese: Int, math: Int, english: Int) &#123; self.chinese = chinese self.math = math self.english = english &#125; init(stringScore: String) &#123; let cme = stringScore.characters.split(separator: \",\") chinese = Int(atoi(String(cme.first!))) math = Int(atoi(String(cme[1]))) english = Int(atoi(String(cme.last!))) &#125;&#125;let student6 = Student()let student7 = Student(chinese: 90, math: 80, english: 70)let student8 = Student(stringScore: \"70,80,90\") ä¸€æ—¦æˆ‘ä»¬è‡ªå®šä¹‰äº†åˆå§‹åŒ–å™¨ï¼Œç³»ç»Ÿè‡ªåŠ¨çš„åˆå§‹åŒ–å™¨å°±ä¸èµ·ä½œç”¨äº†ï¼Œå¦‚æœè¿˜éœ€è¦ä½¿ç”¨åˆ°ç³»ç»Ÿæä¾›çš„åˆå§‹åŒ–å™¨ï¼Œåœ¨æˆ‘ä»¬è‡ªå®šä¹‰åˆå§‹åŒ–å™¨åå°±å¿…é¡»æ˜¾å¼çš„å®šä¹‰å‡ºæ¥ã€‚ å®šä¹‰å…¶ä»–æ–¹æ³• å¦‚æœæ­¤æ—¶éœ€è¦ä¿®æ”¹æŸä¸ªå­¦ç”ŸæŸç§‘çš„æˆç»©ï¼Œè¯¥å¦‚ä½•å®ç°å‘¢ï¼Ÿå¯ä»¥å®šä¹‰ä¸‹é¢çš„æ–¹æ³•ï¼š 12345//æ›´æ”¹æŸä¸ªå­¦ç”ŸæŸé—¨å­¦ç§‘çš„æˆç»©func changeChinese(num: Int, student: inout Student)&#123; student.chinese += num&#125;changeChinese(num: 20, student: &amp;student7) æ­¤æ—¶student7çš„è¯­æ–‡æˆç»©å°±ç”±åŸæ¥çš„70è¢«ä¿®æ”¹åˆ°äº†90 ä½†æ˜¯æ­¤æ–¹æ³•æœ‰ä¸¤ä¸ªæ˜æ˜¾çš„å¼Šç«¯ï¼š 1.å­¦ç”Ÿçš„è¯­æ–‡æˆç»©chineseæ˜¯Studentç»“æ„ä½“çš„å†…éƒ¨æˆå‘˜ï¼Œä¸€ä¸ªå­¦ç”Ÿçš„æŸç§‘æˆç»©æ— éœ€è¢«Studentçš„ä½¿ç”¨è€…äº†è§£ã€‚å³æˆ‘ä»¬åªå…³å¿ƒå­¦ç”Ÿçš„è¯­æ–‡æˆç»©æ›´æ”¹äº†å¤šå°‘ï¼Œè€Œä¸æ˜¯å…³å¿ƒå­¦ç”Ÿè¯­æ–‡æˆç»©æœ¬èº«æ˜¯å¤šå°‘ã€‚ 2.æ›´æ”¹ä¸€ä¸ªå­¦ç”Ÿçš„è¯­æ–‡æˆç»©æœ¬èº«å°±æ˜¯å’ŒStudentç»“æ„ä½“å†…éƒ¨æˆå‘˜è®¡ç®—ç›¸å…³çš„äº‹æƒ…ï¼Œæˆ‘ä»¬æ›´å¸Œæœ›è¾¾åˆ°å¦‚ä¸‹å½¢å¦‚ï¼š 1student7.changeChinese(num: 10) å› ä¸ºåªæœ‰å­¦ç”Ÿæœ¬èº«æ¸…æ¥šè‡ªå·±éœ€è¦å°†è¯­æ–‡æˆç»©æ›´æ”¹å¤šå°‘ï¼ˆæ›´åƒæ˜¯é¢å‘å¯¹è±¡å°è£…çš„æ€æƒ³ï¼‰ã€‚å¾ˆæ˜æ˜¾æ­¤æ—¶changeChinese(num:)æ–¹æ³•æ˜¯Studentç»“æ„ä½“å†…éƒ¨çš„æ–¹æ³•è€Œä¸æ˜¯å¤–éƒ¨çš„æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘å®šä¹‰äº†ä¸€ä¸ªä¿®æ”¹æŸä¸ªå­¦ç”Ÿæ•°å­¦æˆç»©çš„å†…éƒ¨æ–¹æ³•ç”¨äºå’Œä¹‹å‰ä¿®æ”¹è¯­æ–‡æˆç»©çš„å¤–éƒ¨æ–¹æ³•å¯¹æ¯”ï¼š 123456789101112struct Studentes &#123; var chinese: Int = 50 var math: Int = 50 var english: Int = 50 //ä¿®æ”¹æ•°å­¦æˆç»© mutating func changeMath(num: Int) &#123; self.math += num &#125;&#125;var student7 = Studentes(chinese: 20, math: 30, english: 40)student7.changeMath(num: 10)print(\"student7:\\(student7)\") è¿è¡Œç»“æœï¼š å°½ç®¡ä¸¤è€…éƒ½èƒ½è¾¾åˆ°åŒæ ·çš„æ•ˆæœï¼Œä½†æ˜¯æŠŠä¿®æ”¹ç»“æ„ä½“æˆå‘˜çš„æ–¹æ³•å®šä¹‰åœ¨ç»“æ„ä½“å†…éƒ¨æ˜¾å¾—æ›´åŠ åˆç†åŒæ—¶æ»¡è¶³é¢å‘å¯¹è±¡å°è£…çš„ç‰¹ç‚¹ã€‚ä»¥ä¸Šä¸¤ç‚¹å°±æ˜¯æˆ‘ä»¬ä¸ºStudentç»“æ„ä½“å†…éƒ¨æ·»åŠ changeMath(num:)çš„åŸå› ï¼Œä»–è®©æˆ‘ä»¬æŠŠç±»å‹ç›¸å…³çš„è®¡ç®—è¡¨ç°çš„æ›´åŠ è‡ªç„¶å’Œç»Ÿä¸€ï¼Œå³è‡ªå·±çš„äº‹æƒ…åº”è¯¥ç”¨è‡ªå·±çš„æ–¹æ³•å®ç°ä¸åº”è¯¥è¢«åˆ«äººå…³å¿ƒã€‚ å€¼å¾—ä¸€æçš„æ˜¯åœ¨ç»“æ„ä½“å†…éƒ¨æ–¹æ³•ä¸­å¦‚æœä¿®æ”¹äº†ç»“æ„ä½“çš„æˆå‘˜ï¼Œé‚£ä¹ˆè¯¥æ–¹æ³•ä¹‹å‰åº”è¯¥åŠ å…¥ï¼šmutatingå…³é”®å­—ã€‚ç”±äºç»“æ„ä½“æ˜¯å€¼ç±»å‹ï¼ŒSwiftè§„å®šä¸èƒ½ç›´æ¥åœ¨ç»“æ„ä½“çš„æ–¹æ³•ï¼ˆåˆå§‹åŒ–å™¨é™¤å¤–ï¼‰ä¸­ä¿®æ”¹æˆå‘˜ã€‚åŸå› å¾ˆç®€å•ï¼Œç»“æ„ä½“ä½œä¸ºå€¼çš„ä¸€ç§è¡¨ç°ç±»å‹æ€ä¹ˆèƒ½æä¾›æ”¹å˜è‡ªå·±å€¼çš„æ–¹æ³•å‘¢ï¼Œä½†æ˜¯ä½¿ç”¨mutatingæˆ‘ä»¬ä¾¿å¯ä»¥åŠåˆ°è¿™ç‚¹ï¼Œå½“ç„¶è¿™ä¹Ÿæ˜¯å’Œç±»çš„ä¸åŒç‚¹ã€‚ å¸¸è§çš„ç»“æ„ä½“ Swiftä¸­å¾ˆå¤šçš„åŸºç¡€æ•°æ®ç±»å‹éƒ½æ˜¯ç»“æ„ä½“ç±»å‹ï¼Œä¸‹é¢åˆ—ä¸¾çš„æ˜¯ä¸€äº›å¸¸ç”¨çš„ç»“æ„ä½“ç±»å‹ï¼š 12345678//è¡¨ç¤ºæ•°å€¼ç±»å‹çš„ç»“æ„ä½“ï¼šIntï¼ŒFloatï¼ŒDoubleï¼ŒCGFloat...//è¡¨ç¤ºå­—ç¬¦å’Œå­—ç¬¦ä¸²ç±»å‹çš„ç»“æ„ä½“Characterï¼ŒString...//ä½ç½®å’Œå°ºå¯¸çš„ç»“æ„ä½“CGPointï¼ŒCGSize...//é›†åˆç±»å‹ç»“æ„ä½“Arrayï¼ŒSetï¼ŒDictionary... å¾ˆå¤šæ—¶å€™ä½ ä¸ç»†å¿ƒè§‚å¯Ÿçš„è¯å¯èƒ½ä¸ä¼šæƒ³åˆ°è‡ªå·±ä¿¡æ‰‹æ‹ˆæ¥çš„ä»£ç ä¸­å±…ç„¶è—äº†è¿™ä¹ˆå¤šç»“æ„ä½“ã€‚å¦å¤–æœ‰æ—¶å€™åœ¨ä½¿ç”¨ç±»å’Œç»“æ„ä½“çš„æ—¶å€™ä¼šå‡ºç°ä¸‹é¢çš„æƒ…å†µ ç±»æ–¹æ³•ï¼š123456789// Person ç±»class Person &#123; var name: String = \"jack\" let life: Int = 1&#125;var s1 = Person()var s2 = s1s2.name = \"mike\"s1 ç»“æ„ä½“æ–¹æ³•ï¼š123456789// People ç»“æ„ä½“æ•°æ®ç»“æ„struct People &#123; var name: String = \"jack\" let life: Int = 1&#125;var p1 = People()var p2 = p1p2.name = \"mike\"p1 ç»†å¿ƒçš„åŒå­¦å¯èƒ½å·²ç»å‘ç°äº†å…¶ä¸­çš„è¯¡å¼‚ã€‚å˜é‡s1ã€s2æ˜¯Personç±»çš„å®ä¾‹ï¼Œä¿®æ”¹äº†s2çš„nameå±æ€§ï¼Œs1çš„nameä¹Ÿä¼šæ”¹å˜ï¼›è€Œp1ã€p2ä½œä¸ºPeopleç»“æ„ä½“çš„å®ä¾‹ï¼Œä¿®æ”¹äº†p1çš„nameå±æ€§ï¼Œp2çš„nameå¹¶ä¸ä¼šå‘ç”Ÿæ”¹å˜ã€‚è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ ç±»èƒ½å¤Ÿæ”¹å˜æ˜¯å› ä¸ºï¼Œç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œå†…éƒ¨åšæµ…æ‹·è´å¤„ç†ï¼Œæœ¬è´¨æ˜¯æŒ‡å‘åŒä¸€ä¸ªå¯¹è±¡ï¼Œè‡ªç„¶å¯ä»¥æ”¹nameï¼›ç»“æ„ä½“ä¹‹å‰å·²ç»è¯´è¿‡æ˜¯å€¼ç±»å‹ï¼Œå†…éƒ¨åšæ·±æ‹·è´å¤„ç†ï¼Œä¼šé‡æ–°ç”Ÿæˆä¸€ä¸ªå¯¹è±¡ï¼Œåœ¨å¤åˆ¶æ—¶ä¿®æ”¹ä¸€ä¸ªå®ä¾‹çš„æ•°æ®å¹¶ä¸å½±å“å‰¯æœ¬çš„æ•°æ®ã€‚ æ€§èƒ½å¯¹æ¯”å…¶å®æœ¬è´¨æ˜¯å¯¹æ¯”å€¼ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„æ€§èƒ½ï¼Œå› æ­¤æ“‚å°ä¸Šçš„é€‰æ‰‹å°±æ˜¯ç»“æ„ä½“ï¼ˆstructï¼‰å’Œç±»ï¼ˆclassï¼‰ã€‚ æµ‹è¯•1: å¾ªç¯åˆ›å»ºç±»å’Œç»“æ„ä½“a.æ‰§è¡Œ1äº¿æ¬¡ç±»åˆ›å»º 12345678910111213// å®šä¹‰ç±»class StudentC&#123; var name:String init(name:String) &#123; self.name = name &#125;&#125;// ç»Ÿè®¡æ—¶é—´let date = Date()for i in 0...100_000_000&#123; let s = StudentC(name: \"é…·èµ°å¤©æ¶¯\")&#125;print(Date().timeIntervalSince(date)) è¿è¡Œä¸‰æ¬¡ç»“æœ: 19.392848014831520.991949281292120.7549253872943 b.æ‰§è¡Œ10äº¿æ¬¡ç»“æ„ä½“åˆ›å»º 123456789101112// å®šä¹‰ç»“æ„ä½“struct StudentS&#123; var name:String init( name:String) &#123; self.name = name &#125;&#125;let date = Date()for i in 0...1000_000_000&#123; let s = StudentS(name: \"é…·èµ°å¤©æ¶¯\")&#125;print(Date().timeIntervalSince(date)) è¿è¡Œä¸‰æ¬¡ç»“æœ: 9.9922145421245510.928164827391710.7281881727434 æˆ‘ä»¬ä¸Šé¢çš„å±æ€§ä¸ºåŸºæœ¬æ•°æ®ç±»å‹,æˆ‘ä»¬å°†å±æ€§æ”¹ä¸ºå¯¹è±¡æµ‹è¯•ä¸€ä¸‹é€Ÿåº¦ c.åˆ›å»º10_000_000ä¸ªå¯¹è±¡ 123456class StudentC&#123; var date = NSDate()&#125;for i in 0...10_000_000&#123; let s = StudentS()&#125; æµ‹è¯•ç»“æœ: 6.385093986988076.436492025852226.39519000053406 d.åˆ›å»º10_000_000ä¸ªç»“æ„ä½“å®ä¾‹ 123456struct StudentS&#123; var date = NSDate()&#125;for i in 0...10_000_000&#123; let s = StudentS()&#125; æµ‹è¯•ç»“æœ: 4.385093986988074.436492025852224.39519000053406 ç»“è®ºï¼šåˆ›å»ºç»“æ„ä½“è¦æ¯”åˆ›å»ºå¯¹è±¡é€Ÿåº¦å¿« æµ‹è¯•2:åˆ›å»º1000_000 ä¸ªå¯¹è±¡æˆ–è€…ç»“æ„ä½“æ”¾åœ¨æ•°ç»„ä¸­,æŸ¥çœ‹å†…å­˜å ç”¨ç‡a.å¾ªç¯åˆ›å»º1000_000ä¸ªå¯¹è±¡ 123456789101112class StudentC&#123; var name:String init( name:String) &#123; self.name = name &#125;&#125;var students:[StudentC] = []// åˆ›å»ºfor i in 0...1000_000&#123;let s = StudentC(name: \"é…·èµ°å¤©æ¶¯\")students.append(s)&#125; è¿è¡Œç»“æœ: å†…å­˜å ç”¨61.8MB b.å¾ªç¯åˆ›å»º1000_000ä¸ªç»“æ„ä½“ 1234567891011struct StudentS&#123; var name:String init( name:String) &#123; self.name = name &#125;&#125;var students:[StudentS] = []for i in 0...1000_000&#123;let s = StudentS(name: \"é…·èµ°å¤©æ¶¯\")students.append(s)&#125; è¿è¡Œç»“æœ: å†…å­˜å ç”¨32.6MB ç…§æ ·,æˆ‘ä»¬å°†åŸºæœ¬å±æ€§æ”¹ä¸ºå¯¹è±¡ç»§ç»­æµ‹è¯• c.10_000_000 ä¸ªå¯¹è±¡æ·»åŠ åˆ°æ•°ç»„ä¸­ 12345678class StudentC&#123; var date = NSDate()&#125;var students:[StudentC] = []for i in 0...10_000_000&#123; let s = StudentC() students.append(s)&#125; æµ‹è¯•ç»“æœ: å å†…å­˜538.7MB d.10_000_000 ä¸ªç»“æ„ä½“æ·»åŠ åˆ°æ•°ç»„ä¸­ 1234567struct StudentS&#123; var date = NSDate()&#125;for i in 0...10_000_000&#123; let s = StudentS() students.append(s)&#125; æµ‹è¯•ç»“æ„: å ç”¨225.7MB ç»“è®ºï¼šåˆ›å»ºç›¸åŒå±æ€§çš„ç»“æ„ä½“æ¯”ç±»æ›´åŠ èŠ‚çœå†…å­˜ æµ‹è¯•3:å¯¹1_000_000ä¸ªç»“æ„ä½“å®ä½“å’Œå¯¹è±¡è¿›è¡Œæ’åº,æµ‹æ¶ˆè€—æ—¶é—´a.å¯¹1_000_000ä¸ªç»“æ„ä½“å®ä½“è¿›è¡Œæ’åº 12345let date = Date()students.sort &#123; (stu1, stu2) -&gt; Bool in return stu1.name &gt; stu2.name&#125;print(Date().timeIntervalSince(date)) è¿è¡Œç»“æœ: 13.378394961357113.6793909668922 b.å¯¹1_000_000ä¸ªå¯¹è±¡è¿›è¡Œæ’åº 12345let date = Date()students.sort &#123; (stu1, stu2) -&gt; Bool in return stu1.name &gt; stu2.name&#125;print(Date().timeIntervalSince(date)) è¿è¡Œç»“æœ: 6.708819985389716.60394102334976 ç»“è®º: åœ¨æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ’åºä¸­,ç»“æ„ä½“æ’åºçš„é€Ÿåº¦æ¯”è¾ƒæ…¢,å› ä¸ºç»“æ„ä½“æ˜¯å€¼ç±»å‹,æ’åºçš„æ—¶å€™,éœ€è¦å¤§é‡çš„èµ‹å€¼è¿ç®—ã€‚è€Œå¯¹è±¡åªéœ€è¦äº¤æ¢åœ°å€å³å¯ã€‚ å¯¹æ¯”æ€»ç»“æšä¸¾ã€ç»“æ„ä½“ã€ç±»çš„å…±åŒç‚¹ï¼š å®šä¹‰å±æ€§å’Œæ–¹æ³•ï¼› ä¸‹æ ‡è¯­æ³•è®¿é—®å€¼ï¼› åˆå§‹åŒ–å™¨ï¼› æ”¯æŒæ‰©å±•å¢åŠ åŠŸèƒ½ï¼› å¯ä»¥éµå¾ªåè®®ï¼› ç»“æ„ä½“ã€ç±»çš„ä¸åŒç‚¹ï¼š ç±»å¯ä»¥ç»§æ‰¿,ç»“æ„ä½“ä¸èƒ½ç»§æ‰¿ï¼› ç±»èƒ½å¤Ÿåœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œè§£é‡Šç±»å®ä¾‹çš„ç±»å‹ï¼› Deinitializersä½¿ä¸€ä¸ªç±»çš„å®ä¾‹æ¥é‡Šæ”¾ä»»ä½•èµ„æºåˆ†é…ï¼› ç±»æœ‰å¼•ç”¨è®¡æ•°,å…è®¸å¯¹è±¡è¢«å¤šæ¬¡å¼•ç”¨ï¼› ç±»ç‰¹æœ‰çš„åŠŸèƒ½ï¼š ç»§æ‰¿ï¼› å…è®¸ç±»å‹è½¬æ¢ï¼› ææ„æ–¹æ³•é‡Šæ”¾èµ„æºï¼› å¼•ç”¨è®¡æ•°ï¼› å¦‚ä½•é€‰æ‹©ä½¿ç”¨ï¼šå½“ä½ ä½¿ç”¨Cocoaæ¡†æ¶çš„æ—¶å€™ï¼Œå¾ˆå¤šAPIéƒ½è¦é€šè¿‡NSObjectçš„å­ç±»ä½¿ç”¨ï¼Œæ‰€ä»¥è¿™æ—¶å€™å¿…é¡»è¦ç”¨åˆ°å¼•ç”¨ç±»å‹classã€‚åœ¨å…¶ä»–æƒ…å†µä¸‹ï¼Œæœ‰ä¸‹é¢å‡ ä¸ªå‡†åˆ™ï¼š 1.ä»€ä¹ˆæ—¶å€™è¯¥ç”¨å€¼ç±»å‹ï¼š è¦ç”¨==è¿ç®—ç¬¦æ¥æ¯”è¾ƒå®ä¾‹çš„æ•°æ®æ—¶ ä½ å¸Œæœ›é‚£ä¸ªå®ä¾‹çš„æ‹·è´èƒ½ä¿æŒç‹¬ç«‹çš„çŠ¶æ€æ—¶ æ•°æ®ä¼šè¢«å¤šä¸ªçº¿ç¨‹ä½¿ç”¨æ—¶ 2.ä»€ä¹ˆæ—¶å€™è¯¥ç”¨å¼•ç”¨ç±»å‹ï¼ˆclassï¼‰ï¼š è¦ç”¨==è¿ç®—ç¬¦æ¥æ¯”è¾ƒå®ä¾‹èº«ä»½çš„æ—¶å€™ ä½ å¸Œæœ›æœ‰åˆ›å»ºä¸€ä¸ªå…±äº«çš„ã€å¯å˜å¯¹è±¡çš„æ—¶å€™ 3.ç±»å’Œç»“æ„ä½“åœ¨æ•ˆç‡ä¸Šçš„å·®å¼‚ï¼š ç»“æ„ä½“åˆ›å»ºé€Ÿåº¦,å†…å­˜å ç”¨æ›´å°,å¦‚æœéœ€è¦ä½¿ç”¨å¤æ‚çš„è¿ç®—,è¿™ä¸ªæ—¶å€™,å°±éœ€è¦ç»¼åˆè€ƒè™‘ä¸¤è€…çš„æœ‰ç¼ºç‚¹äº†ã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://www.jianshu.com/p/51f99a352838ï¼Œhttp://www.cocoachina.com/swift/20161221/18377.html","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šCategory","slug":"iOS Principle Category","date":"2018-06-03T13:56:27.000Z","updated":"2018-11-16T13:08:51.519Z","comments":true,"path":"2018/06/03/iOS Principle Category/","link":"","permalink":"https://reversescale.github.io/2018/06/03/iOS Principle Category/","excerpt":"åˆ†ç±»å°±æ˜¯å¯¹ä¸€ä¸ªç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•,è®©è¿™ä¸ªç±»èƒ½å¤Ÿé€‚åº”ä¸ä¸åŒæƒ…å†µçš„éœ€æ±‚.åœ¨ä¸€èˆ¬çš„å®é™…å¼€å‘ä¸­,æˆ‘ä»¬éƒ½ä¼šå¯¹ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨ç±»è¿›è¡Œæ‰©å±•,æ¯”å¦‚,NSString,Button,Labelç­‰ç­‰,ç®€å•æ¥è¯´ç±»åˆ«æ˜¯ä¸€ç§ä¸ºç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•çš„æ–¹å¼~","text":"åˆ†ç±»å°±æ˜¯å¯¹ä¸€ä¸ªç±»çš„åŠŸèƒ½è¿›è¡Œæ‰©å±•,è®©è¿™ä¸ªç±»èƒ½å¤Ÿé€‚åº”ä¸ä¸åŒæƒ…å†µçš„éœ€æ±‚.åœ¨ä¸€èˆ¬çš„å®é™…å¼€å‘ä¸­,æˆ‘ä»¬éƒ½ä¼šå¯¹ç³»ç»Ÿçš„ä¸€äº›å¸¸ç”¨ç±»è¿›è¡Œæ‰©å±•,æ¯”å¦‚,NSString,Button,Labelç­‰ç­‰,ç®€å•æ¥è¯´ç±»åˆ«æ˜¯ä¸€ç§ä¸ºç°æœ‰çš„ç±»æ·»åŠ æ–°æ–¹æ³•çš„æ–¹å¼~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿† è°ƒç”¨é¡ºåºï¼šå…ˆè°ƒç”¨ç±»çš„loadæ–¹æ³•ï¼Œå†è°ƒç”¨åˆ†ç±»çš„loadæ–¹æ³• ä¸ºåˆ†ç±»æ·»åŠ å±æ€§ï¼š å®ç°ï¼šRunTime ä¸º Category åŠ¨æ€å…³è”å¯¹è±¡ï¼Œobjc_setAssociatedObjectæ–¹æ³•ï¼Œå†…éƒ¨è°ƒç”¨_object_set_associative_referenceå‡½æ•° åŸç†ï¼šå…³è”å¯¹è±¡å¹¶ä¸æ˜¯æ”¾åœ¨äº†åŸæ¥çš„å¯¹è±¡é‡Œé¢ï¼Œè€Œæ˜¯è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„mapç”¨æ¥å­˜æ”¾æ¯ä¸€ä¸ªå¯¹è±¡åŠå…¶å¯¹åº”å…³è”å±æ€§è¡¨æ ¼ ç›®å½•ç»“æ„ æˆ‘ä»¬ä¹‹å‰è®²åˆ°è¿‡å®ä¾‹å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘ç±»å¯¹è±¡ï¼Œç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å…ƒç±»å¯¹è±¡ï¼Œå½“pè°ƒç”¨runæ–¹æ³•æ—¶ï¼Œç±»å¯¹è±¡çš„isaæŒ‡é’ˆæ‰¾åˆ°ç±»å¯¹è±¡çš„isaæŒ‡é’ˆï¼Œç„¶ååœ¨ç±»å¯¹è±¡ä¸­æŸ¥æ‰¾å¯¹è±¡æ–¹æ³•ï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ï¼Œå°±é€šè¿‡ç±»å¯¹è±¡çš„superclassæŒ‡é’ˆæ‰¾åˆ°çˆ¶ç±»å¯¹è±¡ï¼Œæ¥ç€å»å¯»æ‰¾runæ–¹æ³•ã€‚ Category çš„åº•å±‚å®ç°å°†Preson+Test.mæ–‡ä»¶è½¬åŒ–ä¸ºc++æ–‡ä»¶ï¼ŒæŸ¥çœ‹å…¶ä¸­çš„ç¼–è¯‘è¿‡ç¨‹ 1xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc Person+Test.m åœ¨åˆ†ç±»è½¬åŒ–ä¸ºc++æ–‡ä»¶ä¸­å¯ä»¥çœ‹å‡º_category_tç»“æ„ä½“ä¸­ï¼Œå­˜æ”¾ç€ç±»åï¼Œå¯¹è±¡æ–¹æ³•åˆ—è¡¨ï¼Œç±»æ–¹æ³•åˆ—è¡¨ï¼Œåè®®åˆ—è¡¨ï¼Œä»¥åŠå±æ€§åˆ—è¡¨ 12345678struct _category_t &#123; const char *name; struct _class_t *cls; const struct _method_list_t *instance_methods; const struct _method_list_t *class_methods; const struct _protocol_list_t *protocols; const struct _prop_list_t *properties;&#125;; ç´§æ¥ç€ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°_method_list_tç±»å‹çš„ç»“æ„ä½“ 1234567891011static struct /*_method_list_t*/ &#123; unsigned int entsize; // sizeof(struct _objc_method) unsigned int method_count; struct _objc_method method_list[3];&#125; _OBJC_$_CATEGORY_INSTANCE_METHODS_Person_$_Test __attribute__ ((used, section (\"__DATA,__objc_const\"))) = &#123; sizeof(_objc_method), 3, &#123;&#123;(struct objc_selector *)\"test\", \"v16@0:8\", (void *)_I_Person_Test_test&#125;, &#123;(struct objc_selector *)\"setAge:\", \"v20@0:8i16\", (void *)_I_Person_Test_setAge_&#125;, &#123;(struct objc_selector *)\"age\", \"i16@0:8\", (void *)_I_Person_Test_age&#125;&#125;&#125;; ä»ä¸­æˆ‘ä»¬å‘ç°è¿™ä¸ªç»“æ„ä½“_OBJC_CATEGORY_INSTANCE_METHODS_Preson_Testä»åç§°å¯ä»¥çœ‹å‡ºæ˜¯INSTANCE_METHODSå¯¹è±¡æ–¹æ³•ï¼Œå¹¶ä¸”ä¸€ä¸€å¯¹åº”ä¸ºä¸Šé¢ç»“æ„ä½“å†…èµ‹å€¼ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æ„ä½“ä¸­å­˜å‚¨äº†æ–¹æ³•å ç”¨çš„å†…å­˜ï¼Œæ–¹æ³•æ•°é‡ï¼Œä»¥åŠæ–¹æ³•åˆ—è¡¨ã€‚å¹¶ä¸”æ‰¾åˆ°åˆ†ç±»ä¸­æˆ‘ä»¬å®ç°å¯¹åº”çš„å¯¹è±¡æ–¹æ³•ï¼Œtest , setAge, ageä¸‰ä¸ªæ–¹æ³• 123456789static struct /*_method_list_t*/ &#123; unsigned int entsize; // sizeof(struct _objc_method) unsigned int method_count; struct _objc_method method_list[1];&#125; _OBJC_$_CATEGORY_CLASS_METHODS_Person_$_Test __attribute__ ((used, section (\"__DATA,__objc_const\"))) = &#123; sizeof(_objc_method), 1, &#123;&#123;(struct objc_selector *)\"abc\", \"v16@0:8\", (void *)_C_Person_Test_abc&#125;&#125;&#125;; åŒä¸Šé¢å¯¹è±¡æ–¹æ³•åˆ—è¡¨ä¸€æ ·ï¼Œè¿™ä¸ªæˆ‘ä»¬å¯ä»¥çœ‹å‡ºæ˜¯ç±»æ–¹æ³•åˆ—è¡¨ç»“æ„ä½“ _OBJC_CATEGORY_CLASS_METHODS_Preson_Testï¼ŒåŒå¯¹è±¡æ–¹æ³•ç»“æ„ä½“ç›¸åŒï¼ŒåŒæ ·å¯ä»¥çœ‹åˆ°æˆ‘ä»¬å®ç°çš„ç±»æ–¹æ³•ï¼Œabc æ¥ä¸‹æ¥æ˜¯åè®®æ–¹æ³•åˆ—è¡¨ 1234567891011121314151617181920212223242526272829303132static struct /*_method_list_t*/ &#123; unsigned int entsize; // sizeof(struct _objc_method) unsigned int method_count; struct _objc_method method_list[1];&#125; _OBJC_PROTOCOL_INSTANCE_METHODS_NSCopying __attribute__ ((used, section (\"__DATA,__objc_const\"))) = &#123; sizeof(_objc_method), 1, &#123;&#123;(struct objc_selector *)\"copyWithZone:\", \"@24@0:8^&#123;_NSZone=&#125;16\", 0&#125;&#125;&#125;;struct _protocol_t _OBJC_PROTOCOL_NSCopying __attribute__ ((used)) = &#123; 0, \"NSCopying\", 0, (const struct method_list_t *)&amp;_OBJC_PROTOCOL_INSTANCE_METHODS_NSCopying, 0, 0, 0, 0, sizeof(_protocol_t), 0, (const char **)&amp;_OBJC_PROTOCOL_METHOD_TYPES_NSCopying&#125;;struct _protocol_t *_OBJC_LABEL_PROTOCOL_$_NSCopying = &amp;_OBJC_PROTOCOL_NSCopying;static struct /*_protocol_list_t*/ &#123; long protocol_count; // Note, this is 32/64 bit struct _protocol_t *super_protocols[1];&#125; _OBJC_CATEGORY_PROTOCOLS_$_Person_$_Test __attribute__ ((used, section (\"__DATA,__objc_const\"))) = &#123; 1, &amp;_OBJC_PROTOCOL_NSCopying&#125;; é€šè¿‡ä¸Šè¿°æºç å¯ä»¥çœ‹åˆ°å…ˆå°†åè®®æ–¹æ³•é€šè¿‡_method_list_tç»“æ„ä½“å­˜å‚¨ï¼Œä¹‹åé€šè¿‡_protocol_tç»“æ„ä½“å­˜å‚¨åœ¨_OBJC_CATEGORY_PROTOCOLS_Preson_Testä¸­åŒ_protocol_list_tç»“æ„ä½“ä¸€ä¸€å¯¹åº”ï¼Œåˆ†åˆ«ä¸ºprotocol_count åè®®æ•°é‡ä»¥åŠå­˜å‚¨äº†åè®®æ–¹æ³•çš„_protocol_tç»“æ„ä½“ æœ€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å±æ€§åˆ—è¡¨ 123456789static struct /*_prop_list_t*/ &#123; unsigned int entsize; // sizeof(struct _prop_t) unsigned int count_of_properties; struct _prop_t prop_list[1];&#125; _OBJC_$_PROP_LIST_Person_$_Test __attribute__ ((used, section (\"__DATA,__objc_const\"))) = &#123; sizeof(_prop_t), 1, &#123;&#123;\"age\",\"Ti,N\"&#125;&#125;&#125;; å±æ€§åˆ—è¡¨ç»“æ„ä½“_OBJC_PROP_LIST_Preson_TeståŒ_prop_list_tç»“æ„ä½“å¯¹åº”ï¼Œå­˜å‚¨å±æ€§çš„å ç”¨ç©ºé—´ï¼Œå±æ€§å±æ€§æ•°é‡ï¼Œä»¥åŠå±æ€§åˆ—è¡¨ï¼Œå¯ä»¥çœ‹åˆ°æˆ‘ä»¬è‡ªå·±å†™çš„ageå±æ€§ã€‚ æœ€åæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å®šä¹‰äº†_OBJC_CATEGORY_Preson_Testç»“æ„ä½“ï¼Œå¹¶ä¸”å°†æˆ‘ä»¬ä¸Šé¢ç€é‡åˆ†æçš„ç»“æ„ä½“ä¸€ä¸€èµ‹å€¼ï¼Œæˆ‘ä»¬é€šè¿‡ä¸¤å¼ å›¾ç‰‡å¯¹ç…§ä¸€ä¸‹ã€‚ ä¸Šä¸‹ä¸¤å¼ å›¾ä¸€ä¸€å¯¹åº”ï¼Œå¹¶ä¸”æˆ‘ä»¬çœ‹åˆ°å®šä¹‰_class_tç±»å‹çš„OBJC_CLASS_Presonç»“æ„ä½“ï¼Œæœ€åå°†_OBJC_CATEGORY_Preson_Testçš„clsæŒ‡é’ˆæŒ‡å‘OBJC_CLASS_Presonç»“æ„ä½“åœ°å€ã€‚æˆ‘ä»¬è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼ŒclsæŒ‡é’ˆæŒ‡å‘çš„åº”è¯¥æ˜¯åˆ†ç±»çš„ä¸»ç±»ç±»å¯¹è±¡çš„åœ°å€ã€‚ é€šè¿‡ä»¥ä¸Šåˆ†ææˆ‘ä»¬å‘ç°ã€‚åˆ†ç±»æºç ä¸­ç¡®å®æ˜¯å°†æˆ‘ä»¬å®šä¹‰çš„å¯¹è±¡æ–¹æ³•ï¼Œç±»æ–¹æ³•ï¼Œå±æ€§ç­‰éƒ½å­˜æ”¾åœ¨catagory_tç»“æ„ä½“ä¸­ã€‚é€šè¿‡ runtime æºç æŸ¥çœ‹catagory_tå­˜å‚¨çš„æ–¹æ³•ï¼Œå±æ€§ï¼Œåè®®ç­‰æˆ‘ä»¬å¾—çŸ¥ï¼Œåˆ†ç±»çš„å®ç°åŸç†æ˜¯å°†categoryä¸­çš„æ–¹æ³•ï¼Œå±æ€§ï¼Œåè®®æ•°æ®æ”¾åœ¨category_tç»“æ„ä½“ä¸­ï¼Œç„¶åå°†ç»“æ„ä½“å†…çš„æ–¹æ³•åˆ—è¡¨æ‹·è´åˆ°ç±»å¯¹è±¡çš„æ–¹æ³•åˆ—è¡¨ä¸­ã€‚ Categoryå¯ä»¥æ·»åŠ å±æ€§ï¼Œä½†æ˜¯å¹¶ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆæˆå‘˜å˜é‡åŠset/getæ–¹æ³•ã€‚å› ä¸ºcategory_tç»“æ„ä½“ä¸­å¹¶ä¸å­˜åœ¨æˆå‘˜å˜é‡ã€‚é€šè¿‡ä¹‹å‰å¯¹å¯¹è±¡çš„åˆ†ææˆ‘ä»¬çŸ¥é“æˆå‘˜å˜é‡æ˜¯å­˜æ”¾åœ¨å®ä¾‹å¯¹è±¡ä¸­çš„ï¼Œå¹¶ä¸”ç¼–è¯‘çš„é‚£ä¸€åˆ»å°±å·²ç»å†³å®šå¥½äº†ã€‚è€Œåˆ†ç±»æ˜¯åœ¨è¿è¡Œæ—¶æ‰å»åŠ è½½çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å°±æ— æ³•å†ç¨‹åºè¿è¡Œæ—¶å°†åˆ†ç±»çš„æˆå‘˜å˜é‡ä¸­æ·»åŠ åˆ°å®ä¾‹å¯¹è±¡çš„ç»“æ„ä½“ä¸­ã€‚å› æ­¤åˆ†ç±»ä¸­ä¸å¯ä»¥æ·»åŠ æˆå‘˜å˜é‡ã€‚ load å’Œ initializeloadæ–¹æ³•ä¼šåœ¨ç¨‹åºå¯åŠ¨å°±ä¼šè°ƒç”¨ï¼Œå½“è£…è½½ç±»ä¿¡æ¯çš„æ—¶å€™å°±ä¼šè°ƒç”¨ã€‚ è°ƒç”¨é¡ºåºçœ‹ä¸€ä¸‹æºä»£ç ã€‚ é€šè¿‡æºç æˆ‘ä»¬å‘ç°æ˜¯ä¼˜å…ˆè°ƒç”¨ç±»çš„loadæ–¹æ³•ï¼Œä¹‹åè°ƒç”¨åˆ†ç±»çš„loadæ–¹æ³• æˆ‘ä»¬é€šè¿‡ä»£ç éªŒè¯ä¸€ä¸‹ï¼š æˆ‘ä»¬æ·»åŠ Studentç»§æ‰¿Presenç±»ï¼Œå¹¶æ·»åŠ Student+Teståˆ†ç±»ï¼Œåˆ†åˆ«é‡å†™åª+loadæ–¹æ³•ï¼Œå…¶ä»–ä»€ä¹ˆéƒ½ä¸åšé€šè¿‡æ‰“å°å‘ç° ç¡®å®æ˜¯ä¼˜å…ˆè°ƒç”¨ç±»çš„loadæ–¹æ³•ä¹‹åè°ƒç”¨åˆ†ç±»çš„loadæ–¹æ³•ï¼Œä¸è¿‡è°ƒç”¨ç±»çš„loadæ–¹æ³•ä¹‹å‰ä¼šä¿è¯å…¶çˆ¶ç±»å·²ç»è°ƒç”¨è¿‡loadæ–¹æ³•ã€‚ä¹‹åæˆ‘ä»¬ä¸ºPresonã€Student ã€Student+Test æ·»åŠ initializeæ–¹æ³•ã€‚ æˆ‘ä»¬çŸ¥é“å½“ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯æ—¶ï¼Œå°±ä¼šè°ƒç”¨initializeï¼Œç›¸å½“äºç¬¬ä¸€æ¬¡ä½¿ç”¨ç±»çš„æ—¶å€™å°±ä¼šè°ƒç”¨initializeæ–¹æ³•ã€‚è°ƒç”¨å­ç±»çš„initializeä¹‹å‰ï¼Œä¼šå…ˆä¿è¯è°ƒç”¨çˆ¶ç±»çš„initializeæ–¹æ³•ã€‚å¦‚æœä¹‹å‰å·²ç»è°ƒç”¨è¿‡initializeï¼Œå°±ä¸ä¼šå†è°ƒç”¨initializeæ–¹æ³•äº†ã€‚å½“åˆ†ç±»é‡å†™initializeæ–¹æ³•æ—¶ä¼šå…ˆè°ƒç”¨åˆ†ç±»çš„æ–¹æ³•ã€‚ä½†æ˜¯loadæ–¹æ³•å¹¶ä¸ä¼šè¢«è¦†ç›–ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹initializeçš„æºç ã€‚ ä¸Šå›¾ä¸­æˆ‘ä»¬å‘ç°ï¼Œinitializeæ˜¯é€šè¿‡æ¶ˆæ¯å‘é€æœºåˆ¶è°ƒç”¨çš„ï¼Œæ¶ˆæ¯å‘é€æœºåˆ¶é€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°å¯¹åº”çš„æ–¹æ³•ä¸å®ç°ï¼Œå› æ­¤å…ˆæ‰¾åˆ°åˆ†ç±»æ–¹æ³•ä¸­çš„å®ç°ï¼Œä¼šä¼˜å…ˆè°ƒç”¨åˆ†ç±»æ–¹æ³•ä¸­çš„å®ç° æˆ‘ä»¬å†æ¥çœ‹ä¸€ä¸‹loadæ–¹æ³•çš„è°ƒç”¨æºç  æˆ‘ä»¬çœ‹åˆ°loadæ–¹æ³•ä¸­ç›´æ¥æ‹¿åˆ°loadæ–¹æ³•çš„å†…å­˜åœ°å€ç›´æ¥è°ƒç”¨æ–¹æ³•ï¼Œä¸åœ¨æ˜¯é€šè¿‡æ¶ˆæ¯å‘é€æœºåˆ¶è°ƒç”¨ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°åˆ†ç±»ä¸­ä¹Ÿæ˜¯é€šè¿‡ç›´æ¥æ‹¿åˆ°loadæ–¹æ³•çš„åœ°å€è¿›è¡Œè°ƒç”¨ã€‚å› æ­¤æ­£å¦‚æˆ‘ä»¬ä¹‹å‰è¯•éªŒçš„ä¸€æ ·ï¼Œåˆ†ç±»ä¸­é‡å†™loadæ–¹æ³•ï¼Œå¹¶ä¸ä¼šä¼˜å…ˆè°ƒç”¨åˆ†ç±»çš„loadæ–¹æ³•ï¼Œè€Œä¸è°ƒç”¨æœ¬ç±»ä¸­çš„loadæ–¹æ³•äº†ã€‚ RunTime ä¸º Category åŠ¨æ€å…³è”å¯¹è±¡ä½¿ç”¨RunTimeç»™ç³»ç»Ÿçš„ç±»æ·»åŠ å±æ€§ï¼Œé¦–å…ˆéœ€è¦äº†è§£å¯¹è±¡ä¸å±æ€§çš„å…³ç³»ã€‚æˆ‘ä»¬é€šè¿‡ä¹‹å‰çš„å­¦ä¹ çŸ¥é“ï¼Œå¯¹è±¡ä¸€å¼€å§‹åˆå§‹åŒ–çš„æ—¶å€™å…¶å±æ€§ä¸ºnilï¼Œç»™å±æ€§èµ‹å€¼å…¶å®å°±æ˜¯è®©å±æ€§æŒ‡å‘ä¸€å—å­˜å‚¨å†…å®¹çš„å†…å­˜ï¼Œä½¿è¿™ä¸ªå¯¹è±¡çš„å±æ€§è·Ÿè¿™å—å†…å­˜äº§ç”Ÿä¸€ç§å…³è”ã€‚ é‚£ä¹ˆå¦‚æœæƒ³åŠ¨æ€çš„æ·»åŠ å±æ€§ï¼Œå…¶å®å°±æ˜¯åŠ¨æ€çš„äº§ç”ŸæŸç§å…³è”å°±å¥½äº†ã€‚è€Œæƒ³è¦ç»™ç³»ç»Ÿçš„ç±»æ·»åŠ å±æ€§ï¼Œåªèƒ½é€šè¿‡åˆ†ç±»ã€‚ è¿™é‡Œç»™NSObjectæ·»åŠ nameå±æ€§ï¼Œåˆ›å»ºNSObjectçš„åˆ†ç±» æˆ‘ä»¬å¯ä»¥ä½¿ç”¨@propertyç»™åˆ†ç±»æ·»åŠ å±æ€§ 1@property(nonatomic,strong)NSString *name; é€šè¿‡æ¢å¯»Categoryçš„æœ¬è´¨æˆ‘ä»¬çŸ¥é“ï¼Œè™½ç„¶åœ¨åˆ†ç±»ä¸­å¯ä»¥å†™@propertyæ·»åŠ å±æ€§ï¼Œä½†æ˜¯ä¸ä¼šè‡ªåŠ¨ç”Ÿæˆç§æœ‰å±æ€§ï¼Œä¹Ÿä¸ä¼šç”Ÿæˆset,getæ–¹æ³•çš„å®ç°ï¼Œåªä¼šç”Ÿæˆset,getçš„å£°æ˜ï¼Œéœ€è¦æˆ‘ä»¬è‡ªå·±å»å®ç°ã€‚ æ–¹æ³•ä¸€ï¼šæˆ‘ä»¬å¯ä»¥é€šè¿‡ä½¿ç”¨é™æ€å…¨å±€å˜é‡ç»™åˆ†ç±»æ·»åŠ å±æ€§ 1234567static NSString *_name;- (void)setName:(NSString *)name &#123; _name = name;&#125;- (NSString *)name &#123; return _name;&#125; ä½†æ˜¯è¿™æ ·_nameé™æ€å…¨å±€å˜é‡ä¸ç±»å¹¶æ²¡æœ‰å…³è”ï¼Œæ— è®ºå¯¹è±¡åˆ›å»ºä¸é”€æ¯ï¼Œåªè¦ç¨‹åºåœ¨è¿è¡Œ_nameå˜é‡å°±å­˜åœ¨ï¼Œå¹¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„å±æ€§ã€‚ æ–¹æ³•äºŒï¼šä½¿ç”¨RunTimeåŠ¨æ€æ·»åŠ å±æ€§RunTimeæä¾›äº†åŠ¨æ€æ·»åŠ å±æ€§å’Œè·å¾—å±æ€§çš„æ–¹æ³•ã€‚ 123456-(void)setName:(NSString *)name &#123; objc_setAssociatedObject(self, @\"name\",name, OBJC_ASSOCIATION_RETAIN_NONATOMIC);&#125;-(NSString *)name &#123; return objc_getAssociatedObject(self, @\"name\"); &#125; 1.åŠ¨æ€æ·»åŠ å±æ€§ objc_setAssociatedObject(id object, const void *key, id value, objc_AssociationPolicy policy); å‚æ•°ä¸€ï¼šid object : ç»™å“ªä¸ªå¯¹è±¡æ·»åŠ å±æ€§ï¼Œè¿™é‡Œè¦ç»™è‡ªå·±æ·»åŠ å±æ€§ï¼Œç”¨selfã€‚ å‚æ•°äºŒï¼švoid * == id key : å±æ€§åï¼Œæ ¹æ®keyè·å–å…³è”å¯¹è±¡çš„å±æ€§çš„å€¼ï¼Œåœ¨**objc_getAssociatedObjectä¸­é€šè¿‡æ¬¡keyè·å¾—å±æ€§çš„å€¼å¹¶è¿”å›ã€‚ å‚æ•°ä¸‰ï¼šid value** : å…³è”çš„å€¼ï¼Œä¹Ÿå°±æ˜¯setæ–¹æ³•ä¼ å…¥çš„å€¼ç»™å±æ€§å»ä¿å­˜ã€‚ å‚æ•°å››ï¼šobjc_AssociationPolicy policy : ç­–ç•¥ï¼Œå±æ€§ä»¥ä»€ä¹ˆå½¢å¼ä¿å­˜ã€‚ æœ‰ä»¥ä¸‹å‡ ç§1234567typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123; OBJC_ASSOCIATION_ASSIGN = 0, // æŒ‡å®šä¸€ä¸ªå¼±å¼•ç”¨ç›¸å…³è”çš„å¯¹è±¡ OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, // æŒ‡å®šç›¸å…³å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼ŒéåŸå­æ€§ OBJC_ASSOCIATION_COPY_NONATOMIC = 3, // æŒ‡å®šç›¸å…³çš„å¯¹è±¡è¢«å¤åˆ¶ï¼ŒéåŸå­æ€§ OBJC_ASSOCIATION_RETAIN = 01401, // æŒ‡å®šç›¸å…³å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼ŒåŸå­æ€§ OBJC_ASSOCIATION_COPY = 01403 // æŒ‡å®šç›¸å…³çš„å¯¹è±¡è¢«å¤åˆ¶ï¼ŒåŸå­æ€§ &#125;; keyå€¼åªè¦æ˜¯ä¸€ä¸ªæŒ‡é’ˆå³å¯ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥@selector(name) 2.è·å¾—å±æ€§1objc_getAssociatedObject(id object, const void *key); å‚æ•°ä¸€ï¼šid object : è·å–å“ªä¸ªå¯¹è±¡é‡Œé¢çš„å…³è”çš„å±æ€§ã€‚ å‚æ•°äºŒï¼švoid * == id key : ä»€ä¹ˆå±æ€§ï¼Œä¸objc_setAssociatedObjectä¸­çš„keyç›¸å¯¹åº”ï¼Œå³é€šè¿‡keyå€¼å–å‡ºvalueã€‚ 3.ç§»é™¤æ‰€æœ‰å…³è”å¯¹è±¡ 1234- (void)removeAssociatedObjects &#123; // ç§»é™¤æ‰€æœ‰å…³è”å¯¹è±¡ objc_removeAssociatedObjects(self);&#125; æ­¤æ—¶å·²ç»æˆåŠŸç»™NSObjectæ·»åŠ nameå±æ€§ï¼Œå¹¶ä¸”NSObjectå¯¹è±¡å¯ä»¥é€šè¿‡ç‚¹è¯­æ³•ä¸ºå±æ€§èµ‹å€¼ã€‚ 123NSObject *objc = [[NSObject alloc]init];objc.name = @\"xx_cc\";NSLog(@\"%@\",objc.name); å¯ä»¥çœ‹å‡ºå…³è”å¯¹è±¡çš„ä½¿ç”¨éå¸¸ç®€å•ï¼Œæ¥ä¸‹æ¥æˆ‘ä»¬æ¥æ¢å¯»å…³è”å¯¹è±¡çš„åº•å±‚åŸç† objc_setAssociatedObjectå‡½æ•° æ¥åˆ°runtimeæºç ï¼Œé¦–å…ˆæ‰¾åˆ°objc_setAssociatedObjectå‡½æ•°ï¼Œçœ‹ä¸€ä¸‹å…¶å®ç° æˆ‘ä»¬çœ‹åˆ°å…¶å®å†…éƒ¨è°ƒç”¨çš„æ˜¯_object_set_associative_referenceå‡½æ•°ï¼Œæˆ‘ä»¬æ¥åˆ°_object_set_associative_referenceå‡½æ•°ä¸­ _object_set_associative_referenceå‡½æ•° _object_set_associative_referenceå‡½æ•°å†…éƒ¨æˆ‘ä»¬å¯ä»¥å…¨éƒ¨æ‰¾åˆ°æˆ‘ä»¬ä¸Šé¢è¯´è¿‡çš„å®ç°å…³è”å¯¹è±¡æŠ€æœ¯çš„æ ¸å¿ƒå¯¹è±¡ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬æ¥ä¸€ä¸ªä¸€ä¸ªçœ‹å…¶å†…éƒ¨å®ç°åŸç†æ¢å¯»ä»–ä»¬ä¹‹é—´çš„å…³ç³»ã€‚ AssociationsManager é€šè¿‡AssociationsManagerå†…éƒ¨æºç å‘ç°ï¼ŒAssociationsManagerå†…éƒ¨æœ‰ä¸€ä¸ªAssociationsHashMapå¯¹è±¡ã€‚ AssociationsHashMap æˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹AssociationsHashMapå†…éƒ¨çš„æºç ã€‚ é€šè¿‡AssociationsHashMapå†…éƒ¨æºç æˆ‘ä»¬å‘ç°AssociationsHashMapç»§æ‰¿è‡ªunordered_mapé¦–å…ˆæ¥çœ‹ä¸€ä¸‹unordered_mapå†…çš„æºç  ä»unordered_mapæºç ä¸­æˆ‘ä»¬å¯ä»¥çœ‹å‡º_Keyå’Œ_Tpä¹Ÿå°±æ˜¯å‰ä¸¤ä¸ªå‚æ•°å¯¹åº”ç€mapä¸­çš„Keyå’ŒValueï¼Œé‚£ä¹ˆå¯¹ç…§ä¸Šé¢AssociationsHashMapå†…æºç å‘ç°_Keyä¸­ä¼ å…¥çš„æ˜¯disguised_ptr_tï¼Œ_Tpä¸­ä¼ å…¥çš„å€¼åˆ™ä¸ºObjectAssociationMap*ã€‚ ç´§æ¥ç€æˆ‘ä»¬æ¥åˆ°ObjectAssociationMapä¸­ï¼Œä¸Šå›¾ä¸­ObjectAssociationMapå·²ç»æ ‡è®°å‡ºï¼Œæˆ‘ä»¬å‘ç°ObjectAssociationMapä¸­åŒæ ·ä»¥keyã€Valueçš„æ–¹å¼å­˜å‚¨ç€ObjcAssociationã€‚ æ¥ç€æˆ‘ä»¬æ¥åˆ°ObjcAssociationä¸­ æˆ‘ä»¬å‘ç°ObjcAssociationå­˜å‚¨ç€_policyã€_valueï¼Œè€Œè¿™ä¸¤ä¸ªå€¼æˆ‘ä»¬å¯ä»¥å‘ç°æ­£æ˜¯æˆ‘ä»¬è°ƒç”¨objc_setAssociatedObjectå‡½æ•°ä¼ å…¥çš„å€¼ï¼Œä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬åœ¨è°ƒç”¨objc_setAssociatedObjectå‡½æ•°ä¸­ä¼ å…¥çš„valueå’Œpolicyè¿™ä¸¤ä¸ªå€¼æœ€ç»ˆæ˜¯å­˜å‚¨åœ¨ObjcAssociationä¸­çš„ã€‚ ç°åœ¨æˆ‘ä»¬å·²ç»å¯¹AssociationsManagerã€ AssociationsHashMapã€ ObjectAssociationMapã€ObjcAssociationå››ä¸ªå¯¹è±¡ä¹‹é—´çš„å…³ç³»æœ‰äº†ç®€å•çš„è®¤è¯†ï¼Œé‚£ä¹ˆæ¥ä¸‹æ¥æˆ‘ä»¬æ¥ç»†è¯»æºç ï¼Œçœ‹ä¸€ä¸‹objc_setAssociatedObjectå‡½æ•°ä¸­ä¼ å…¥çš„å››ä¸ªå‚æ•°åˆ†åˆ«æ”¾åœ¨å“ªä¸ªå¯¹è±¡ä¸­å……å½“ä»€ä¹ˆä½œç”¨ã€‚ é‡æ–°å›åˆ°_object_set_associative_referenceå‡½æ•°å®ç°ä¸­ ç»†è¯»ä¸Šè¿°æºç æˆ‘ä»¬å¯ä»¥å‘ç°ï¼Œé¦–å…ˆæ ¹æ®æˆ‘ä»¬ä¼ å…¥çš„valueç»è¿‡acquireValueå‡½æ•°å¤„ç†è·å–new_valueã€‚acquireValueå‡½æ•°å†…éƒ¨å…¶å®æ˜¯é€šè¿‡å¯¹ç­–ç•¥çš„åˆ¤æ–­è¿”å›ä¸åŒçš„å€¼ ä¹‹ååˆ›å»º AssociationsManager manager ä»¥åŠæ‹¿åˆ°managerå†…éƒ¨çš„AssociationsHashMapå³associationsã€‚ä¹‹åæˆ‘ä»¬çœ‹åˆ°äº†æˆ‘ä»¬ä¼ å…¥çš„ç¬¬ä¸€ä¸ªå‚æ•°objectï¼Œobjectç»è¿‡DISGUISEå‡½æ•°è¢«è½¬åŒ–ä¸ºäº†disguised_ptr_tç±»å‹çš„disguised_objectã€‚ DISGUISEå‡½æ•°å…¶å®ä»…ä»…å¯¹objectåšäº†ä½è¿ç®— ä¹‹åæˆ‘ä»¬çœ‹åˆ°è¢«å¤„ç†æˆnew_valueçš„valueï¼ŒåŒpolicyè¢«å­˜å…¥äº†ObjcAssociationä¸­ã€‚ è€ŒObjcAssociationå¯¹åº”æˆ‘ä»¬ä¼ å…¥çš„keyè¢«å­˜å…¥äº†ObjectAssociationMapä¸­ã€‚ disguised_objectå’ŒObjectAssociationMapåˆ™ä»¥key-valueçš„å½¢å¼å¯¹åº”å­˜å‚¨åœ¨associationsä¸­ä¹Ÿå°±æ˜¯AssociationsHashMapä¸­ã€‚ å¦‚æœæˆ‘ä»¬valueè®¾ç½®ä¸ºnilçš„è¯é‚£ä¹ˆä¼šæ‰§è¡Œä¸‹é¢çš„ä»£ç  ä»ä¸Šè¿°ä»£ç ä¸­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœæˆ‘ä»¬è®¾ç½®valueä¸ºnilæ—¶ï¼Œå°±ä¼šå°†å…³è”å¯¹è±¡ä»ObjectAssociationMapä¸­ç§»é™¤ã€‚ æœ€åæˆ‘ä»¬é€šè¿‡ä¸€å¼ å›¾å¯ä»¥å¾ˆæ¸…æ™°çš„ç†æ¸…æ¥šå…¶ä¸­çš„å…³ç³» é€šè¿‡ä¸Šå›¾æˆ‘ä»¬å¯ä»¥æ€»ç»“ä¸ºï¼šä¸€ä¸ªå®ä¾‹å¯¹è±¡å°±å¯¹åº”ä¸€ä¸ªObjectAssociationMapï¼Œè€ŒObjectAssociationMapä¸­å­˜å‚¨ç€å¤šä¸ªæ­¤å®ä¾‹å¯¹è±¡çš„å…³è”å¯¹è±¡çš„keyä»¥åŠObjcAssociationï¼Œä¸ºObjcAssociationä¸­å­˜å‚¨ç€å…³è”å¯¹è±¡çš„valueå’Œpolicyç­–ç•¥ã€‚ ç”±æ­¤æˆ‘ä»¬å¯ä»¥çŸ¥é“å…³è”å¯¹è±¡å¹¶ä¸æ˜¯æ”¾åœ¨äº†åŸæ¥çš„å¯¹è±¡é‡Œé¢ï¼Œè€Œæ˜¯è‡ªå·±ç»´æŠ¤äº†ä¸€ä¸ªå…¨å±€çš„mapç”¨æ¥å­˜æ”¾æ¯ä¸€ä¸ªå¯¹è±¡åŠå…¶å¯¹åº”å…³è”å±æ€§è¡¨æ ¼ã€‚ objc_getAssociatedObjectå‡½æ•° objc_getAssociatedObjectå†…éƒ¨è°ƒç”¨çš„æ˜¯_object_get_associative_reference _object_get_associative_referenceå‡½æ•° ä»_object_get_associative_referenceå‡½æ•°å†…éƒ¨å¯ä»¥çœ‹å‡ºï¼Œå‘setæ–¹æ³•ä¸­é‚£æ ·ï¼Œåå‘å°†valueä¸€å±‚ä¸€å±‚å–å‡ºæœ€åreturnå‡ºå»ã€‚ objc_removeAssociatedObjectså‡½æ•° objc_removeAssociatedObjectsç”¨æ¥åˆ é™¤æ‰€æœ‰çš„å…³è”å¯¹è±¡ï¼Œobjc_removeAssociatedObjectså‡½æ•°å†…éƒ¨è°ƒç”¨çš„æ˜¯_object_remove_assocationså‡½æ•° _object_remove_assocationså‡½æ•° ä¸Šè¿°æºç å¯ä»¥çœ‹å‡º_object_remove_assocationså‡½æ•°å°†objectå¯¹è±¡å‘å¯¹åº”çš„æ‰€æœ‰å…³è”å¯¹è±¡å…¨éƒ¨åˆ é™¤ã€‚ å…³è”å¯¹è±¡å¹¶ä¸æ˜¯å­˜å‚¨åœ¨è¢«å…³è”å¯¹è±¡æœ¬èº«å†…å­˜ä¸­ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨å…¨å±€çš„ç»Ÿä¸€çš„ä¸€ä¸ªAssociationsManagerä¸­ï¼Œå¦‚æœè®¾ç½®å…³è”å¯¹è±¡ä¸ºnilï¼Œå°±ç›¸å½“äºæ˜¯ç§»é™¤å…³è”å¯¹è±¡ã€‚ æ­¤æ—¶æˆ‘ä»¬æˆ‘ä»¬åœ¨å›è¿‡å¤´æ¥çœ‹objc_AssociationPolicy policy å‚æ•°: å±æ€§ä»¥ä»€ä¹ˆå½¢å¼ä¿å­˜çš„ç­–ç•¥ã€‚ 1234567typedef OBJC_ENUM(uintptr_t, objc_AssociationPolicy) &#123; OBJC_ASSOCIATION_ASSIGN = 0, // æŒ‡å®šä¸€ä¸ªå¼±å¼•ç”¨ç›¸å…³è”çš„å¯¹è±¡ OBJC_ASSOCIATION_RETAIN_NONATOMIC = 1, // æŒ‡å®šç›¸å…³å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼ŒéåŸå­æ€§ OBJC_ASSOCIATION_COPY_NONATOMIC = 3, // æŒ‡å®šç›¸å…³çš„å¯¹è±¡è¢«å¤åˆ¶ï¼ŒéåŸå­æ€§ OBJC_ASSOCIATION_RETAIN = 01401, // æŒ‡å®šç›¸å…³å¯¹è±¡çš„å¼ºå¼•ç”¨ï¼ŒåŸå­æ€§ OBJC_ASSOCIATION_COPY = 01403 // æŒ‡å®šç›¸å…³çš„å¯¹è±¡è¢«å¤åˆ¶ï¼ŒåŸå­æ€§ &#125;; æˆ‘ä»¬ä¼šå‘ç°å…¶ä¸­åªæœ‰RETAINå’ŒCOPYè€Œä¸ºä»€ä¹ˆæ²¡æœ‰weakå‘¢ï¼Ÿæ€»è¿‡ä¸Šé¢å¯¹æºç çš„åˆ†ææˆ‘ä»¬çŸ¥é“ï¼Œobjectç»è¿‡DISGUISEå‡½æ•°è¢«è½¬åŒ–ä¸ºäº†disguised_ptr_tç±»å‹çš„disguised_objectã€‚ 1disguised_ptr_t disguised_object = DISGUISE(object); è€ŒåŒæ—¶æˆ‘ä»¬çŸ¥é“ï¼Œweakä¿®é¥°çš„å±æ€§ï¼Œå½“æ²¡æœ‰æ‹¥æœ‰å¯¹è±¡ä¹‹åå°±ä¼šè¢«é”€æ¯ï¼Œå¹¶ä¸”æŒ‡é’ˆç½®ä½nilï¼Œé‚£ä¹ˆåœ¨å¯¹è±¡é”€æ¯ä¹‹åï¼Œè™½ç„¶åœ¨mapä¸­æ—¢ç„¶å­˜åœ¨å€¼objectå¯¹åº”çš„AssociationsHashMapï¼Œä½†æ˜¯å› ä¸ºobjectåœ°å€å·²ç»è¢«ç½®ä½nilï¼Œä¼šé€ æˆååœ°å€è®¿é—®è€Œæ— æ³•æ ¹æ®objectå¯¹è±¡çš„åœ°å€è½¬åŒ–ä¸ºdisguised_objectäº†ã€‚ ç›¸å…³é—®é¢˜é—®ï¼šCategoryä¸­æœ‰loadæ–¹æ³•å—ï¼Ÿloadæ–¹æ³•æ˜¯ä»€ä¹ˆæ—¶å€™è°ƒç”¨çš„ï¼Ÿload æ–¹æ³•èƒ½ç»§æ‰¿å—ï¼Ÿ ç­”ï¼šCategoryä¸­æœ‰loadæ–¹æ³•ï¼Œloadæ–¹æ³•åœ¨ç¨‹åºå¯åŠ¨è£…è½½ç±»ä¿¡æ¯çš„æ—¶å€™å°±ä¼šè°ƒç”¨ã€‚loadæ–¹æ³•å¯ä»¥ç»§æ‰¿ã€‚è°ƒç”¨å­ç±»çš„loadæ–¹æ³•ä¹‹å‰ï¼Œä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„loadæ–¹æ³• é—®ï¼šloadã€initializeçš„åŒºåˆ«ï¼Œä»¥åŠå®ƒä»¬åœ¨categoryé‡å†™çš„æ—¶å€™çš„è°ƒç”¨çš„æ¬¡åºã€‚ ç­”ï¼šåŒºåˆ«åœ¨äºè°ƒç”¨æ–¹å¼å’Œè°ƒç”¨æ—¶åˆ» è°ƒç”¨æ–¹å¼ï¼šloadæ˜¯æ ¹æ®å‡½æ•°åœ°å€ç›´æ¥è°ƒç”¨ï¼Œinitializeæ˜¯é€šè¿‡objc_msgSendè°ƒç”¨ è°ƒç”¨æ—¶åˆ»ï¼šloadæ˜¯runtimeåŠ è½½ç±»ã€åˆ†ç±»çš„æ—¶å€™è°ƒç”¨ï¼ˆåªä¼šè°ƒç”¨1æ¬¡ï¼‰ï¼Œinitializeæ˜¯ç±»ç¬¬ä¸€æ¬¡æ¥æ”¶åˆ°æ¶ˆæ¯çš„æ—¶å€™è°ƒç”¨ï¼Œæ¯ä¸€ä¸ªç±»åªä¼šinitializeä¸€æ¬¡ï¼ˆçˆ¶ç±»çš„initializeæ–¹æ³•å¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼‰ è°ƒç”¨é¡ºåºï¼šå…ˆè°ƒç”¨ç±»çš„loadæ–¹æ³•ï¼Œå…ˆç¼–è¯‘é‚£ä¸ªç±»ï¼Œå°±å…ˆè°ƒç”¨loadã€‚åœ¨è°ƒç”¨loadä¹‹å‰ä¼šå…ˆè°ƒç”¨çˆ¶ç±»çš„loadæ–¹æ³•ã€‚åˆ†ç±»ä¸­loadæ–¹æ³•ä¸ä¼šè¦†ç›–æœ¬ç±»çš„loadæ–¹æ³•ï¼Œå…ˆç¼–è¯‘çš„åˆ†ç±»ä¼˜å…ˆè°ƒç”¨loadæ–¹æ³•ã€‚initializeå…ˆåˆå§‹åŒ–çˆ¶ç±»ï¼Œä¹‹åå†åˆå§‹åŒ–å­ç±»ã€‚å¦‚æœå­ç±»æ²¡æœ‰å®ç°+initializeï¼Œä¼šè°ƒç”¨çˆ¶ç±»çš„+initializeï¼ˆæ‰€ä»¥çˆ¶ç±»çš„+initializeå¯èƒ½ä¼šè¢«è°ƒç”¨å¤šæ¬¡ï¼‰ï¼Œå¦‚æœåˆ†ç±»å®ç°äº†+initializeï¼Œå°±è¦†ç›–ç±»æœ¬èº«çš„+initializeè°ƒç”¨ã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://juejin.im/post/5aef0a3b518825670f7bc0f3ã€https://juejin.im/post/5af86b276fb9a07aa34a59e6","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šClassAndObjective","slug":"iOS Principle ClassAndObjective","date":"2018-06-02T13:56:27.000Z","updated":"2018-11-16T13:06:02.391Z","comments":true,"path":"2018/06/02/iOS Principle ClassAndObjective/","link":"","permalink":"https://reversescale.github.io/2018/06/02/iOS Principle ClassAndObjective/","excerpt":"é¢å‘å¯¹è±¡(Object Oriented,OO)æ˜¯è½¯ä»¶å¼€å‘æ–¹æ³•ã€‚é¢å‘å¯¹è±¡çš„æ¦‚å¿µå’Œåº”ç”¨å·²è¶…è¶Šäº†ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å¼€å‘ï¼Œæ‰©å±•åˆ°å¦‚æ•°æ®åº“ç³»ç»Ÿã€äº¤äº’å¼ç•Œé¢ã€åº”ç”¨ç»“æ„ã€åº”ç”¨å¹³å°ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€ç½‘ç»œç®¡ç†ç»“æ„ã€CADæŠ€æœ¯ã€äººå·¥æ™ºèƒ½ç­‰é¢†åŸŸ~","text":"é¢å‘å¯¹è±¡(Object Oriented,OO)æ˜¯è½¯ä»¶å¼€å‘æ–¹æ³•ã€‚é¢å‘å¯¹è±¡çš„æ¦‚å¿µå’Œåº”ç”¨å·²è¶…è¶Šäº†ç¨‹åºè®¾è®¡å’Œè½¯ä»¶å¼€å‘ï¼Œæ‰©å±•åˆ°å¦‚æ•°æ®åº“ç³»ç»Ÿã€äº¤äº’å¼ç•Œé¢ã€åº”ç”¨ç»“æ„ã€åº”ç”¨å¹³å°ã€åˆ†å¸ƒå¼ç³»ç»Ÿã€ç½‘ç»œç®¡ç†ç»“æ„ã€CADæŠ€æœ¯ã€äººå·¥æ™ºèƒ½ç­‰é¢†åŸŸ~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿† OC ä¸‰ç§å¯¹è±¡ï¼šinstanceå®ä¾‹å¯¹è±¡ã€classç±»å¯¹è±¡ã€meta-classå…ƒç±»å¯¹è±¡ instanceå®ä¾‹å¯¹è±¡ï¼šNSObjectè½¬åŒ–ä¸ºcè¯­è¨€å…¶å®å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ï¼Œç³»ç»Ÿåˆ†é…å†…å­˜ç©ºé—´ï¼Œå­˜æ”¾ä¸€ä¸ªæˆå‘˜isaæŒ‡é’ˆè¡¨ç¤ºå¯¹è±¡çš„åœ°å€ï¼ˆç»“æ„ä½“çš„åœ°å€ï¼‰64bitå ç”¨8ä¸ªå­—èŠ‚ï¼Œ32bitå ç”¨4ä¸ªå­—èŠ‚ classç±»å¯¹è±¡ï¼šç±»å¯¹è±¡å†…å­˜å­˜å‚¨çš„ä¿¡æ¯ï¼šisaå’ŒsuperclassæŒ‡é’ˆã€ç±»çš„å±æ€§ä¿¡æ¯å’Œæˆå‘˜å˜é‡ã€å¯¹è±¡æ–¹æ³•å’Œåè®®ä¿¡æ¯ meta-classå…ƒç±»å¯¹è±¡ï¼šå…ƒç±»å¯¹è±¡å’Œclasså¯¹è±¡çš„å†…å­˜ç»“æ„ä¸€æ ·ï¼ŒisaæŒ‡é’ˆæŒ‡å‘åŸºç±»å¯¹è±¡ï¼ŒåŸºç±»çš„å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è‡ªå·± OC ä¸‰ç§å¯¹è±¡åŸç†ï¼šobjc_classç»“æ„ä½“çš„æŒ‡é’ˆ å…³äºOCå¯¹è±¡çš„åº•å±‚å®ç°å¯»OCå¯¹è±¡çš„æœ¬è´¨ï¼Œæˆ‘ä»¬å¹³æ—¶ç¼–å†™çš„Objective-Cä»£ç ï¼Œåº•å±‚å®ç°å…¶å®éƒ½æ˜¯C\\C++ä»£ç ã€‚ OCçš„å¯¹è±¡ç»“æ„éƒ½æ˜¯é€šè¿‡åŸºç¡€C\\C++çš„ç»“æ„ä½“å®ç°çš„ã€‚ æˆ‘ä»¬é€šè¿‡åˆ›å»ºOCæ–‡ä»¶åŠå¯¹è±¡ï¼Œå¹¶å°†OCæ–‡ä»¶è½¬åŒ–ä¸ºC++æ–‡ä»¶æ¥æ¢å¯»OCå¯¹è±¡çš„æœ¬è´¨ OCå¦‚ä¸‹ä»£ç  12345678#import &lt;Foundation/Foundation.h&gt;int main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; NSObject *objc = [[NSObject alloc] init]; NSLog(@\"Hello, World!\"); &#125; return 0;&#125; æˆ‘ä»¬é€šè¿‡å‘½ä»¤è¡Œå°†OCçš„mian.mæ–‡ä»¶è½¬åŒ–ä¸ºc++æ–‡ä»¶ 1clang -rewrite-objc main.m -o main.cpp // è¿™ç§æ–¹å¼æ²¡æœ‰æŒ‡å®šæ¶æ„ä¾‹å¦‚arm64æ¶æ„ æˆ‘ä»¬å¯ä»¥æŒ‡å®šæ¶æ„æ¨¡å¼çš„å‘½ä»¤è¡Œï¼Œä½¿ç”¨xcodeå·¥å…· xcrun 1xcrun -sdk iphoneos clang -arch arm64 -rewrite-objc main.m -o main-arm64.cpp // ç”Ÿæˆ main-arm64.cpp main-arm64.cpp æ–‡ä»¶ä¸­æœç´¢NSObjcetï¼Œå¯ä»¥æ‰¾åˆ° NSObjcet_IMPLï¼ˆIMPLä»£è¡¨ implementation å®ç°ï¼‰ æˆ‘ä»¬çœ‹ä¸€ä¸‹NSObject_IMPLå†…éƒ¨ 123456struct NSObject_IMPL &#123; Class isa;&#125;;// æŸ¥çœ‹Classæœ¬è´¨typedef struct objc_class *Class;// æˆ‘ä»¬å‘ç°Classå…¶å®å°±æ˜¯ä¸€ä¸ªæŒ‡é’ˆï¼Œå¯¹è±¡åº•å±‚å®ç°å…¶å®å°±æ˜¯è¿™ä¸ªæ ·å­ã€‚ æ€è€ƒï¼š ä¸€ä¸ªOCå¯¹è±¡åœ¨å†…å­˜ä¸­æ˜¯å¦‚ä½•å¸ƒå±€çš„? NSObjcetçš„åº•å±‚å®ç°ï¼Œç‚¹å‡»NSObjcetè¿›å…¥å‘ç°NSObjectçš„å†…éƒ¨å®ç° 1234567@interface NSObject &lt;NSObject&gt; &#123; #pragma clang diagnostic push #pragma clang diagnostic ignored \"-Wobjc-interface-ivars\" Class isa OBJC_ISA_AVAILABILITY; #pragma clang diagnostic pop&#125;@end è½¬åŒ–ä¸ºcè¯­è¨€å…¶å®å°±æ˜¯ä¸€ä¸ªç»“æ„ä½“ 123struct NSObject_IMPL &#123; Class isa;&#125;; é‚£ä¹ˆè¿™ä¸ªç»“æ„ä½“å å¤šå¤§çš„å†…å­˜ç©ºé—´å‘¢ï¼Œæˆ‘ä»¬å‘ç°è¿™ä¸ªç»“æ„ä½“åªæœ‰ä¸€ä¸ªæˆå‘˜ï¼ŒisaæŒ‡é’ˆï¼Œè€ŒæŒ‡é’ˆåœ¨64ä½æ¶æ„ä¸­å 8ä¸ªå­—èŠ‚ã€‚ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªNSObjecå¯¹è±¡æ‰€å ç”¨çš„å†…å­˜æ˜¯8ä¸ªå­—èŠ‚ã€‚ ä¸ºäº†æ¢å¯»OCå¯¹è±¡åœ¨å†…å­˜ä¸­å¦‚ä½•ä½“ç°ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹é¢ä¸€æ®µä»£ç  1NSObject *objc = [[NSObject alloc] init]; ä¸Šé¢ä¸€æ®µä»£ç åœ¨å†…å­˜ä¸­å¦‚ä½•ä½“ç°çš„å‘¢ï¼Ÿä¸Šè¿°ä¸€æ®µä»£ç ä¸­ç³»ç»Ÿä¸ºNSObjectå¯¹è±¡åˆ†é…8ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œç”¨æ¥å­˜æ”¾ä¸€ä¸ªæˆå‘˜isaæŒ‡é’ˆã€‚é‚£ä¹ˆisaæŒ‡é’ˆè¿™ä¸ªå˜é‡çš„åœ°å€å°±æ˜¯ç»“æ„ä½“çš„åœ°å€ï¼Œä¹Ÿå°±æ˜¯NSObjcetå¯¹è±¡çš„åœ°å€ã€‚ å‡è®¾isaçš„åœ°å€ä¸º0x100400110ï¼Œé‚£ä¹ˆä¸Šè¿°ä»£ç åˆ†é…å­˜å‚¨ç©ºé—´ç»™NSObjectå¯¹è±¡ï¼Œç„¶åå°†å­˜å‚¨ç©ºé—´çš„åœ°å€èµ‹å€¼ç»™objcæŒ‡é’ˆã€‚objcå­˜å‚¨çš„å°±æ˜¯isaçš„åœ°å€ã€‚objcæŒ‡å‘å†…å­˜ä¸­NSObjectå¯¹è±¡åœ°å€ï¼Œå³æŒ‡å‘å†…å­˜ä¸­çš„ç»“æ„ä½“ï¼Œä¹Ÿå°±æ˜¯isaçš„ä½ç½®ã€‚ è‡ªå®šä¹‰ç±»çš„å†…éƒ¨å®ç°1234567891011121314151617@interface Student : NSObject&#123; @public int _no; int _age;&#125;@end@implementation Studentint main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; Student *stu = [[Student alloc] init]; stu -&gt; _no = 4; stu -&gt; _age = 5; NSLog(@\"%@\",stu); &#125; return 0;&#125;@end æŒ‰ç…§ä¸Šè¿°æ­¥éª¤åŒæ ·ç”Ÿæˆc++æ–‡ä»¶ã€‚å¹¶æŸ¥æ‰¾Studentï¼Œæˆ‘ä»¬å‘ç°Student_IMPL 12345struct Student_IMPL &#123; struct NSObject_IMPL NSObject_IVARS; int _no; int _age;&#125;; å‘ç°ç¬¬ä¸€ä¸ªæ˜¯ NSObject_IMPLçš„å®ç°ã€‚è€Œé€šè¿‡ä¸Šé¢çš„å®éªŒæˆ‘ä»¬çŸ¥é“NSObject_IMPLå†…éƒ¨å…¶å®å°±æ˜¯Class isa é‚£ä¹ˆæˆ‘ä»¬å‡è®¾ struct NSObject_IMPL NSObject_IVARS; 12345struct Student_IMPL &#123; Class *isa; int _no; int _age;&#125;; å› æ­¤æ­¤ç»“æ„ä½“å ç”¨å¤šå°‘å­˜å‚¨ç©ºé—´ï¼Œå¯¹è±¡å°±å ç”¨å¤šå°‘å­˜å‚¨ç©ºé—´ã€‚å› æ­¤ç»“æ„ä½“å ç”¨çš„å­˜å‚¨ç©ºé—´ä¸ºï¼ŒisaæŒ‡é’ˆ8ä¸ªå­—èŠ‚ç©ºé—´+intç±»å‹_no4ä¸ªå­—èŠ‚ç©ºé—´+intç±»å‹_age4ä¸ªå­—èŠ‚ç©ºé—´å…±16ä¸ªå­—èŠ‚ç©ºé—´ 123Student *stu = [[Student alloc] init];stu -&gt; _no = 4;stu -&gt; _age = 5; é‚£ä¹ˆä¸Šè¿°ä»£ç å®é™…ä¸Šåœ¨å†…å­˜ä¸­çš„ä½“ç°ä¸ºï¼Œåˆ›å»ºStudentå¯¹è±¡é¦–å…ˆä¼šåˆ†é…16ä¸ªå­—èŠ‚ï¼Œå­˜å‚¨3ä¸ªä¸œè¥¿ï¼ŒisaæŒ‡é’ˆ8ä¸ªå­—èŠ‚ï¼Œ4ä¸ªå­—èŠ‚çš„_no ,4ä¸ªå­—èŠ‚çš„_age sutdentå¯¹è±¡çš„3ä¸ªå˜é‡åˆ†åˆ«æœ‰è‡ªå·±çš„åœ°å€ã€‚è€ŒstuæŒ‡å‘isaæŒ‡é’ˆçš„åœ°å€ã€‚å› æ­¤stuçš„åœ°å€ä¸º0x100400110ï¼Œstuå¯¹è±¡åœ¨å†…å­˜ä¸­å ç”¨16ä¸ªå­—èŠ‚çš„ç©ºé—´ã€‚å¹¶ä¸”ç»è¿‡èµ‹å€¼ï¼Œ_noé‡Œé¢å­˜å‚¨ç€4 ï¼Œ_ageé‡Œé¢å­˜å‚¨ç€5 éªŒè¯Studentåœ¨å†…å­˜ä¸­æ¨¡æ · 1234567891011121314151617181920struct Student_IMPL &#123; Class isa; int _no; int _age;&#125;;@interface Student : NSObject &#123; @public int _no; int _age;&#125;@end@implementation Studentint main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; // å¼ºåˆ¶è½¬åŒ– struct Student_IMPL *stuImpl = (__bridge struct Student_IMPL *)stu; NSLog(@\"_no = %d, _age = %d\", stuImpl-&gt;_no, stuImpl-&gt;_age); // æ‰“å°å‡º _no = 4, _age = 5 &#125; return 0;&#125; ä¸Šè¿°ä»£ç å°†ocå¯¹è±¡å¼ºè½¬æˆStudent_IMPLçš„ç»“æ„ä½“ã€‚ä¹Ÿå°±æ˜¯è¯´æŠŠä¸€ä¸ªæŒ‡å‘ocå¯¹è±¡çš„æŒ‡é’ˆï¼ŒæŒ‡å‘è¿™ç§ç»“æ„ä½“ã€‚ç”±äºæˆ‘ä»¬ä¹‹å‰çŒœæƒ³ï¼Œå¯¹è±¡åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ä¸ç»“æ„ä½“åœ¨å†…å­˜ä¸­çš„å¸ƒå±€ç›¸åŒï¼Œé‚£ä¹ˆå¦‚æœå¯ä»¥è½¬åŒ–æˆåŠŸï¼Œè¯´æ˜æˆ‘ä»¬çš„çŒœæƒ³æ­£ç¡®ã€‚ç”±æ­¤è¯´æ˜stuè¿™ä¸ªå¯¹è±¡æŒ‡å‘çš„å†…å­˜ç¡®å®æ˜¯ä¸€ä¸ªç»“æ„ä½“ã€‚ å®é™…ä¸Šæƒ³è¦è·å–å¯¹è±¡å ç”¨å†…å­˜çš„å¤§å°ï¼Œå¯ä»¥é€šè¿‡æ›´ä¾¿æ·çš„è¿è¡Œæ—¶æ–¹æ³•æ¥è·å–ã€‚ 123class_getInstanceSize([Student class])NSLog(@\"%zd,%zd\", class_getInstanceSize([NSObject class]) ,class_getInstanceSize([Student class]));// æ‰“å°ä¿¡æ¯ 8å’Œ16 çª¥æ¢å†…å­˜ç»“æ„å®æ—¶æŸ¥çœ‹å†…å­˜æ•°æ® æ–¹å¼ä¸€ï¼šé€šè¿‡æ‰“æ–­ç‚¹ã€‚ Debug Workflow -&gt; viewMemory addressä¸­è¾“å…¥stuçš„åœ°å€ ä»ä¸Šå›¾ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç°è¯»å–æ•°æ®ä»é«˜ä½æ•°æ®å¼€å§‹è¯»ï¼ŒæŸ¥çœ‹å‰16ä½å­—èŠ‚ï¼Œæ¯å››ä¸ªå­—èŠ‚è¯»å‡ºçš„æ•°æ®ä¸º16è¿›åˆ¶ 0x0000004(4å­—èŠ‚) 0x0000005(4å­—èŠ‚) isaçš„åœ°å€ä¸º 00D1081000001119(8å­—èŠ‚) æ–¹å¼äºŒï¼šé€šè¿‡lldbæŒ‡ä»¤xcodeè‡ªå¸¦çš„è°ƒè¯•å™¨ 12345678910memory read 0x10074c450// ç®€å†™ x 0x10074c450// å¢åŠ è¯»å–æ¡ä»¶// memory read/æ•°é‡æ ¼å¼å­—èŠ‚æ•° å†…å­˜åœ°å€// ç®€å†™ x/æ•°é‡æ ¼å¼å­—èŠ‚æ•° å†…å­˜åœ°å€// æ ¼å¼ xæ˜¯16è¿›åˆ¶ï¼Œfæ˜¯æµ®ç‚¹ï¼Œdæ˜¯10è¿›åˆ¶// å­—èŠ‚å¤§å° bï¼šbyte 1å­—èŠ‚ï¼Œhï¼šhalf word 2å­—èŠ‚ï¼Œwï¼šword 4å­—èŠ‚ï¼Œgï¼šgiant word 8å­—èŠ‚ç¤ºä¾‹ï¼šx/4xw // /åé¢è¡¨ç¤ºå¦‚ä½•è¯»å–æ•°æ® wè¡¨ç¤º4ä¸ªå­—èŠ‚4ä¸ªå­—èŠ‚è¯»å–ï¼Œxè¡¨ç¤ºä»¥16è¿›åˆ¶çš„æ–¹å¼è¯»å–æ•°æ®ï¼Œ4åˆ™è¡¨ç¤ºè¯»å–4æ¬¡ åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡lldbä¿®æ”¹å†…å­˜ä¸­çš„å€¼ 12memory write 0x100400c68 6å°†_noçš„å€¼æ”¹ä¸ºäº†6 é‚£ä¹ˆä¸€ä¸ªNSObjectå¯¹è±¡å ç”¨å¤šå°‘å†…å­˜ï¼Ÿ NSObjcetå®é™…ä¸Šæ˜¯åªæœ‰ä¸€ä¸ªåä¸ºisaçš„æŒ‡é’ˆçš„ç»“æ„ä½“ï¼Œå› æ­¤å ç”¨ä¸€ä¸ªæŒ‡é’ˆå˜é‡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´å¤§å°ï¼Œå¦‚æœ64bitå ç”¨8ä¸ªå­—èŠ‚ï¼Œå¦‚æœ32bitå ç”¨4ä¸ªå­—èŠ‚ã€‚ æ›´å¤æ‚çš„ç»§æ‰¿å…³ç³»åœ¨64bitç¯å¢ƒä¸‹ï¼Œ ä¸‹é¢ä»£ç çš„è¾“å‡ºå†…å®¹ï¼Ÿ1234567891011121314151617181920212223/* Person */@interface Person: NSObject &#123; int _age;&#125;@end@implementation Person@end/* Student */@interface Student: Person &#123; int _no;&#125;@end@implementation Student@endint main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; NSLog(@\"%zd %zd\", class_getInstanceSize([Person class]), class_getInstanceSize([Student class]) ); &#125; return 0;&#125; æˆ‘ä»¬ä¾æ®ä¸Šé¢çš„åˆ†æä¸å‘ç°ï¼Œç±»å¯¹è±¡å®è´¨ä¸Šæ˜¯ä»¥ç»“æ„ä½“çš„å½¢å¼å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œç”»å‡ºçœŸæ­£çš„å†…å­˜å›¾ä¾‹ æˆ‘ä»¬å‘ç°åªè¦æ˜¯ç»§æ‰¿è‡ªNSObjectçš„å¯¹è±¡ï¼Œé‚£ä¹ˆåº•å±‚ç»“æ„ä½“å†…ä¸€å®šæœ‰ä¸€ä¸ªisaæŒ‡é’ˆã€‚ é‚£ä¹ˆä»–ä»¬æ‰€å çš„å†…å­˜ç©ºé—´æ˜¯å¤šå°‘å‘¢ï¼Ÿå•çº¯çš„å°†æŒ‡é’ˆå’Œæˆå‘˜å˜é‡æ‰€å çš„å†…å­˜ç›¸åŠ å³å¯å—ï¼Ÿä¸Šè¿°ä»£ç å®é™…æ‰“å°çš„å†…å®¹æ˜¯16 16ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œpersonå¯¹è±¡å’Œstudentå¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´éƒ½ä¸º16ä¸ªå­—èŠ‚ã€‚ å…¶å®å®é™…ä¸Špersonå¯¹è±¡ç¡®å®åªä½¿ç”¨äº†12ä¸ªå­—èŠ‚ã€‚ä½†æ˜¯å› ä¸ºå†…å­˜å¯¹é½çš„åŸå› ã€‚ä½¿personå¯¹è±¡ä¹Ÿå ç”¨16ä¸ªå­—èŠ‚ã€‚ æˆ‘ä»¬å¯ä»¥æ€»ç»“å†…å­˜å¯¹é½ä¸ºä¸¤ä¸ªåŸåˆ™ï¼š åŸåˆ™ 1. å‰é¢çš„åœ°å€å¿…é¡»æ˜¯åé¢çš„åœ°å€æ­£æ•°å€,ä¸æ˜¯å°±è¡¥é½ã€‚ åŸåˆ™ 2. æ•´ä¸ªStructçš„åœ°å€å¿…é¡»æ˜¯æœ€å¤§å­—èŠ‚çš„æ•´æ•°å€ã€‚ é€šè¿‡ä¸Šè¿°å†…å­˜å¯¹é½çš„åŸåˆ™æˆ‘ä»¬æ¥çœ‹ï¼Œpersonå¯¹è±¡çš„ç¬¬ä¸€ä¸ªåœ°å€è¦å­˜æ”¾isaæŒ‡é’ˆéœ€è¦8ä¸ªå­—èŠ‚ï¼Œç¬¬äºŒä¸ªåœ°å€è¦å­˜æ”¾_ageæˆå‘˜å˜é‡éœ€è¦4ä¸ªå­—èŠ‚ï¼Œæ ¹æ®åŸåˆ™ä¸€ï¼Œ8æ˜¯4çš„æ•´æ•°å€ï¼Œç¬¦åˆåŸåˆ™ä¸€ï¼Œä¸éœ€è¦è¡¥é½ã€‚ç„¶åæ£€æŸ¥åŸåˆ™2ï¼Œç›®å‰personå¯¹è±¡å…±å æ®12ä¸ªå­—èŠ‚çš„å†…å­˜ï¼Œä¸æ˜¯æœ€å¤§å­—èŠ‚æ•°8ä¸ªå­—èŠ‚çš„æ•´æ•°å€ï¼Œæ‰€ä»¥éœ€è¦è¡¥é½4ä¸ªå­—èŠ‚ï¼Œå› æ­¤personå¯¹è±¡å°±å ç”¨16ä¸ªå­—èŠ‚ç©ºé—´ã€‚ è€Œå¯¹äºstudentå¯¹è±¡ï¼Œæˆ‘ä»¬çŸ¥é“studentå¯¹è±¡ä¸­ï¼ŒåŒ…å«personå¯¹è±¡çš„ç»“æ„ä½“å®ç°ï¼Œå’Œä¸€ä¸ªintç±»å‹çš„_noæˆå‘˜å˜é‡ï¼ŒåŒæ ·isaæŒ‡é’ˆ8ä¸ªå­—èŠ‚ï¼Œ_ageæˆå‘˜å˜é‡4ä¸ªå­—èŠ‚ï¼Œ_noæˆå‘˜å˜é‡4ä¸ªå­—èŠ‚ï¼Œåˆšå¥½æ»¡è¶³åŸåˆ™1å’ŒåŸåˆ™2ï¼Œæ‰€ä»¥studentå¯¹è±¡å æ®çš„å†…å­˜ç©ºé—´ä¹Ÿæ˜¯16ä¸ªå­—èŠ‚ã€‚ OCçš„ç±»ä¿¡æ¯å­˜æ”¾åœ¨å“ªé‡ŒOCå¯¹è±¡ä¸»è¦å¯ä»¥åˆ†ä¸ºä¸‰ç§ instanceå¯¹è±¡ï¼ˆå®ä¾‹å¯¹è±¡ï¼‰ classå¯¹è±¡ï¼ˆç±»å¯¹è±¡ï¼‰ meta-classå¯¹è±¡ï¼ˆå…ƒç±»å¯¹è±¡ï¼‰ instanceå¯¹è±¡å°±æ˜¯é€šè¿‡ç±»allocå‡ºæ¥çš„å¯¹è±¡ï¼Œæ¯æ¬¡è°ƒç”¨allocéƒ½ä¼šäº§ç”Ÿæ–°çš„instanceå¯¹è±¡12NSObjcet *object1 = [[NSObjcet alloc] init];NSObjcet *object2 = [[NSObjcet alloc] init]; object1å’Œobject2éƒ½æ˜¯NSObjectçš„instaceå¯¹è±¡ï¼ˆå®ä¾‹å¯¹è±¡ï¼‰ï¼Œä½†ä»–ä»¬æ˜¯ä¸åŒçš„ä¸¤ä¸ªå¯¹è±¡ï¼Œå¹¶ä¸”åˆ†åˆ«å æ®ç€ä¸¤å—ä¸åŒçš„å†…å­˜ã€‚instanceå¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯åŒ…æ‹¬ isaæŒ‡é’ˆ å…¶ä»–æˆå‘˜å˜é‡ è¡ç”Ÿé—®é¢˜ï¼šåœ¨ä¸Šå›¾å®ä¾‹å¯¹è±¡ä¸­æ ¹æœ¬æ²¡æœ‰çœ‹åˆ°æ–¹æ³•ï¼Œé‚£ä¹ˆå®ä¾‹å¯¹è±¡çš„æ–¹æ³•çš„ä»£ç æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿé‚£ä¹ˆç±»çš„æ–¹æ³•çš„ä¿¡æ¯ï¼Œåè®®çš„ä¿¡æ¯ï¼Œå±æ€§çš„ä¿¡æ¯éƒ½å­˜æ”¾åœ¨ä»€ä¹ˆåœ°æ–¹å‘¢ï¼Ÿ classå¯¹è±¡ æˆ‘ä»¬é€šè¿‡classæ–¹æ³•æˆ–runtimeæ–¹æ³•å¾—åˆ°ä¸€ä¸ªclasså¯¹è±¡ã€‚classå¯¹è±¡ä¹Ÿå°±æ˜¯ç±»å¯¹è±¡ 1234567Class objectClass1 = [object1 class];Class objectClass2 = [object2 class];Class objectClass3 = [NSObject class];// runtimeClass objectClass4 = object_getClass(object1);Class objectClass5 = object_getClass(object2);NSLog(@\"%p %p %p %p %p\", objectClass1, objectClass2, objectClass3, objectClass4, objectClass5); æ¯ä¸€ä¸ªç±»åœ¨å†…å­˜ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªclasså¯¹è±¡ å¯ä»¥é€šè¿‡æ‰“å°å†…å­˜åœ°å€è¯æ˜ï¼Œclasså¯¹è±¡åœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ 1.isaæŒ‡é’ˆ 2.superclassæŒ‡é’ˆ 3.ç±»çš„å±æ€§ä¿¡æ¯ï¼ˆ@propertyï¼‰ï¼Œç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼ˆivarï¼‰ 4.ç±»çš„å¯¹è±¡æ–¹æ³•ä¿¡æ¯ï¼ˆinstance methodï¼‰ï¼Œç±»çš„åè®®ä¿¡æ¯ï¼ˆprotocolï¼‰ æˆå‘˜å˜é‡çš„å€¼æ—¶å­˜å‚¨åœ¨å®ä¾‹å¯¹è±¡ä¸­çš„ï¼Œå› ä¸ºåªæœ‰å½“æˆ‘ä»¬åˆ›å»ºå®ä¾‹å¯¹è±¡çš„æ—¶å€™æ‰ä¸ºæˆå‘˜å˜èµ‹å€¼ã€‚ä½†æ˜¯æˆå‘˜å˜é‡å«ä»€ä¹ˆåå­—ï¼Œæ˜¯ä»€ä¹ˆç±»å‹ï¼Œåªéœ€è¦æœ‰ä¸€ä»½å°±å¯ä»¥äº†ã€‚ ç±»æ–¹æ³•æ”¾åœ¨é‚£é‡Œï¼Ÿ å…ƒç±»å¯¹è±¡ meta-class 1234567//runtimeä¸­ä¼ å…¥ç±»å¯¹è±¡æ­¤æ—¶å¾—åˆ°çš„å°±æ˜¯å…ƒç±»å¯¹è±¡Class objectMetaClass = object_getClass([NSObject class]);// è€Œè°ƒç”¨ç±»å¯¹è±¡çš„classæ–¹æ³•æ—¶å¾—åˆ°è¿˜æ˜¯ç±»å¯¹è±¡ï¼Œæ— è®ºè°ƒç”¨å¤šå°‘æ¬¡éƒ½æ˜¯ç±»å¯¹è±¡Class cls = [[NSObject class] class];Class objectClass3 = [NSObject class];class_isMetaClass(objectMetaClass) // åˆ¤æ–­è¯¥å¯¹è±¡æ˜¯å¦ä¸ºå…ƒç±»å¯¹è±¡NSLog(@\"%p %p %p\", objectMetaClass, objectClass3, cls); // åé¢ä¸¤ä¸ªåœ°å€ç›¸åŒï¼Œè¯´æ˜å¤šæ¬¡è°ƒç”¨classå¾—åˆ°çš„è¿˜æ˜¯ç±»å¯¹è±¡ æ¯ä¸ªç±»åœ¨å†…å­˜ä¸­æœ‰ä¸”åªæœ‰ä¸€ä¸ªmeta-classå¯¹è±¡ã€‚ meta-classå¯¹è±¡å’Œclasså¯¹è±¡çš„å†…å­˜ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç”¨é€”ä¸ä¸€æ ·ï¼Œåœ¨å†…å­˜ä¸­å­˜å‚¨çš„ä¿¡æ¯ä¸»è¦åŒ…æ‹¬ 1.isaæŒ‡é’ˆ 2.superclassæŒ‡é’ˆ 3.ç±»çš„ç±»æ–¹æ³•çš„ä¿¡æ¯ï¼ˆclass methodï¼‰ meta-classå¯¹è±¡å’Œclasså¯¹è±¡çš„å†…å­˜ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥meta-classä¸­ä¹Ÿæœ‰ç±»çš„å±æ€§ä¿¡æ¯ï¼Œç±»çš„å¯¹è±¡æ–¹æ³•ä¿¡æ¯ç­‰æˆå‘˜å˜é‡ï¼Œä½†æ˜¯å…¶ä¸­çš„å€¼å¯èƒ½æ˜¯ç©ºçš„ã€‚ å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘å“ªé‡Œ? 1.å½“å¯¹è±¡è°ƒç”¨å®ä¾‹æ–¹æ³•çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¸Šé¢è®²åˆ°ï¼Œå®ä¾‹æ–¹æ³•ä¿¡æ¯æ˜¯å­˜å‚¨åœ¨classç±»å¯¹è±¡ä¸­çš„ï¼Œé‚£ä¹ˆè¦æƒ³æ‰¾åˆ°å®ä¾‹æ–¹æ³•ï¼Œå°±å¿…é¡»æ‰¾åˆ°classç±»å¯¹è±¡ï¼Œé‚£ä¹ˆæ­¤æ—¶isaçš„ä½œç”¨å°±æ¥äº†ã€‚ 1[stu studentMethod]; instanceçš„isaæŒ‡å‘classï¼Œå½“è°ƒç”¨å¯¹è±¡æ–¹æ³•æ—¶ï¼Œé€šè¿‡instanceçš„isaæ‰¾åˆ°classï¼Œæœ€åæ‰¾åˆ°å¯¹è±¡æ–¹æ³•çš„å®ç°è¿›è¡Œè°ƒç”¨ã€‚ 2.å½“ç±»å¯¹è±¡è°ƒç”¨ç±»æ–¹æ³•çš„æ—¶å€™ï¼ŒåŒä¸Šï¼Œç±»æ–¹æ³•æ˜¯å­˜å‚¨åœ¨meta-classå…ƒç±»å¯¹è±¡ä¸­çš„ã€‚é‚£ä¹ˆè¦æ‰¾åˆ°ç±»æ–¹æ³•ï¼Œå°±éœ€è¦æ‰¾åˆ°meta-classå…ƒç±»å¯¹è±¡ï¼Œè€Œclassç±»å¯¹è±¡çš„isaæŒ‡é’ˆå°±æŒ‡å‘å…ƒç±»å¯¹è±¡ 1[Student studentClassMethod]; class çš„ isa æŒ‡å‘ meta-class å½“è°ƒç”¨ç±»æ–¹æ³•æ—¶ï¼Œé€šè¿‡ class çš„ isa æ‰¾åˆ° meta-classï¼Œæœ€åæ‰¾åˆ°ç±»æ–¹æ³•çš„å®ç°è¿›è¡Œè°ƒç”¨ 3.å½“å¯¹è±¡è°ƒç”¨å…¶çˆ¶ç±»å¯¹è±¡æ–¹æ³•çš„æ—¶å€™ï¼Œåˆæ˜¯æ€ä¹ˆæ‰¾åˆ°çˆ¶ç±»å¯¹è±¡æ–¹æ³•çš„å‘¢ï¼Ÿï¼Œæ­¤æ—¶å°±éœ€è¦ä½¿ç”¨åˆ°classç±»å¯¹è±¡superclassæŒ‡é’ˆã€‚ 12[stu personMethod];[stu init]; å½“Studentçš„instanceå¯¹è±¡è¦è°ƒç”¨Personçš„å¯¹è±¡æ–¹æ³•æ—¶ï¼Œä¼šå…ˆé€šè¿‡isaæ‰¾åˆ°Studentçš„classï¼Œç„¶åé€šè¿‡superclassæ‰¾åˆ°Personçš„classï¼Œæœ€åæ‰¾åˆ°å¯¹è±¡æ–¹æ³•çš„å®ç°è¿›è¡Œè°ƒç”¨ï¼ŒåŒæ ·å¦‚æœPersonå‘ç°è‡ªå·±æ²¡æœ‰å“åº”çš„å¯¹è±¡æ–¹æ³•ï¼Œåˆä¼šé€šè¿‡Personçš„superclassæŒ‡é’ˆæ‰¾åˆ°NSObjectçš„classå¯¹è±¡ï¼Œå»å¯»æ‰¾å“åº”çš„æ–¹æ³• å½“ç±»å¯¹è±¡è°ƒç”¨çˆ¶ç±»çš„ç±»æ–¹æ³•æ—¶ï¼Œå°±éœ€è¦å…ˆé€šè¿‡isaæŒ‡é’ˆæ‰¾åˆ°meta-classï¼Œç„¶åé€šè¿‡superclasså»å¯»æ‰¾å“åº”çš„æ–¹æ³• 12[Student personClassMethod];[Student load]; å½“Studentçš„classè¦è°ƒç”¨Personçš„ç±»æ–¹æ³•æ—¶ï¼Œä¼šå…ˆé€šè¿‡isaæ‰¾åˆ°Studentçš„meta-classï¼Œç„¶åé€šè¿‡superclassæ‰¾åˆ°Personçš„meta-classï¼Œæœ€åæ‰¾åˆ°ç±»æ–¹æ³•çš„å®ç°è¿›è¡Œè°ƒç”¨ æœ€ååˆæ˜¯è¿™å¼ é™å®šçš„isaæŒ‡å‘å›¾ï¼Œç»è¿‡ä¸Šé¢çš„åˆ†ææˆ‘ä»¬åœ¨æ¥çœ‹è¿™å¼ å›¾ï¼Œå°±æ˜¾å¾—æ¸…æ™°æ˜äº†å¾ˆå¤šã€‚ å¯¹isaã€superclassæ€»ç»“ 1.instanceçš„isaæŒ‡å‘class 2.classçš„isaæŒ‡å‘meta-class 3.meta-classçš„isaæŒ‡å‘åŸºç±»çš„meta-classï¼ŒåŸºç±»çš„isaæŒ‡å‘è‡ªå·± 4.classçš„superclassæŒ‡å‘çˆ¶ç±»çš„classï¼Œå¦‚æœæ²¡æœ‰çˆ¶ç±»ï¼ŒsuperclassæŒ‡é’ˆä¸ºnil 5.meta-classçš„superclassæŒ‡å‘çˆ¶ç±»çš„meta-classï¼ŒåŸºç±»çš„meta-classçš„superclassæŒ‡å‘åŸºç±»çš„class 6.instanceè°ƒç”¨å¯¹è±¡æ–¹æ³•çš„è½¨è¿¹ï¼Œisaæ‰¾åˆ°classï¼Œæ–¹æ³•ä¸å­˜åœ¨ï¼Œå°±é€šè¿‡superclassæ‰¾çˆ¶ç±» 7.classè°ƒç”¨ç±»æ–¹æ³•çš„è½¨è¿¹ï¼Œisaæ‰¾meta-classï¼Œæ–¹æ³•ä¸å­˜åœ¨ï¼Œå°±é€šè¿‡superclassæ‰¾çˆ¶ç±» å¦‚ä½•è¯æ˜isaæŒ‡é’ˆçš„æŒ‡å‘çœŸçš„å¦‚ä¸Šé¢æ‰€è¯´ï¼Ÿæˆ‘ä»¬é€šè¿‡å¦‚ä¸‹ä»£ç è¯æ˜ï¼š1234NSObject *object = [[NSObject alloc] init];Class objectClass = [NSObject class];Class objectMetaClass = object_getClass([NSObject class]);NSLog(@\"%p %p %p\", object, objectClass, objectMetaClass); æ‰“æ–­ç‚¹å¹¶é€šè¿‡æ§åˆ¶å°æ‰“å°ç›¸åº”å¯¹è±¡çš„isaæŒ‡é’ˆ æˆ‘ä»¬å‘ç°object-&gt;isaä¸objectClassçš„åœ°å€ä¸åŒï¼Œè¿™æ˜¯å› ä¸ºä»64bitå¼€å§‹ï¼Œisaéœ€è¦è¿›è¡Œä¸€æ¬¡ä½è¿ç®—ï¼Œæ‰èƒ½è®¡ç®—å‡ºçœŸå®åœ°å€ã€‚è€Œä½è¿ç®—çš„å€¼æˆ‘ä»¬å¯ä»¥é€šè¿‡ä¸‹è½½objcæºä»£ç æ‰¾åˆ°ã€‚ æˆ‘ä»¬é€šè¿‡ä½è¿ç®—è¿›è¡ŒéªŒè¯ã€‚ æˆ‘ä»¬å‘ç°ï¼Œobject-isaæŒ‡é’ˆåœ°å€0x001dffff96537141ç»è¿‡åŒ0x00007ffffffffff8ä½è¿ç®—ï¼Œå¾—å‡ºobjectClassçš„åœ°å€0x00007fff96537140 æ¥ç€æˆ‘ä»¬æ¥éªŒè¯classå¯¹è±¡çš„isaæŒ‡é’ˆæ˜¯å¦åŒæ ·éœ€è¦ä½è¿ç®—è®¡ç®—å‡ºmeta-classå¯¹è±¡çš„åœ°å€ã€‚å½“æˆ‘ä»¬ä»¥åŒæ ·çš„æ–¹å¼æ‰“å°objectClass-&gt;isaæŒ‡é’ˆæ—¶ï¼Œå‘ç°æ— æ³•æ‰“å° åŒæ—¶ä¹Ÿå‘ç°å·¦è¾¹objectClasså¯¹è±¡ä¸­å¹¶æ²¡æœ‰isaæŒ‡é’ˆã€‚æˆ‘ä»¬æ¥åˆ°Classå†…éƒ¨çœ‹ä¸€ä¸‹ 12345678910111213141516typedef struct objc_class *Class;struct objc_class &#123; Class _Nonnull isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class _Nullable super_class OBJC2_UNAVAILABLE; const char * _Nonnull name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list * _Nullable ivars OBJC2_UNAVAILABLE; struct objc_method_list * _Nullable * _Nullable methodLists OBJC2_UNAVAILABLE; struct objc_cache * _Nonnull cache OBJC2_UNAVAILABLE; struct objc_protocol_list * _Nullable protocols OBJC2_UNAVAILABLE;#endif&#125; OBJC2_UNAVAILABLE;/* Use `Class` instead of `struct objc_class *` */ ç›¸ä¿¡äº†è§£è¿‡isaæŒ‡é’ˆçš„åŒå­¦å¯¹objc_classç»“æ„ä½“å†…çš„å†…å®¹å¾ˆç†Ÿæ‚‰äº†ï¼Œä»Šå¤©è¿™é‡Œä¸æ·±å…¥ç ”ç©¶ï¼Œæˆ‘ä»¬åªçœ‹ç¬¬ä¸€ä¸ªå¯¹è±¡æ˜¯ä¸€ä¸ªisaæŒ‡é’ˆï¼Œä¸ºäº†æ‹¿åˆ°isaæŒ‡é’ˆçš„åœ°å€ï¼Œæˆ‘ä»¬è‡ªå·±åˆ›å»ºä¸€ä¸ªåŒæ ·çš„ç»“æ„ä½“å¹¶é€šè¿‡å¼ºåˆ¶è½¬åŒ–æ‹¿åˆ°isaæŒ‡é’ˆã€‚ 12345struct xx_cc_objc_class&#123;Class isa;&#125;;Class objectClass = [NSObject class];struct xx_cc_objc_class *objectClass2 = (__bridge struct xx_cc_objc_class *)(objectClass); æ­¤æ—¶æˆ‘ä»¬é‡æ–°éªŒè¯ä¸€ä¸‹ ç¡®å®ï¼ŒobjectClass2çš„isaæŒ‡é’ˆç»è¿‡ä½è¿ç®—ä¹‹åçš„åœ°å€æ˜¯meta-classçš„åœ°å€ã€‚ å…³äºOC Class çš„åº•å±‚å®ç°Classçš„æœ¬è´¨æˆ‘ä»¬çŸ¥é“ä¸ç®¡æ˜¯ç±»å¯¹è±¡è¿˜æ˜¯å…ƒç±»å¯¹è±¡ï¼Œç±»å‹éƒ½æ˜¯Classï¼Œclasså’Œmete-classçš„åº•å±‚éƒ½æ˜¯objc_classç»“æ„ä½“çš„æŒ‡é’ˆï¼Œå†…å­˜ä¸­å°±æ˜¯ç»“æ„ä½“ï¼Œæœ¬ç« æ¥æ¢å¯»Classçš„æœ¬è´¨ã€‚ 12Class objectClass = [NSObject class]; Class objectMetaClass = object_getClass([NSObject class]); ç‚¹å‡»Classæ¥åˆ°å†…éƒ¨ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° 1typedef struct objc_class *Class; Classå¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ªæŒ‡å‘objc_classç»“æ„ä½“çš„æŒ‡é’ˆã€‚å› æ­¤æˆ‘ä»¬å¯ä»¥è¯´ç±»å¯¹è±¡æˆ–å…ƒç±»å¯¹è±¡åœ¨å†…å­˜ä¸­å…¶å®å°±æ˜¯objc_classç»“æ„ä½“ã€‚ æˆ‘ä»¬æ¥åˆ°objc_classå†…éƒ¨ï¼Œå¯ä»¥çœ‹åˆ°è¿™æ®µåœ¨åº•å±‚åŸç†ä¸­ç»å¸¸å‡ºç°çš„ä»£ç ã€‚ 123456789101112131415struct objc_class &#123; Class _Nonnull isa OBJC_ISA_AVAILABILITY;#if !__OBJC2__ Class _Nullable super_class OBJC2_UNAVAILABLE; const char * _Nonnull name OBJC2_UNAVAILABLE; long version OBJC2_UNAVAILABLE; long info OBJC2_UNAVAILABLE; long instance_size OBJC2_UNAVAILABLE; struct objc_ivar_list * _Nullable ivars OBJC2_UNAVAILABLE; struct objc_method_list * _Nullable * _Nullable methodLists OBJC2_UNAVAILABLE; struct objc_cache * _Nonnull cache OBJC2_UNAVAILABLE; struct objc_protocol_list * _Nullable protocols OBJC2_UNAVAILABLE;#endif&#125; OBJC2_UNAVAILABLE;/* Use `Class` instead of `struct objc_class *` */ è¿™éƒ¨åˆ†ä»£ç ç›¸ä¿¡åœ¨æ–‡ç« ä¸­å¾ˆå¸¸è§ï¼Œä½†æ˜¯OBJC2_UNAVAILABLE;è¯´æ˜è¿™äº›ä»£ç å·²ç»ä¸åœ¨ä½¿ç”¨äº†ã€‚é‚£ä¹ˆç›®å‰objc_classçš„ç»“æ„æ˜¯ä»€ä¹ˆæ ·çš„å‘¢ï¼Ÿæˆ‘ä»¬é€šè¿‡objcæºç ä¸­å»æŸ¥æ‰¾objc_classç»“æ„ä½“çš„å†…å®¹ æˆ‘ä»¬å‘ç°è¿™ä¸ªç»“æ„ä½“ç»§æ‰¿ objc_object å¹¶ä¸”ç»“æ„ä½“å†…æœ‰ä¸€äº›å‡½æ•°ï¼Œå› ä¸ºè¿™æ˜¯c++ç»“æ„ä½“ï¼Œåœ¨cä¸Šåšäº†æ‰©å±•ï¼Œå› æ­¤ç»“æ„ä½“ä¸­å¯ä»¥åŒ…å«å‡½æ•°ã€‚æˆ‘ä»¬æ¥åˆ°objc_objectå†…ï¼Œæˆªå–éƒ¨åˆ†ä»£ç  æˆ‘ä»¬å‘ç°objc_objectä¸­æœ‰ä¸€ä¸ªisaæŒ‡é’ˆï¼Œé‚£ä¹ˆobjc_classç»§æ‰¿objc_objectï¼Œä¹Ÿå°±åŒæ ·æ‹¥æœ‰ä¸€ä¸ªisaæŒ‡é’ˆ é‚£ä¹ˆæˆ‘ä»¬ä¹‹å‰äº†è§£åˆ°çš„ï¼Œç±»ä¸­å­˜å‚¨çš„ç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œå®ä¾‹æ–¹æ³•ï¼Œå±æ€§åç­‰è¿™äº›ä¿¡æ¯åœ¨å“ªé‡Œå‘¢ã€‚æˆ‘ä»¬æ¥åˆ°class_rw_tä¸­ï¼Œæˆªå–éƒ¨åˆ†ä»£ç ï¼Œæˆ‘ä»¬å‘ç°class_rw_tä¸­å­˜å‚¨ç€æ–¹æ³•åˆ—è¡¨ï¼Œå±æ€§åˆ—è¡¨ï¼Œåè®®åˆ—è¡¨ç­‰å†…å®¹ã€‚ è€Œclass_rw_tæ˜¯é€šè¿‡bitsè°ƒç”¨dataæ–¹æ³•å¾—æ¥çš„ï¼Œæˆ‘ä»¬æ¥åˆ°dataæ–¹æ³•å†…éƒ¨å®ç°ã€‚æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œdataå‡½æ•°å†…éƒ¨ä»…ä»…å¯¹bitsè¿›è¡Œ&amp;FAST_DATA_MASKæ“ä½œ è€Œæˆå‘˜å˜é‡ä¿¡æ¯åˆ™æ˜¯å­˜å‚¨åœ¨class_ro_tå†…éƒ¨ä¸­çš„ï¼Œæˆ‘ä»¬æ¥åˆ°class_ro_tå†…æŸ¥çœ‹ æœ€åæ€»ç»“é€šè¿‡ä¸€å¼ å›¾è¿›è¡Œæ€»ç»“ æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ä¸€ä¸ªç»“æ„ä½“ï¼Œå¦‚æœæˆ‘ä»¬è‡ªå·±å†™çš„ç»“æ„å’Œobjc_classçœŸå®ç»“æ„æ˜¯ä¸€æ ·çš„ï¼Œé‚£ä¹ˆå½“æˆ‘ä»¬å¼ºåˆ¶è½¬åŒ–çš„æ—¶å€™ï¼Œå°±ä¼šä¸€ä¸€å¯¹åº”çš„èµ‹å€¼ã€‚æ­¤æ—¶æˆ‘ä»¬å°±å¯ä»¥æ‹¿åˆ°ç»“æ„ä½“å†…éƒ¨çš„ä¿¡æ¯ã€‚ ä¸‹åˆ—ä»£ç æ˜¯æˆ‘ä»¬ä»¿ç…§objc_classç»“æ„ä½“ï¼Œæå–å…¶ä¸­éœ€è¦ä½¿ç”¨åˆ°çš„ä¿¡æ¯ï¼Œè‡ªå®šä¹‰çš„ä¸€ä¸ªç»“æ„ä½“ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115#import &lt;Foundation/Foundation.h&gt;#ifndef XXClassInfo_h#define XXClassInfo_h# if __arm64__# define ISA_MASK 0x0000000ffffffff8ULL# elif __x86_64__# define ISA_MASK 0x00007ffffffffff8ULL# endif#if __LP64__ typedef uint32_t mask_t;#else typedef uint16_t mask_t;#endif typedef uintptr_t cache_key_t;struct bucket_t &#123; cache_key_t _key; IMP _imp;&#125;;struct cache_t &#123; bucket_t *_buckets; mask_t _mask; mask_t _occupied;&#125;;struct entsize_list_tt &#123; uint32_t entsizeAndFlags; uint32_t count;&#125;;struct method_t &#123; SEL name; const char *types; IMP imp;&#125;;struct method_list_t : entsize_list_tt &#123; method_t first;&#125;;struct ivar_t &#123; int32_t *offset; const char *name; const char *type; uint32_t alignment_raw; uint32_t size;&#125;;struct ivar_list_t : entsize_list_tt &#123; ivar_t first;&#125;;struct property_t &#123; const char *name; const char *attributes;&#125;;struct property_list_t : entsize_list_tt &#123; property_t first;&#125;;struct chained_property_list &#123; chained_property_list *next; uint32_t count; property_t list[0];&#125;;typedef uintptr_t protocol_ref_t; struct protocol_list_t &#123; uintptr_t count; protocol_ref_t list[0];&#125;;struct class_ro_t &#123; uint32_t flags; uint32_t instanceStart; uint32_t instanceSize; // instanceå¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´#ifdef __LP64__ uint32_t reserved;#endif const uint8_t * ivarLayout; const char * name; // ç±»å method_list_t * baseMethodList; protocol_list_t * baseProtocols; const ivar_list_t * ivars; // æˆå‘˜å˜é‡åˆ—è¡¨ const uint8_t * weakIvarLayout; property_list_t *baseProperties;&#125;;struct class_rw_t &#123; uint32_t flags; uint32_t version; const class_ro_t *ro; method_list_t * methods; // æ–¹æ³•åˆ—è¡¨ property_list_t *properties; // å±æ€§åˆ—è¡¨ const protocol_list_t * protocols; // åè®®åˆ—è¡¨ Class firstSubclass; Class nextSiblingClass; char *demangledName;&#125;;#define FAST_DATA_MASK 0x00007ffffffffff8ULstruct class_data_bits_t &#123; uintptr_t bits; public: class_rw_t* data() &#123; // æä¾›data()æ–¹æ³•è¿›è¡Œ &amp; FAST_DATA_MASK æ“ä½œ return (class_rw_t *)(bits &amp; FAST_DATA_MASK); &#125;&#125;;/* OCå¯¹è±¡ */struct xx_objc_object &#123; void *isa;&#125;;/* ç±»å¯¹è±¡ */struct xx_objc_class : xx_objc_object &#123; Class superclass; cache_t cache; class_data_bits_t bits; public: class_rw_t* data() &#123; return bits.data(); &#125; xx_objc_class* metaClass() &#123; // æä¾›metaClasså‡½æ•°ï¼Œè·å–å…ƒç±»å¯¹è±¡ // ä¸Šä¸€ç¯‡æˆ‘ä»¬è®²è§£è¿‡ï¼ŒisaæŒ‡é’ˆéœ€è¦ç»è¿‡ä¸€æ¬¡ &amp; ISA_MASKæ“ä½œä¹‹åæ‰å¾—åˆ°çœŸæ­£çš„åœ°å€ return (xx_objc_class *)((long long)isa &amp; ISA_MASK); &#125;&#125;;#endif /* XXClassInfo_h */ æ¥ä¸‹æ¥æˆ‘ä»¬å°†è‡ªå·±å®šä¹‰çš„ç±»å¼ºåˆ¶è½¬åŒ–ä¸ºæˆ‘ä»¬è‡ªå®šä¹‰çš„ç²¾ç®€çš„classç»“æ„ä½“ç±»å‹ã€‚ 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051#import &lt;Foundation/Foundation.h&gt;#import &lt;objc/runtime.h&gt;#import \"XXClassInfo.h\"/* Person */@interface Person : NSObject &lt;NSCopying&gt; &#123; @public int _age;&#125;@property (nonatomic, assign) int height;- (void)personMethod;+ (void)personClassMethod;@end@implementation Person- (void)personMethod &#123;&#125;+ (void)personClassMethod &#123;&#125;@end/* Student */@interface Student : Person &lt;NSCoding&gt; &#123; @public int _no;&#125;@property (nonatomic, assign) int score;- (void)studentMethod;+ (void)studentClassMethod;@end@implementation Student- (void)studentMethod &#123;&#125;+ (void)studentClassMethod &#123;&#125;@endint main(int argc, const char * argv[]) &#123; @autoreleasepool &#123; NSObject *object = [[NSObject alloc] init]; Person *person = [[Person alloc] init]; Student *student = [[Student alloc] init]; xx_objc_class *objectClass = (__bridge xx_objc_class *)[object class]; xx_objc_class *personClass = (__bridge xx_objc_class *)[person class]; xx_objc_class *studentClass = (__bridge xx_objc_class *)[student class]; xx_objc_class *objectMetaClass = objectClass-&gt;metaClass(); xx_objc_class *personMetaClass = personClass-&gt;metaClass(); xx_objc_class *studentMetaClass = studentClass-&gt;metaClass(); class_rw_t *objectClassData = objectClass-&gt;data(); class_rw_t *personClassData = personClass-&gt;data(); class_rw_t *studentClassData = studentClass-&gt;data(); class_rw_t *objectMetaClassData = objectMetaClass-&gt;data(); class_rw_t *personMetaClassData = personMetaClass-&gt;data(); class_rw_t *studentMetaClassData = studentMetaClass-&gt;data(); // 0x00007ffffffffff8 NSLog(@\"%p %p %p %p %p %p\", objectClassData, personClassData, studentClassData, objectMetaClassData, personMetaClassData, studentMetaClassData); return 0;&#125; é€šè¿‡æ‰“æ–­ç‚¹ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°classå†…éƒ¨ä¿¡æ¯ã€‚ è‡³æ­¤ï¼Œæˆ‘ä»¬å†æ¬¡æ‹¿å‡ºé‚£å¼ ç»å…¸çš„å›¾ï¼ŒæŒ¨ä¸ªåˆ†æå›¾ä¸­isaæŒ‡é’ˆå’ŒsuperclassæŒ‡é’ˆçš„æŒ‡å‘ instanceå¯¹è±¡é¦–å…ˆæˆ‘ä»¬æ¥çœ‹instanceå¯¹è±¡ï¼Œæˆ‘ä»¬é€šè¿‡ä¸Šä¸€ç¯‡æ–‡ç« çŸ¥é“ï¼Œinstanceå¯¹è±¡ä¸­å­˜å‚¨ç€isaæŒ‡é’ˆå’Œå…¶ä»–æˆå‘˜å˜é‡ï¼Œå¹¶ä¸”instanceå¯¹è±¡çš„isaæŒ‡é’ˆæ˜¯æŒ‡å‘å…¶ç±»å¯¹è±¡åœ°å€çš„ã€‚æˆ‘ä»¬é¦–å…ˆåˆ†æä¸Šè¿°ä»£ç ä¸­æˆ‘ä»¬åˆ›å»ºçš„objectï¼Œpersonï¼Œstudentä¸‰ä¸ªinstanceå¯¹è±¡ä¸å…¶ç›¸å¯¹åº”çš„ç±»å¯¹è±¡objectClassï¼ŒpersonClassï¼ŒstudentClassã€‚ ä»ä¸Šå›¾ä¸­æˆ‘ä»¬å¯ä»¥å‘ç°instanceå¯¹è±¡ä¸­ç¡®å®å­˜å‚¨äº†isaæŒ‡é’ˆå’Œå…¶æˆå‘˜å˜é‡ï¼ŒåŒæ—¶å°†instanceå¯¹è±¡çš„isaæŒ‡é’ˆç»è¿‡&amp;è¿ç®—ä¹‹åè®¡ç®—å‡ºçš„åœ°å€ç¡®å®æ˜¯å…¶ç›¸åº”ç±»å¯¹è±¡çš„å†…å­˜åœ°å€ã€‚ç”±æ­¤æˆ‘ä»¬è¯æ˜isaï¼ŒsuperclassæŒ‡å‘å›¾ä¸­çš„1ï¼Œ2ï¼Œ3å·çº¿ã€‚ classå¯¹è±¡æ¥ç€æˆ‘ä»¬æ¥çœ‹classå¯¹è±¡ï¼ŒåŒæ ·é€šè¿‡ä¸Šä¸€ç¯‡æ–‡ç« ï¼Œæˆ‘ä»¬æ˜ç¡®classå¯¹è±¡ä¸­å­˜å‚¨ç€isaæŒ‡é’ˆï¼ŒsuperclassæŒ‡é’ˆï¼Œä»¥åŠç±»çš„å±æ€§ä¿¡æ¯ï¼Œç±»çš„æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œç±»çš„å¯¹è±¡æ–¹æ³•ï¼Œå’Œç±»çš„åè®®ä¿¡æ¯ï¼Œè€Œé€šè¿‡ä¸Šé¢å¯¹objectæºç çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨classå¯¹è±¡çš„class_rw_tä¸­ï¼Œæˆ‘ä»¬é€šè¿‡å¼ºåˆ¶è½¬åŒ–æ¥çª¥æ¢å…¶ä¸­çš„å†…å®¹ã€‚å¦‚ä¸‹å›¾ ä¸Šå›¾ä¸­æˆ‘ä»¬é€šè¿‡æ¨¡æ‹Ÿå¯¹personç±»å¯¹è±¡è°ƒç”¨.dataå‡½æ•°ï¼Œå³å¯¹bitsè¿›è¡Œ&amp;FAST_DATA_MASK(0x00007ffffffffff8UL)è¿ç®—ï¼Œå¹¶è½¬åŒ–ä¸ºclass_rw_tã€‚å³ä¸Šå›¾ä¸­çš„personClassDataã€‚å…¶ä¸­æˆ‘ä»¬å‘ç°æˆå‘˜å˜é‡ä¿¡æ¯ï¼Œå¯¹è±¡æ–¹æ³•ï¼Œå±æ€§ç­‰ä¿¡æ¯åªæ˜¾ç¤ºfirstç¬¬ä¸€ä¸ªï¼Œå¦‚æœæƒ³è¦æ‹¿åˆ°æ›´å¤šçš„éœ€è¦é€šè¿‡ä»£ç å°†æŒ‡é’ˆåç§»è·å–ã€‚ è€Œä¸Šå›¾ä¸­çš„instaceSize = 16ä¹ŸåŒpersonå¯¹è±¡ä¸­isaæŒ‡é’ˆ8ä¸ªå­—èŠ‚+_age4ä¸ªå­—èŠ‚+_height4ä¸ªå­—èŠ‚ç›¸å¯¹åº”èµ·æ¥ã€‚è¿™é‡Œä¸åœ¨å±•å¼€å¯¹objectClassDataåŠstudentClassDataè¿›è¡Œåˆ†æï¼ŒåŸºæœ¬å†…å®¹åŒpersonClassDataç›¸åŒã€‚ é‚£ä¹ˆç±»å¯¹è±¡ä¸­çš„isaæŒ‡é’ˆå’ŒsuperclassæŒ‡é’ˆçš„æŒ‡å‘æ˜¯å¦å¦‚é‚£å¼ ç»å…¸çš„å›¾ç¤ºå‘¢ï¼Ÿæˆ‘ä»¬æ¥éªŒè¯ä¸€ä¸‹ã€‚ é€šè¿‡ä¸Šå›¾ä¸­çš„å†…å­˜åœ°å€çš„åˆ†æï¼Œç”±æ­¤æˆ‘ä»¬è¯æ˜isaï¼ŒsuperclassæŒ‡å‘å›¾ä¸­ï¼ŒisaæŒ‡é’ˆçš„4ï¼Œ5ï¼Œ6å·çº¿ï¼Œä»¥åŠsuperclassæŒ‡é’ˆçš„10ï¼Œ11ï¼Œ12å·çº¿ã€‚ meta-classå¯¹è±¡æœ€åæˆ‘ä»¬æ¥çœ‹meta-classå…ƒç±»å¯¹è±¡ï¼Œä¸Šæ–‡æåˆ°meta-classä¸­å­˜å‚¨ç€isaæŒ‡é’ˆï¼ŒsuperclassæŒ‡é’ˆï¼Œä»¥åŠç±»çš„ç±»æ–¹æ³•ä¿¡æ¯ã€‚åŒæ—¶æˆ‘ä»¬çŸ¥é“meta-classå…ƒç±»å¯¹è±¡ä¸classç±»å¯¹è±¡ï¼Œå…·æœ‰ç›¸åŒçš„ç»“æ„ï¼Œåªä¸è¿‡å­˜å‚¨çš„ä¿¡æ¯ä¸åŒï¼Œå¹¶ä¸”å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘åŸºç±»çš„å…ƒç±»å¯¹è±¡ï¼ŒåŸºç±»çš„å…ƒç±»å¯¹è±¡çš„isaæŒ‡é’ˆæŒ‡å‘è‡ªå·±ã€‚å…ƒç±»å¯¹è±¡çš„superclassæŒ‡é’ˆæŒ‡å‘å…¶çˆ¶ç±»çš„å…ƒç±»å¯¹è±¡ï¼ŒåŸºç±»çš„å…ƒç±»å¯¹è±¡çš„superclassæŒ‡é’ˆæŒ‡å‘å…¶ç±»å¯¹è±¡ã€‚ ä¸classå¯¹è±¡ç›¸åŒï¼Œæˆ‘ä»¬åŒæ ·é€šè¿‡æ¨¡æ‹Ÿå¯¹personå…ƒç±»å¯¹è±¡è°ƒç”¨.dataå‡½æ•°ï¼Œå³å¯¹bitsè¿›è¡Œ&amp;FAST_DATA_MASK(0x00007ffffffffff8UL)è¿ç®—ï¼Œå¹¶è½¬åŒ–ä¸ºclass_rw_tã€‚ é¦–å…ˆæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ç»“æ„åŒpersonClassDataç›¸åŒï¼Œå¹¶ä¸”æˆå‘˜å˜é‡åŠå±æ€§åˆ—è¡¨ç­‰ä¿¡æ¯ä¸ºç©ºï¼Œè€Œmethodsä¸­å­˜å‚¨ç€ç±»æ–¹æ³•personClassMethodã€‚ æ¥ç€æ¥éªŒè¯isaåŠsuperclassæŒ‡é’ˆçš„æŒ‡å‘æ˜¯å¦åŒä¸Šå›¾åºå·æ ‡æ³¨ä¸€æ ·ã€‚ ä¸Šå›¾ä¸­é€šè¿‡åœ°å€è¯æ˜meta-classçš„isaæŒ‡å‘åŸºç±»çš„meta-classï¼ŒåŸºç±»çš„isaæŒ‡é’ˆä¹ŸæŒ‡å‘è‡ªå·±ã€‚ ä¸Šå›¾ä¸­é€šè¿‡åœ°å€è¯æ˜meta-classçš„superclassæŒ‡å‘çˆ¶ç±»çš„meta-classï¼ŒåŸºç±»çš„meta-classçš„superclassæŒ‡å‘åŸºç±»çš„classç±»ã€‚ ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://juejin.im/post/5ac81c75518825556534c0afã€https://juejin.im/post/5ad210636fb9a028da7cf90c","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS Principleï¼šLLVMAndClang","slug":"iOS Principle LLVMAndClang","date":"2018-05-29T13:56:27.000Z","updated":"2018-11-16T13:24:49.138Z","comments":true,"path":"2018/05/29/iOS Principle LLVMAndClang/","link":"","permalink":"https://reversescale.github.io/2018/05/29/iOS Principle LLVMAndClang/","excerpt":"LLVM æ˜¯ Low Level Virtual Machine çš„ç®€ç§°ï¼Œè¿™ä¸ªåº“æä¾›äº†ä¸ç¼–è¯‘å™¨ç›¸å…³çš„æ”¯æŒï¼Œèƒ½å¤Ÿè¿›è¡Œç¨‹åºè¯­è¨€çš„ç¼–è¯‘æœŸä¼˜åŒ–ã€é“¾æ¥ä¼˜åŒ–ã€åœ¨çº¿ç¼–è¯‘ä¼˜åŒ–ã€ä»£ç ç”Ÿæˆã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¯ä»¥ä½œä¸ºå¤šç§è¯­è¨€ç¼–è¯‘å™¨çš„åå°æ¥ä½¿ç”¨~","text":"LLVM æ˜¯ Low Level Virtual Machine çš„ç®€ç§°ï¼Œè¿™ä¸ªåº“æä¾›äº†ä¸ç¼–è¯‘å™¨ç›¸å…³çš„æ”¯æŒï¼Œèƒ½å¤Ÿè¿›è¡Œç¨‹åºè¯­è¨€çš„ç¼–è¯‘æœŸä¼˜åŒ–ã€é“¾æ¥ä¼˜åŒ–ã€åœ¨çº¿ç¼–è¯‘ä¼˜åŒ–ã€ä»£ç ç”Ÿæˆã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¯ä»¥ä½œä¸ºå¤šç§è¯­è¨€ç¼–è¯‘å™¨çš„åå°æ¥ä½¿ç”¨~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo æ–¹ä¾¿è®°å¿† ç¼–è¯‘è¯­è¨€ï¼šOC å’Œ Swift åŸºäº Clang å’Œ LLVM æ¥ç¼–è¯‘ï¼ˆClang å‰ç«¯ã€LLVM åç«¯ï¼‰ ç‰¹ç‚¹ï¼šClang æ›´å¿«ã€å†…å­˜å ç”¨å°ã€å…¼å®¹GCCã€è®¾è®¡ç®€å•ã€æ¨¡å—åŒ–åº“ï¼ˆGCC æ”¯æŒJAVAç­‰å’Œæ›´å¤šå¹³å°ï¼‰ ç¼–è¯‘å·¥ä½œï¼šClang è¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æï¼Œç”Ÿæˆä¸­é—´ä»£ç ï¼›LLVM æœºå™¨æ— å…³çš„ä»£ç ä¼˜åŒ–ï¼Œç”Ÿæˆæœºå™¨è¯­è¨€ ç¼–è¯‘å®Œæˆï¼šç”Ÿæˆ dSYM æ–‡ä»¶å­˜æ”¾å‡½æ•°åœ°å€æ˜ å°„ï¼ŒFabricã€å‹ç›Ÿç­‰å´©æºƒè§£æ ç¼–è¯‘æ’å…¥ï¼šé¢„å¤„ç†â€”â€”å®ã€æ’å…¥è„šæœ¬â€”â€”cocoapod ç¼–è¯‘æ—¶é—´ä¼˜åŒ–ï¼š ä»£ç å±‚â€”ä¼˜åŒ–@classä»£æ›¿#importã€æ‰“åŒ…åº“ã€å¤´æ–‡ä»¶è¿›è¡Œé¢„ç¼–è¯‘ï¼› ç¼–è¯‘å™¨å±‚â€”debugæ¨¡å¼ä¸ç”Ÿæˆdsymå’Œå¼€å¯Build Active Architectureå¹¶ä¸”å…³é—­ç¼–è¯‘å™¨ä¼˜åŒ–Only æ•´ç†å­¦ä¹  iOS Principle ä¸€ç³»åˆ—çš„æ–‡ç« ï¼Œæ¯ç¯‡å¼€å¤´å½’ç»“çŸ¥è¯†ç‚¹ï¼Œå¸®åŠ©è®°å¿† ç›¸å…³æ¦‚å¿µå†å²åŸå› 2000å¹´ï¼Œä¼Šåˆ©è¯ºä¼Šå¤§å­¦å„å·´çº³ï¼é¦™æ§Ÿåˆ†æ ¡ï¼ˆUniversity of Illinois at Urbana-Champaign ç®€ç§°UIUCï¼‰è¿™æ‰€äº«æœ‰ä¸–ç•Œå£°æœ›çš„ä¸€æµå…¬ç«‹ç ”ç©¶å‹å¤§å­¦çš„ Chris Lattnerï¼ˆä»–çš„ twitter @clattner_llvm ï¼‰ å¼€å‘äº†ä¸€ä¸ªå«ä½œ Low Level Virtual Machine çš„ç¼–è¯‘å™¨å¼€å‘å·¥å…·å¥—ä»¶ï¼Œåæ¥æ¶‰åŠèŒƒå›´è¶Šæ¥è¶Šå¤§ï¼Œå¯ä»¥ç”¨äºå¸¸è§„ç¼–è¯‘å™¨ï¼ŒJITç¼–è¯‘å™¨ï¼Œæ±‡ç¼–å™¨ï¼Œè°ƒè¯•å™¨ï¼Œé™æ€åˆ†æå·¥å…·ç­‰ä¸€ç³»åˆ—è·Ÿç¼–ç¨‹è¯­è¨€ç›¸å…³çš„å·¥ä½œï¼Œäºæ˜¯å°±æŠŠç®€ç§° LLVM è¿™ä¸ªç®€ç§°ä½œä¸ºäº†æ­£å¼çš„åå­—ã€‚Chris Lattner åæ¥åˆå¼€å‘äº† Clangï¼Œä½¿å¾— LLVM ç›´æ¥æŒ‘æˆ˜ GCC çš„åœ°ä½ã€‚2012å¹´ï¼ŒLLVM è·å¾—ç¾å›½è®¡ç®—æœºå­¦ä¼š ACM çš„è½¯ä»¶ç³»ç»Ÿå¤§å¥–ï¼Œå’Œ UNIXï¼ŒWWWï¼ŒTCP/IPï¼ŒTexï¼ŒJAVA ç­‰é½åã€‚ Chris Lattner ç”Ÿäº 1978 å¹´ï¼Œ2005å¹´åŠ å…¥è‹¹æœï¼Œå°†è‹¹æœä½¿ç”¨çš„ GCC å…¨é¢è½¬ä¸º LLVMã€‚2010å¹´å¼€å§‹ä¸»å¯¼å¼€å‘ Swift è¯­è¨€ã€‚ iOS å¼€å‘ä¸­ Objective-C æ˜¯ Clang / LLVM æ¥ç¼–è¯‘çš„ã€‚ Swift æ˜¯ Swift / LLVMï¼Œå…¶ä¸­ Swift å‰ç«¯ä¼šå¤šå‡º SIL optimizerï¼Œå®ƒä¼šæŠŠ .swift ç”Ÿæˆä¸ºä¸­é—´ä»£ç  .sil å±äº High-Level IRï¼Œ å› ä¸º Swift åœ¨ç¼–è¯‘æ—¶å°±å®Œæˆäº†æ–¹æ³•ç»‘å®šï¼Œç›´æ¥é€šè¿‡åœ°å€è°ƒç”¨å±äºå¼ºç±»å‹è¯­è¨€ï¼Œæ–¹æ³•è°ƒç”¨ä¸å†æ˜¯åƒOCé‚£æ ·çš„æ¶ˆæ¯å‘é€ï¼Œè¿™æ ·ç¼–è¯‘å°±å¯ä»¥è·å¾—æ›´å¤šçš„ä¿¡æ¯ç”¨åœ¨åé¢çš„åç«¯ä¼˜åŒ–ä¸Šã€‚ LLVMæ˜¯ä¸€ä¸ªæ¨¡å—åŒ–å’Œå¯é‡ç”¨çš„ç¼–è¯‘å™¨å’Œå·¥å…·é“¾æŠ€æœ¯çš„é›†åˆï¼ŒClang æ˜¯ LLVM çš„å­é¡¹ç›®ï¼Œæ˜¯ Cï¼ŒC++ å’Œ Objective-C ç¼–è¯‘å™¨ï¼Œç›®çš„æ˜¯æä¾›æƒŠäººçš„å¿«é€Ÿç¼–è¯‘ï¼Œæ¯” GCC å¿«3å€ï¼Œå…¶ä¸­çš„ clang static analyzer ä¸»è¦æ˜¯è¿›è¡Œè¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æå’Œç”Ÿæˆä¸­é—´ä»£ç ï¼Œå½“ç„¶è¿™ä¸ªè¿‡ç¨‹ä¼šå¯¹ä»£ç è¿›è¡Œæ£€æŸ¥ï¼Œå‡ºé”™çš„å’Œéœ€è¦è­¦å‘Šçš„ä¼šæ ‡æ³¨å‡ºæ¥ã€‚LLVM æ ¸å¿ƒåº“æä¾›ä¸€ä¸ªä¼˜åŒ–å™¨ï¼Œå¯¹æµè¡Œçš„ CPU åšä»£ç ç”Ÿæˆæ”¯æŒã€‚lld æ˜¯ Clang / LLVM çš„å†…ç½®é“¾æ¥å™¨ï¼Œclang å¿…é¡»è°ƒç”¨é“¾æ¥å™¨æ¥äº§ç”Ÿå¯æ‰§è¡Œæ–‡ä»¶ã€‚ è¿™é‡Œæ˜¯ Clang å®˜æ–¹è¯¦ç»†æ–‡æ¡£ï¼š Welcome to Clangâ€™s documentation! â€” Clang 4.0 documentation è¿™ç¯‡æ˜¯å¯¹ LLVM æ¶æ„çš„ä¸€ä¸ªæ¦‚è¿°ï¼š The Architecture of Open Source Applications å°†ç¼–è¯‘å™¨ä¹‹å‰å¯¹äºç¼–è¯‘çš„å‰ä¸–ä»Šç”Ÿä¹Ÿæ˜¯éœ€è¦äº†è§£çš„ï¼Œæ¯”å¦‚å›ç­”ä¸‹è¿™ä¸ªé—®é¢˜ï¼Œç¼–è¯‘å™¨ç¨‹åºæ˜¯ç”¨ä»€ä¹ˆç¼–è¯‘çš„ï¼Ÿçœ‹çœ‹ ã€Šlinkers and loadersã€‹è¿™æœ¬ä¹¦å°±çŸ¥é“äº†ã€‚ LLVM ä¸ Clang ä»‹ç»LLVM æ˜¯ Low Level Virtual Machine çš„ç®€ç§°ï¼Œè¿™ä¸ªåº“æä¾›äº†ä¸ç¼–è¯‘å™¨ç›¸å…³çš„æ”¯æŒï¼Œèƒ½å¤Ÿè¿›è¡Œç¨‹åºè¯­è¨€çš„ç¼–è¯‘æœŸä¼˜åŒ–ã€é“¾æ¥ä¼˜åŒ–ã€åœ¨çº¿ç¼–è¯‘ä¼˜åŒ–ã€ä»£ç ç”Ÿæˆã€‚ç®€è€Œè¨€ä¹‹ï¼Œå¯ä»¥ä½œä¸ºå¤šç§è¯­è¨€ç¼–è¯‘å™¨çš„åå°æ¥ä½¿ç”¨ã€‚å¦‚æœè¿™æ ·è¿˜æ¯”è¾ƒæŠ½è±¡çš„è¯ï¼Œä»‹ç»ä¸‹ Clang å°±çŸ¥é“äº†ï¼šClang æ˜¯ä¸€ä¸ª C++ ç¼–å†™ã€åŸºäº LLVMã€å‘å¸ƒäº LLVM BSD è®¸å¯è¯ä¸‹çš„ C/C++/Objective C/Objective C++ ç¼–è¯‘å™¨ï¼Œå…¶ç›®æ ‡ï¼ˆä¹‹ä¸€ï¼‰å°±æ˜¯è¶…è¶Š GCCã€‚ Clang å¼€å‘äº‹å‡ºæœ‰å› ï¼ŒWiki ä»‹ç»å¦‚ä¸‹ï¼š Apple ä½¿ç”¨ LLVM åœ¨ä¸æ”¯æŒå…¨éƒ¨ OpenGL ç‰¹æ€§çš„ GPU (Intel ä½ç«¯æ˜¾å¡) ä¸Šç”Ÿæˆä»£ç  (JIT)ï¼Œä»¤ç¨‹åºä»ç„¶èƒ½å¤Ÿæ­£å¸¸è¿è¡Œã€‚ä¹‹å LLVM ä¸ GCC çš„é›†æˆè¿‡ç¨‹å¼•å‘äº†ä¸€äº›ä¸å¿«ï¼ŒGCC ç³»ç»Ÿåºå¤§è€Œç¬¨é‡ï¼Œè€Œ Apple å¤§é‡ä½¿ç”¨çš„ Objective-C åœ¨ GCC ä¸­ä¼˜å…ˆçº§å¾ˆä½ã€‚æ­¤å¤– GCC ä½œä¸ºä¸€ä¸ªçº¯ç²¹çš„ç¼–è¯‘ç³»ç»Ÿï¼Œä¸ IDE é…åˆå¾ˆå·®ã€‚åŠ ä¹‹è®¸å¯è¯æ–¹é¢çš„è¦æ±‚ï¼ŒApple æ— æ³•ä½¿ç”¨ä¿®æ”¹ç‰ˆçš„ GCC è€Œé—­æºã€‚äºæ˜¯ Apple å†³å®šä»é›¶å¼€å§‹å†™ C family çš„å‰ç«¯ï¼Œä¹Ÿå°±æ˜¯åŸºäº LLVM çš„ Clang äº†ã€‚ Clang çš„ç‰¹æ€§ï¼š å¿«ï¼šé€šè¿‡ç¼–è¯‘ OS X ä¸Šå‡ ä¹åŒ…å«äº†æ‰€æœ‰ C å¤´æ–‡ä»¶çš„ carbon.h çš„æµ‹è¯•ï¼ŒåŒ…æ‹¬é¢„å¤„ç† (Preprocess)ï¼Œè¯­æ³• (lex)ï¼Œè§£æ (parse)ï¼Œè¯­ä¹‰åˆ†æ (Semantic Analysis)ï¼ŒæŠ½è±¡è¯­æ³•æ ‘ç”Ÿæˆ (Abstract Syntax Tree) çš„æ—¶é—´ï¼ŒClang æ˜¯ Apple GCC 4.0 çš„ 2.5x å¿«ã€‚(2007-7-25) å†…å­˜å ç”¨å°ï¼šClang å†…å­˜å ç”¨æ˜¯æºç çš„ 130%ï¼ŒApple GCC åˆ™è¶…è¿‡ 10xã€‚ è¯Šæ–­ä¿¡æ¯å¯è¯»æ€§å¼ºï¼šæˆ‘ä¸ä¼šæ’ç‰ˆï¼Œæ¨èå»ç½‘ç«™è§‚çœ‹ã€‚å…¶ä¸­é”™è¯¯çš„è¯­æ³•ä¸ä½†æœ‰æºç æç¤ºï¼Œè¿˜ä¼šåœ¨é”™è¯¯çš„è°ƒç”¨å’Œç›¸å…³ä¸Šä¸‹æ–‡çš„ä¸‹æ–¹æœ‰~å’Œ^çš„æç¤ºï¼Œç›¸æ¯”ä¹‹ä¸‹ GCC çš„æç¤ºå¾ˆå¤©ä¹¦ã€‚ GCC å…¼å®¹æ€§ã€‚ è®¾è®¡æ¸…æ™°ç®€å•ï¼Œå®¹æ˜“ç†è§£ï¼Œæ˜“äºæ‰©å±•å¢å¼ºã€‚ä¸ä»£ç åŸºç¡€å¤è€çš„ GCC ç›¸æ¯”ï¼Œå­¦ä¹ æ›²çº¿å¹³ç¼“ã€‚ åŸºäºåº“çš„æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äº IDE é›†æˆåŠå…¶ä»–ç”¨é€”çš„é‡ç”¨ã€‚ç”±äºå†å²åŸå› ï¼ŒGCC æ˜¯ä¸€ä¸ªå•ä¸€çš„å¯æ‰§è¡Œç¨‹åºç¼–è¯‘å™¨ï¼Œå…¶å†…éƒ¨å®Œæˆäº†ä»é¢„å¤„ç†åˆ°æœ€åä»£ç ç”Ÿæˆçš„å…¨éƒ¨è¿‡ç¨‹ï¼Œä¸­é—´è¯¸å¤šä¿¡æ¯éƒ½æ— æ³•è¢«å…¶ä»–ç¨‹åºé‡ç”¨ã€‚Clang å°†ç¼–è¯‘è¿‡ç¨‹åˆ†æˆå½¼æ­¤åˆ†ç¦»çš„å‡ ä¸ªé˜¶æ®µï¼ŒAST ä¿¡æ¯å¯åºåˆ—åŒ–ã€‚é€šè¿‡åº“çš„æ”¯æŒï¼Œç¨‹åºèƒ½å¤Ÿè·å–åˆ° AST çº§åˆ«çš„ä¿¡æ¯ï¼Œå°†å¤§å¤§å¢å¼ºå¯¹äºä»£ç çš„æ“æ§èƒ½åŠ›ã€‚å¯¹äº IDE è€Œè¨€ï¼Œä»£ç è¡¥å…¨ã€é‡æ„æ˜¯é‡è¦çš„åŠŸèƒ½ï¼Œç„¶è€Œå¦‚æœæ²¡æœ‰åº•å±‚çš„æ”¯æŒï¼Œåªä½¿ç”¨ tags åˆ†ææˆ–æ˜¯æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…æ˜¯å¾ˆéš¾è¾¾æˆçš„ã€‚ å½“ç„¶ï¼ŒGCC ä¹Ÿæœ‰å…¶ä¼˜åŠ¿ï¼š æ”¯æŒ JAVA/ADA/FORTRAN å½“å‰çš„ Clang çš„ C++ æ”¯æŒè½åäº GCCï¼Œå‚è§ã€‚ï¼ˆè¿‘æ—¥ Clang å·²ç»å¯ä»¥è‡ªç¼–è¯‘ï¼Œè§ï¼‰ GCC æ”¯æŒæ›´å¤šå¹³å° GCC æ›´æµè¡Œï¼Œå¹¿æ³›ä½¿ç”¨ï¼Œæ”¯æŒå®Œå¤‡ GCC åŸºäº Cï¼Œä¸éœ€è¦ C++ ç¼–è¯‘å™¨å³å¯ç¼–è¯‘ iOS å¼€å‘ä¸­ç”¨é€” ä¸€èˆ¬å¯ä»¥å°†ç¼–ç¨‹è¯­è¨€åˆ†ä¸ºä¸¤ç§ï¼Œç¼–è¯‘è¯­è¨€å’Œç›´è¯‘å¼è¯­è¨€ã€‚ ç¼–è¯‘è¯­è¨€:åƒC++,Objective Céƒ½æ˜¯ç¼–è¯‘è¯­è¨€ã€‚ç¼–è¯‘è¯­è¨€åœ¨æ‰§è¡Œçš„æ—¶å€™ï¼Œå¿…é¡»å…ˆé€šè¿‡ç¼–è¯‘å™¨ç”Ÿæˆæœºå™¨ç ï¼Œæœºå™¨ç å¯ä»¥ç›´æ¥åœ¨CPUä¸Šæ‰§è¡Œï¼Œæ‰€ä»¥æ‰§è¡Œæ•ˆç‡è¾ƒé«˜ã€‚ ç›´è¯‘å¼è¯­è¨€:åƒJavaScript,Pythonéƒ½æ˜¯ç›´è¯‘å¼è¯­è¨€ã€‚ç›´è¯‘å¼è¯­è¨€ä¸éœ€è¦ç»è¿‡ç¼–è¯‘çš„è¿‡ç¨‹ï¼Œè€Œæ˜¯åœ¨æ‰§è¡Œçš„æ—¶å€™é€šè¿‡ä¸€ä¸ªä¸­é—´çš„è§£é‡Šå™¨å°†ä»£ç è§£é‡Šä¸ºCPUå¯ä»¥æ‰§è¡Œçš„ä»£ç ã€‚æ‰€ä»¥ï¼Œè¾ƒç¼–è¯‘è¯­è¨€æ¥è¯´ï¼Œç›´è¯‘å¼è¯­è¨€æ•ˆç‡ä½ä¸€äº›ï¼Œä½†æ˜¯ç¼–å†™çš„æ›´çµæ´»ï¼Œä¹Ÿå°±æ˜¯ä¸ºå•¥JSå¤§æ³•å¥½ã€‚ iOSå¼€å‘ç›®å‰çš„å¸¸ç”¨è¯­è¨€æ˜¯ï¼šObjectiveå’ŒSwiftã€‚äºŒè€…éƒ½æ˜¯ç¼–è¯‘è¯­è¨€ï¼Œæ¢å¥è¯è¯´éƒ½æ˜¯éœ€è¦ç¼–è¯‘æ‰èƒ½æ‰§è¡Œçš„ã€‚äºŒè€…çš„ç¼–è¯‘éƒ½æ˜¯ä¾èµ–äºClang + LLVM. iOSç¼–è¯‘ä¸ç®¡æ˜¯OCè¿˜æ˜¯Swiftï¼Œéƒ½æ˜¯é‡‡ç”¨Clangä½œä¸ºç¼–è¯‘å™¨å‰ç«¯ï¼ŒLLVM(Low level vritual machine)ä½œä¸ºç¼–è¯‘å™¨åç«¯ã€‚æ‰€ä»¥ç®€å•çš„ç¼–è¯‘è¿‡ç¨‹å¦‚å›¾ ç¼–è¯‘å™¨å‰ç«¯ç¼–è¯‘å™¨å‰ç«¯çš„ä»»åŠ¡æ˜¯è¿›è¡Œï¼šè¯­æ³•åˆ†æï¼Œè¯­ä¹‰åˆ†æï¼Œç”Ÿæˆä¸­é—´ä»£ç (intermediate representation )ã€‚åœ¨è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œä¼šè¿›è¡Œç±»å‹æ£€æŸ¥ï¼Œå¦‚æœå‘ç°é”™è¯¯æˆ–è€…è­¦å‘Šä¼šæ ‡æ³¨å‡ºæ¥åœ¨å“ªä¸€è¡Œã€‚ ç¼–è¯‘å™¨åç«¯ç¼–è¯‘å™¨åç«¯ä¼šè¿›è¡Œæœºå™¨æ— å…³çš„ä»£ç ä¼˜åŒ–ï¼Œç”Ÿæˆæœºå™¨è¯­è¨€ï¼Œå¹¶ä¸”è¿›è¡Œæœºå™¨ç›¸å…³çš„ä»£ç ä¼˜åŒ–ã€‚iOSçš„ç¼–è¯‘è¿‡ç¨‹ï¼Œåç«¯çš„å¤„ç†å¦‚ä¸‹ LVVMä¼˜åŒ–å™¨ä¼šè¿›è¡ŒBitCodeçš„ç”Ÿæˆï¼Œé“¾æ¥æœŸä¼˜åŒ–ç­‰ç­‰ã€‚ LLVMæœºå™¨ç ç”Ÿæˆå™¨ä¼šé’ˆå¯¹ä¸åŒçš„æ¶æ„ï¼Œæ¯”å¦‚arm64ç­‰ç”Ÿæˆä¸åŒçš„æœºå™¨ç ã€‚ æ‰§è¡Œä¸€æ¬¡ XCode build çš„æµç¨‹å½“ä½ åœ¨XCodeä¸­ï¼Œé€‰æ‹©buildçš„æ—¶å€™(å¿«æ·é”®command+B)ï¼Œä¼šæ‰§è¡Œå¦‚ä¸‹è¿‡ç¨‹ ç¼–è¯‘ä¿¡æ¯å†™å…¥è¾…åŠ©æ–‡ä»¶ï¼Œåˆ›å»ºç¼–è¯‘åçš„æ–‡ä»¶æ¶æ„(name.app) å¤„ç†æ–‡ä»¶æ‰“åŒ…ä¿¡æ¯ï¼Œä¾‹å¦‚åœ¨debugç¯å¢ƒä¸‹ 12345Entitlements:&#123; &quot;application-identifier&quot; = &quot;appçš„bundleid&quot;; &quot;aps-environment&quot; = development;&#125; æ‰§è¡ŒCocoaPodç¼–è¯‘å‰è„šæœ¬(ä¾‹å¦‚å¯¹äºä½¿ç”¨CocoaPodçš„å·¥ç¨‹ä¼šæ‰§è¡ŒCheckPods Manifest.lock) ç¼–è¯‘å„ä¸ª.mæ–‡ä»¶ï¼Œä½¿ç”¨CompileCå’Œclangå‘½ä»¤ã€‚ 1234CompileC ClassName.o ClassName.m normal x86_64 objective-c com.apple.compilers.llvm.clang.1_0.compilerexport LANG=en_US.US-ASCIIexport PATH=&quot;...&quot;clang -x objective-c -arch x86_64 -fmessage-length=0 -fobjc-arc... -Wno-missing-field-initializers ... -DDEBUG=1 ... -isysroot iPhoneSimulator10.1.sdk -fasm-blocks ... -I ä¸Šæ–‡æåˆ°çš„æ–‡ä»¶ -F æ‰€éœ€è¦çš„Framework -iquote æ‰€éœ€è¦çš„Framework ... -c ClassName.c -o ClassName.o é€šè¿‡è¿™ä¸ªç¼–è¯‘çš„å‘½ä»¤ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° clangæ˜¯å®é™…çš„ç¼–è¯‘å‘½ä»¤ x objective-c æŒ‡å®šäº†ç¼–è¯‘çš„è¯­è¨€ arch x86_64åˆ¶å®šäº†ç¼–è¯‘çš„æ¶æ„ï¼Œç±»ä¼¼è¿˜æœ‰arm7ç­‰ fobjc-arc ä¸€äº›åˆ—-få¼€å¤´çš„ï¼ŒæŒ‡å®šäº†é‡‡ç”¨arcç­‰ä¿¡æ¯ã€‚è¿™ä¸ªä¹Ÿå°±æ˜¯ä¸ºä»€ä¹ˆä½ å¯ä»¥å¯¹å•ç‹¬çš„ä¸€ä¸ª.mæ–‡ä»¶é‡‡ç”¨éARCç¼–ç¨‹ã€‚ Wno-missing-field-initializers ä¸€ç³»åˆ—ä»¥-Wå¼€å¤´çš„ï¼ŒæŒ‡çš„æ˜¯ç¼–è¯‘çš„è­¦å‘Šé€‰é¡¹ï¼Œé€šè¿‡è¿™äº›ä½ å¯ä»¥å®šåˆ¶åŒ–ç¼–è¯‘é€‰é¡¹ DDEBUG=1 ä¸€äº›åˆ—-Då¼€å¤´çš„ï¼ŒæŒ‡çš„æ˜¯é¢„ç¼–è¯‘å®ï¼Œé€šè¿‡è¿™äº›å®å¯ä»¥å®ç°æ¡ä»¶ç¼–è¯‘ iPhoneSimulator10.1.sdk åˆ¶å®šäº†ç¼–è¯‘é‡‡ç”¨çš„iOS SDKç‰ˆæœ¬ I æŠŠç¼–è¯‘ä¿¡æ¯å†™å…¥æŒ‡å®šçš„è¾…åŠ©æ–‡ä»¶ F é“¾æ¥æ‰€éœ€è¦çš„Framework c ClassName.c ç¼–è¯‘æ–‡ä»¶ o ClassName.o ç¼–è¯‘äº§ç‰© å·¥ä½œæµç¨‹ é“¾æ¥éœ€è¦çš„Frameworkï¼Œä¾‹å¦‚Foundation.framework,AFNetworking.framework,ALiPay.fframework ç¼–è¯‘xibæ–‡ä»¶ æ‹·è´xibï¼Œå›¾ç‰‡ç­‰èµ„æºæ–‡ä»¶åˆ°ç»“æœç›®å½• ç¼–è¯‘ImageAssets å¤„ç†info.plist æ‰§è¡ŒCocoaPodè„šæœ¬ æ‹·è´Swiftæ ‡å‡†åº“ åˆ›å»º.appæ–‡ä»¶å’Œå¯¹å…¶ç­¾å dSYM æ–‡ä»¶æˆ‘ä»¬åœ¨æ¯æ¬¡ç¼–è¯‘è¿‡åï¼Œéƒ½ä¼šç”Ÿæˆä¸€ä¸ªdsymæ–‡ä»¶ã€‚dsymæ–‡ä»¶ä¸­ï¼Œå­˜å‚¨äº†16è¿›åˆ¶çš„å‡½æ•°åœ°å€æ˜ å°„ã€‚ åœ¨Appå®é™…æ‰§è¡Œçš„äºŒè¿›åˆ¶æ–‡ä»¶ä¸­ï¼Œæ˜¯é€šè¿‡åœ°å€æ¥è°ƒç”¨æ–¹æ³•çš„ã€‚åœ¨App crashçš„æ—¶å€™ï¼Œç¬¬ä¸‰æ–¹å·¥å…·(Fabric,å‹ç›Ÿç­‰)ä¼šå¸®æˆ‘ä»¬æŠ“åˆ°å´©æºƒçš„è°ƒç”¨æ ˆï¼Œè°ƒç”¨æ ˆé‡Œä¼šåŒ…å«crashåœ°å€çš„è°ƒç”¨ä¿¡æ¯ã€‚ç„¶åï¼Œé€šè¿‡dSYMæ–‡ä»¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥ç”±åœ°å€æ˜ å°„åˆ°å…·ä½“çš„å‡½æ•°ä½ç½®ã€‚ XCodeä¸­ï¼Œé€‰æ‹©Window -&gt; Organizerå¯ä»¥çœ‹åˆ°æˆ‘ä»¬ç”Ÿæˆçš„archieræ–‡ä»¶ iOS å¦‚ä½•è°ƒè¯•ç¬¬ä¸‰æ–¹ç»Ÿè®¡åˆ°çš„å´©æºƒæŠ¥å‘Š (http://blog.csdn.net/hello_hwc/article/details/50036323) attributeæˆ–å¤šæˆ–å°‘ï¼Œä½ éƒ½ä¼šåœ¨ç¬¬ä¸‰æ–¹åº“æˆ–è€…iOSçš„å¤´æ–‡ä»¶ä¸­ï¼Œè§åˆ°è¿‡attributeã€‚ æ¯”å¦‚ 1__attribute__ ((warn_unused_result)) //å¦‚æœæ²¡æœ‰ä½¿ç”¨è¿”å›å€¼ï¼Œç¼–è¯‘çš„æ—¶å€™ç»™å‡ºè­¦å‘Š attribtue æ˜¯ä¸€ä¸ªé«˜çº§çš„çš„ç¼–è¯‘å™¨æŒ‡ä»¤ï¼Œå®ƒå…è®¸å¼€å‘è€…æŒ‡å®šæ›´æ›´å¤šçš„ç¼–è¯‘æ£€æŸ¥å’Œä¸€äº›é«˜çº§çš„ç¼–è¯‘æœŸä¼˜åŒ–ã€‚ åˆ†ä¸ºä¸‰ç§ï¼š å‡½æ•°å±æ€§ (Function Attribute) ç±»å‹å±æ€§ (Variable Attribute ) å˜é‡å±æ€§ (Type Attribute ) è¯­æ³•ç»“æ„ attribute è¯­æ³•æ ¼å¼ä¸ºï¼šattribute ((attribute-list)) æ”¾åœ¨å£°æ˜åˆ†å·â€œ;â€å‰é¢ã€‚ æ¯”å¦‚ï¼Œåœ¨ä¸‰æ–¹åº“ä¸­æœ€å¸¸è§çš„ï¼Œå£°æ˜ä¸€ä¸ªå±æ€§æˆ–è€…æ–¹æ³•åœ¨å½“å‰ç‰ˆæœ¬å¼ƒç”¨äº† 1@property (strong,nonatomic)CLASSNAME * property __deprecated; è¿™æ ·çš„å¥½å¤„æ˜¯ï¼šç»™å¼€å‘è€…ä¸€ä¸ªè¿‡æ¸¡çš„ç‰ˆæœ¬ï¼Œè®©å¼€å‘è€…çŸ¥é“è¿™ä¸ªå±æ€§è¢«å¼ƒç”¨äº†ï¼Œåº”å½“ä½¿ç”¨æœ€æ–°çš„APIï¼Œä½†æ˜¯è¢«__deprecatedçš„å±æ€§ä»ç„¶å¯ä»¥æ­£å¸¸ä½¿ç”¨ã€‚å¦‚æœç›´æ¥å¼ƒç”¨ï¼Œä¼šå¯¼è‡´å¼€å‘è€…åœ¨æ›´æ–°Podçš„æ—¶å€™ï¼Œä»£ç æ— æ³•è¿è¡Œäº†ã€‚ attribtueçš„ä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œæœ¬æ–‡åªåˆ—ä¸¾iOSå¼€å‘ä¸­å¸¸ç”¨çš„å‡ ä¸ªï¼š 1234567891011121314151617181920//å¼ƒç”¨APIï¼Œç”¨ä½œAPIæ›´æ–°#define __deprecated __attribute__((deprecated))//å¸¦æè¿°ä¿¡æ¯çš„å¼ƒç”¨#define __deprecated_msg(_msg) __attribute__((deprecated(_msg)))//é‡åˆ°__unavailableçš„å˜é‡/æ–¹æ³•ï¼Œç¼–è¯‘å™¨ç›´æ¥æŠ›å‡ºError#define __unavailable __attribute__((unavailable))//å‘Šè¯‰ç¼–è¯‘å™¨ï¼Œå³ä½¿è¿™ä¸ªå˜é‡/æ–¹æ³• æ²¡è¢«ä½¿ç”¨ï¼Œä¹Ÿä¸è¦æŠ›å‡ºè­¦å‘Š#define __unused __attribute__((unused))//å’Œ__unusedç›¸å#define __used __attribute__((used))//å¦‚æœä¸ä½¿ç”¨æ–¹æ³•çš„è¿”å›å€¼ï¼Œè¿›è¡Œè­¦å‘Š#define __result_use_check __attribute__((__warn_unused_result__))//OCæ–¹æ³•åœ¨Swiftä¸­ä¸å¯ç”¨#define __swift_unavailable(_msg) __attribute__((__availability__(swift, unavailable, message=_msg))) Clangè­¦å‘Šå¤„ç†ä½ ä¸€å®šè¿˜è§è¿‡å¦‚ä¸‹ä»£ç ï¼š 1234#pragma clang diagnostic push#pragma clang diagnostic ignored &quot;-Wundeclared-selector&quot;///ä»£ç #pragma clang diagnostic pop è¿™æ®µä»£ç çš„ä½œç”¨æ˜¯ å¯¹å½“å‰ç¼–è¯‘ç¯å¢ƒè¿›è¡Œå‹æ ˆ å¿½ç•¥-Wundeclared-selector(æœªå£°æ˜çš„)Selectorè­¦å‘Š ç¼–è¯‘ä»£ç  å¯¹ç¼–è¯‘ç¯å¢ƒè¿›è¡Œå‡ºæ ˆ é€šè¿‡clang diagnostic push/pop,ä½ å¯ä»¥çµæ´»çš„æ§åˆ¶ä»£ç å—çš„ç¼–è¯‘é€‰é¡¹ã€‚ iOS åˆç†åˆ©ç”¨Clangè­¦å‘Šæ¥æé«˜ä»£ç è´¨é‡ (http://blog.csdn.net/Hello_Hwc/article/details/46425503) é¢„å¤„ç†æ‰€è°“é¢„å¤„ç†ï¼Œå°±æ˜¯åœ¨ç¼–è¯‘ä¹‹å‰çš„å¤„ç†ã€‚é¢„å¤„ç†èƒ½å¤Ÿè®©ä½ å®šä¹‰ç¼–è¯‘å™¨å˜é‡ï¼Œå®ç°æ¡ä»¶ç¼–è¯‘ã€‚ æ¯”å¦‚ï¼Œè¿™æ ·çš„ä»£ç å¾ˆå¸¸è§ 12345#ifdef DEBUG//...#else//...#endif åŒæ ·ï¼Œæˆ‘ä»¬åŒæ ·ä¹Ÿå¯ä»¥å®šä¹‰å…¶ä»–é¢„å¤„ç†å˜é‡,åœ¨XCode-é€‰ä¸­Target-build settingsä¸­ï¼Œæœç´¢proprecessã€‚ç„¶åç‚¹å‡»å›¾ä¸­è“è‰²çš„åŠ å·ï¼Œå¯ä»¥åˆ†åˆ«ä¸ºdebugå’Œreleaseä¸¤ç§æ¨¡å¼è®¾ç½®é¢„å¤„ç†å®ã€‚ æ¯”å¦‚æˆ‘ä»¬åŠ ä¸Šï¼šTestServerï¼Œè¡¨ç¤ºåœ¨è¿™ä¸ªå®ä¸­çš„ä»£ç è¿è¡Œåœ¨æµ‹è¯•æœåŠ¡å™¨ ç„¶åï¼Œé…åˆå¤šä¸ªTarget(å³é”®Targetï¼Œé€‰æ‹©Duplicate)ï¼Œå•ç‹¬ä¸€ä¸ªTargetè´Ÿè´£æµ‹è¯•æœåŠ¡å™¨ã€‚è¿™æ ·æˆ‘ä»¬å°±ä¸ç”¨æ¯æ¬¡åˆ‡æ¢æµ‹è¯•æœåŠ¡å™¨éƒ½è¦ä¿®æ”¹ä»£ç äº†ã€‚ 12345#ifdef TESTMODE//æµ‹è¯•æœåŠ¡å™¨ç›¸å…³çš„ä»£ç #else//ç”Ÿäº§æœåŠ¡å™¨ç›¸å…³ä»£ç #endif æ’å…¥è„šæœ¬é€šå¸¸ï¼Œå¦‚æœä½ ä½¿ç”¨CocoaPodæ¥ç®¡ç†ä¸‰æ–¹åº“ï¼Œé‚£ä¹ˆä½ çš„Build Phaseæ˜¯è¿™æ ·å­çš„ï¼š å…¶ä¸­ï¼š[CP]å¼€å¤´çš„ï¼Œå°±æ˜¯CocoaPodæ’å…¥çš„è„šæœ¬ã€‚ Check Pods Manifest.lockï¼Œç”¨æ¥æ£€æŸ¥cocoapodç®¡ç†çš„ä¸‰æ–¹åº“æ˜¯å¦éœ€è¦æ›´æ–° Embed Pods Frameworkï¼Œè¿è¡Œè„šæœ¬æ¥é“¾æ¥ä¸‰æ–¹åº“çš„é™æ€/åŠ¨æ€åº“ Copy Pods Resourcesï¼Œè¿è¡Œè„šæœ¬æ¥æ‹·è´ä¸‰æ–¹åº“çš„èµ„æºæ–‡ä»¶ è€Œè¿™äº›é…ç½®ä¿¡æ¯éƒ½å­˜å‚¨åœ¨è¿™ä¸ªæ–‡ä»¶(.xcodeprog)é‡Œ åˆ°è¿™é‡Œï¼ŒCocoaPodçš„åŸç†ä¹Ÿå°±å¤§è‡´ææ¸…æ¥šäº†ï¼Œé€šè¿‡ä¿®æ”¹xcodeprojectï¼Œç„¶åé…ç½®ç¼–è¯‘æœŸè„šæœ¬ï¼Œæ¥ä¿è¯ä¸‰æ–¹åº“èƒ½å¤Ÿæ­£ç¡®çš„ç¼–è¯‘è¿æ¥ã€‚ åŒæ ·ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æ’å…¥è‡ªå·±çš„è„šæœ¬ï¼Œæ¥åšä¸€äº›é¢å¤–çš„äº‹æƒ…ã€‚æ¯”å¦‚ï¼Œæ¯æ¬¡è¿›è¡Œarchiveçš„æ—¶å€™ï¼Œæˆ‘ä»¬éƒ½å¿…é¡»æ‰‹åŠ¨è°ƒæ•´targetçš„buildç‰ˆæœ¬ï¼Œå¦‚æœä¸€ä¸å°å¿ƒï¼Œå°±ä¼šå¿˜è®°ã€‚è¿™ä¸ªè¿‡ç¨‹ï¼Œæˆ‘ä»¬å¯ä»¥é€šè¿‡æ’å…¥è„šæœ¬è‡ªåŠ¨åŒ–ã€‚ 123buildNumber=$(/usr/libexec/PlistBuddy -c &quot;Print CFBundleVersion&quot; &quot;$&#123;PROJECT_DIR&#125;/$&#123;INFOPLIST_FILE&#125;&quot;)buildNumber=$(($buildNumber + 1))/usr/libexec/PlistBuddy -c &quot;Set :CFBundleVersion $buildNumber&quot; &quot;$&#123;PROJECT_DIR&#125;/$&#123;INFOPLIST_FILE&#125;&quot; è¿™æ®µè„šæœ¬å…¶å®å¾ˆç®€å•ï¼Œè¯»å–å½“å‰pistçš„buildç‰ˆæœ¬å·,ç„¶åå¯¹å…¶åŠ ä¸€ï¼Œé‡æ–°å†™å…¥ã€‚ ä½¿ç”¨èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼š Xcode â€“ é€‰ä¸­Target â€“ é€‰ä¸­build phase é€‰æ‹©æ·»åŠ Run Script Phase ç„¶åæŠŠè¿™æ®µè„šæœ¬æ‹·è´è¿›å»ï¼Œå¹¶ä¸”å‹¾é€‰Run Script Only When installingï¼Œä¿è¯åªæœ‰æˆ‘ä»¬åœ¨å®‰è£…åˆ°è®¾å¤‡ä¸Šçš„æ—¶å€™ï¼Œæ‰ä¼šæ‰§è¡Œè¿™æ®µè„šæœ¬ã€‚é‡å‘½åè„šæœ¬çš„åå­—ä¸ºAuto Increase build number ç„¶åï¼Œæ‹–åŠ¨è¿™ä¸ªè„šæœ¬çš„åˆ°Link Binary With Librariesä¸‹é¢ è„šæœ¬ç¼–è¯‘æ‰“åŒ…è„šæœ¬åŒ–ç¼–è¯‘æ‰“åŒ…å¯¹äºCI(æŒç»­é›†æˆ)æ¥è¯´ï¼Œååˆ†æœ‰ç”¨ã€‚iOSå¼€å‘ä¸­ï¼Œç¼–è¯‘æ‰“åŒ…å¿…å¤‡çš„ä¸¤ä¸ªå‘½ä»¤æ˜¯ï¼š 1234567//ç¼–è¯‘æˆ.appxcodebuild -workspace $projectName.xcworkspace -scheme $projectName -configuration $buildConfig clean build SYMROOT=$buildAppToDir//æ‰“åŒ…xcrun -sdk iphoneos PackageApplication -v $appDir/$projectName.app -o $appDir/$ipaName.ipaé€šè¿‡infoå‘½ä»¤ï¼Œå¯ä»¥æŸ¥çœ‹åˆ°è¯¦ç»†çš„æ–‡æ¡£info xcodebuild ä¹‹å‰å†™çš„ä¸€å¥—åŸºäº Python çš„ç¼–è¯‘æ‰“åŒ…è„šæœ¬ (https://github.com/ReverseScale/AutoBuildScript/blob/master/autobuild.py) æé«˜é¡¹ç›®ç¼–è¯‘é€Ÿåº¦é€šå¸¸ï¼Œå½“é¡¹ç›®å¾ˆå¤§ï¼Œæºä»£ç å’Œä¸‰æ–¹åº“å¼•å…¥å¾ˆå¤šçš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šå‘ç°ç¼–è¯‘çš„é€Ÿåº¦å¾ˆæ…¢ã€‚åœ¨äº†è§£äº†XCodeçš„ç¼–è¯‘è¿‡ç¨‹åï¼Œæˆ‘ä»¬å¯ä»¥ä»ä»¥ä¸‹è§’åº¦æ¥ä¼˜åŒ–ç¼–è¯‘é€Ÿåº¦ï¼š æŸ¥çœ‹ç¼–è¯‘æ—¶é—´æˆ‘ä»¬éœ€è¦ä¸€ä¸ªé€”å¾„ï¼Œèƒ½å¤Ÿçœ‹åˆ°ç¼–è¯‘çš„æ—¶é—´ï¼Œè¿™æ ·æ‰èƒ½æœ‰ä¸ªå¯¹æ¯”ï¼ŒçŸ¥é“æˆ‘ä»¬çš„ä¼˜åŒ–ç©¶ç«Ÿæœ‰æ²¡æœ‰æ•ˆæœã€‚ å¯¹äºXCode 8ï¼Œå…³é—­XCodeï¼Œç»ˆç«¯è¾“å…¥ä»¥ä¸‹æŒ‡ä»¤ 1defaults write com.apple.dt.Xcode ShowBuildOperationDuration YES ç„¶åï¼Œé‡å¯XCodeï¼Œç„¶åç¼–è¯‘ï¼Œä½ ä¼šåœ¨è¿™é‡Œçœ‹åˆ°ç¼–è¯‘æ—¶é—´ã€‚ ä»£ç å±‚é¢çš„ä¼˜åŒ–2.1)forward declaration æ‰€è°“forward declarationï¼Œå°±æ˜¯@class CLASSNAMEï¼Œè€Œä¸æ˜¯#import CLASSNAME.hã€‚è¿™æ ·ï¼Œç¼–è¯‘å™¨èƒ½å¤§å¤§æé«˜#importçš„æ›¿æ¢é€Ÿåº¦ã€‚ 2.2)å¯¹å¸¸ç”¨çš„å·¥å…·ç±»è¿›è¡Œæ‰“åŒ…(Framework/.a) æ‰“åŒ…æˆFrameworkæˆ–è€…é™æ€åº“ï¼Œè¿™æ ·ç¼–è¯‘çš„æ—¶å€™è¿™éƒ¨åˆ†ä»£ç å°±ä¸éœ€è¦é‡æ–°ç¼–è¯‘äº†ã€‚ 2.3)å¸¸ç”¨å¤´æ–‡ä»¶æ”¾åˆ°é¢„ç¼–è¯‘æ–‡ä»¶é‡Œ XCodeçš„pchæ–‡ä»¶æ˜¯é¢„ç¼–è¯‘æ–‡ä»¶ï¼Œè¿™é‡Œçš„å†…å®¹åœ¨æ‰§è¡ŒXCode buildä¹‹å‰å°±å·²ç»è¢«é¢„ç¼–è¯‘ï¼Œå¹¶ä¸”å¼•å…¥åˆ°æ¯ä¸€ä¸ª.mæ–‡ä»¶é‡Œäº†ã€‚ ç¼–è¯‘å™¨é€‰é¡¹ä¼˜åŒ–3.1)Debugæ¨¡å¼ä¸‹ï¼Œä¸ç”Ÿæˆdsymæ–‡ä»¶ ä¸Šæ–‡æåˆ°äº†ï¼Œdysmæ–‡ä»¶é‡Œå­˜å‚¨äº†è°ƒè¯•ä¿¡æ¯ï¼Œåœ¨Debugæ¨¡å¼ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ©XCodeå’ŒLLDBè¿›è¡Œè°ƒè¯•ã€‚æ‰€ä»¥ï¼Œä¸éœ€è¦ç”Ÿæˆé¢å¤–çš„dsymæ–‡ä»¶æ¥é™ä½ç¼–è¯‘é€Ÿåº¦ã€‚ 3.2)Debugå¼€å¯Build Active Architecture Only åœ¨XCode -&gt; Build Settings -&gt; Build Active Architecture Only æ”¹ä¸ºYESã€‚è¿™æ ·åšï¼Œå¯ä»¥åªç¼–è¯‘å½“å‰çš„ç‰ˆæœ¬ï¼Œæ¯”å¦‚arm7/arm64ç­‰ç­‰ï¼Œè®°å¾—åªå¼€å¯Debugæ¨¡å¼ã€‚è¿™ä¸ªé€‰é¡¹åœ¨é«˜ç‰ˆæœ¬çš„XCodeä¸­è‡ªåŠ¨å¼€å¯äº†ã€‚ 3.3)Debugæ¨¡å¼ä¸‹ï¼Œå…³é—­ç¼–è¯‘å™¨ä¼˜åŒ– ç¼–è¯‘å™¨ä¼˜åŒ– æ›´å¤šæ·±å…¥å­¦ä¹ å…³äº iOS ç¼–è¯‘ Clang LLVM ç›¸å…³çš„çŸ¥è¯†æ•´ç†å‚è§ï¼šæ·±å…¥å‰–æ iOS ç¼–è¯‘ Clang LLVM ç‰ˆæƒå£°æ˜æ­¤ç³»åˆ—æ–‡ç« å†…å®¹å¤šä¸ºç½‘ä¸Šèµ„æ–™æ•´ç†ï¼Œæ–‡ç« ç»“å°¾ä¼šåˆ—å‡ºå‚ç…§é“¾æ¥ï¼Œå¦‚æœ‰çº°æ¼æ¬¢è¿è®¨è®ºğŸ¤— ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼šhttps://my.oschina.net/u/2345393/blog/820141ï¼Œhttps://linuxtoy.org/archives/llvm-and-clang.htmlï¼Œhttps://blog.csdn.net/hello_hwc/article/details/53557308ï¼Œhttps://github.com/ming1016/study/wiki/æ·±å…¥å‰–æ-iOS-ç¼–è¯‘-Clang---LLVM","categories":[{"name":"Principle","slug":"Principle","permalink":"https://reversescale.github.io/categories/Principle/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"èµ°åœ¨æŠ€æœ¯å‰æ²¿çš„ iOS æ¶æ„å®ç°","slug":"iOS Architecture","date":"2018-05-01T13:56:27.000Z","updated":"2018-11-16T12:08:39.132Z","comments":true,"path":"2018/05/01/iOS Architecture/","link":"","permalink":"https://reversescale.github.io/2018/05/01/iOS Architecture/","excerpt":"æˆ‘ç†è§£çš„æ¡†æ¶ï¼Œå°±å¥½æ¯”è®¡ç®—æœºçš„ä¸»æ¿ï¼Œæˆ¿å±‹çš„å»ºç­‘éª¨æ¶ï¼Œé“è·¯çš„åŸºç¡€è®¾æ–½é…å¥—ï¼Œæ¡†æ¶æ­çš„å¥½ï¼Œèƒ½ç›´æ¥å½±å“å¼€å‘è€…çš„å¼€å‘å¿ƒæƒ…ï¼Œæ›´èƒ½è®©é¡¹ç›®å¥å£®æ€§å’Œæ‰©å±•æ€§å¤§å¤§å¢å¼º~","text":"æˆ‘ç†è§£çš„æ¡†æ¶ï¼Œå°±å¥½æ¯”è®¡ç®—æœºçš„ä¸»æ¿ï¼Œæˆ¿å±‹çš„å»ºç­‘éª¨æ¶ï¼Œé“è·¯çš„åŸºç¡€è®¾æ–½é…å¥—ï¼Œæ¡†æ¶æ­çš„å¥½ï¼Œèƒ½ç›´æ¥å½±å“å¼€å‘è€…çš„å¼€å‘å¿ƒæƒ…ï¼Œæ›´èƒ½è®©é¡¹ç›®å¥å£®æ€§å’Œæ‰©å±•æ€§å¤§å¤§å¢å¼º~ åŸºäº Objective-C å®ç°çš„æ¡†æ¶è®¾è®¡ï¼ŒYTKNetworkç½‘ç»œå±‚ + AOPæ›¿ä»£åŸºç±» + MVVM + ReactiveObjC + JLRoutesè·¯ç”± ğŸ‘¨ğŸ»â€ğŸ’» Github Demo ğŸ¤– è¦æ±‚ iOS 8.0+ Xcode 8.0+ Objective-C ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ 1.å±•ç¤ºé¡µ 2.å±•ç¤ºé¡µ 3.å±•ç¤ºé¡µ 4.è¯´æ˜é¡µ ç™»å½•è§†å›¾ ç¤ºä¾‹å±•ç¤º è·³è½¬é¡µé¢ ä»‹ç»é¡µé¢ ğŸ¯ å®‰è£…æ–¹æ³•å®‰è£…åœ¨ iOS, ä½ éœ€è¦åœ¨ Podfile ä¸­æ·»åŠ .123456789101112131415161718source &apos;https://github.com/CocoaPods/Specs.git&apos;platform :ios, &apos;9.0&apos;use_frameworks! # æç¤ºç»„ä»¶æ¡†æ¶ pod &apos;SVProgressHUD&apos;, &apos;~&gt; 2.2.2&apos; # ç½‘ç»œè¯·æ±‚æ¡†æ¶ pod &apos;YTKNetwork&apos;, &apos;~&gt; 2.0.3&apos; # AOPé¢å‘åˆ‡é¢ pod &apos;Aspects&apos;, &apos;~&gt; 1.4.1&apos; # å“åº”å‡½æ•°å¼æ¡†æ¶ pod &apos;ReactiveObjC&apos;, &apos;~&gt; 3.0.0&apos; # è·¯ç”±ç»„ä»¶åŒ–è§£è€¦ pod &apos;JLRoutes&apos;, &apos;~&gt; 2.0.5&apos; # æç¤ºç»„ä»¶æ¡†æ¶ pod &apos;SVProgressHUD&apos;, &apos;~&gt; 2.2.2&apos; # è‡ªåŠ¨å¸ƒå±€ pod &apos;Masonry&apos;, &apos;~&gt; 1.0.2&apos; ğŸ›  æ¡†æ¶ä»‹ç»AOP æ¨¡å¼ï¼ˆAspects-RunTime ä»£æ›¿åŸºç±»ï¼‰+ Category æ–¹æ³•äº¤æ¢é‡‡ç”¨AOPæ€æƒ³ï¼Œä½¿ç”¨ Aspects æ¥å®Œæˆæ›¿æ¢ Controller ï¼ŒViewï¼ŒViewModelåŸºç±»ï¼Œå’ŒåŸºç±»è¯´æ‹œæ‹œ Casaåé©å‘½å·¥ç¨‹å¸ˆ iOSåº”ç”¨æ¶æ„è°ˆ viewå±‚çš„ç»„ç»‡å’Œè°ƒç”¨æ–¹æ¡ˆ åšå®¢ä¸­æåˆ°ä¸€ä¸ªç–‘é—®æ˜¯å¦æœ‰å¿…è¦è®©ä¸šåŠ¡æ–¹ç»Ÿä¸€æ´¾ç”ŸViewController Casaå¤§ç¥å›ç­”æ˜¯NOï¼ŒåŸå› å¦‚ä¸‹ ä½¿ç”¨æ´¾ç”Ÿæ¯”ä¸ä½¿ç”¨æ´¾ç”Ÿæ›´å®¹æ˜“å¢åŠ ä¸šåŠ¡æ–¹çš„ä½¿ç”¨æˆæœ¬ ä¸ä½¿ç”¨æ´¾ç”Ÿæ‰‹æ®µä¸€æ ·ä¹Ÿèƒ½è¾¾åˆ°ç»Ÿä¸€è®¾ç½®çš„ç›®çš„å¯¹äºç¬¬ä¸€ç‚¹ï¼Œä» é›†æˆæˆæœ¬ ï¼Œä¸Šæ‰‹æˆæœ¬ ï¼Œæ¶æ„ç»´æŠ¤æˆæœ¬ç­‰å› ç´ å…¥æ‰‹ï¼Œå¤§ç¥åšå®¢ä¸­ä¹Ÿå·²ç»å¾ˆè¯¦ç»†ã€‚ æ¡†æ¶ä¸éœ€è¦é€šè¿‡ç»§æ‰¿å³èƒ½å¤Ÿå¯¹ViewControllerè¿›è¡Œç»Ÿä¸€é…ç½®ã€‚ä¸šåŠ¡å³ä½¿è„±ç¦»ç¯å¢ƒï¼Œä¹Ÿèƒ½å¤Ÿè·‘å®Œä»£ç ï¼ŒViewControllerä¸€æ—¦æ”¾å…¥æ¡†æ¶ç¯å¢ƒï¼Œä¸éœ€è¦æ·»åŠ é¢å¤–çš„æˆ–è€…åªéœ€æ·»åŠ å°‘é‡ä»£ç ï¼Œæ¡†æ¶ä¹Ÿèƒ½å¤Ÿèµ·åˆ°ç›¸åº”çš„ä½œç”¨ å¯¹äºæœ¬äººæ¥è¯´ ï¼Œå…·å¤‡è¿™ç‚¹çš„å¸å¼•åŠ›ï¼Œå·²ç»è¶³å¤Ÿè®©æˆ‘æœ‰å°è¯•ä¸€ç•ªçš„å¿ƒæ€äº†ã€‚ å¯¹äºOCæ¥è¯´ï¼Œæ–¹æ³•æ‹¦æˆªå¾ˆå®¹æ˜“å°±æƒ³åˆ°è‡ªå¸¦çš„é»‘é­”æ³•æ–¹æ³•è°ƒé… Method Swizzlingï¼Œ è‡³äºä¸ºViewControlleråšåŠ¨æ€é…ç½®ï¼Œè‡ªç„¶éCategoryè«å±äº†Method Swizzling ä¸šç•Œå·²ç»æœ‰éå¸¸æˆç†Ÿçš„ä¸‰æ–¹åº“ Aspects, æ‰€ä»¥Demoä»£ç é‡‡ç”¨ Aspects åšæ–¹æ³•æ‹¦æˆªã€‚ 12345678910111213141516171819202122+ (void)load &#123; [super load]; [FKViewControllerIntercepter sharedInstance];&#125;// .... å•ä¾‹åˆå§‹åŒ–ä»£ç - (instancetype)init &#123; self = [super init]; if (self) &#123; /* æ–¹æ³•æ‹¦æˆª */ // æ‹¦æˆª viewDidLoad æ–¹æ³• [UIViewController aspect_hookSelector:@selector(viewDidLoad) withOptions:AspectPositionAfter usingBlock:^(id&lt;AspectInfo&gt;aspectInfo)&#123; [self _viewDidLoad:aspectInfo.instance]; &#125; error:nil]; // æ‹¦æˆª viewWillAppear: [UIViewController aspect_hookSelector:@selector(viewWillAppear:) withOptions:AspectPositionAfter usingBlock:^(id&lt;AspectInfo&gt; aspectInfo, BOOL animated)&#123; [self _viewWillAppear:animated controller:aspectInfo.instance]; &#125; error:NULL]; &#125; return self;&#125; è‡³äº Category å·²ç»éå¸¸ç†Ÿæ‚‰äº† 12345678910111213141516171819202122232425262728@interface UIViewController (NonBase)/** å»Model&amp;&amp;è¡¨å¾åŒ–å‚æ•°åˆ—è¡¨ */@property (nonatomic, strong) NSDictionary *params;/** ViewModel å±æ€§ */@property (nonatomic, strong) id &lt;FKViewControllerProtocol&gt; viewModel;#pragma mark - é€šç”¨ç±»/** è¿”å›Controllerçš„å½“å‰bounds @param hasNav æ˜¯å¦æœ‰å¯¼èˆªæ  @param hasTabBar æ˜¯å¦æœ‰tabbar @return åæ ‡ */- (CGRect)fk_visibleBoundsShowNav:(BOOL)hasNav showTabBar:(BOOL)hasTabBar;/** éšè—é”®ç›˜ */- (void)fk_hideKeyBoard;@end è‡³æ­¤ï¼Œæˆ‘ä»¬å·²ç»å®ç°äº†ä¸ç»§æ‰¿åŸºç±»æ¥å®ç°å¯¹ViewControllerçš„é…ç½®ï¼Œé¡¹ç›®ä¸­çš„ View ViewModel å»åŸºç±»åŸç†å¦‚å‡ºä¸€è¾™ã€‚ Viewå±‚é‡‡ç”¨ MVVM è®¾è®¡æ¨¡å¼ï¼Œä½¿ç”¨ ReactiveObjC è¿›è¡Œæ•°æ®ç»‘å®š-MVC- ä½œä¸ºè€ç‰Œæ€æƒ³MVCï¼Œå¤§å®¶æ—©å·²è€³ç†Ÿèƒ½è¯¦ï¼ŒMVCç´ æœ‰ Massive VCä¹‹ç§°ï¼Œéšç€ä¸šåŠ¡å¢åŠ ï¼ŒControllerå°†ä¼šè¶Šæ¥è¶Šå¤æ‚ï¼Œæœ€ç»ˆControllerä¼šå˜æˆä¸€ä¸ªâ€ç¥ç±»â€, å³æœ‰ç½‘ç»œè¯·æ±‚ç­‰ä»£ç ï¼Œåˆå……æ–¥ç€å¤§é‡ä¸šåŠ¡é€»è¾‘ï¼Œæ‰€ä»¥ä¸ºControllerå‡è´Ÿï¼Œåœ¨æŸäº›æƒ…å†µä¸‹å˜å¾—åŠ¿åœ¨å¿…è¡Œ -MVVM- MVVMæ˜¯åŸºäºèƒ–Modelçš„æ¶æ„æ€è·¯å»ºç«‹çš„ï¼Œç„¶ååœ¨èƒ–Modelä¸­æ‹†å‡ºä¸¤éƒ¨åˆ†ï¼šModelå’ŒViewModel (æ³¨ï¼šèƒ–Model æ˜¯æŒ‡åŒ…å«äº†ä¸€äº›å¼±ä¸šåŠ¡é€»è¾‘çš„Model)èƒ–Modelå®é™…ä¸Šæ˜¯ä¸ºäº†å‡è´Ÿ Controller è€Œå­˜åœ¨çš„ï¼Œè€Œ MVVM æ˜¯ä¸ºäº†æ‹†åˆ†èƒ–Model , æœ€ç»ˆç›®çš„éƒ½æ˜¯ä¸ºäº†å‡è´ŸControllerã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œè‹¹æœMVCå¹¶æ²¡æœ‰ä¸“é—¨ä¸ºç½‘ç»œå±‚ä»£ç åˆ†ä¸“é—¨çš„å±‚çº§ï¼ŒæŒ‰ç…§ä»¥å¾€ä¹ æƒ¯ï¼Œå¤§å®¶éƒ½å†™åœ¨äº†Controller ä¸­ï¼Œè¿™ä¹Ÿæ˜¯Controller å˜Massiveå¾—å…ƒå‡¶ä¹‹ä¸€ï¼Œç°åœ¨æˆ‘ä»¬å¯ä»¥å°†ç½‘ç»œè¯·æ±‚ç­‰è¯¸å¦‚æ­¤ç±»çš„ä»£ç æ”¾åˆ°ViewModelä¸­äº† ï¼ˆæ–‡ç« ååŠéƒ¨åˆ†å°†ä¼šæè¿°ViewModelä¸­çš„ç½‘ç»œè¯·æ±‚ï¼‰ -æ•°æ®æµå‘- æ­£å¸¸çš„ç½‘ç»œè¯·æ±‚è·å–æ•°æ®ï¼Œç„¶åæ›´æ–°Viewè‡ªç„¶ä¸å¿…å¤šè¯´ï¼Œé‚£ä¹ˆå¦‚æœViewäº§ç”Ÿäº†æ•°æ®è¦æ€ä¹ˆæŠŠæ•°æ®ç»™åˆ°Modelï¼Œç”±äºViewä¸ç›´æ¥æŒæœ‰ViewModelï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦æœ‰ä¸ªæ¡¥æ¢ ReactiveCocoa, é€šè¿‡ Signal æ¥å’Œ ViewModel é€šä¿¡ï¼Œè¿™ä¸ªè¿‡ç¨‹æˆ‘ä»¬ä½¿ç”¨ é€šçŸ¥ æˆ–è€… Target-Actionä¹Ÿå¯ä»¥å®ç°ç›¸åŒçš„æ•ˆæœï¼Œåªä¸è¿‡æ²¡æœ‰ ReactiveCocoa å¦‚æ­¤æ–¹ä¾¿ç½¢äº† 123456789101112131415161718/* View -&gt; ViewModel ä¼ é€’æ•°æ®ç¤ºä¾‹ */#pragma mark - Bind ViewModel- (void)bindViewModel:(id&lt;FKViewModelProtocol&gt;)viewModel withParams:(NSDictionary *)params &#123; if ([viewModel isKindOfClass:[FKLoginViewModel class]])&#123; FKLoginViewModel *_viewModel = (FKLoginViewModel *)viewModel; // ç»‘å®šè´¦å· View -&gt; ViewModel ä¼ é€’æ•°æ® @weakify(self); RAC(_viewModel, userAccount) = [[self.inputTextFiled.rac_textSignal takeUntil:self.rac_prepareForReuseSignal] map:^id _Nullable(NSString * _Nullable account) &#123; @strongify(self); // é™åˆ¶è´¦å·é•¿åº¦ if (account.length &gt; 25) &#123; self.inputTextFiled.text = [account substringToIndex:25]; &#125; return self.inputTextFiled.text; &#125;]; &#125;&#125; ä¸Šé¢ä»£ç ç»™å‡ºäº† View -&gt; ViewModel ç»‘å®šçš„ä¸€ä¸ªä¾‹å­ å…·ä½“ä¸€äº›è¯¦æƒ…ï¼Œå¯ä»¥ç›´æ¥çœ‹DemoMVVMä¸€äº›æ€»ç»“ï¼š View C ViewModel Model å®é™…ä¸Šåº”è¯¥ç§°ä¹‹ä¸ºMVCVM Controller å°†ä¸å†ç›´æ¥å’Œ Model è¿›è¡Œç»‘å®šï¼Œè€Œé€šè¿‡æ¡¥æ¢ViewModel æœ€ç»ˆ Controller çš„ä½œç”¨å˜æˆä¸€äº›UIçš„å¤„ç†é€»è¾‘ï¼Œå’Œè¿›è¡ŒViewå’ŒViewModelçš„ç»‘å®š MVVM å’Œ MVC å…¼å®¹ ç”±äºå¤šäº†ä¸€å±‚ ViewModel, ä¼šéœ€è¦å†™ä¸€äº›èƒ¶æ°´ä»£ç ï¼Œæ‰€ä»¥ä»£ç é‡ä¼šå¢åŠ  ç½‘ç»œå±‚ä½¿ç”¨ YTKNetwork é…åˆ ReactiveCocoa å°è£…ç½‘ç»œè¯·æ±‚ï¼Œè§£å†³å¦‚ä½•äº¤ä»˜æ•°æ®ï¼Œäº¤ä»˜ä»€ä¹ˆæ ·çš„æ•°æ®ï¼ˆå»ModelåŒ–)ç­‰é—®é¢˜YTKNetwork æ˜¯çŒ¿é¢˜åº“ iOS ç ”å‘å›¢é˜ŸåŸºäº AFNetworking å°è£…çš„ iOS ç½‘ç»œåº“ï¼Œå…¶å®ç°äº†ä¸€å¥— High Level çš„ APIï¼Œæä¾›äº†æ›´é«˜å±‚æ¬¡çš„ç½‘ç»œè®¿é—®æŠ½è±¡ã€‚ ç¬”è€…å¯¹ YTKNetwork è¿›è¡Œäº†ä¸€äº›å°è£…ï¼Œç»“åˆ ReactiveCocoaï¼Œå¹¶æä¾› reFormatter æ¥å£å¯¹æœåŠ¡å™¨å“åº”æ•°æ®é‡æ–°å¤„ç†ï¼Œçµæ´»äº¤ä»˜ç»™ä¸šåŠ¡å±‚ã€‚æ¥ä¸‹æ¥ï¼Œæœ¬æ–‡ä¼šå›ç­”ä¸¤ä¸ªé—®é¢˜ ä»¥ä»€ä¹ˆæ–¹å¼å°†æ•°æ®äº¤ä»˜ç»™ä¸šåŠ¡å±‚ï¼Ÿ äº¤ä»˜ä»€ä¹ˆæ ·çš„æ•°æ® ?å¯¹äºç¬¬ä¸€ä¸ªé—®é¢˜ ä»¥ä»€ä¹ˆæ–¹å¼å°†æ•°æ®äº¤ä»˜ç»™ä¸šåŠ¡å±‚ï¼Ÿ è™½ç„¶ iOSåº”ç”¨æ¶æ„è°ˆ ç½‘ç»œå±‚è®¾è®¡æ–¹æ¡ˆ ä¸­ Casaå¤§ç¥å†™åˆ° å°½é‡ä¸è¦ç”¨blockï¼Œåº”è¯¥ä½¿ç”¨ä»£ç†çš„ç¡®ï¼ŒBlockéš¾ä»¥è¿½è¸ªå’Œå®šä½é”™è¯¯ï¼Œå®¹æ˜“å†…å­˜æ³„æ¼ï¼Œ YTKNetwork ä¹Ÿæä¾›ä»£ç†æ–¹å¼å›è°ƒ 1234567891011121314@protocol YTKRequestDelegate &lt;NSObject&gt;@optional/// Tell the delegate that the request has finished successfully.////// @param request The corresponding request.- (void)requestFinished:(__kindof YTKBaseRequest *)request;/// Tell the delegate that the request has failed.////// @param request The corresponding request.- (void)requestFailed:(__kindof YTKBaseRequest *)request;@end å‰æ–‡æœ‰è¯´è¿‡ï¼ŒMVVM å¹¶ä¸ç­‰äº ReactiveCocoa , ä½†æ˜¯æƒ³è¦ä½“éªŒæœ€çº¯æ­£çš„ ReactiveCocoa è¿˜æ˜¯Blockè¾ƒä¸ºé…¸çˆ½ï¼ŒDemoä¸­ç¬”è€…ä¸¤è€…éƒ½ç»™å‡ºäº†ä»£ç , å¤§å®¶å¯ä»¥è‡ªè¡Œé€‰æ‹©å’Œæ–Ÿé…Œå“ˆæˆ‘ä»¬çœ‹ä¸€ä¸‹ YTKNetwork å’Œ ReactiveCocoa ç»“åˆçš„ä»£ç  123456789101112131415161718192021222324252627- (RACSignal *)rac_requestSignal &#123; [self stop]; RACSignal *signal = [[RACSignal createSignal:^RACDisposable * _Nullable(id&lt;RACSubscriber&gt; _Nonnull subscriber) &#123; // è¯·æ±‚èµ·é£ [self startWithCompletionBlockWithSuccess:^(__kindof YTKBaseRequest * _Nonnull request) &#123; // æˆåŠŸå›è°ƒ [subscriber sendNext:[request responseJSONObject]]; [subscriber sendCompleted]; &#125; failure:^(__kindof YTKBaseRequest * _Nonnull request) &#123; // é”™è¯¯å›è°ƒ [subscriber sendError:[request error]]; &#125;]; return [RACDisposable disposableWithBlock:^&#123; // Signalé”€æ¯ åœæ­¢è¯·æ±‚ [self stop]; &#125;]; &#125;] takeUntil:[self rac_willDeallocSignal]]; //è®¾ç½®åç§° ä¾¿äºè°ƒè¯• if (DEBUG) &#123; [signal setNameWithFormat:@\"%@ -rac_xzwRequest\", RACDescription(self)]; &#125; return signal;&#125; å†™äº†ä¸€ä¸ªç®€å•çš„ Category FKBaseRequest+Rac.hViewModel ä¸­ä½¿ç”¨ RACCommand å°è£…è°ƒç”¨ï¼š1234567891011- (RACCommand *)loginCommand &#123; if (!_loginCommand) &#123; @weakify(self); _loginCommand = [[RACCommand alloc] initWithSignalBlock:^RACSignal * _Nonnull(id _Nullable input) &#123; @strongify(self); return [[[FKLoginRequest alloc] initWithUsr:self.userAccount pwd:self.password] rac_requestSignal]; &#125;]; &#125; return _loginCommand;&#125; Blockæ–¹å¼äº¤ä»˜ä¸šåŠ¡1234567FKLoginRequest *loginRequest = [[FKLoginRequest alloc] initWithUsr:self.userAccount pwd:self.password];return [[[loginRequest rac_requestSignal] doNext:^(id _Nullable x) &#123; // è§£ææ•°æ® [[NSUserDefaults standardUserDefaults] setObject:@(YES) forKey:@\"isLogin\"]; &#125;] materialize]; Delegateæ–¹å¼äº¤ä»˜ä¸šåŠ¡12345678910FKLoginRequest *loginRequest = [[FKLoginRequest alloc] initWithUsr:self.userAccount pwd:self.password];// æ•°æ®è¯·æ±‚å“åº”ä»£ç† é€šè¿‡ä»£ç†å›è°ƒloginRequest.delegate = self;return [loginRequest rac_requestSignal];#pragma mark - YTKRequestDelegate- (void)requestFinished:(__kindof YTKBaseRequest *)request &#123; // è§£ææ•°æ® [[NSUserDefaults standardUserDefaults] setObject:@(YES) forKey:@\"isLogin\"];&#125; äº¤ä»˜ä»€ä¹ˆæ ·çš„æ•°æ® ? ç°åœ¨è¯¸å¦‚ JSONModel ï¼ŒYYModel ä¹‹ç±»çš„Jsonè½¬Modelçš„åº“ä¹Ÿéå¸¸å¤šï¼Œå¤§å¤šæ•°Jsonå¯¹è±¡ï¼Œç½‘ç»œè¯·æ±‚æˆåŠŸç›´æ¥å°±è¢«è½¬æˆModeläº†ç„¶è€Œ iOSåº”ç”¨æ¶æ„è°ˆ ç½‘ç»œå±‚è®¾è®¡æ–¹æ¡ˆ ä¸­ç»™å‡ºäº†ä¸¤ç§æœ‰æ„æ€çš„äº¤ä»˜æ€è·¯ ä½¿ç”¨ reformer å¯¹æ•°æ®è¿›è¡Œæ¸…æ´— å»ç‰¹å®šå¯¹è±¡è¡¨å¾ ï¼ˆå»Modelï¼‰ Casaæ–‡ç« ä¸­å¥½å¤„å·²ç»å†™å¾—å¾ˆè¯¦ç»†äº†ï¼Œé€šè¿‡ä¸åŒçš„ reformer æ¥é‡å¡‘å’Œäº¤ä»˜ä¸åŒçš„ä¸šåŠ¡æ•°æ®ï¼Œå¯ä»¥è¯´æ˜¯éå¸¸çµæ´»äº† ä½¿ç”¨ reformer å¯¹æ•°æ®è¿›è¡Œæ¸…æ´— åœ¨ç½‘ç»œå±‚å°è£… FKBaseRequest.h ä¸­ ç»™å‡ºäº† FKBaseRequestFeformDelegate æ¥å£æ¥é‡å¡‘æ•°æ®1234567891011121314151617181920@protocol FKBaseRequestFeformDelegate &lt;NSObject&gt;/** è‡ªå®šä¹‰è§£æå™¨è§£æå“åº”å‚æ•° @param request å½“å‰è¯·æ±‚ @param jsonResponse å“åº”æ•°æ® @return è‡ªå®šreformatæ•°æ® */- (id)request:(FKBaseRequest *)request reformJSONResponse:(id)jsonResponse;@endç„¶ååœ¨å¯¹åº”çš„ reformer å¯¹æ•°æ®è¿›è¡Œé‡å¡‘#pragma mark - FKBaseRequestFeformDelegate- (id)request:(FKBaseRequest *)request reformJSONResponse:(id)jsonResponse &#123; if([request isKindOfClass:FKLoginRequest.class])&#123; // åœ¨è¿™é‡Œå¯¹jsonæ•°æ®è¿›è¡Œé‡æ–°æ ¼å¼åŒ– &#125; return jsonResponse;&#125; ä¹Ÿå¯ä»¥ç›´æ¥åœ¨å­ç±»çš„ RequestManager ä¸­è¦†ç›–çˆ¶ç±»æ–¹æ³•è¾¾åˆ°ä¸€æ ·çš„æ•ˆæœ12345/* FKLoginRequest.m */// å¯ä»¥åœ¨è¿™é‡Œå¯¹response æ•°æ®è¿›è¡Œé‡æ–°æ ¼å¼åŒ–ï¼Œ ä¹Ÿå¯ä»¥ä½¿ç”¨delegate è®¾ç½® reformattor- (id)reformJSONResponse:(id)jsonResponse &#123;&#125; å»ç‰¹å®šå¯¹è±¡è¡¨å¾ ï¼ˆå»Modelï¼‰ è¿™æ€è·¯å¯ä»¥è¯´æ˜¯ä¸šç•Œçš„æ³¥çŸ³æµäº†å»Modelä¹Ÿå°±æ˜¯è¯´ï¼Œä½¿ç”¨NSDictionaryå½¢å¼äº¤ä»˜æ•°æ®ï¼Œå¯¹äºç½‘ç»œå±‚è€Œè¨€ï¼Œåªéœ€è¦ä¿æŒä½åŸå§‹æ•°æ®å³å¯ï¼Œä¸éœ€è¦ä¸»åŠ¨è½¬åŒ–æˆæ•°æ®åŸå‹ä½†æ˜¯ä¼šå­˜åœ¨ä¸€äº›å°é—®é¢˜ å»Modelå¦‚ä½•ä¿æŒå¯è¯»æ€§ï¼Ÿ å¤æ‚å’Œå¤šæ ·çš„æ•°æ®ç»“æ„å¦‚ä½•è§£æï¼Ÿ Casaå¤§ç¥ æå‡ºäº† ä½¿ç”¨EXTERN + Const å­—ç¬¦ä¸²å½¢å¼ï¼Œå¹¶å»ºè®®å­—ç¬¦ä¸²è·Ÿç€reformerèµ°ï¼Œä¸ªäººè§‰å¾—å¾ˆå¤šæ—¶å€™APIåªéœ€è¦ä¸€ç§è§£ææ ¼å¼ï¼Œæ‰€ä»¥Demoè·Ÿç€ APIManager èµ°ï¼Œå…¶ä»–æƒ…å†µä¸‹å¸¸é‡å­—ç¬¦ä¸²å»ºè®®å¬ä» Casaå¤§ç¥ çš„å»ºè®®ï¼Œå¸¸é‡å®šä¹‰ï¼š 123456/* FKBaseRequest.h */// ç™»å½•token keyFOUNDATION_EXTERN NSString *FKLoginAccessTokenKey;/* FKBaseRequest.m */NSString *FKLoginAccessTokenKey = @\"accessToken\"; åœ¨ .h å’Œ .m æ–‡ä»¶ä¸­è¦åŒæ—¶å†™å¤ªå¤šä»£ç ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥ä½¿ç”¨å±€éƒ¨å¸¸é‡çš„å½¢å¼ï¼Œåªè¦åœ¨ .h æ–‡ä»¶ä¸­å®šä¹‰å³å¯ 12345678910111213// ä¹Ÿå¯ä»¥å†™æˆ å±€éƒ¨å¸¸é‡å½¢å¼static const NSString *FKLoginAccessTokenKey2 = @\"accessToken\";æœ€ç»ˆé‚£ä¹ˆæˆ‘ä»¬çš„reformerå¯èƒ½ä¼šå˜æˆè¿™æ ·å­- (id)request:(FKBaseRequest *)request reformJSONResponse:(id)jsonResponse &#123; if([request isKindOfClass:FKLoginRequest.class])&#123; // åœ¨è¿™é‡Œå¯¹jsonæ•°æ®è¿›è¡Œé‡æ–°æ ¼å¼åŒ– return @&#123; FKLoginAccessTokenKey : jsonResponse[@\"token\"], &#125;; &#125; return jsonResponse;&#125; å¤æ‚å’Œå¤šæ ·çš„æ•°æ®ç»“æ„å¦‚ä½•è§£æï¼Ÿæœ‰æ—¶å€™ï¼Œreformer äº¤ä»˜è¿‡æ¥çš„æ•°æ®ï¼Œæˆ‘ä»¬éœ€è¦è§£æçš„å¯èƒ½æ˜¯å­—ç¬¦ä¸²ç±»å‹ï¼Œä¹Ÿå¯èƒ½æ˜¯NSNumberç±»å‹ï¼Œä¹Ÿæœ‰å¯èƒ½æ˜¯æ•°ç»„ä¸ºæ­¤ï¼Œç¬”è€…æä¾›äº†ä¸€ç³»åˆ— Encode Decodeæ–¹æ³•ï¼Œæ¥é™ä½è§£æçš„å¤æ‚åº¦å’Œå®‰å…¨æ€§1234567891011121314151617181920212223242526#pragma mark - Encode Decode æ–¹æ³•// NSDictionary -&gt; NSStringFK_EXTERN NSString* DecodeObjectFromDic(NSDictionary *dic, NSString *key);// NSArray + index -&gt; idFK_EXTERN id DecodeSafeObjectAtIndex(NSArray *arr, NSInteger index);// NSDictionary -&gt; NSStringFK_EXTERN NSString * DecodeStringFromDic(NSDictionary *dic, NSString *key);// NSDictionary -&gt; NSString ï¼Ÿ NSString ï¼š defaultStrFK_EXTERN NSString* DecodeDefaultStrFromDic(NSDictionary *dic, NSString *key,NSString * defaultStr);// NSDictionary -&gt; NSNumberFK_EXTERN NSNumber * DecodeNumberFromDic(NSDictionary *dic, NSString *key);// NSDictionary -&gt; NSDictionaryFK_EXTERN NSDictionary *DecodeDicFromDic(NSDictionary *dic, NSString *key);// NSDictionary -&gt; NSArrayFK_EXTERN NSArray *DecodeArrayFromDic(NSDictionary *dic, NSString *key);FK_EXTERN NSArray *DecodeArrayFromDicUsingParseBlock(NSDictionary *dic, NSString *key, id(^parseBlock)(NSDictionary *innerDic));#pragma mark - Encode Decode æ–¹æ³•// (nonull Key: nonull NSString) -&gt; NSMutableDictionaryFK_EXTERN void EncodeUnEmptyStrObjctToDic(NSMutableDictionary *dic,NSString *object, NSString *key);// nonull objec -&gt; NSMutableArrayFK_EXTERN void EncodeUnEmptyObjctToArray(NSMutableArray *arr,id object);// (nonull (Key ? key : defaultStr) : nonull Value) -&gt; NSMutableDictionaryFK_EXTERN void EncodeDefaultStrObjctToDic(NSMutableDictionary *dic,NSString *object, NSString *key,NSString * defaultStr);// (nonull Key: nonull object) -&gt; NSMutableDictionaryFK_EXTERN void EncodeUnEmptyObjctToDic(NSMutableDictionary *dic,NSObject *object, NSString *key); æˆ‘ä»¬çš„reformerå¯ä»¥å†™æˆè¿™æ ·å­1234567891011#pragma mark - FKBaseRequestFeformDelegate- (id)request:(FKBaseRequest *)request reformJSONResponse:(id)jsonResponse &#123; if([request isKindOfClass:FKLoginRequest.class])&#123; // åœ¨è¿™é‡Œå¯¹jsonæ•°æ®è¿›è¡Œé‡æ–°æ ¼å¼åŒ– return @&#123; FKLoginAccessTokenKey : DecodeStringFromDic(jsonResponse, @\"token\") &#125;; &#125; return jsonResponse;&#125; è§£ææœ‰å¯èƒ½æ˜¯è¿™æ ·å­1NSString *token = DecodeStringFromDic(jsonResponse, FKLoginAccessTokenKey) å¥½äº†ï¼Œè‡³æ­¤æˆ‘ä»¬è§£å†³äº†ä¸¤ä¸ªé—®é¢˜ ä»¥ä»€ä¹ˆæ–¹å¼å°†æ•°æ®äº¤ä»˜ç»™ä¸šåŠ¡å±‚ç­”ï¼šdelegate æœ€ä½³ï¼Œblockä¸ºæ¬¡ äº¤ä»˜ä»€ä¹ˆæ ·çš„æ•°æ®ç­”ï¼šçº¯å­—å…¸ï¼Œå»Model é‡‡ç”¨ JLRoutes è·¯ç”±å¯¹åº”ç”¨è¿›è¡Œç»„ä»¶åŒ–è§£è€¦ å¸¦ç€é—®é¢˜æ€è€ƒå¦‚ä½•æ‰èƒ½è®¾è®¡å‡ºæœ€å¥½çš„ç»„ä»¶åŒ–è·¯ç”±ï¼š 1ï¼‰3D-TouchåŠŸèƒ½æˆ–è€…ç‚¹å‡»æ¨é€æ¶ˆæ¯ï¼Œè¦æ±‚å¤–éƒ¨è·³è½¬åˆ°Appå†…éƒ¨ä¸€ä¸ªå¾ˆæ·±å±‚æ¬¡çš„ä¸€ä¸ªç•Œé¢ã€‚ 2ï¼‰è‡ªå®¶çš„ä¸€ç³»åˆ—Appä¹‹é—´å¦‚ä½•ç›¸äº’è·³è½¬ï¼Ÿ 3ï¼‰å¦‚ä½•è§£é™¤Appç»„ä»¶ä¹‹é—´å’ŒAppé¡µé¢ä¹‹é—´çš„è€¦åˆæ€§ï¼Ÿ 4ï¼‰å¦‚ä½•èƒ½ç»Ÿä¸€iOSå’ŒAndroidä¸¤ç«¯çš„é¡µé¢è·³è½¬é€»è¾‘ï¼Ÿç”šè‡³å¦‚ä½•èƒ½ç»Ÿä¸€ä¸‰ç«¯çš„è¯·æ±‚èµ„æºçš„æ–¹å¼ï¼Ÿ 5ï¼‰å¦‚æœä½¿ç”¨äº†åŠ¨æ€ä¸‹å‘é…ç½®æ–‡ä»¶æ¥é…ç½®Appçš„è·³è½¬é€»è¾‘ï¼Œé‚£ä¹ˆå¦‚æœåšåˆ°iOSå’ŒAndroidä¸¤è¾¹åªè¦å…±ç”¨ä¸€å¥—é…ç½®æ–‡ä»¶ï¼Ÿ 6ï¼‰å¦‚æœAppå‡ºç°bugäº†ï¼Œå¦‚ä½•ä¸ç”¨JSPatchï¼Œå°±èƒ½åšåˆ°ç®€å•çš„çƒ­ä¿®å¤åŠŸèƒ½ï¼Ÿ 7ï¼‰å¦‚ä½•åœ¨æ¯ä¸ªç»„ä»¶é—´è°ƒç”¨å’Œé¡µé¢è·³è½¬æ—¶éƒ½è¿›è¡ŒåŸ‹ç‚¹ç»Ÿè®¡ï¼Ÿæ¯ä¸ªè·³è½¬çš„åœ°æ–¹éƒ½æ‰‹å†™ä»£ç åŸ‹ç‚¹ï¼Ÿåˆ©ç”¨Runtime AOP ï¼Ÿ 8ï¼‰å¦‚ä½•åœ¨æ¯ä¸ªç»„ä»¶é—´è°ƒç”¨çš„è¿‡ç¨‹ä¸­ï¼ŒåŠ å…¥è°ƒç”¨çš„é€»è¾‘æ£€æŸ¥ï¼Œä»¤ç‰Œæœºåˆ¶ï¼Œé…åˆç°åº¦è¿›è¡Œé£æ§é€»è¾‘ï¼Ÿ 9ï¼‰å¦‚ä½•åœ¨Appä»»ä½•ç•Œé¢éƒ½å¯ä»¥è°ƒç”¨åŒä¸€ä¸ªç•Œé¢æˆ–è€…åŒä¸€ä¸ªç»„ä»¶ï¼Ÿåªèƒ½åœ¨AppDelegateé‡Œé¢æ³¨å†Œå•ä¾‹æ¥å®ç°ï¼Ÿ iOSåº”ç”¨æ¶æ„è°ˆ ç»„ä»¶åŒ–æ–¹æ¡ˆ ä¸€æ–‡ä¸­ Casa é’ˆå¯¹ è˜‘è‡è¡—ç»„ä»¶åŒ– æå‡ºäº†è´¨ç–‘ï¼Œè´¨ç–‘ç‚¹ä¸»è¦åœ¨è¿™å‡ æ–¹é¢ Appå¯åŠ¨æ—¶ç»„ä»¶éœ€è¦æ³¨å†ŒURL URLè°ƒç”¨ç»„ä»¶æ–¹å¼ä¸å¤ªå¥½ä¼ é€’ç±»ä¼¼ UIImage ç­‰éå¸¸è§„å¯¹è±¡ URLéœ€è¦æ·»åŠ é¢å¤–å‚æ•°å¯è¯»æ€§å·®ï¼Œæ‰€ä»¥æ²¡å¿…è¦ä½¿ç”¨URL å¯¹äº Appå¯åŠ¨æ—¶ç»„ä»¶éœ€è¦æ³¨å†ŒURL é¡¾è™‘ä¸»è¦åœ¨äºï¼Œæ³¨å†Œçš„URLéœ€è¦åœ¨åº”ç”¨ç”Ÿå­˜å‘¨æœŸå†…å¸¸é©»å†…å­˜ï¼Œå¦‚æœæ˜¯æ³¨å†ŒClassè¿˜å¥½äº›ï¼Œå¦‚æœæ³¨å†Œçš„æ˜¯å®ä¾‹ï¼Œæ¶ˆè€—çš„å†…å­˜å°±éå¸¸å¯è§‚äº† 12345#pragma mark - è·¯ç”±è¡¨NSString *const FKNavPushRoute = @\"/com_madao_navPush/:viewController\";NSString *const FKNavPresentRoute = @\"/com_madao_navPresent/:viewController\";NSString *const FKNavStoryBoardPushRoute = @\"/com_madao_navStoryboardPush/:viewController\";NSString *const FKComponentsCallBackRoute = @\"/com_madao_callBack/*\"; è€Œä¸”JLRoutes è¿˜æ”¯æŒ * æ¥è¿›è¡Œé€šé…ï¼Œè·¯ç”±è¡¨å¦‚ä½•ç¼–å†™å¤§å®¶å¯ä»¥è‡ªç”±å‘æŒ¥å¯¹åº”çš„è·¯ç”±äº‹ä»¶ handler 12345678910111213141516171819202122232425262728293031323334353637// push// è·¯ç”± /com_madao_navPush/:viewController[[JLRoutes globalRoutes] addRoute:FKNavPushRoute handler:^BOOL(NSDictionary&lt;NSString *,id&gt; * _Nonnull parameters) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; [self _handlerSceneWithPresent:NO parameters:parameters]; &#125;); return YES;&#125;];// present// è·¯ç”± /com_madao_navPresent/:viewController[[JLRoutes globalRoutes] addRoute:FKNavPresentRoute handler:^BOOL(NSDictionary&lt;NSString *,id&gt; * _Nonnull parameters) &#123; dispatch_async(dispatch_get_main_queue(), ^&#123; [self _handlerSceneWithPresent:YES parameters:parameters]; &#125;); return YES;&#125;];#pragma mark - Private/// å¤„ç†è·³è½¬äº‹ä»¶- (void)_handlerSceneWithPresent:(BOOL)isPresent parameters:(NSDictionary *)parameters &#123; // å½“å‰æ§åˆ¶å™¨ NSString *controllerName = [parameters objectForKey:FKControllerNameRouteParam]; UIViewController *currentVC = [self _currentViewController]; UIViewController *toVC = [[NSClassFromString(controllerName) alloc] init]; toVC.params = parameters; if (currentVC &amp;&amp; currentVC.navigationController) &#123; if (isPresent) &#123; [currentVC.navigationController presentViewController:toVC animated:YES completion:nil]; &#125;else &#123; [currentVC.navigationController pushViewController:toVC animated:YES]; &#125; &#125;&#125; é€šè¿‡URLä¸­ä¼ å…¥çš„ç»„ä»¶ååŠ¨æ€æ³¨å†Œï¼Œå¤„ç†ç›¸åº”è·³è½¬äº‹ä»¶ï¼Œå¹¶ä¸éœ€è¦æ¯ä¸ªç»„ä»¶ä¸€ä¸€æ³¨å†Œä½¿ç”¨URLè·¯ç”±ï¼Œå¿…ç„¶URLä¼šæ•£è½åˆ°ä»£ç å„ä¸ªåœ°æ–¹ 1234NSString *key = @\"key\";NSString *value = @\"value\";NSString *url = [NSString stringWithFormat:@\"/com_madao_navPush/%@?%@=%@\", NSStringFromClass(ViewController.class), key, value];[[UIApplication sharedApplication] openURL:[NSURL URLWithString:url]]; è¯¸å¦‚æ­¤ç±»ä¸‘é™‹çš„ä»£ç ï¼Œæ•£è½åœ¨å„ä¸ªåœ°æ–¹çš„è¯ç®€ç›´ä¼šè®©äººå¤´çš®å‘éº», æ‰€ä»¥ç¬”è€…åœ¨ JLRoutes+GenerateURL.h å†™äº†ä¸€äº› Helperæ–¹æ³•1234567891011121314151617181920212223242526272829303132333435/** é¿å… URL æ•£è½å„å¤„ï¼Œ é›†ä¸­ç”ŸæˆURL @param pattern åŒ¹é…æ¨¡å¼ @param parameters é™„å¸¦å‚æ•° @return URLå­—ç¬¦ä¸² */+ (NSString *)fk_generateURLWithPattern:(NSString *)pattern parameters:(NSArray *)parameters;/** é¿å… URL æ•£è½å„å¤„ï¼Œ é›†ä¸­ç”ŸæˆURL é¢å¤–å‚æ•°å°†è¢« ?key=value&amp;key2=value2 æ ·å¼ç»™å‡º @param pattern åŒ¹é…æ¨¡å¼ @param parameters é™„åŠ å‚æ•° @param extraParameters é¢å¤–å‚æ•° @return URLå­—ç¬¦ä¸² */+ (NSString *)fk_generateURLWithPattern:(NSString *)pattern parameters:(NSArray *)parameters extraParameters:(NSDictionary *)extraParameters;/** è§£æNSURLå¯¹è±¡ä¸­çš„è¯·æ±‚å‚æ•°http://madao?param1=value1Â¶m2=value2 è§£ææˆ @&#123;param1:value1, param2:value2&#125; @param URL NSURLå¯¹è±¡ @return URLå­—ç¬¦ä¸² */+ (NSDictionary *)fk_parseParamsWithURL:(NSURL *)URL;/** å°†å‚æ•°å¯¹è±¡è¿›è¡Œurlç¼–ç  å°†@&#123;param1:value1, param2:value2&#125; è½¬æ¢æˆ ?param1=value1&amp;param2=value2 @param dic å‚æ•°å¯¹è±¡ @return URLå­—ç¬¦ä¸² */+ (NSString *)fk_mapDictionaryToURLQueryString:(NSDictionary *)dic; å®å®šä¹‰Helper12345678910#undef JLRGenRoute#define JLRGenRoute(Schema, path) \\([NSString stringWithFormat: @\"%@:/%@\", \\Schema, \\path])#undef JLRGenRouteURL#define JLRGenRouteURL(Schema, path) \\([NSURL URLWithString: \\JLRGenRoute(Schema, path)]) æœ€ç»ˆæˆ‘ä»¬çš„è°ƒç”¨å¯ä»¥å˜æˆ12NSString *router = [JLRoutes fk_generateURLWithPattern:FKNavPushRoute parameters:@[NSStringFromClass(ViewController.class)] extraParameters:nil];[[UIApplication sharedApplication] openURL:JLRGenRouteURL(FKDefaultRouteSchema, router)]; ğŸ“ æ•´ç†åˆ¶ä½œCasa Taloyumï¼šhttps://casatwy.com/modulization_in_action.html ç®€ä¹¦åšå®¢ï¼šhttp://www.jianshu.com/p/921dd65e79cb ğŸ˜¬ è”ç³» å¾®ä¿¡ : WhatsXie é‚®ä»¶ : ReverseScale@iCloud.com åšå®¢ : https://reversescale.github.io","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"ReactNative å¼€å‘å¸¸ç”¨å‘½ä»¤è¡Œï¼ˆæŒç»­æ›´æ–°ï¼‰","slug":"ReactNative command","date":"2018-03-29T14:56:27.000Z","updated":"2018-11-16T12:13:47.540Z","comments":true,"path":"2018/03/29/ReactNative command/","link":"","permalink":"https://reversescale.github.io/2018/03/29/ReactNative command/","excerpt":"è®°å½•ä¸€äº› ReactNative å¸¸ç”¨çš„å‘½ä»¤è¡Œï¼ŒåŒ…æ‹¬äº†ä¾‹å¦‚å®‰è£…ã€å¯åŠ¨æœåŠ¡ã€æ’ä»¶ç®¡ç†ã€çƒ­æ›´æ–°ç­‰ä¸€äº›æ—¥å¸¸ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤ï¼Œä¼šéšç€ä½¿ç”¨çš„æ·±å…¥ä¸æ–­çš„è¡¥å…… ~","text":"è®°å½•ä¸€äº› ReactNative å¸¸ç”¨çš„å‘½ä»¤è¡Œï¼ŒåŒ…æ‹¬äº†ä¾‹å¦‚å®‰è£…ã€å¯åŠ¨æœåŠ¡ã€æ’ä»¶ç®¡ç†ã€çƒ­æ›´æ–°ç­‰ä¸€äº›æ—¥å¸¸ç»å¸¸ä½¿ç”¨çš„å‘½ä»¤ï¼Œä¼šéšç€ä½¿ç”¨çš„æ·±å…¥ä¸æ–­çš„è¡¥å…… ~ Node ç›¸å…³æŸ¥çœ‹æ‰€æœ‰å®‰è£…çš„nodeç‰ˆæœ¬ä¿¡æ¯ï¼š1nvm list æŸ¥çœ‹æ›´æ–°äº†çš„nodeçš„ç‰ˆæœ¬(å¯èƒ½éœ€è¦ç¿»å¢™)ï¼š1nvm ls-remote å®‰è£…nodeï¼š1nvm install v7.4.0 è®¾ç½®é»˜è®¤çš„nodeç‰ˆæœ¬(è¿™é‡Œè®¾ç½®æˆäº†7.4.0)ï¼Œè§£å†³æœ‰äº›ç‰ˆæœ¬æœ‰äº›å…¼å®¹æ€§çš„é—®é¢˜ï¼š1nvm alias default v7.4.0 React ç›¸å…³å¸è½½å‘½ä»¤ï¼š1npm uninstall -g react-native-cli å®‰è£…å‘½ä»¤ï¼š1npm install -g react-native-cli æŸ¥çœ‹æŸä¸ªæ¨¡å—æœ€æ–°å‘å¸ƒç‰ˆæœ¬ä¿¡æ¯(è¿™é‡ŒæŸ¥çœ‹react-nativeå‘å¸ƒçš„ç‰ˆæœ¬ä¿¡æ¯)ï¼š1npm info react-native å‡çº§æˆ–è€…é™çº§react-nativeçš„ç‰ˆæœ¬å¹¶ä¸”æ›´æ–°package.jsonï¼Œéœ€è¦ç”¨åœ¨react-nativeé¡¹ç›®ç›®å½•ä¸‹ï¼š1npm install --save react-native@0.41.1 æ–°å»º react-native é¡¹ç›®å¹¶æŒ‡å®šç‰ˆæœ¬ï¼š1react-native init demo --version 0.40.0 å¼€å¯æœåŠ¡ï¼š1react-native start è¿è¡ŒAndroidï¼š1react-native run-android è¿è¡ŒiOSï¼š1react-native run-ios ç‰ˆæœ¬æŸ¥çœ‹ï¼š1react-native --version é¡¹ç›®ç‰ˆæœ¬æŸ¥çœ‹ï¼š1react-native -v æŸ¥çœ‹react-nativeçš„å¸®åŠ©ä¿¡æ¯ï¼š1react-native --help ä½¿ç”¨ Cocoapods ç®¡ç† ReactNativePodfile æ–‡ä»¶æ ¼å¼ï¼š1234567891011pod &apos;React&apos;, :path =&gt; &apos;./node_modules/react-native&apos;, :subspecs =&gt; [ &apos;Core&apos;, &apos;RCTText&apos;, &apos;RCTImage&apos;, &apos;RCTActionSheet&apos;, &apos;RCTGeolocation&apos;, &apos;RCTNetwork&apos;, &apos;RCTSettings&apos;, &apos;RCTVibration&apos;, &apos;RCTWebSocket&apos;, ] ReactNative 0.42.0 ä»¥ä¸Šç‰ˆæœ¬éœ€åœ¨ Podfile é…ç½® yogaï¼š12# å¦‚æœä½ çš„RNç‰ˆæœ¬ &gt;= 0.42.0ï¼Œè¯·åŠ å…¥ä¸‹é¢è¿™è¡Œpod &quot;yoga&quot;, :path =&gt; &quot;./node_modules/react-native/ReactCommon/yoga&quot; å¼€æºç»„ä»¶åº“ï¼šå®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼š1npm install react-native-tab-navigator --save å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼š1npm install --save react-native-tab-navigator@0.4.0 react-native é›†æˆç»„ä»¶ç»‘å®š(ReactNative 0.27ä»¥åï¼Œè‡ªé›†æˆRNPM)ï¼š1react-native link react-native-splash-screen å¸¸ç”¨å¼€æºåº“ï¼š12345678npm install --save react-native-tab-navigator@0.4.0npm install --save react-native-scrollable-tab-view@0.7.0npm install --save react-native-check-box@1.0.4npm install --react-native-easy-toast@1.0.9npm install --save GitHubTrending@2.0.0npm install --save react-native-htmlview@0.5.0npm install --save react-native-popover@0.5.0npm install --react-native-splash-screen@2.0.0 Code-Push å¸¸ç”¨å‘½ä»¤Code-Push æ¨åŒ…å‘½ä»¤ï¼š1code-push release-react &lt;appName&gt; &lt;platform&gt; [options] ç¤ºä¾‹ï¼š 1code-push release-react RNAPPGithub ios --t 1.0.2 --dev false --d Staging --des &quot;1.çƒ­æ›´æ–°ç›¸å…³è®¾ç½®&quot; --m true Code-Push çº¿ä¸ŠæŸ¥çœ‹æ›´æ–°ï¼š1code-push deployment ls RNAPPGithub Code-Push æŸ¥çœ‹é¡¹ç›®Keyï¼š1code-push deployment ls RNAPPGithub -k Code-Push iOSæ›´æ–°æ‰“åŒ…æ–¹æ³•ï¼š1react-native bundle --platform ios --entry-file index.js --bundle-output release_ios/main.jsbundle --assets-dest release_ios/ --dev fasle IDE æŠ€å·§ã€Šä½¿ç”¨VS Codeè°ƒè¯•React-Nativeç¨‹åºã€‹ï¼ˆhttps://jingyan.baidu.com/article/ad310e80fb13fc1849f49ed1.htmlï¼‰","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"ReactNative","slug":"ReactNative","permalink":"https://reversescale.github.io/tags/ReactNative/"}]},{"title":"ReactNative å­¦ä¹ æˆæœæ€»ç»“","slug":"ReactNative APP","date":"2018-03-29T11:56:27.000Z","updated":"2018-11-16T12:13:55.027Z","comments":true,"path":"2018/03/29/ReactNative APP/","link":"","permalink":"https://reversescale.github.io/2018/03/29/ReactNative APP/","excerpt":"ReactNative è¿™å‡ å¹´é£ç”Ÿæ°´èµ·ï¼Œå½“ç„¶é™¤äº† React ç¤¾åŒºç”Ÿæ€åœˆçš„åŠ æŒå’Œ Facebook çš„å¤§åŠ›æ¨å¹¿ä»¥å¤–ï¼Œå¦å¤–ä¸€ä¸ªæœ€ä¸»è¦çš„åŸå› å°±æ˜¯å…¶åœ¨å¼€å‘æ•ˆç‡å’Œåº”ç”¨æ€§èƒ½æ–¹é¢å–å¾—äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¹³è¡¡~","text":"ReactNative è¿™å‡ å¹´é£ç”Ÿæ°´èµ·ï¼Œå½“ç„¶é™¤äº† React ç¤¾åŒºç”Ÿæ€åœˆçš„åŠ æŒå’Œ Facebook çš„å¤§åŠ›æ¨å¹¿ä»¥å¤–ï¼Œå¦å¤–ä¸€ä¸ªæœ€ä¸»è¦çš„åŸå› å°±æ˜¯å…¶åœ¨å¼€å‘æ•ˆç‡å’Œåº”ç”¨æ€§èƒ½æ–¹é¢å–å¾—äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¹³è¡¡~ å­¦ä¹ è¯¾ç¨‹ï¼šã€ŠåŒå¹³å°çœŸå®å¼€å‘GitHub App React NativeæŠ€æœ¯å…¨é¢æŒæ¡ã€‹399 å¤§æ´‹ï¼Œå«ç€æ³ªåƒäº†ä¸€ä¸ªæœˆæ³¡é¢.. ğŸ‘¨ğŸ»â€ğŸ’» Github Demo çŸ¥è¯†ç‚¹ï¼š 1.æ•´ç† ReactNative ç½‘ç»œå°è£…åŠå¸¸ç”¨çš„ä¸‰æ–¹æ¨¡å— 2.ReactNative çš„ AsyncStorageæ•°æ®åº“æŠ€æœ¯ã€ç¦»çº¿ç¼“å­˜ 3.ReactNative çš„æ•°æ® DAO å±‚è®¾è®¡æŠ€å·§ï¼Œæ•°æ®çŠ¶æ€å®æ—¶æ›´æ–° 4.ReactNative çš„ä»£ç æå–æŠ€å·§ï¼Œç»„åˆæ¨¡å¼åº”ç”¨æŠ€å·§ï¼Œæ•°æ®å¼‚æ­¥åˆ·æ–°ä¸åŠ¨æ€æ·»åŠ  5.ReactNative çš„ç‰ˆæœ¬å‡çº§ã€æ•°æ®ç»Ÿè®¡ã€ç¤¾ä¼šåŒ–åˆ†äº«ã€ç¬¬ä¸‰æ–¹ç™»å½•ï¼Œçƒ­æ›´æ–°ç­‰ 6.ReactNative é¡¹ç›®å‘å¸ƒå‰çš„ä¼˜åŒ–ã€æ‰“åŒ…ä¸ä¸Šçº¿ ç›®å½•ç»“æ„ï¼š ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯ é¡¹ç›®ä»‹ç» ç»„ä»¶åŒ– é›†æˆä¸ç®¡ç† å¸ƒå±€çº¦æŸ ç»„ä»¶å°è£… æœ¬åœ°æŒä¹…åŒ– ç½‘ç»œè¯·æ±‚å°è£… åŠŸèƒ½è°ƒè¯• åŒå¹³å°é€‚é… å¼€æºç»„ä»¶åº“çš„ä½¿ç”¨ çƒ­æ›´æ–° ç”Ÿå‘½å‘¨æœŸåŠä½¿ç”¨åœºæ™¯å¸¸ç”¨æ–¹æ³•ï¼š constructor: componentWillMount: render: componentDidMount: componentWillReceiveProps: shouldComponentUpdate: componentWillUpdate: componentDidUpdate componentWillUnmount: constructor:åœ¨ç»„ä»¶åˆ›å»ºçš„æ—¶å€™è°ƒç”¨ä¸€æ¬¡,è¿™ä¸ªæ–¹æ³•è¿›è¡Œthis.stateåˆå§‹åŒ–çŠ¶æ€æœºã€‚123456constructor(props) &#123; super(props); // åˆå§‹çŠ¶æ€ this.state = &#123; isShow:true &#125;;&#125; componentWillMount:åœ¨ç»„ä»¶ç”Ÿå‘½å‘¨æœŸä¸­åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡,åœ¨åˆå§‹æ¸²æŸ“(renderå‡½æ•°)å‰è¢«æ‰§è¡Œã€‚æ³¨æ„: å¦‚æœè¿™ä¸ªå‡½æ•°é€šè¿‡setStateå‡½æ•°ä¿®æ”¹çŠ¶æ€æœºå˜é‡,RNæ¡†æ¶ä¸ä¼šé¢å¤–æ‰§è¡Œæ¸²æŸ“(ç•Œé¢åˆ·æ–°) å¦‚æœå­ç»„ä»¶ä¹Ÿæœ‰componentWillMountå‡½æ•°ä½¿ç”¨,ä¼šåœ¨çˆ¶ç»„ä»¶ä¹‹åè°ƒç”¨ éœ€è¦ä»æœ¬åœ°å­˜å‚¨ä¸­è¯»å–æ•°æ®ç”¨äºæ˜¾ç¤º,å¸¸ç”¨è¿™ä¸ªå‡½æ•° render:è¯¥å‡½æ•°ç»„ä»¶å¿…æœ‰çš„ï¼Œé€šè¿‡è¿”å›JSXæˆ–å…¶ä»–ç»„ä»¶æ¥æ„æˆDOMï¼Œæ¢è¨€ä¹‹ï¼Œå°±æ˜¯ç»„ä»¶çš„æ ¸å¿ƒæ¸²æŸ“è¿‡ç¨‹ã€‚ componentDidMount:åœ¨React Nativeç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­,è¿™ä¸ªå‡½æ•°åªä¼šè¢«æ‰§è¡Œä¸€æ¬¡ï¼Œå®ƒåœ¨åˆå§‹æ¸²æŸ“å®Œæˆåä¼šé©¬ä¸Šè¢«è°ƒç”¨ã€‚åœ¨è¿™ä¹‹åå¼€å‘è€…å¯ä»¥é€šè¿‡å­ç»„ä»¶çš„å¼•ç”¨æ¥è®¿é—®ï¼Œæ“ä½œä»»ä½•å­ç»„ä»¶ã€‚å¦‚æœRNç»„ä»¶çš„å­ç»„ä»¶ä¹Ÿæœ‰componentDidMountå‡½æ•°ï¼Œå¹¶ä¼šåœ¨çˆ¶ç»„ä»¶çš„componentDidMountå‡½æ•°ä¹‹å‰è¢«è°ƒç”¨ã€‚ å¸¸ç”¨æ¥ç½‘ç»œè¯·æ±‚æ•°æ® componentWillReceiveProps:åœ¨React Nativeç»„ä»¶çš„åˆå§‹æ¸²æŸ“å®Œæˆåï¼Œpropsæ”¹å˜æ—¶ï¼Œè¿™ä¸ªå‡½æ•°è¢«è°ƒç”¨ï¼Œå‚æ•°æ˜¯ä¸ªæ–°çš„propsã€‚ shouldComponentUpdate:React Nativeç»„ä»¶çš„åˆå§‹æ¸²æŸ“æ‰§è¡Œå®Œæˆå, RNç»„ä»¶æ¥æ”¶åˆ°æ–°çš„stateæˆ–è€…propsæ—¶è¿™ä¸ªå‡½æ•°ä¼šè°ƒç”¨ã€‚ é€šè¿‡è¿™ä¸ªå‡½æ•°é˜»æ­¢æ— å¿…è¦çš„é‡æ–°æ¸²æŸ“ï¼Œæ˜¯æé«˜React Nativeåº”ç”¨ç¨‹åºæ€§èƒ½çš„ä¸€å¤§æŠ€å·§ã€‚ componentWillUpdate:åˆå§‹æ¸²æŸ“å®Œæˆå,é‡æ–°æ¸²æŸ“å‰ä¼šè°ƒç”¨è¿™ä¸ªå‡½æ•°ã€‚ è¿™ä¸ªå‡½æ•°ä¸èƒ½é€šè¿‡this.setStateå†æ¬¡æ”¹å˜çŠ¶æ€æœºå˜é‡çš„å€¼ã€‚ ç»„ä»¶æ›´æ–°æ—¶è°ƒç”¨ã€‚ componentDidUpdateRNç»„ä»¶åˆå§‹æ¸²æŸ“å®Œæˆåï¼ŒRNæ¡†æ¶åœ¨é‡æ–°æ¸²æŸ“RNç»„ä»¶å®Œæˆåè°ƒç”¨ã€‚å‚æ•°æ˜¯æ¸²æŸ“å‰çš„propså’Œstateã€‚ ç»„ä»¶æ›´æ–°å®Œæ¯•æ—¶è°ƒç”¨ã€‚ componentWillUnmount:ReactNative ç»„ä»¶è¢«å¸è½½å‰ä¼šè°ƒç”¨ï¼Œé€šå¸¸åšä¸€äº›æ¸…ç†å†…å®¹ã€‚ é¡¹ç›®ä»‹ç»åŒå¹³å°æ•ˆæœé¢„è§ˆï¼š React Nativeæ˜¯Reactåœ¨ç§»åŠ¨ç«¯çš„è·¨å¹³å°æ–¹æ¡ˆã€‚å¦‚æœæƒ³æ›´å¿«åœ°ç†è§£å’ŒæŒæ¡React Nativeå¼€å‘ï¼Œå°±å¿…é¡»å…ˆäº†è§£Reactã€‚ Reactæ˜¯FaceBookå¼€æºçš„ä¸€ä¸ªå‰ç«¯æ¡†æ¶ï¼Œå®ƒèµ·æºäº Facebook çš„å†…éƒ¨é¡¹ç›®ï¼Œå¹¶äº 2013 å¹´ 5 æœˆå¼€æºã€‚å› ä¸ºReact æ‹¥æœ‰è¾ƒé«˜çš„æ€§èƒ½ï¼Œä»£ç é€»è¾‘éå¸¸ç®€å•ï¼Œæ‰€ä»¥è¶Šæ¥è¶Šå¤šçš„äººå·²å¼€å§‹å…³æ³¨å’Œä½¿ç”¨å®ƒï¼Œç›®å‰è¯¥æ¡†æ¶åœ¨Githubä¸Šå·²ç»æœ‰7ä¸‡+starã€‚ ReactNative æŠ€æœ¯å¯¼å›¾ï¼š ç»„ä»¶åŒ–Reacté‡‡ç”¨ç»„ä»¶åŒ–çš„æ–¹å¼å¼€å‘ï¼Œé€šè¿‡å°†viewæ„å»ºæˆç»„ä»¶ï¼Œä½¿å¾—ä»£ç æ›´åŠ å®¹æ˜“å¾—åˆ°å¤ç”¨ï¼Œèƒ½å¤Ÿå¾ˆå¥½çš„åº”ç”¨åœ¨å¤§é¡¹ç›®çš„å¼€å‘ä¸­ã€‚æœ‰ä¸€å¥è¯è¯´çš„å¾ˆå½¢è±¡ï¼šåœ¨Reactä¸­ï¼Œæ„å»ºåº”ç”¨å°±åƒæ­ç§¯æœ¨ä¸€æ ·ã€‚ ç»„ä»¶åŒ–ç‰¹å¾Reactè®¤ä¸ºä¸€ä¸ªç»„ä»¶åº”è¯¥å…·æœ‰å¦‚ä¸‹ç‰¹å¾ï¼š å¯ç»„åˆï¼ˆComposeableï¼‰ï¼šä¸€ä¸ªç»„ä»¶æ˜“äºå’Œå…¶å®ƒç»„ä»¶ä¸€èµ·ä½¿ç”¨ï¼Œæˆ–è€…åµŒå¥—åœ¨å¦ä¸€ä¸ªç»„ä»¶å†…éƒ¨ã€‚å¦‚æœä¸€ä¸ªç»„ä»¶å†…éƒ¨åˆ›å»ºäº†å¦ä¸€ä¸ªç»„ä»¶ï¼Œé‚£ä¹ˆè¯´çˆ¶ç»„ä»¶æ‹¥æœ‰å®ƒåˆ›å»ºçš„å­ç»„ä»¶ï¼Œé€šè¿‡è¿™ä¸ªç‰¹æ€§ï¼Œä¸€ä¸ªå¤æ‚çš„UIå¯ä»¥æ‹†åˆ†æˆå¤šä¸ªç®€å•çš„UIç»„ä»¶ï¼› å¯é‡ç”¨ï¼ˆReusableï¼‰ï¼šæ¯ä¸ªç»„ä»¶éƒ½æ˜¯å…·æœ‰ç‹¬ç«‹åŠŸèƒ½çš„ï¼Œå®ƒå¯ä»¥è¢«ä½¿ç”¨åœ¨å¤šä¸ªUIåœºæ™¯ï¼› å¯ç»´æŠ¤ï¼ˆMaintainableï¼‰ï¼šæ¯ä¸ªå°çš„ç»„ä»¶ä»…ä»…åŒ…å«è‡ªèº«çš„é€»è¾‘ï¼Œæ›´å®¹æ˜“è¢«ç†è§£å’Œç»´æŠ¤ï¼› å°è£…å¥½çš„å¯¼èˆªæ å°±å¯ä»¥è¢«ç§°ä¹‹ä¸ºä¸€ä¸ªç»„ä»¶ï¼Œå®ƒç¬¦åˆä¸Šè¿°ä¸‰ä¸ªç‰¹ç‚¹ï¼š å¯ç»„åˆï¼šå¯ä»¥å°†å¯¼èˆªæ ç»„ä»¶æ”¾åœ¨é¡µé¢ç»„ä»¶ä¸­ä½œä¸ºé¡µé¢ç»„ä»¶çš„å­ç»„ä»¶ã€‚è€Œä¸”åœ¨å¯¼èˆªæ ç»„ä»¶çš„å†…éƒ¨ï¼Œä¹Ÿæœ‰æŒ‰é’®ç»„ä»¶ç­‰å­ç»„ä»¶ã€‚ å¯é‡ç”¨ï¼šå¦‚æœå°è£…å¥½äº†è¯¥ç»„ä»¶ï¼Œå°±å¯ä»¥æ”¾åœ¨ä»»æ„éœ€è¦å¯¼èˆªæ çš„é¡µé¢ï¼ˆç»„ä»¶ï¼‰ä½¿ç”¨ï¼Œä¹Ÿå¯ä»¥æ”¾åœ¨å…¶ä»–é¡¹ç›®ä¸­ä½¿ç”¨ã€‚ å¯ç»´æŠ¤ï¼šå› ä¸ºå…·æœ‰ç‹¬ç«‹çš„åŠŸèƒ½å’Œå±•ç¤ºé€»è¾‘ï¼Œæ‰€ä»¥ä¾¿äºå®šä½å’Œä¿®æ”¹ã€‚ ç»„ä»¶çš„å±æ€§ä¸çŠ¶æ€åœ¨React Nativeï¼ˆReact.jsï¼‰é‡Œï¼Œç»„ä»¶æ‰€æŒæœ‰çš„æ•°æ®åˆ†ä¸ºä¸¤ç§ï¼š å±æ€§ï¼ˆpropsï¼‰ï¼šç»„ä»¶çš„propsæ˜¯ä¸å¯å˜çš„ï¼Œå®ƒåªèƒ½ä»å…¶ä»–çš„ç»„ä»¶ï¼ˆä¾‹å¦‚çˆ¶ç»„ä»¶ï¼‰ä¼ é€’è¿‡æ¥ã€‚ çŠ¶æ€ï¼ˆstateï¼‰ï¼šç»„ä»¶çš„stateæ˜¯å¯å˜çš„ï¼Œå®ƒè´Ÿè´£å¤„ç†ä¸ç”¨æˆ·çš„äº¤äº’ã€‚åœ¨é€šè¿‡ç”¨æˆ·ç‚¹å‡»äº‹ä»¶ç­‰æ“ä½œä»¥åï¼Œå¦‚æœä½¿å¾—å½“å‰ç»„ä»¶çš„æŸä¸ªstateå‘ç”Ÿäº†æ”¹å˜ï¼Œé‚£ä¹ˆå½“å‰ç»„ä»¶å°±ä¼šè§¦å‘render()æ–¹æ³•åˆ·æ–°è‡ªå·±ã€‚ æˆ‘ä»¬å¯ä»¥çœ‹åˆ°è¿™ä¸ªé¡µé¢æœ‰ä¸¤ä¸ªå­é¡µé¢ï¼Œä¸€ä¸ªæ˜¯â€˜æœ€çƒ­â€™é¡µé¢ï¼ˆç»„ä»¶ï¼‰ï¼Œå¦ä¸€ä¸ªæ˜¯â€˜è¶‹åŠ¿â€˜é¡µé¢ï¼ˆç»„ä»¶ï¼‰ã€‚é‚£ä¹ˆè¿™ä¸¤ä¸ªç»„ä»¶éƒ½æœ‰ä»€ä¹ˆpropså’Œstateå‘¢ï¼Ÿ 1.propsï¼šç”±äºpropsæ˜¯ä»å…¶çˆ¶ç»„ä»¶ä¼ é€’è¿‡æ¥çš„ï¼Œé‚£ä¹ˆå¯æƒ³è€ŒçŸ¥ï¼Œpropsçš„å£°æ˜åº”è¯¥æ˜¯åœ¨å½“å‰ç»„ä»¶çš„çˆ¶ç»„ä»¶é‡Œæ¥åšã€‚åœ¨React Nativeä¸­ï¼Œé€šå¸¸propsçš„å£°æ˜æ˜¯å’Œå½“å‰ç»„ä»¶çš„å£°æ˜æ”¾åœ¨ä¸€èµ·çš„ï¼š 1234//æœ€çƒ­å­é¡µé¢&lt;FavoriteTabPage &#123;...this.props&#125; tabLabel='æœ€çƒ­' flag=&#123;FlAG_STORAGE.flag_popular&#125;/&gt;//è¶‹åŠ¿å­é¡µé¢&lt;FavoriteTabPage &#123;...this.props&#125; tabLabel='è¶‹åŠ¿' flag=&#123;FlAG_STORAGE.flag_trending&#125;/&gt; åœ¨è¿™é‡Œï¼Œæ”¶è—é¡µé¢æ˜¯çˆ¶ç»„ä»¶ï¼Œè€Œæœ€çƒ­é¡µé¢å’Œè¶‹åŠ¿é¡µé¢æ˜¯å…¶å­ç»„ä»¶ã€‚åœ¨æ”¶è—é¡µé¢ç»„ä»¶é‡Œå£°æ˜äº†æœ€çƒ­é¡µé¢å’Œè¶‹åŠ¿é¡µé¢çš„ç»„ä»¶ã€‚ è€Œä¸”æˆ‘ä»¬ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œæœ€çƒ­é¡µé¢å’Œè¶‹åŠ¿é¡µé¢ç»„ä»¶éƒ½ç”¨çš„æ˜¯åŒä¸€ä¸ªç»„ä»¶ï¼šFavoriteTabPageï¼Œè€Œè¿™ä¸¤ä¸ªé¡µé¢çš„ä¸åŒç‚¹åªåœ¨äºä¼ å…¥çš„ä¸¤ä¸ªpropsçš„ä¸åŒï¼štabLabelå’Œflagã€‚ è€Œåœ¨FavoriteTabPageç»„ä»¶å†…éƒ¨ï¼Œå¦‚æœæƒ³è°ƒç”¨flagè¿™ä¸ªpropsï¼Œå¯ä»¥ä½¿ç”¨this.props.flagæ¥è°ƒç”¨ã€‚ 2.state: ä¸‹é¢æ˜¯æœ€çƒ­å’Œè¶‹åŠ¿é¡µé¢çš„ç»„ä»¶ï¼š 12345678class FavoriteTabPage extends Component&#123;//ç»„ä»¶çš„æ„é€ æ–¹æ³•constructor(props)&#123; super(props); this.state=&#123; dataSource:new ListView.DataSource(&#123;rowHasChanged:(r1,r2)=&gt;r1!==r2&#125;),isLoading:false, &#125;&#125; è¿™é‡Œé¢å®šä¹‰äº†ä¸¤ä¸ªstate: dataSource:åˆ—è¡¨çš„æ•°æ®æº isLoading:æ˜¯å¦æ­£åœ¨åˆ·æ–° è¿™ä¸¤ä¸ªstateéƒ½æ˜¯å°†æ¥å¯èƒ½ç»å¸¸å˜åŒ–çš„ã€‚æ¯”å¦‚åœ¨ç½‘ç»œè¯·æ±‚ä»¥åï¼Œåˆ—è¡¨çš„æ•°æ®æºä¼šè¢«æ›¿æ¢æ‰ï¼Œè¿™ä¸ªæ—¶å€™å°±è¦è°ƒç”¨: 1234this.setState(&#123; //æŠŠæ–°çš„å€¼newDataArrå¯¹è±¡ä¼ ç»™dataSource dataSource:newDataArr&#125;) 3.DOMDOM æ˜¯å‰ç«¯çš„ä¸€ä¸ªæ¦‚å¿µï¼Œæš‚æ—¶å¯ä»¥ç²—ç•¥ç†è§£ä¸ºä¸€ä¸ªé¡µé¢çš„æ ‘å½¢ç»“æ„ã€‚React ç”Ÿå‘½å‘¨æœŸçš„ä¸‰å¤§é˜¶æ®µ Mountingï¼šå·²æ’å…¥çœŸå® DOM Updatingï¼šæ­£åœ¨è¢«é‡æ–°æ¸²æŸ“ Unmountingï¼šå·²ç§»å‡ºçœŸå® DOM åœ¨æ¯ä¸ªé˜¶æ®µéƒ½æœ‰ç›¸åº”çš„çŠ¶æ€å’Œä¸ä¹‹å¯¹åº”çš„å›è°ƒå‡½æ•°ï¼Œå…·ä½“å¯ä»¥çœ‹ä¸‹å›¾ï¼š ä¸Šå›¾æ¥è‡ªï¼šè´¾é¹è¾‰çš„æŠ€æœ¯åšå®¢ï¼šReact Nativeä¹‹Reacté€Ÿå­¦æ•™ç¨‹(ä¸­) é›†æˆä¸ç®¡ç†1.æŒ‡å®šç‰ˆæœ¬åˆå§‹åŒ–åœ¨ç»ˆç«¯è¾“å…¥react-native demo â€“version 0.40.0å‘½ä»¤ä»¥åï¼Œå°±ä¼šåˆå§‹åŒ–ä¸€ä¸ªReact Nativeç‰ˆæœ¬ä¸º0.40.0çš„é¡¹ç›®ã€‚è¿™ä¸ªæœ€åˆé¡¹ç›®é‡Œé¢ç›´æ¥å°±åŒ…å«äº†iOSå’ŒAndroidçš„å·¥ç¨‹æ–‡ä»¶å¤¹ï¼Œå¯ä»¥ç”¨å¯¹åº”çš„IDEæ‰“å¼€åç¼–è¯‘è¿è¡Œã€‚ åœ¨æ–°å»ºä¸€ä¸ªReact Nativeé¡¹ç›®ä¹‹åçš„æ ¹ç›®å½•ç»“æ„æ˜¯è¿™æ ·çš„ï¼š 2.ä½¿ç”¨ Cocoapods ç®¡ç† ReactNativePodfile æ–‡ä»¶æ ¼å¼ï¼š1234567891011pod &apos;React&apos;, :path =&gt; &apos;./node_modules/react-native&apos;, :subspecs =&gt; [ &apos;Core&apos;, &apos;RCTText&apos;, &apos;RCTImage&apos;, &apos;RCTActionSheet&apos;, &apos;RCTGeolocation&apos;, &apos;RCTNetwork&apos;, &apos;RCTSettings&apos;, &apos;RCTVibration&apos;, &apos;RCTWebSocket&apos;, ] ReactNative 0.42.0 ä»¥ä¸Šç‰ˆæœ¬éœ€åœ¨ Podfile é…ç½® yogaï¼š12# å¦‚æœä½ çš„RNç‰ˆæœ¬ &gt;= 0.42.0ï¼Œè¯·åŠ å…¥ä¸‹é¢è¿™è¡Œpod &quot;yoga&quot;, :path =&gt; &quot;./node_modules/react-native/ReactCommon/yoga&quot; è¾“å…¥react-native run-iosæˆ–è€…react-native run-androidæŒ‡ä»¤ï¼Œ å°±ä¼šè‡ªåŠ¨æ‰“å¼€æ¨¡æ‹Ÿå™¨è¿è¡Œé¡¹ç›®(å‰ææ˜¯å®‰è£…äº†ç›¸åº”çš„å¼€å‘ç¯å¢ƒ)ã€‚ ä½†æ˜¯ä¸€ä¸ªæ¯”è¾ƒå®Œæ•´çš„é¡¹ç›®ä»…ä»…æœ‰è¿™äº›ç±»åˆ«çš„æ–‡ä»¶æ˜¯ä¸å¤Ÿçš„ï¼Œè¿˜éœ€è¦ä¸€äº›å·¥å…·ç±»ï¼Œæ¨¡å‹ç±»ï¼Œèµ„æºç­‰æ–‡ä»¶ã€‚ä¸ºäº†å¾ˆå¥½åœ°åŒºåˆ†å®ƒä»¬ï¼Œä½¿é¡¹ç›®ç»“æ„ä¸€ç›®äº†ç„¶ï¼Œéœ€è¦ç»„ç»‡å¥½é¡¹ç›®æ–‡ä»¶å¤¹ä»¥åŠç±»çš„å‘½åï¼Œä¸‹é¢æ˜¯æˆ‘å°†æ•™ç¨‹é‡Œçš„æ–‡ä»¶å¤¹å‘½åå’Œç»“æ„ç¨åŠ ä¿®æ”¹åçš„ä¸€ä¸ªæ–¹æ¡ˆï¼Œå¯ä¾›å¤§å®¶å‚è€ƒï¼š å¸ƒå±€çº¦æŸé‡‡ç”¨Flexå¸ƒå±€çš„å…ƒç´ ï¼Œè¢«ç§°ä¸ºFlex containerï¼Œå…¶æ‰€æœ‰å­å…ƒç´ è¢«ç§°ä¸ºFlex itemï¼›å®¹å™¨é»˜è®¤å­˜åœ¨ä¸¤ä¸ªè½´ï¼Œåˆ†åˆ«æ˜¯ä¸»è½´ï¼ˆmain axisï¼‰å’Œå‚ç›´çš„äº¤å‰è½´ï¼ˆcross axisï¼‰,ä¸»è½´å¼€å§‹çš„ä½ç½®å«åšmain startï¼Œç»“æŸçš„ä½ç½®å«main endï¼›äº¤å‰è½´çš„å¼€å§‹ä½ç½®å«åšcross startï¼Œç»“æŸçš„ä½ç½®å«åšcross endï¼›å•ä¸ªitemå æ®çš„ä¸»è½´ç©ºé—´å«åšmain sizeï¼Œå æ®çš„äº¤å‰è½´æ§ä»¶å«åšcross sizeã€‚ å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š ç»„ä»¶åŒ–é©±åŠ¨ä¸‹ï¼Œæœç´¢ç»“æœé¡µä¸­å±•ç¤ºçš„ Cell ä¸ä¹‹å‰çš„åˆ—è¡¨é¡µ Cell å¯ä»¥é‡ç”¨ï¼š æˆ‘ä»¬æŠŠè¯¥ç»„ä»¶å®šåä¸ºï¼šRespositoryCellï¼Œç»“åˆä»£ç æ¥çœ‹ä¸€ä¸‹å…·ä½“çš„å®ç°ï¼š123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960export default class RepositoryCell extends Component &#123; constructor(props) &#123; super(props); this.state = &#123; isFavorite: this.props.projectModel.isFavorite, favoriteIcon: this.props.projectModel.isFavorite ? require('../../res/images/ic_star.png') : require('../../res/images/ic_unstar_transparent.png'), &#125;; &#125; componentWillReceiveProps(nextProps) &#123; this.setFavoriteState(nextProps.projectModel.isFavorite) &#125; setFavoriteState(isFavorite) &#123; this.props.projectModel.isFavorite = isFavorite; this.setState(&#123; isFavorite: isFavorite, favoriteIcon: isFavorite ? require('../../res/images/ic_star.png') : require('../../res/images/ic_unstar_transparent.png') &#125;) &#125; onPressFavorite() &#123; this.setFavoriteState(!this.state.isFavorite) this.props.onFavorite(this.props.projectModel.item, !this.state.isFavorite) &#125; render() &#123; let item = this.props.projectModel.item? this.props.projectModel.item:this.props.projectModel; let favoriteButton=this.props.projectModel.item? &lt;TouchableOpacity style=&#123;&#123;padding:6&#125;&#125; onPress=&#123;()=&gt;this.onPressFavorite()&#125; underlayColor='transparent'&gt; &lt;Image ref='favoriteIcon' style=&#123;[&#123;width: 22, height: 22,&#125;,this.props.theme.styles.tabBarSelectedIcon]&#125; source=&#123;this.state.favoriteIcon&#125;/&gt; &lt;/TouchableOpacity&gt;:null; return ( &lt;TouchableOpacity onPress=&#123;this.props.onSelect&#125; style=&#123;styles.container&#125; &gt; &lt;View style=&#123;styles.cell_container&#125;&gt; &lt;Text style=&#123;styles.title&#125;&gt;&#123;item.full_name&#125;&lt;/Text&gt; &lt;Text style=&#123;styles.description&#125;&gt;&#123;item.description&#125;&lt;/Text&gt; &lt;View style=&#123;styles.row&#125;&gt; &lt;View style=&#123;styles.row&#125;&gt; &lt;Text&gt;Author:&lt;/Text&gt; &lt;Image style=&#123;&#123;height: 22, width: 22&#125;&#125; source=&#123;&#123;uri: item.owner.avatar_url&#125;&#125; /&gt; &lt;/View&gt; &lt;View style=&#123;&#123;justifyContent: 'space-between', flexDirection: 'row'&#125;&#125;&gt; &lt;Text&gt;Star:&lt;/Text&gt; &lt;Text&gt;&#123;item.stargazers_count&#125;&lt;/Text&gt; &lt;/View&gt; &#123;favoriteButton&#125; &lt;/View&gt; &lt;/View&gt; &lt;/TouchableOpacity&gt; ) &#125;&#125; è¿™é‡Œå£°æ˜äº†RespositoryCellç»„ä»¶ï¼Œå®ƒç»§æ‰¿äºComponentï¼Œä¹Ÿå°±æ˜¯ç»„ä»¶ç±»ï¼Œå³æ˜¯è¯´ï¼Œå£°æ˜ç»„ä»¶çš„æ—¶å€™å¿…é¡»éƒ½è¦ç»§æ‰¿ä¸è¿™ä¸ªç±»ã€‚ é›†ä¸­çœ‹ä¸€ä¸‹è¯¥ç»„ä»¶çš„renderæ–¹æ³•ï¼Œå®ƒè¿”å›çš„æ˜¯è¯¥ç»„ä»¶çš„å®é™…å¸ƒå±€ï¼šåœ¨è¯­æ³•ä¸Šä½¿ç”¨JSXï¼Œç±»ä¼¼äºHTMLçš„æ ‡ç­¾å¼è¯­æ³•ï¼Œå¾ˆæ¸…æ¥šåœ°å°†cellçš„å±‚çº§å±•ç°äº†å‡ºæ¥ï¼š æœ€å¤–å±‚è¢«ä¸€ä¸ªViewç»„ä»¶åŒ…è£¹ç€ï¼Œé‡Œé¢ç¬¬ä¸€å±‚æœ‰ä¸‰ä¸ªå­ç»„ä»¶ï¼šä¸¤ä¸ªTextç»„ä»¶å’Œä¸€ä¸ªä½œä¸ºåº•éƒ¨èƒŒæ™¯çš„Viewç»„ä»¶ã€‚ åº•éƒ¨èƒŒæ™¯çš„Viewç»„ä»¶åˆæœ‰ä¸‰ä¸ªå­ç»„ä»¶ï¼šViewç»„ä»¶ï¼ˆæ˜¾ç¤ºä½œè€…ä¿¡æ¯ï¼‰ï¼ŒViewç»„ä»¶ï¼ˆæ˜¾ç¤ºstarä¿¡æ¯ï¼‰,æ”¶è—æŒ‰é’®ã€‚ ç»“æ„åˆ†è§£å›¾ï¼š ç»„ä»¶å°è£… æˆ‘çš„é¡µé¢ ä¸ªäººä¸­å¿ƒ å¯¹äºâ€œæˆ‘çš„é¡µé¢â€å’Œâ€œä¸ªäººä¸­å¿ƒâ€è¿™ç±»ç»“æ„ç›¸ä¼¼çš„é¡µé¢ï¼Œå»ºè®®è¿›è¡Œç»„ä»¶å°è£…ï¼Œå°è£…åçš„ AboutPage å®ç°ä»£ç ç®€æ´å¦‚ä¸‹ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768export default class AboutPage extends Component&#123; constructor(props) &#123; super(props); this.aboutCommon=new AboutCommon(props,(dic)=&gt;this.updateState(dic),FLAG_ABOUT.flag_about,config); this.state = &#123; projectModels: [], author:config.author &#125; &#125; componentDidMount() &#123; this.aboutCommon.componentDidMount(); &#125; componentWillUnmount() &#123; this.aboutCommon.componentWillUnmount(); &#125; updateState(dic)&#123; this.setState(dic); &#125; onClick(tab) &#123; let TargetComponent, params = &#123;...this.props,menuType:tab&#125;; switch (tab) &#123; case MORE_MENU.About_Author: TargetComponent = AboutMePage; break; case MORE_MENU.Website: TargetComponent = WebViewPage; params.title='GitHubPopular'; var url='https://reversescale.github.io'; params.url=url; break; case MORE_MENU.Feedback: var url='mailto://reversescale@icloud.com'; Linking.canOpenURL(url).then(supported =&gt; &#123; if (!supported) &#123; console.log('Can\\'t handle url: ' + url); &#125; else &#123; return Linking.openURL(url); &#125; &#125;).catch(err =&gt; console.error('An error occurred', err)); break; case MORE_MENU.Share: break; &#125; if (TargetComponent) &#123; this.props.navigator.push(&#123; component: TargetComponent, params: params, &#125;); &#125; &#125; render() &#123; let content=&lt;View&gt; &#123;this.aboutCommon.renderRepository(this.state.projectModels)&#125; &#123;ViewUtils.getSettingItem(()=&gt;this.onClick(MORE_MENU.Website), require('../../../res/images/ic_computer.png'), MORE_MENU.Website, this.props.theme.styles.tabBarSelectedIcon)&#125; &lt;View style=&#123;GlobalStyles.line&#125;/&gt; &#123;ViewUtils.getSettingItem(()=&gt;this.onClick(MORE_MENU.About_Author), require('../my/img/ic_insert_emoticon.png'), MORE_MENU.About_Author, this.props.theme.styles.tabBarSelectedIcon)&#125; &lt;View style=&#123;GlobalStyles.line&#125;/&gt; &#123;ViewUtils.getSettingItem(()=&gt;this.onClick(MORE_MENU.Feedback), require('../../../res/images/ic_feedback.png'), MORE_MENU.Feedback, this.props.theme.styles.tabBarSelectedIcon)&#125; &lt;/View&gt; return this.aboutCommon.render(content, &#123; 'name': 'GitHub Popular', 'description': 'è¿™æ˜¯ä¸€ä¸ªç”¨æ¥æŸ¥çœ‹GitHubæœ€å—æ¬¢è¿ä¸æœ€çƒ­é¡¹ç›®çš„App,å®ƒåŸºäºReact Nativeæ”¯æŒAndroidå’ŒiOSåŒå¹³å°ã€‚', \"avatar\": \"http://og1yl0w9z.bkt.clouddn.com/18-3-28/61685877.jpg\", \"backgroundImg\": \"http://og1yl0w9z.bkt.clouddn.com/18-3-28/37407402.jpg\", &#125;); &#125;&#125; æœ¬åœ°æŒä¹…åŒ– ä¸»é¢˜é€‰æ‹©ç•Œé¢ åˆ‡æ¢ä¸»é¢˜åç•Œé¢ åœ¨æ¶‰åŠå¦‚ä¸»é¢˜å˜æ›´ç­‰æ“ä½œæ—¶ï¼Œéœ€è¦å°†çŠ¶æ€ä¿¡æ¯ä¿å­˜ï¼Œè¿™æ—¶å°±éœ€è¦ç”¨åˆ°ç±»ä¼¼äºiOS ä¸­çš„NSUserDefaultï¼Œ AsyncStorage æ˜¯React Nativeä¸­çš„ Key-Value å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥åšæœ¬åœ°æŒä¹…åŒ–ã€‚ é¦–å…ˆçœ‹å®ƒä¸»è¦çš„å‡ ä¸ªæ¥å£ï¼š æ ¹æ®é”®æ¥è·å–å€¼ï¼Œè·å–çš„ç»“æœä¼šæ”¾åœ¨å›è°ƒå‡½æ•°ä¸­ï¼š1static getItem(key: string, callback:(error, result)) æ ¹æ®é”®æ¥è®¾ç½®å€¼ï¼š1static setItem(key: string, value: string, callback:(error)) æ ¹æ®é”®æ¥ç§»é™¤é¡¹ï¼š1static removeItem(key: string, callback:(error)) è·å–æ‰€æœ‰çš„é”®ï¼š1static getAllKeys(callback:(error, keys)) è®¾ç½®å¤šé¡¹ï¼Œå…¶ä¸­ keyValuePairs æ˜¯å­—ç¬¦ä¸²çš„äºŒç»´æ•°ç»„ï¼Œæ¯”å¦‚ï¼š[[â€˜k1â€™, â€˜val1â€™], [â€˜k2â€™, â€˜val2â€™]]ï¼š1static multiSet(keyValuePairs, callback:(errors)) è·å–å¤šé¡¹ï¼Œå…¶ä¸­ keys æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯”å¦‚ï¼š[â€˜k1â€™, â€˜k2â€™]ï¼š1static multiGet(keys, callback:(errors, result)) åˆ é™¤å¤šé¡¹ï¼Œå…¶ä¸­ keys æ˜¯å­—ç¬¦ä¸²æ•°ç»„ï¼Œæ¯”å¦‚ï¼š[â€˜k1â€™, â€˜k2â€™]ï¼š1static multiRemove(keys, callback:(errors)) æ¸…é™¤æ‰€æœ‰çš„é¡¹ç›®ï¼š1static clear(callback:(error)) ç½‘ç»œè¯·æ±‚å°è£…åœ¨React Nativeä¸­ï¼Œç»å¸¸ä½¿ç”¨Fetchå‡½æ•°æ¥å®ç°ç½‘ç»œè¯·æ±‚ï¼Œå®ƒæ”¯æŒGETå’ŒPOSTè¯·æ±‚å¹¶è¿”å›ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œè¿™ä¸ªå¯¹è±¡åŒ…å«ä¸€ä¸ªæ­£ç¡®çš„ç»“æœå’Œä¸€ä¸ªé”™è¯¯çš„ç»“æœã€‚ æ¥çœ‹ä¸€ä¸‹ç”¨Fetchå‘èµ·çš„POSTè¯·æ±‚å°è£…ï¼š 12345678910111213141516171819static post(url,data)&#123; return new Promise((resolve,reject)=&gt;&#123; fetch(url,&#123; method:'POST', header:&#123; 'Accept':'application/json', 'Content-Type':'application/json' &#125;, body:JSON.stringify(data) &#125;) .then(response=&gt;response.json()) .then(result=&gt;&#123; resolve(result); &#125;) .catch(error=&gt;&#123; reject(error); &#125;) &#125;) &#125; ä»ä¸Šé¢çš„ä»£ç ä¸­ï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´çœ‹åˆ°ï¼šFetchå‡½æ•°ä¸­ï¼Œç¬¬ä¸€ä¸ªå‚æ•°æ˜¯è¯·æ±‚urlï¼Œç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªå­—å…¸ï¼ŒåŒ…æ‹¬æ–¹æ³•ï¼Œè¯·æ±‚å¤´ï¼Œè¯·æ±‚ä½“ç­‰ä¿¡æ¯ã€‚ éšåçš„thenå’Œcatchåˆ†åˆ«æ•æ‰äº†fetchå‡½æ•°çš„è¿”å›å€¼ï¼šä¸€ä¸ªPromiseå¯¹è±¡çš„æ­£ç¡®ç»“æœå’Œé”™è¯¯ç»“æœã€‚æ³¨æ„ï¼Œè¿™é‡Œé¢æœ‰ä¸¤ä¸ªthenï¼Œå…¶ä¸­ç¬¬äºŒä¸ªthenæŠŠç¬¬ä¸€ä¸ªthençš„ç»“æœæ‹¿äº†è¿‡æ¥ã€‚è€Œç¬¬ä¸€ä¸ªthenåšçš„äº‹æƒ…æ˜¯æŠŠç½‘ç»œè¯·æ±‚çš„ç»“æœè½¬åŒ–ä¸ºJSONå¯¹è±¡ã€‚ é‚£ä¹ˆä»€ä¹ˆæ˜¯Promiseå¯¹è±¡å‘¢ï¼Ÿ Promise æ˜¯å¼‚æ­¥ç¼–ç¨‹çš„ä¸€ç§è§£å†³æ–¹æ¡ˆï¼ŒPromiseå¯¹è±¡å¯ä»¥è·å–æŸä¸ªå¼‚æ­¥æ“ä½œçš„æ¶ˆæ¯ã€‚å®ƒé‡Œé¢ä¿å­˜ç€æŸä¸ªæœªæ¥æ‰ä¼šç»“æŸçš„äº‹ä»¶ï¼ˆé€šå¸¸æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œï¼‰çš„ç»“æœã€‚ å®ƒåˆ†ä¸ºä¸‰ç§çŠ¶æ€ï¼š Pendingï¼ˆè¿›è¡Œä¸­ï¼‰ã€Resolvedï¼ˆå·²æˆåŠŸï¼‰å’ŒRejectedï¼ˆå·²å¤±è´¥ï¼‰ å®ƒçš„æ„é€ å‡½æ•°æ¥å—ä¸€ä¸ªå‡½æ•°ä½œä¸ºå‚æ•°ï¼Œè¯¥å‡½æ•°çš„ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯resolveå’Œrejectï¼š resolveå‡½æ•°çš„ä½œç”¨ï¼šå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜æˆâ€œæˆåŠŸâ€(å³ä»Pendingå˜ä¸ºResolved)ï¼Œåœ¨å¼‚æ­¥æ“ä½œæˆåŠŸæ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œçš„ç»“æœï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ï¼› rejectå‡½æ•°çš„ä½œç”¨ï¼šå°†Promiseå¯¹è±¡çš„çŠ¶æ€ä»â€œæœªå®Œæˆâ€å˜æˆâ€œæˆåŠŸâ€(å³ä»Pendingå˜ä¸ºRejected)ï¼Œåœ¨å¼‚æ­¥æ“ä½œå¤±è´¥æ—¶è°ƒç”¨ï¼Œå¹¶å°†å¼‚æ­¥æ“ä½œæŠ¥å‡ºçš„é”™è¯¯ï¼Œä½œä¸ºå‚æ•°ä¼ é€’å‡ºå»ã€‚ GET è¯·æ±‚å°è£…ï¼š123456789101112static get(url)&#123; return new Promise((resolve,reject)=&gt;&#123; fetch(url) .then(response=&gt;response.json()) .then(result=&gt;&#123; resolve(result); &#125;) .catch(error=&gt;&#123; reject(error); &#125;) &#125;) &#125; å› ä¸ºåªæ˜¯GETè¯·æ±‚ï¼Œæ‰€ä»¥ä¸éœ€è¦é…ç½®è¯·æ±‚ä½“ï¼Œè€Œä¸”å› ä¸ºè¿™ä¸ªfetchå‡½æ•°è¿”å›å€¼æ˜¯ä¸€ä¸ªPromiseå¯¹è±¡ï¼Œ æ‰€ä»¥æˆ‘ä»¬å¯ä»¥ç”¨.thenå’Œ.catchæ¥æ•æ‰æ­£ç¡®å’Œé”™è¯¯çš„ç»“æœã€‚ åŠŸèƒ½è°ƒè¯•æˆ‘ä»¬å¯ä»¥ä½¿ç”¨æµè§ˆå™¨çš„å¼€å‘è€…å·¥å…·æ¥è°ƒè¯•React Nativeé¡¹ç›®ï¼Œå¯ä»¥é€šè¿‡æ‰“æ–­ç‚¹çš„æ–¹å¼æ¥çœ‹æ•°æ®ä¿¡æ¯ä»¥åŠæ–¹æ³•çš„è°ƒç”¨ï¼š é¦–å…ˆåœ¨iOSæ¨¡æ‹Ÿå™¨ä¸­ç‚¹å‡»command + Dï¼Œç„¶åå†å¼¹å‡ºèœå•é‡Œç‚¹å‡»Debug JS Remotelyã€‚éšåå°±æ‰“å¼€äº†æµè§ˆå™¨è¿›å…¥äº†è°ƒè¯•ã€‚ æµè§ˆå™¨ä¸€èˆ¬ä¼šå±•ç¤ºä¸‹é¢çš„é¡µé¢ï¼Œç„¶åç‚¹å‡»command + option + Jè¿›å…¥çœŸç”Ÿçš„è°ƒè¯•ç•Œé¢ã€‚ åŒå¹³å°é€‚é…å› ä¸ºReact Nativeè®²æ±‚çš„æ˜¯ä¸€ä»½ä»£ç è·‘åœ¨ä¸¤ä¸ªå¹³å°ä¸Šï¼Œè€Œå®¢è§‚ä¸Šè¿™ä¸¤ä¸ªå¹³å°åˆæœ‰ä¸€äº›ä¸ä¸€æ ·çš„åœ°æ–¹ï¼Œæ‰€ä»¥å°±éœ€è¦åœ¨åˆ«è¦çš„æ—¶å€™åšä¸€ä¸‹ä¸¤ä¸ªå¹³å°çš„é€‚é…ã€‚ ä¾‹å¦‚å¯¼èˆªæ ï¼šåœ¨iOSè®¾å¤‡ä¸­æ˜¯å­˜åœ¨å¯¼èˆªæ çš„ï¼Œè€Œå®‰å“è®¾å¤‡ä¸Šæ˜¯æ²¡æœ‰çš„ã€‚æ‰€ä»¥åœ¨å®šåˆ¶å¯¼èˆªæ çš„æ—¶å€™ï¼Œåœ¨ä¸åŒå¹³å°ä¸‹ç»™å¯¼èˆªæ è®¾ç½®ä¸åŒçš„é«˜åº¦ï¼š 12345678910const NAV_BAR_HEIGHT_IOS = 54;const NAV_BAR_HEIGHT_ANDROID = 50;// css navBar: &#123; flexDirection: 'row', alignItems: 'center', justifyContent: 'space-between', height: Platform.OS === 'ios' ? NAV_BAR_HEIGHT_IOS : NAV_BAR_HEIGHT_ANDROID, &#125;, ä¸Šé¢çš„Platformæ˜¯React Nativeå†…ç½®çš„ç”¨äºåŒºåˆ†å¹³å°çš„åº“ï¼Œå¯ä»¥åœ¨å¼•å…¥åç›´æ¥ä½¿ç”¨ã€‚ å»ºè®®åœ¨è°ƒè¯•ç¨‹åºçš„æ—¶å€™ï¼ŒåŒæ—¶æ‰“å¼€iOSå’ŒAndroidçš„æ¨¡æ‹Ÿå™¨è¿›è¡Œè°ƒè¯•ï¼Œå› ä¸ºæœ‰äº›åœ°æ–¹å¯èƒ½åœ¨æŸä¸ªå¹³å°ä¸Šæ˜¯æ²¡é—®é¢˜çš„ï¼Œä½†æ˜¯å¦ä¸€ä¸ªå¹³å°ä¸Šæœ‰é—®é¢˜ï¼Œè¿™å°±éœ€è¦ä½¿ç”¨Platformæ¥åŒºåˆ†å¹³å°ã€‚ å¼€æºç»„ä»¶åº“çš„ä½¿ç”¨ReactNative çš„ç»„ä»¶ä¸åŸç”Ÿçš„ç»„ä»¶æœ‰è®¸å¤šå…±åŒä¹‹å¤„ï¼Œå¦‚ä¸‹æ‹‰åˆ·æ–°ï¼ŒåŒæ ·çš„ Github ä¸­å¼€æºç»„ä»¶å·²ç»ç›¸å½“å®Œå–„ã€‚ å¼€æºç»„ä»¶åº“æ–¹æ³•å¦‚ä¸‹ï¼Œå®‰è£…æœ€æ–°ç‰ˆæœ¬ï¼š1npm install react-native-tab-navigator --save å®‰è£…æŒ‡å®šç‰ˆæœ¬ï¼š1npm install --save react-native-tab-navigator@0.4.0 react-native é›†æˆç»„ä»¶ç»‘å®š(ReactNative 0.27ä»¥åï¼Œè‡ªé›†æˆRNPM)ï¼š1react-native link react-native-splash-screen å¸¸ç”¨å¼€æºåº“ï¼š12345678npm install --save react-native-tab-navigator@0.4.0npm install --save react-native-scrollable-tab-view@0.7.0npm install --save react-native-check-box@1.0.4npm install --react-native-easy-toast@1.0.9npm install --save GitHubTrending@2.0.0npm install --save react-native-htmlview@0.5.0npm install --save react-native-popover@0.5.0npm install --react-native-splash-screen@2.0.0 ä¸‹å›¾ä¸ºä½¿ç”¨ react-native-splash-screen åçš„æ•ˆæœæ¼”ç¤ºï¼š çƒ­æ›´æ–°CodePush æ˜¯å¾®è½¯æä¾›çš„ä¸€å¥—ç”¨äºçƒ­æ›´æ–° React Native å’Œ Cordova åº”ç”¨çš„æœåŠ¡ã€‚ CodePush æ˜¯æä¾›ç»™ React Native å’Œ Cordova å¼€å‘è€…ç›´æ¥éƒ¨ç½²ç§»åŠ¨åº”ç”¨æ›´æ–°ç»™ç”¨æˆ·è®¾å¤‡çš„äº‘æœåŠ¡ã€‚CodePush ä½œä¸ºä¸€ä¸ªä¸­å¤®ä»“åº“ï¼Œå¼€å‘è€…å¯ä»¥æ¨é€æ›´æ–° (JS, HTML, CSS and images)ï¼Œåº”ç”¨å¯ä»¥ä»å®¢æˆ·ç«¯ SDK é‡Œé¢æŸ¥è¯¢æ›´æ–°ã€‚ Code-Push æ¨åŒ…å‘½ä»¤ï¼š1code-push release-react &lt;appName&gt; &lt;platform&gt; [options] ç¤ºä¾‹ï¼š1code-push release-react RNAPPGithub ios --t 1.0.0 --dev false --d Staging --des &quot;1.çƒ­æ›´æ–°æˆ‘çš„é¡µé¢èƒŒæ™¯è‰²&quot; --m true 1code-push release-react RNAPPGithub ios --t 1.0.1 --dev false --d Staging --des &quot;1.çƒ­æ›´æ–°ç›¸å…³è®¾ç½®&quot; --m true Code-Push çº¿ä¸ŠæŸ¥çœ‹æ›´æ–°ï¼š1code-push deployment ls RNAPPGithub Code-Push æŸ¥çœ‹é¡¹ç›®Keyï¼š1code-push deployment ls RNAPPGithub -k Code-Push iOSæ›´æ–°æ‰“åŒ…æ–¹æ³•ï¼š1react-native bundle --platform ios --entry-file index.ios.js --bundle-output release_ios/main.jsbundle --assets-dest release_ios/ --dev fasle æ€»ç»“ä¹‹å‰ä¹Ÿæœ‰é›¶é›¶æ•£æ•£çš„è°ƒç ”è¿™é—¨æŠ€æœ¯ï¼Œä½†æ˜¯ç»è¿‡ç³»ç»Ÿçš„ 15 ä¸ªä¸‹åˆçš„åšæŒå­¦ä¹ ï¼Œæ·±æ„Ÿè·¨å¹³å°æŠ€æœ¯çš„ç‹¬åˆ°ä¹‹å¤„ï¼Œç‰¹åˆ«æ˜¯åœ¨ä¸åŸç”Ÿäº¤äº’çš„ç¼–å†™ä¸Šç®€ç›´è®©äººæ¬²ç”Ÿæ¬²æ­»ï¼Œè¿˜å¥½åœ¨ Github ä¸Šå·²ç»æœ‰å„è·¯å¤§ç¥å¼€æºçš„å„ç§æ–¹ä¾¿å¼€å‘çš„ç»„ä»¶åº“å¯ä»¥ä¾›æˆ‘ä»¬ä½¿ç”¨ã€‚ åˆ†äº«é“¾æ¥ã€ŠReact Native å¼€å‘å¸¸ç”¨å‘½ä»¤è¡Œï¼ˆæŒç»­æ›´æ–°ï¼‰ã€‹(https://juejin.im/post/5abc54c86fb9a028da7c998c) ã€ŠReactNative å¼€å‘å¸¸ç”¨çš„ä¸‰æ–¹æ¨¡å—ã€‹(https://www.jianshu.com/p/53ff78168acc) ã€Šä½¿ç”¨VS Codeè°ƒè¯•React-Nativeç¨‹åºã€‹ï¼ˆhttps://jingyan.baidu.com/article/ad310e80fb13fc1849f49ed1.htmlï¼‰ å‚è€ƒèµ„æ–™ React Nativeä¸­æ–‡ç½‘ è´¾é¹è¾‰çš„æŠ€æœ¯åšå®¢ ä»ä¸€ä¸ªå®æˆ˜é¡¹ç›®æ¥çœ‹ä¸€ä¸‹React Nativeå¼€å‘çš„å‡ ä¸ªå…³é”®æŠ€æœ¯ç‚¹ Marno:ç»™æ‰€æœ‰å¼€å‘è€…çš„React Nativeè¯¦ç»†å…¥é—¨æŒ‡å— å¤§æ¼ :ä¸€ä¸ªå®Œæ•´çš„FlexboxæŒ‡å— é˜®ä¸€å³°:Flex å¸ƒå±€æ•™ç¨‹ï¼šè¯­æ³•ç¯‡ å…«æ®µä»£ç å½»åº•æŒæ¡ Promise é˜®ä¸€å³°ï¼šPromiseå¯¹è±¡ asce1885:React Native é«˜è´¨é‡å­¦ä¹ èµ„æ–™æ±‡æ€» ä¸–é”‹æ—¥ä¸Š:ReactNative å­¦ä¹ èµ„æºå¤§æ±‡é›†","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"ReactNative","slug":"ReactNative","permalink":"https://reversescale.github.io/tags/ReactNative/"}]},{"title":"åŸºäº Aspects æ·±å…¥äº†è§£ AOP","slug":"Library Aspects","date":"2018-03-23T13:56:27.000Z","updated":"2018-11-16T13:22:46.436Z","comments":true,"path":"2018/03/23/Library Aspects/","link":"","permalink":"https://reversescale.github.io/2018/03/23/Library Aspects/","excerpt":"AOP(Aspect-Oriented-Programming)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œå¦‚ç»Ÿè®¡åŸ‹ç‚¹ã€æ–¹æ³•æ›¿æ¢ç­‰~","text":"AOP(Aspect-Oriented-Programming)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œå¦‚ç»Ÿè®¡åŸ‹ç‚¹ã€æ–¹æ³•æ›¿æ¢ç­‰~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ 1.å±•ç¤ºé¡µ 2.å±•ç¤ºé¡µ 3.å±•ç¤ºé¡µ å±•ç¤ºåˆ—è¡¨ æ‹¦æˆªç³»ç»Ÿäº‹ä»¶ è‡ªå®šä¹‰æ‹¦æˆª ğŸ¯ å®‰è£…æ–¹æ³•å®‰è£…åœ¨ iOS, ä½ éœ€è¦åœ¨ Podfile ä¸­æ·»åŠ .12345source &apos;https://github.com/CocoaPods/Specs.git&apos;platform :ios, &apos;9.0&apos;use_frameworks!pod &quot;Aspects&quot; ğŸ›  é…ç½®ç³»ç»Ÿçº§æ‹¦æˆªæ‹¦æˆªç³»ç»Ÿçº§çº§äº‹ä»¶ï¼Œå¦‚ viewWillAppear ç­‰ 1234567891011121314#import &lt;Aspects.h&gt;- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view, typically from a nib. [UIViewController aspect_hookSelector:@selector(viewWillAppear:) withOptions:AspectPositionAfter usingBlock:^(id&lt;AspectInfo&gt; aspectInfo, BOOL animated) &#123; NSLog(@&quot;View Controller %@ will appear animated: %tu&quot;, aspectInfo.instance, animated); &#125; error:NULL];&#125;- (void)viewWillAppear:(BOOL)animated &#123; [super viewWillAppear:animated]; NSLog(@&quot;System View Controller will appear&quot;);&#125; è‡ªå®šä¹‰æ‹¦æˆªæ‹¦æˆªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¦‚å¯¹ç±»çš„æ“ä½œ 12345678910111213141516171819202122232425262728// Cat.h ç±»@interface Cat: NSObject+ (void)classFee;@end// Cat.m ç±»@implementation Cat+ (void)classFee &#123; NSLog(@&quot;Miao~&quot;);&#125;@end// å®ç°æ–¹æ³•#import &quot;Cat.h&quot;#import &lt;Aspects.h&gt;- (void)viewDidLoad &#123; [super viewDidLoad]; // Do any additional setup after loading the view. Class catMetal = objc_getMetaClass(NSStringFromClass(Cat.class).UTF8String); [catMetal aspect_hookSelector:@selector(classFee) withOptions:AspectPositionAfter usingBlock:^(id&lt;AspectInfo&gt; aspectInfo) &#123; NSLog(@&quot;Miao~,I am angry~&quot;); &#125; error:NULL]; [Cat classFee];&#125; ğŸ“ æ·±å…¥å­¦ä¹ ç´¢å¼•ï¼š AOP ç®€ä»‹ Aspects ç®€ä»‹ Aspects ç»“æ„å‰–æ Aspects æ ¸å¿ƒä»£ç å‰–æ ä¼˜ç§€ AOP åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨ æ€»ç»“ AOP ç®€ä»‹åœ¨ Objective-C çš„å®ç°ç»“æ„ä¸­ Runtime çš„åŠ¨æ€æ´¾å‘æœºåˆ¶ä¿è¯äº†è¿™ä¹ˆè¯­è¨€çš„çµæ´»æ€§ï¼Œè€Œåœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ä¸Šçš„ç¼–ç¨‹æ€æƒ³å°±æ˜¯AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹)ã€‚ AOP æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼æˆ–è€…ç¼–ç¨‹æ€æƒ³ï¼Œå®ƒè§£å†³äº† OOP (Object-oriented programming) çš„å»¶ä¼¸é—®é¢˜ ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ AOPå‡è®¾éšç€æˆ‘ä»¬æ‰€åœ¨çš„å…¬å¸é€æ­¥å‘å±•ï¼Œä¹‹å‰ç¬¬ä¸‰æ–¹çš„ç”¨æˆ·é¡µé¢ç»Ÿè®¡å·²ç»ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ï¼Œå…¬å¸è¦æ±‚å®ç°ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·é¡µé¢ç»Ÿè®¡ã€‚ åœ¨ä¼ ç»Ÿçš„ OOP æ€æƒ³ä¸‹ï¼Œå¯èƒ½ä¼šå¦‚ä¸‹æ“ä½œï¼š ä¸€ä¸ªç†Ÿæ‚‰ OOP æ€æƒ³çš„ç¨‹åºçŒ¿ä¼šç†æ‰€åº”å½“çš„æƒ³åˆ°è¦æŠŠç”¨æˆ·é¡µé¢ç»Ÿè®¡è¿™ä¸€ä»»åŠ¡æ”¾åˆ° ViewController ä¸­ï¼› è€ƒè™‘åˆ°ä¸€ä¸ªä¸ªçš„æ‰‹åŠ¨æ·»åŠ ç»Ÿè®¡ä»£ç è¦æ­»äººï¼ˆè€Œä¸”è¿˜ä¼šæ¼ï¼Œä»¥åæ–°å¢ ViewController ä¹Ÿè¦æ‰‹åŠ¨åŠ ï¼‰ï¼Œäºæ˜¯æƒ³åˆ°äº† OOP æ€æƒ³ä¸­çš„ç»§æ‰¿ï¼› ä¸å·§ç”±äºé¡¹ç›®ä¹…è¿œï¼Œæ‰€æœ‰çš„ ViewController éƒ½æ˜¯ç›´æ¥ç»§æ‰¿è‡ªç³»ç»Ÿç±» UIViewControllerï¼ˆç¬‘ï¼‰ï¼Œæ­¤æ—¶é€‰æ‹©æŠ½ä¸€ä¸ªé¡¹ç›® RootViewControllerï¼Œæ›¿æ¢æ‰€æœ‰ ViewController ç»§æ‰¿ RootViewControllerï¼› ç„¶ååœ¨ RootViewController çš„ viewWillAppear: å’Œ viewWillDisappear: æ–¹æ³•åŠ å…¥æ—¶é—´ç»Ÿè®¡ä»£ç ï¼Œè®°å½• ViewController ä»¥åŠ Router ä¼ å‚ã€‚ å…¶å® OOP ä¹Ÿæœ‰å…¶ç‰¹æ®Šçš„å®šä½ï¼Œä¹Ÿèƒ½å¤Ÿå®ç°ä¸Šè¿°çš„éœ€æ±‚ã€‚ è€Œ AOP åˆ™æ›´é€‚åˆåœ¨ç»™å¤šä¸ª App å†™é€šç”¨ç»„ä»¶å¹¶ä»¥é€šç”¨çš„å½¢å¼å®ç°ç»Ÿè®¡çš„æƒ…å†µä¸‹ã€‚ ä¸€ä¸ªç®€å•çš„æ€è·¯ï¼šHook æ–¹æ³•äº¤æ¢çš„æ–¹æ³•ï¼Œåœ¨åŸæ–¹æ³•æ‰§è¡Œä¹‹åè®°å½•éœ€è¦ç»Ÿè®¡çš„ä¿¡æ¯å¹¶ä¸ŠæŠ¥ã€‚ å•é€šè¿‡ Method Swizzling æ¥ Hook çš„æ–¹æ³•åœ¨å¤„ç†ä¸å½“çš„æƒ…å†µä¸‹å®¹æ˜“å‡ºç°å®‰å…¨éšæ‚£ Aspects ç®€ä»‹ Aspects æ˜¯ä¸€ä¸ªä½¿ç”¨èµ·æ¥ç®€å•æ„‰å¿«çš„ AOP åº“ï¼Œä½¿ç”¨ Objective-C ç¼–å†™ï¼Œé€‚ç”¨äº iOS ä¸ Mac OS Xã€‚ Aspects ç®€å•æ˜“ç”¨ï¼Œä½œè€…é€šè¿‡åœ¨ NSObject (Aspects) åˆ†ç±»ä¸­æš´éœ²å‡ºçš„ä¸¤ä¸ªæ¥å£åˆ†åˆ«æä¾›äº†å¯¹å®ä¾‹å’Œ Class çš„ Hook å®ç°ï¼š 12345678910@interface NSObject (Aspects)+ (id)aspect_hookSelector:(SEL)selector withOptions:(AspectOptions)options usingBlock:(id)block error:(NSError **)error;- (id)aspect_hookSelector:(SEL)selector withOptions:(AspectOptions)options usingBlock:(id)block error:(NSError **)error;@end Aspects æ”¯æŒå®ä¾‹ Hookï¼Œç›¸è¾ƒå…¶ä»– Objective-C AOP åº“è€Œè¨€å¯æ“ä½œç²’åº¦æ›´å°ï¼Œé€‚åˆçš„åœºæ™¯æ›´åŠ å¤šæ ·åŒ–ã€‚ä½œä¸ºä½¿ç”¨è€…æ— éœ€è¿›è¡Œæ›´å¤šçš„æ“ä½œå³å¯ Hook æŒ‡å®šå®ä¾‹æˆ–è€… Class çš„æŒ‡å®š SELï¼ŒAspectOptions å‚æ•°å¯ä»¥æŒ‡å®š Hook çš„ç‚¹ï¼Œä»¥åŠæ˜¯å¦æ‰§è¡Œä¸€æ¬¡ä¹‹åå°±æ’¤é”€ Hookã€‚ Aspects ç»“æ„å‰–æ å°½ç®¡ Aspects åªæœ‰ä¸åˆ°åƒè¡Œçš„æºç ï¼Œä½†æ˜¯å…¶å†…éƒ¨å®ç°è€ƒè™‘åˆ°äº†å¾ˆå¤š Hook ç›¸å…³çš„å®‰å…¨é—®é¢˜å’Œå…¶ä»–ç»†èŠ‚ï¼Œå¯¹æ¯”å…¶ä»– Objective-C AOP å¼€æºé¡¹ç›®æ¥è¯´ Aspects æ›´ä¸ºå¥å…¨ã€‚ Aspects å†…éƒ¨ç»“æ„Aspects å†…éƒ¨å®šä¹‰äº†ä¸¤ä¸ªåè®®ï¼š AspectToken - ç”¨äºæ³¨é”€ Hook AspectInfo - åµŒå…¥ Hook ä¸­çš„ Block é¦–ä½å‚æ•° æ­¤å¤– Aspects å†…éƒ¨è¿˜å®šä¹‰äº† 4 ä¸ªç±»ï¼š AspectInfo - åˆ‡é¢ä¿¡æ¯ï¼Œéµå¾ª AspectInfo åè®® AspectIdentifier - åˆ‡é¢ IDï¼Œåº”è¯¥éµå¾ª AspectToken åè®®ï¼ˆä½œè€…æ¼æ‰äº†ï¼Œå·²æ PRï¼‰ AspectsContainer - åˆ‡é¢å®¹å™¨ AspectTracker - åˆ‡é¢è·Ÿè¸ªå™¨ ä»¥åŠä¸€ä¸ªç»“æ„ä½“ï¼š AspectBlockRef - å³ _AspectBlockï¼Œå……å½“å†…éƒ¨ Blockå¦‚æœä½ æ‰’ä¸€éæºç ï¼Œè¿˜ä¼šå‘ç°ä¸¤ä¸ªå†…éƒ¨é™æ€å…¨å±€å˜é‡ï¼š static NSMutableDictionary *swizzledClassesDict; static NSMutableSet *swizzledClasses; Aspects åè®®AspectToken AspectToken åè®®æ—¨åœ¨è®©ä½¿ç”¨è€…å¯ä»¥çµæ´»çš„æ³¨é”€ä¹‹å‰æ·»åŠ è¿‡çš„ Hookï¼Œå†…éƒ¨è§„å®šéµå®ˆæ­¤åè®®çš„å¯¹è±¡é¡»å®ç° remove æ–¹æ³•ã€‚ 12345/// ä¸é€æ˜çš„ Aspect Tokenï¼Œç”¨äºæ³¨é”€ Hook@protocol AspectToken /// æ³¨é”€ä¸€ä¸ª aspect./// è¿”å› YES è¡¨ç¤ºæ³¨é”€æˆåŠŸï¼Œå¦åˆ™è¿”å› NO- (BOOL)remove;@end AspectInfo AspectInfo åè®®æ—¨åœ¨è§„èŒƒå¯¹ä¸€ä¸ªåˆ‡é¢ï¼Œå³ aspect çš„ Hook å†…éƒ¨ä¿¡æ¯çš„çº°æ¼ï¼Œæˆ‘ä»¬åœ¨ Hook æ—¶æ·»åŠ åˆ‡é¢çš„ Block ç¬¬ä¸€ä¸ªå‚æ•°å°±éµå®ˆæ­¤åè®®ã€‚ 12345678/// AspectInfo åè®®æ˜¯æˆ‘ä»¬å—è¯­æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚@protocol AspectInfo /// å½“å‰è¢« Hook çš„å®ä¾‹- (id)instance;/// è¢« Hook æ–¹æ³•çš„åŸå§‹ invocation- (NSInvocation *)originalInvocation;/// æ‰€æœ‰æ–¹æ³•å‚æ•°ï¼ˆè£…ç®±ä¹‹åçš„ï¼‰æƒ°æ€§æ‰§è¡Œ- (NSArray *)arguments;@end è£…ç®±æ˜¯ä¸€ä¸ªå¼€é”€æ˜‚è´µæ“ä½œï¼Œæ‰€ä»¥ç”¨åˆ°å†å»æ‰§è¡Œ Aspects å†…éƒ¨ç±»æ¥ç€åè®®ï¼Œæˆ‘ä»¬ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ Aspects çš„å†…éƒ¨ç±»ã€‚ AspectInfo AspectInfo åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ª Classï¼Œå…¶éµå®ˆä¸Šæ–‡ä¸­è®²åˆ°çš„ AspectInfo åè®®ï¼Œä¸è¦æ··æ·†ã€‚ 123456@interface AspectInfo : NSObject - (id)initWithInstance:(__unsafe_unretained id)instance invocation:(NSInvocation *)invocation;@property (nonatomic, unsafe_unretained, readonly) id instance;@property (nonatomic, strong, readonly) NSArray *arguments;@property (nonatomic, strong, readonly) NSInvocation *originalInvocation;@end AspectInfo æ¯”è¾ƒç®€å•ï¼Œå‚è€ƒ ReactiveCocoa å›¢é˜Ÿæä¾›çš„ NSInvocation å‚æ•°é€šç”¨æ–¹æ³•å¯å°†å‚æ•°è£…ç®±ä¸º NSValueï¼Œç®€å•æ¥è¯´ AspectInfo æ‰®æ¼”äº†ä¸€ä¸ªæä¾› Hook ä¿¡æ¯çš„è§’è‰²ã€‚ AspectIdentifier AspectIdentifier ç±»å®šä¹‰ï¼š 123456789@interface AspectIdentifier : NSObject+ (instancetype)identifierWithSelector:(SEL)selector object:(id)object options:(AspectOptions)options block:(id)block error:(NSError **)error;- (BOOL)invokeWithInfo:(id)info;@property (nonatomic, assign) SEL selector;@property (nonatomic, strong) id block;@property (nonatomic, strong) NSMethodSignature *blockSignature;@property (nonatomic, weak) id object;@property (nonatomic, assign) AspectOptions options;@end AspectIdentifier å®é™…ä¸Šæ˜¯æ·»åŠ åˆ‡é¢çš„ Block çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶åº”è¯¥éµå¾ª AspectToken åè®®ï¼Œäº‹å®ä¸Šä¹Ÿçš„ç¡®å¦‚æ­¤ï¼Œå…¶æä¾›äº† remove æ–¹æ³•çš„å®ç°ã€‚ AspectIdentifier å†…éƒ¨éœ€è¦æ³¨æ„çš„æ˜¯ç”±äºä½¿ç”¨ Block æ¥å†™ Hook ä¸­æˆ‘ä»¬åŠ çš„æ–™ï¼Œè¿™é‡Œç”Ÿæˆäº† blockSignatureï¼Œåœ¨ AspectIdentifier åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä¼šå»åˆ¤æ–­ blockSignature ä¸å…¥å‚ object çš„ selector å¾—åˆ°çš„ methodSignature çš„å…¼å®¹æ€§ï¼Œå…¼å®¹æ€§åˆ¤æ–­æˆåŠŸæ‰ä¼šé¡ºåˆ©åˆå§‹åŒ–ã€‚ AspectsContainer AspectsContainer ä½œä¸ºåˆ‡é¢çš„å®¹å™¨ç±»ï¼Œå…³è”æŒ‡å®šå¯¹è±¡çš„æŒ‡å®šæ–¹æ³•ï¼Œå†…éƒ¨æœ‰ä¸‰ä¸ªåˆ‡é¢é˜Ÿåˆ—ï¼Œåˆ†åˆ«å®¹çº³å…³è”æŒ‡å®šå¯¹è±¡çš„æŒ‡å®šæ–¹æ³•ä¸­ç›¸å¯¹åº” AspectOption çš„ Hookï¼š NSArray *beforeAspects; - AspectPositionBefore NSArray *insteadAspects; - AspectPositionInstead NSArray *afterAspects; - AspectPositionAfter AspectsContainer åœ¨ NSObject åˆ†ç±»ä¸­é€šè¿‡ AssociatedObject æ–¹æ³•ä¸å½“å‰è¦ Hook çš„ç›®æ ‡å…³è”åœ¨ä¸€èµ·çš„ã€‚ 12345678@interface AspectsContainer : NSObject- (void)addAspect:(AspectIdentifier *)aspect withOptions:(AspectOptions)injectPosition;- (BOOL)removeAspect:(id)aspect;- (BOOL)hasAspects;@property (atomic, copy) NSArray *beforeAspects;@property (atomic, copy) NSArray *insteadAspects;@property (atomic, copy) NSArray *afterAspects;@end å…³è”ç›®æ ‡æ˜¯ Hook ä¹‹åçš„ Selectorï¼Œå³ aliasSelectorï¼ˆåŸå§‹ SEL åç§°åŠ  aspects_ å‰ç¼€å¯¹åº”çš„ SELï¼‰ AspectTracker AspectTracker ç±»å®šä¹‰ï¼š 123456@interface AspectTracker : NSObject- (id)initWithTrackedClass:(Class)trackedClass parent:(AspectTracker *)parent;@property (nonatomic, strong) Class trackedClass;@property (nonatomic, strong) NSMutableSet *selectorNames;@property (nonatomic, weak) AspectTracker *parentEntry;@end AspectTracker ä½œä¸ºåˆ‡é¢è¿½è¸ªå™¨ï¼ŒåŸç†å¤§è‡´å¦‚ä¸‹ï¼š 12345678910111213// Add the selector as being modified.currentClass = klass;AspectTracker *parentTracker = nil;do &#123; AspectTracker *tracker = swizzledClassesDict[currentClass]; if (!tracker) &#123; tracker = [[AspectTracker alloc] initWithTrackedClass:currentClass parent:parentTracker]; swizzledClassesDict[(id)currentClass] = tracker; &#125; [tracker.selectorNames addObject:selectorName]; // All superclasses get marked as having a subclass that is modified. parentTracker = tracker;&#125;while ((currentClass = class_getSuperclass(currentClass))); å…¨å±€å˜é‡ swizzledClassesDict ä¸­çš„ value å¯¹åº”ç€ AspectTracker æŒ‡é’ˆã€‚ AspectTracker æ˜¯ä»ä¸‹è€Œä¸Šè¿½è¸ªï¼Œæœ€åº•å±‚çš„ parentEntry ä¸º nilï¼Œçˆ¶ç±»çš„ parentEntry ä¸ºå­ç±»çš„ trackerã€‚ Aspects é™æ€å…¨å±€å˜é‡ 1ï¼‰static NSMutableDictionary *swizzledClassesDict; static NSMutableDictionary *swizzledClassesDict; åœ¨ Aspects ä¸­æ‰®æ¼”ç€å·²æ··å†™ç±»å­—å…¸çš„è§’è‰²ï¼ŒAspects å†…éƒ¨æä¾›äº†ä¸“é—¨è®¿é—®è¿™ä¸ªå…¨å±€å­—å…¸çš„æ–¹æ³•ï¼š 12345678static NSMutableDictionary *aspect_getSwizzledClassesDict() &#123; static NSMutableDictionary *swizzledClassesDict; static dispatch_once_t pred; dispatch_once(&amp;pred, ^&#123; swizzledClassesDict = [NSMutableDictionary new]; &#125;); return swizzledClassesDict;&#125; è¿™ä¸ªå…¨å±€å˜é‡å¯ä»¥ç®€å•ç†è§£ä¸ºè®°å½•æ•´ä¸ª Hook å½±å“çš„ Class åŒ…å«å…¶ SuperClass çš„è¿½è¸ªè®°å½•çš„å…¨å±€å­—å…¸ã€‚ 2ï¼‰static NSMutableSet *swizzledClasses; static NSMutableSet *swizzledClasses; åœ¨ Aspects ä¸­æ‹…å½“è®°å½•å·²æ··å†™ç±»çš„è§’è‰²ï¼ŒAspects å†…éƒ¨æä¾›ä¸€ä¸ªç”¨äºä¿®æ”¹è¿™ä¸ªå…¨å±€å˜é‡å†…å®¹çš„æ–¹æ³•ï¼š 12345678910static void _aspect_modifySwizzledClasses(void (^block)(NSMutableSet *swizzledClasses)) &#123; static NSMutableSet *swizzledClasses; static dispatch_once_t pred; dispatch_once(&amp;pred, ^&#123; swizzledClasses = [NSMutableSet new]; &#125;); @synchronized(swizzledClasses) &#123; block(swizzledClasses); &#125;&#125; Aspects æ ¸å¿ƒä»£ç å‰–æHook Class &amp;&amp; Hook InstanceAspects ä¸å…‰æ”¯æŒ Hook Class è¿˜æ”¯æŒ Hook Instanceï¼Œè¿™æä¾›äº†æ›´å°ç²’åº¦çš„æ§åˆ¶ï¼Œé…åˆ Hook çš„æ’¤é”€åŠŸèƒ½å¯ä»¥æ›´åŠ çµæ´»ç²¾å‡†çš„å®ç°åŠŸèƒ½ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647static Class aspect_hookClass(NSObject *self, NSError **error) &#123; // æ–­è¨€ self NSCParameterAssert(self); // classClass statedClass = self.class;// isaClass baseClass = object_getClass(self);NSString *className = NSStringFromClass(baseClass); // å·²ç»å­ç±»åŒ–è¿‡äº†if ([className hasSuffix:AspectsSubclassSuffix]) &#123;return baseClass; // æˆ‘ä»¬æ··å†™äº†ä¸€ä¸ª class å¯¹è±¡ï¼Œè€Œéä¸€ä¸ªå•ç‹¬çš„ object&#125;else if (class_isMetaClass(baseClass)) &#123; // baseClass æ˜¯å…ƒç±»ï¼Œåˆ™ self æ˜¯ Class æˆ– MetaClassï¼Œæ··å†™ self return aspect_swizzleClassInPlace((Class)self); // å¯èƒ½æ˜¯ä¸€ä¸ª KVO'ed classã€‚æ··å†™å°±ä½ã€‚ä¹Ÿè¦æ··å†™ meta classesã€‚ &#125;else if (statedClass != baseClass) &#123; // å½“ .class å’Œ isa æŒ‡å‘ä¸åŒçš„æƒ…å†µï¼Œæ··å†™ baseClass return aspect_swizzleClassInPlace(baseClass); &#125; // é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åˆ›å»ºå­ç±» // æ‹¼æ¥å­ç±»åç¼€ AspectsSubclassSuffixconst char *subclassName = [className stringByAppendingString:AspectsSubclassSuffix].UTF8String;// å°è¯•ç”¨æ‹¼æ¥åç¼€çš„åç§°è·å– isaClass subclass = objc_getClass(subclassName); // æ‰¾ä¸åˆ° isaï¼Œä»£è¡¨è¿˜æ²¡æœ‰åŠ¨æ€åˆ›å»ºè¿‡è¿™ä¸ªå­ç±»if (subclass == nil) &#123; // åˆ›å»ºä¸€ä¸ª class pairï¼ŒbaseClass ä½œä¸ºæ–°ç±»çš„ superClassï¼Œç±»åä¸º subclassNamesubclass = objc_allocateClassPair(baseClass, subclassName, 0);if (subclass == nil) &#123; // è¿”å› nilï¼Œå³åˆ›å»ºå¤±è´¥ NSString *errrorDesc = [NSString stringWithFormat:@\"objc_allocateClassPair failed to allocate class %s.\", subclassName]; AspectError(AspectErrorFailedToAllocateClassPair, errrorDesc); return nil; &#125; // æ··å†™ forwardInvocation:aspect_swizzleForwardInvocation(subclass);// subClass.class = statedClassaspect_hookedGetClass(subclass, statedClass);// subClass.isa.class = statedClassaspect_hookedGetClass(object_getClass(subclass), statedClass);// æ³¨å†Œæ–°ç±»objc_registerClassPair(subclass);&#125; // è¦†ç›– isaobject_setClass(self, subclass);return subclass;&#125; éš¾ç‚¹å°±åœ¨äºå¯¹ .class å’Œ object_getClass çš„åŒºåˆ†ã€‚ .class å½“ target æ˜¯ Instance åˆ™è¿”å› Classï¼Œå½“ target æ˜¯ Class åˆ™è¿”å›è‡ªèº« object_getClass è¿”å› isa æŒ‡é’ˆçš„æŒ‡å‘ åŠ¨æ€åˆ›å»ºä¸€ä¸ª Class çš„å®Œæ•´æ­¥éª¤ä¹Ÿæ˜¯æˆ‘ä»¬åº”è¯¥æ³¨æ„çš„ã€‚ objc_allocateClassPair class_addMethod class_addIvar objc_registerClassPair Hook çš„å®ç°åœ¨ä¸Šé¢ aspect_hookClass æ–¹æ³•ä¸­ï¼Œä¸ä»…ä»…æ˜¯è¿”å›ä¸€ä¸ªè¦ Hook çš„ Classï¼ŒæœŸé—´è¿˜åšäº†ä¸€äº›ç»†èŠ‚æ“ä½œï¼Œä¸è®ºæ˜¯ Class è¿˜æ˜¯ Instanceï¼Œéƒ½ä¼šè°ƒç”¨ aspect_swizzleForwardInvocation æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œç®€å•è´´ä¸€ä¸‹ä»£ç è®©å¤§å®¶æœ‰ä¸ªå°è±¡ï¼š 123456789101112static void aspect_swizzleForwardInvocation(Class klass) &#123; // æ–­è¨€ klass NSCParameterAssert(klass); // å¦‚æœæ²¡æœ‰ methodï¼Œreplace å®é™…ä¸Šä¼šåƒæ˜¯ class_addMethod ä¸€æ · IMP originalImplementation = class_replaceMethod(klass, @selector(forwardInvocation:), (IMP)__ASPECTS_ARE_BEING_CALLED__, \"v@:@\"); // æ‹¿åˆ° originalImplementation è¯æ˜æ˜¯ replace è€Œä¸æ˜¯ addï¼Œæƒ…å†µå°‘è§ if (originalImplementation) &#123; // æ·»åŠ  AspectsForwardInvocationSelectorName çš„æ–¹æ³•ï¼ŒIMP ä¸ºåŸç”Ÿ forwardInvocation: class_addMethod(klass, NSSelectorFromString(AspectsForwardInvocationSelectorName), originalImplementation, \"v@:@\"); &#125; AspectLog(@\"Aspects: %@ is now aspect aware.\", NSStringFromClass(klass));&#125; ä¸Šé¢çš„æ–¹æ³•å°±æ˜¯æŠŠè¦ Hook çš„ç›®æ ‡ Class çš„ forwardInvocation: æ··å†™äº†ï¼Œæ··å†™ä¹‹å forwardInvocation: çš„å…·ä½“å®ç°åœ¨ ASPECTS_ARE_BEING_CALLED ä¸­ï¼Œé‡Œé¢èƒ½çœ‹åˆ° invoke æ ‡è¯†ä½çš„ä¸åŒæ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å®ç°ç»†èŠ‚ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263// å®å®šä¹‰ï¼Œä»¥ä¾¿äºæˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´æ˜æ™°çš„ stack trace#define aspect_invoke(aspects, info) \\for (AspectIdentifier *aspect in aspects) &#123;\\ [aspect invokeWithInfo:info];\\ if (aspect.options &amp; AspectOptionAutomaticRemoval) &#123; \\ aspectsToRemove = [aspectsToRemove?:@[] arrayByAddingObject:aspect]; \\ &#125; \\&#125;static void __ASPECTS_ARE_BEING_CALLED__(__unsafe_unretained NSObject *self, SEL selector, NSInvocation *invocation) &#123; // __unsafe_unretained NSObject *self ä¸è§£é‡Šäº† // æ–­è¨€ self, invocation NSCParameterAssert(self); NSCParameterAssert(invocation); // ä» invocation å¯ä»¥æ‹¿åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚ originalSelector SEL originalSelector = invocation.selector; // originalSelector åŠ å‰ç¼€å¾—åˆ° aliasSelectorSEL aliasSelector = aspect_aliasForSelector(invocation.selector);// ç”¨ aliasSelector æ›¿æ¢ invocation.selector invocation.selector = aliasSelector; // Instance çš„å®¹å™¨ AspectsContainer *objectContainer = objc_getAssociatedObject(self, aliasSelector); // Class çš„å®¹å™¨ AspectsContainer *classContainer = aspect_getContainerForClass(object_getClass(self), aliasSelector); AspectInfo *info = [[AspectInfo alloc] initWithInstance:self invocation:invocation]; NSArray *aspectsToRemove = nil; // Before hooks. aspect_invoke(classContainer.beforeAspects, info); aspect_invoke(objectContainer.beforeAspects, info); // Instead hooks. BOOL respondsToAlias = YES; if (objectContainer.insteadAspects.count || classContainer.insteadAspects.count) &#123; // å¦‚æœæœ‰ä»»ä½• insteadAspects å°±ç›´æ¥æ›¿æ¢äº† aspect_invoke(classContainer.insteadAspects, info); aspect_invoke(objectContainer.insteadAspects, info); &#125;else &#123; // å¦åˆ™æ­£å¸¸æ‰§è¡Œ // éå† invocation.target åŠå…¶ superClass æ‰¾åˆ°å®ä¾‹å¯ä»¥å“åº” aliasSelector çš„ç‚¹ invoke Class klass = object_getClass(invocation.target); do &#123; if ((respondsToAlias = [klass instancesRespondToSelector:aliasSelector])) &#123; [invocation invoke]; break; &#125; &#125;while (!respondsToAlias &amp;&amp; (klass = class_getSuperclass(klass))); &#125; // After hooks. aspect_invoke(classContainer.afterAspects, info); aspect_invoke(objectContainer.afterAspects, info); // å¦‚æœæ²¡æœ‰ hookï¼Œåˆ™æ‰§è¡ŒåŸå§‹å®ç°ï¼ˆé€šå¸¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰ if (!respondsToAlias) &#123; invocation.selector = originalSelector; SEL originalForwardInvocationSEL = NSSelectorFromString(AspectsForwardInvocationSelectorName); // å¦‚æœå¯ä»¥å“åº” originalForwardInvocationSELï¼Œè¡¨ç¤ºä¹‹å‰æ˜¯ replace method è€Œé add method if ([self respondsToSelector:originalForwardInvocationSEL]) &#123; ((void( *)(id, SEL, NSInvocation *))objc_msgSend)(self, originalForwardInvocationSEL, invocation); &#125;else &#123; [self doesNotRecognizeSelector:invocation.selector]; &#125; &#125; // ç§»é™¤ aspectsToRemove é˜Ÿåˆ—ä¸­çš„ AspectIdentifierï¼Œæ‰§è¡Œ remove [aspectsToRemove makeObjectsPerformSelector:@selector(remove)];&#125;#undef aspect_invoke aspect_invoke å®å®šä¹‰çš„ä½œç”¨åŸŸ ä»£ç å®ç°å¯¹åº”äº† Hook çš„ AspectOptions å‚æ•°çš„ Beforeï¼ŒInstead å’Œ Afterã€‚ aspect_invoke ä¸­ aspectsToRemove æ˜¯ä¸€ä¸ª NSArrayï¼Œé‡Œé¢å®¹çº³ç€éœ€è¦è¢«é”€æˆ·çš„ Hookï¼Œå³ AspectIdentifierï¼ˆä¹‹åä¼šè°ƒç”¨ remove ç§»é™¤ï¼‰ã€‚ éå† invocation.target åŠå…¶ superClass æ‰¾åˆ°å®ä¾‹å¯ä»¥å“åº” aliasSelector çš„ç‚¹ invoke å®ç°ä»£ç ã€‚ Block Hook Aspects è®©æˆ‘ä»¬åœ¨æŒ‡å®š Class æˆ– Instance çš„ç‰¹å®š Selector æ‰§è¡Œæ—¶ï¼Œæ ¹æ® AspectOptions æ’å…¥æˆ‘ä»¬è‡ªå·±çš„ Block åš Hookï¼Œè€Œè¿™ä¸ª Block å†…éƒ¨æœ‰æˆ‘ä»¬æƒ³è¦çš„æœ‰å…³äºå½“å‰ Target å’Œ Selector çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Aspects æ˜¯æ€ä¹ˆåŠåˆ°çš„ï¼š 1234567891011121314151617181920212223242526272829303132333435363738- (BOOL)invokeWithInfo:(id)info &#123; NSInvocation *blockInvocation = [NSInvocation invocationWithMethodSignature:self.blockSignature]; NSInvocation *originalInvocation = info.originalInvocation; NSUInteger numberOfArguments = self.blockSignature.numberOfArguments; // åæ‰§ã€‚æˆ‘ä»¬å·²ç»åœ¨ hook æ³¨å†Œçš„æ—¶å€™æ£€æŸ¥è¿‡äº†ï¼Œï¼ˆä¸è¿‡è¿™é‡Œæˆ‘ä»¬è¿˜è¦æ£€æŸ¥ï¼‰ã€‚ if (numberOfArguments &gt; originalInvocation.methodSignature.numberOfArguments) &#123; AspectLogError(@\"Block has too many arguments. Not calling %@\", info); return NO; &#125; // block çš„ `self` å°†ä¼šæ˜¯ AspectInfoã€‚å¯é€‰çš„ã€‚ if (numberOfArguments &gt; 1) &#123; [blockInvocation setArgument:&amp;info atIndex:1]; &#125; // ç®€å†å‚æ•°åˆ†é…å†…å­˜ argBuf ç„¶åä» originalInvocation å– argument èµ‹å€¼ç»™ blockInvocationvoid *argBuf = NULL; for (NSUInteger idx = 2; idx &lt; numberOfArguments; idx++) &#123; const char *type = [originalInvocation.methodSignature getArgumentTypeAtIndex:idx];NSUInteger argSize;NSGetSizeAndAlignment(type, &amp;argSize, NULL); // reallocf ä¼˜ç‚¹ï¼Œå¦‚æœåˆ›å»ºå†…å­˜å¤±è´¥ä¼šè‡ªåŠ¨é‡Šæ”¾ä¹‹å‰çš„å†…å­˜ï¼Œè®²ç©¶if (!(argBuf = reallocf(argBuf, argSize))) &#123; AspectLogError(@\"Failed to allocate memory for block invocation.\");return NO;&#125; [originalInvocation getArgument:argBuf atIndex:idx];[blockInvocation setArgument:argBuf atIndex:idx]; &#125; // æ‰§è¡Œ [blockInvocation invokeWithTarget:self.block]; // é‡Šæ”¾ argBuf if (argBuf != NULL) &#123; free(argBuf); &#125; return YES;&#125; è€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼š [blockInvocation setArgument:&amp;info atIndex:1]; ä¸ºä»€ä¹ˆè¦åœ¨ç´¢å¼• 1 å¤„æ’å…¥å‘¢ï¼Ÿ for (NSUInteger idx = 2; idx &lt; numberOfArguments; idx++) ä¸ºä»€ä¹ˆè¦ä»ç´¢å¼• 2 å¼€å§‹éå†å‚æ•°å‘¢ï¼Ÿ ä¼˜ç§€ AOP åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨ è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ å¯æ§ç²’åº¦å° ä½¿ç”¨ Block åš Hook æ”¯æŒæ’¤é”€ Hook å®‰å…¨æ€§ è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒAspects ä½¿ç”¨ NSObject + Categroy çš„æ–¹å¼æä¾›æ¥å£ï¼Œéå¸¸å·§å¦™çš„æ¶µç›–äº† Instance å’Œ Classã€‚ Aspects æä¾›çš„æ¥å£ä¿æŒé«˜åº¦ä¸€è‡´ï¼ˆæœ¬ç€æ˜“ç”¨ï¼Œç®€å•ï¼Œæ–¹ä¾¿çš„åŸåˆ™è®¾è®¡æ¥å£å’Œæ•´ä¸ªæ¡†æ¶çš„å®ç°ä¼šè®©ä½ çš„å¼€æºé¡¹ç›®æ›´å®¹æ˜“è¢«äººä»¬æ¥çº³å’Œä½¿ç”¨ï¼‰ï¼š 12345678+ (id)aspect_hookSelector:(SEL)selector withOptions:(AspectOptions)options usingBlock:(id)block error:(NSError **)error;- (id)aspect_hookSelector:(SEL)selector withOptions:(AspectOptions)options usingBlock:(id)block error:(NSError **)error; å¯æ§ç²’åº¦å°Aspects ä¸ä»…æ”¯æŒå¤§éƒ¨åˆ† AOP æ¡†æ¶åº”è¯¥åšåˆ°çš„å¯¹äº Class çš„ Hookï¼Œè¿˜æ”¯æŒç²’åº¦æ›´å°çš„ Instance Hookï¼Œè€Œå…¶åœ¨å†…éƒ¨å®ç°ä¸­ä¸ºäº†æ”¯æŒ Instance Hook æ‰€åšçš„ä»£ç ä¹Ÿéå¸¸å€¼å¾—æˆ‘ä»¬å‚è€ƒå’Œå­¦ä¹ ï¼ˆå·²åœ¨ä¸Šæ–‡ Aspects æ ¸å¿ƒä»£ç å‰–æå¤„å•ç‹¬åˆ†æï¼‰ã€‚ ä¸ºä½¿ç”¨è€…æä¾›æ›´ä¸ºè‡ªç”±çš„ Hook æ–¹å¼ä»¥è¾¾åˆ°æ›´åŠ ç²¾å‡†çš„æ§åˆ¶æ˜¯æ¯ä¸ªä½¿ç”¨è€…ä¹äºè§åˆ°çš„äº‹ã€‚ ä½¿ç”¨ Block åš HookAspects ä½¿ç”¨ Block æ¥åš Hook åº”è¯¥è€ƒè™‘åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ”¯æŒä½¿ç”¨è€…é€šè¿‡åœ¨ Block ä¸­è·å–åˆ°ç›¸å…³çš„ä¿¡æ¯ï¼Œä¹¦å†™è‡ªå·±é¢å¤–çš„æ“ä½œå°±å¯ä»¥å®ç° Hook éœ€æ±‚ã€‚ æ”¯æŒæ’¤é”€ HookAspects è¿˜æ”¯æŒæ’¤é”€ä¹‹å‰åšçš„ Hook ä»¥åŠå·²æ··å†™çš„ Methodï¼Œä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ Aspects è®¾è®¡äº†å…¨å±€å®¹å™¨ï¼ŒæŠŠ Hook å’Œæ··å†™ç”¨å…¨å±€å®¹å™¨åšè®°å½•ï¼Œè®©ä¸€åˆ‡éƒ½å¯ä»¥å¤åŸï¼Œè¿™ä¸æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„å—ï¼Ÿ å®‰å…¨æ€§åœ¨å­¦ä¹  Runtime çš„æ—¶å€™ï¼Œå°±åº”è¯¥çœ‹åˆ°è¿‡ä¸å°‘æ–‡ç« è®²è§£ Method Swizzling è¦æ³¨æ„çš„å®‰å…¨æ€§é—®é¢˜ï¼Œç”±äºç”¨åˆ°äº†å¤§é‡ Runtime æ–¹æ³•ï¼ŒåŠ ä¸Š AOP æ˜¯é¢å‘æ•´ä¸ªåˆ‡é¢çš„ï¼Œæ‰€ä»¥ä¸€å•å‘ç°é—®é¢˜å°±ä¼šæ¯”è¾ƒä¸¥é‡ï¼Œè®¾è®¡çš„é¢ä¼šæ¯”è¾ƒå¹¿ï¼Œè€Œä¸”éš¾ä»¥è°ƒè¯•ã€‚ ä¸èƒ½å› ä¸ºå®¹æ˜“é€ æˆé—®é¢˜å°±å¯ä»¥å›é¿ Method Swizzlingï¼Œå°±å¥½æ¯”å¤§å­¦è€å¸ˆè®²åˆ°é€’å½’æ—¶å¼ºè°ƒå®¹æ˜“å¼•èµ·å¾ªç¯è°ƒç”¨ï¼Œå¾ˆå¤šäººå°±åœ¨å†…å¿ƒå›é¿ä½¿ç”¨é€’å½’ï¼Œç”šè‡³äºéå¸¸é€‚åˆä½¿ç”¨é€’å½’æ¥å†™çš„ç®—æ³•é¢˜ï¼ˆè¿™é‡ŒæŒ‡é€’å½’æ¥å†™ä¼šæ˜“è¯»å†™ã€æ˜“ç»´æŠ¤ï¼‰åªä¼šç”¨å¤æ‚çš„æ–¹å¼æ¥æ€è€ƒã€‚ æ€»ç»“ æ–‡ç« ç®€å•ä»‹ç»äº† AOP çš„æ¦‚å¿µï¼Œå¸Œæœ›èƒ½ç»™å„ä½è¯»è€…å¯¹ AOP æ€æƒ³çš„ç†è§£æä¾›å¾®è–„çš„å¸®åŠ©ã€‚ æ–‡ç« ç³»ç»Ÿçš„å‰–æäº† Aspects å¼€æºåº“çš„å†…éƒ¨ç»“æ„ï¼Œå¸Œæœ›èƒ½è®©å¤§å®¶åœ¨æµè§ˆ Aspects æºç æ—¶å¿«é€Ÿå®šä½ä»£ç ä½ç½®ï¼Œæ‰¾åˆ°æ ¸å¿ƒå†…å®¹ã€‚ æ–‡ç« é‡ç‚¹åˆ†æäº† Aspects çš„æ ¸å¿ƒä»£ç ï¼Œæç‚¼äº†ä¸€äº›ç¬”è€…è®¤ä¸ºå€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œä½†æ„¿å¯ä»¥åœ¨å¤§å®¶æ‰’æºç æ—¶æä¾›ä¸€äº›æŒ‡å¼•ã€‚ æ–‡ç« ç»“å°¾æ€»ç»“äº† Aspects ä½œä¸ºä¸€ä¸ªæ¯”è¾ƒä¼˜ç§€çš„ AOP å¼€æºåº“æ‰€å…·æœ‰çš„ç‰¹è´¨ï¼Œä¸è¿‡æ¯•ç«Ÿæ˜¯å¾ˆä¹…ä¹‹å‰çš„ä»£ç äº†ï¼Œå¦‚æœæœ‰å“ªä½æƒ³è¦é€ ä¸€ä¸ªå…³äº AOP çš„è½®å­ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿäº§ç”Ÿäº›è®¸å¸®åŠ©ã€‚ ğŸ˜¬ è”ç³» å¾®ä¿¡ : WhatsXie é‚®ä»¶ : ReverseScale@iCloud.com åšå®¢ : https://reversescale.github.io","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"Swift 4.0 ä¸­å¯¹ Dictionary çš„æ”¹è¿›","slug":"Swift 4 Dictionary","date":"2018-03-13T13:56:27.000Z","updated":"2018-11-16T12:47:15.150Z","comments":true,"path":"2018/03/13/Swift 4 Dictionary/","link":"","permalink":"https://reversescale.github.io/2018/03/13/Swift 4 Dictionary/","excerpt":"Swift 4 å‘å¸ƒå·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰åˆ‡æ¢åˆ° 4.0 ç‰ˆæœ¬ã€‚ è¿™æ¬¡ 4.0 æ›´æ–°ç»™æˆ‘æœ€å¤§çš„æ„Ÿå—å°±æ˜¯æ²¡æœ‰äº†å‰å‡ æ¬¡å‡çº§çš„è·³è·ƒå¼å˜åŒ–ã€‚ ä¸ç”¨ä¸ºäº†æ›´æ–°è¯­è¨€ç‰ˆæœ¬ï¼Œå®Œå…¨æ¨ç¿»å·²æœ‰çš„é¡¹ç›®ï¼Œè¿™ä¹Ÿæ˜¯ Swift æ…¢æ…¢è¶‹å‘äºç¨³å®šçš„æ ‡å¿—~","text":"Swift 4 å‘å¸ƒå·²ç»æœ‰ä¸€æ®µæ—¶é—´äº†ï¼Œä¸çŸ¥é“å¤§å®¶æœ‰æ²¡æœ‰åˆ‡æ¢åˆ° 4.0 ç‰ˆæœ¬ã€‚ è¿™æ¬¡ 4.0 æ›´æ–°ç»™æˆ‘æœ€å¤§çš„æ„Ÿå—å°±æ˜¯æ²¡æœ‰äº†å‰å‡ æ¬¡å‡çº§çš„è·³è·ƒå¼å˜åŒ–ã€‚ ä¸ç”¨ä¸ºäº†æ›´æ–°è¯­è¨€ç‰ˆæœ¬ï¼Œå®Œå…¨æ¨ç¿»å·²æœ‰çš„é¡¹ç›®ï¼Œè¿™ä¹Ÿæ˜¯ Swift æ…¢æ…¢è¶‹å‘äºç¨³å®šçš„æ ‡å¿—~ å’±ä»¬è¿™æ¬¡è¯´è¯´ Swift 4.0 å¯¹ Dictionary è¿™ä¸ªç»å¸¸ä¼šç”¨åˆ°çš„ç±»çš„æ”¹è¿›ã€‚ è‡ªåŠ¨æ ¹æ® key åˆ†ç»„Dictionary æ–°å¢äº†ä¸€ä¸ªæ„é€ æ–¹æ³•ï¼Œå¯ä»¥å°†ç»™å®šçš„ä¸€ä¸ªæ•°ç»„ï¼Œæ ¹æ®æŒ‡å®šçš„æ¡ä»¶è¿›è¡Œåˆ†ç»„ã€‚ æ¥çœ‹ä¸€ä¸ªä¾‹å­: 123456789struct Person &#123; var name: String var gender: Gender var age: Int enum Gender &#123; case male case female &#125;&#125; è¿™é‡Œæœ‰ä¸€ä¸ª Person ç»“æ„, ç„¶åæˆ‘ä»¬åˆå§‹åŒ–ä¸€ä¸ªæ•°ç»„ï¼š 12345let p1 = Person(name: \"aa\", gender: .female, age: 22)let p2 = Person(name: \"bb\", gender: .male, age: 24)let p3 = Person(name: \"cc\", gender: .male, age: 21)let persons = [p1, p2, p3] ç°åœ¨ç”¨æ–°çš„ Dictionary æ„é€ æ–¹æ³•ï¼Œå¯ä»¥ç«‹å³å°†è¿™ç»„ Person å®ä¾‹æ ¹æ®ä»–ä»¬çš„ gender å±æ€§è¿›è¡Œåˆ†ç»„ï¼š 123let groupedDict = Dictionary(grouping: persons) &#123; p in return p.gender&#125; è¿™ä¸ªæ„é€ æ–¹æ³•ï¼Œç¬¬ä¸€ä¸ªå‚æ•° grouping æ¥æ”¶çš„æ˜¯ persons æ•°ç»„ï¼Œ ç¬¬äºŒä¸ªå‚æ•°æ˜¯ä¸€ä¸ªé—­åŒ…ï¼Œç”¨äºè¿”å›æ ¹æ®è¿›è¡Œåˆ†ç»„çš„ä¾æ®ï¼Œæˆ‘ä»¬è¿™é‡Œè¿”å›çš„æ˜¯ p.genderã€‚ç»“æœä¸€ç›®äº†ç„¶ï¼š 123456789[ .male: [ Person(name: \"bb\", gender: .male, age: 24), Person(name: \"cc\", gender: .male, age: 21) ], .female: [ Person(name: \"aa\", gender: .female, age: 22) ]] ä»¥å¾€è¦å®ç°è¿™æ ·çš„åŠŸèƒ½ï¼Œå°±éœ€è¦æ‰‹åŠ¨éå†æ•´ä¸ªæ•°ç»„ï¼Œå–å‡º keyï¼Œ ç„¶åç”Ÿæˆå­—å…¸ï¼Œ ç°åœ¨æ–¹ä¾¿å¾ˆå¤šã€‚ value æ— ç¼è½¬æ¢å¦å¤–ä¸€ä¸ªæ¯”è¾ƒæœ‰ç”¨çš„ç‰¹æ€§æ˜¯ï¼ŒDictionary æä¾›çš„ mapValues æ–¹æ³•ã€‚ è¿˜ä»¥æˆ‘ä»¬åˆšæ‰ç”Ÿæˆçš„ groupedDict ä¸ºä¾‹ï¼Œå¯ä»¥è¿›è¡Œè¿™æ ·çš„æ“ä½œï¼š 123let count = groupedDict.mapValues &#123; persons in persons.count&#125; å…ˆçœ‹ä¸€ä¸‹è¾“å‡ºï¼Œå¤§å®¶å¯èƒ½å°±çŒœåˆ°è¿™ä¸ªæ–¹æ³•çš„ç”¨é€”æ˜¯ä»€ä¹ˆäº†ï¼š 1234[ .male: 2, .female: 1] ä¸Šé¢çš„è¾“å‡ºå¯ä»¥çœ‹åˆ°ï¼Œ mapValues ä¼šéå†æ¯ä¸€ä¸ª key å¯¹åº”çš„ valuesï¼Œ ç„¶åä¼ é€’ç»™é—­åŒ…è¿›è¡Œè‡ªå®šä¹‰è½¬æ¢ã€‚ æˆ‘ä»¬ä¾‹å­ä¸­çš„é—­åŒ…è¿”å›çš„å°±æ˜¯æ¯ä¸ª key å¯¹åº”çš„ Person é›†åˆçš„æ•°é‡ï¼Œæœ€ç”Ÿæˆäº†ä¸€ä¸ªæ–°çš„ Dictionaryï¼Œé‡Œé¢çš„ key å’Œä¹‹å‰ä¸€æ ·ï¼Œåªæ˜¯å¯¹åº”çš„å€¼å˜æˆäº†æˆ‘ä»¬é—­åŒ…ä¸­è‡ªå®šä¹‰çš„äº†ã€‚ mapValues æ–¹æ³•åŒæ ·æ˜¯ä¸€ä¸ªå¸®åŠ©æˆ‘ä»¬è§£å†³ç¹æ‚æ“ä½œçš„å·¥å…·æ–¹æ³•ã€‚ ä»é”®å€¼å¯¹å…ƒç»„ä¸­ç›´æ¥æ„å»ºå‡å¦‚æˆ‘ä»¬æœ‰è¿™æ ·ä¸€ä¸ªæ•°ç»„: 1let personsTuples = [(\"group 1\", [p1, p2]), (\"group 2\", [p3])] ç„¶åå¯ä»¥è°ƒç”¨ uniqueKeysWithValues æ„é€ æ–¹æ³•ç›´æ¥åˆå§‹åŒ–å­—å…¸ï¼š 1let dict = Dictionary(uniqueKeysWithValues: personsTuples) personsTuples æ•°ç»„ä¸­ï¼Œæ¯ä¸€ä¸ªå…ƒç´ éƒ½æ˜¯ä¸€ä¸ªå…ƒç»„(Tuple)ï¼Œ è¿™ä¸ªæ„é€ æ–¹æ³•æŠŠå…ƒç»„ä¸­çš„ç¬¬ä¸€é¡¹å½“åš keyï¼Œ ç¬¬äºŒé¡¹å½“åš valueï¼Œ ç”Ÿæˆä¸€ä¸ªæ–°çš„ Dictionaryï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š 123456789[ \"group 1\": [ Person(name: \"aa\", gender: .female, age: 22), Person(name: \"bb\", gender: .male, age: 24) ], \"group 2\": [ Person(name: \"cc\", gender: .male, age: 21) ]] ä½¿ç”¨ uniqueKeysWithValues æ„é€ æ–¹æ³•æ—¶å€™éœ€è¦æ³¨æ„ï¼Œå°±æ˜¯ä¼ å…¥çš„æ•°ç»„ä¸­ï¼Œä¸èƒ½æœ‰é‡å¤çš„ keyï¼Œ å¦åˆ™ä¼šæŠ¥è¿è¡Œæ—¶é”™è¯¯ï¼Œæ¯”å¦‚è¿™ä¸ªæ•°ç»„å°±ä¼šæŠ¥é”™ï¼š 1let personsTuples = [(\"group 1\", [p1, p2]), (\"group 2\", [p3]), (\"group 2\", [p4])] ä¸Šé¢æ•°ç»„ä¸­ group 2 å‡ºç°äº†ä¸¤æ¬¡ã€‚ å¦‚æœç”¨å®ƒæ¥åˆå§‹åŒ–çš„è¯ï¼Œå°±ä¼šå‡ºé”™ã€‚ æ‰€ä»¥ Swift 4.0 è¿˜æä¾›äº†å¦å¤–ä¸€ä¸ªåˆå§‹åŒ–æ–¹æ³•ï¼Œ å¯¹äºä¸Šé¢è¿™ä¸ªæ•°ç»„ï¼Œå¯ä»¥è°ƒç”¨ï¼š 123let dict = Dictionary(personsTuples) &#123; old, new in return new&#125; ç¬¬äºŒä¸ªé—­åŒ…å‚æ•°ï¼Œä¼šåœ¨é‡åˆ°é‡å¤çš„ key æ—¶å€™è°ƒç”¨ã€‚ å®ƒæä¾›ä¸¤ä¸ªå‚æ•°ï¼Œä¸€ä¸ªæ˜¯åŒæ ·è¿™ä¸ª key çš„ä¸Šä¸€ä¸ªå€¼ oldï¼Œ è¿˜æœ‰å½“å‰çš„å€¼ newã€‚ æˆ‘ä»¬è¿™é‡Œç›´æ¥è¿”å› newï¼Œæ„æ€å°±æ˜¯ æ¯æ¬¡é‡åˆ°é‡å¤çš„ keyï¼Œ å°±ç”¨æ–°çš„å€¼ä»£æ›¿è€çš„å€¼ã€‚ è¿™æ ·åˆå§‹åŒ–åï¼Œç”Ÿæˆçš„ Dictionary ç»“æ„å¦‚ä¸‹ï¼š 123456789[ \"group 1\": [ p1, p2 ], \"group 2\": [ p4 ]] group 2 ä¸­çš„å€¼ï¼Œ æ˜¯ç¬¬äºŒæ¬¡ key æ‰€å¯¹åº”çš„ p4ã€‚ æä¾›é»˜è®¤å€¼å¦‚æœæˆ‘ä»¬è®¿é—®äº†ä¸€ä¸ªå­—å…¸ä¸­ä¸å­˜åœ¨çš„ keyï¼Œ ä¼šè¿”å› nilï¼š 1dict[\"group 3\"] å› ä¸ºä¸Šé¢å­—å…¸ä¸­ï¼Œä¸å­˜åœ¨ group 3 è¿™ä¸ª keyï¼Œ æ‰€ä»¥å®ƒè¿”å›äº† nilã€‚ Swift 4 ä¸­æ–°å¢äº†æŒ‡å®šé»˜è®¤å€¼çš„èƒ½åŠ›ï¼š 1dict[\"group 3\", default: []] è¿™æ ·è°ƒç”¨ï¼Œå¦‚æœ group 3 è¿™ä¸ª key ä¸å­˜åœ¨çš„è¯ï¼Œ å°±ä¼šè¿”å›æˆ‘ä»¬æŒ‡å®šçš„é»˜è®¤å€¼ç©ºæ•°ç»„ï¼Œ è€Œä¸æ˜¯ nil äº†ã€‚ è¿™ä¸ªç‰¹æ€§åœ¨æˆ‘ä»¬å¤„ç† JSON æ•°æ®è§£æè¿™ç±»çš„é—®é¢˜ä¸Šå¾ˆå®ç”¨ã€‚ è¿‡æ»¤å™¨è¿‡æ»¤å™¨å¯¹äºé›†åˆç±»æ¥è¯´æ˜¯æ¯”è¾ƒå¸¸ç”¨çš„åŠŸèƒ½ã€‚ Swift 4 ä¸­å¯¹ Dictionary ç±»å‹ä¹Ÿæä¾›äº†è¿‡æ»¤å™¨çš„æ”¯æŒï¼š 123let filteredDict = dict.filter &#123; key, val in return val.count &gt;= 2&#125; filter æ–¹æ³•æ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œå®ƒä¼šéå† Dictionary ä¸­æ‰€æœ‰çš„å…ƒç´ ï¼Œå¹¶ä¸”ä½œä¸ºé—­åŒ…çš„å‚æ•°ä¼ å…¥ã€‚ æˆ‘ä»¬éœ€è¦é€šè¿‡é—­åŒ…çš„è¿”å›å€¼ç¡®å®šè¿™ä¸ªå…ƒç´ æ˜¯å¦è¢«ä¿ç•™ã€‚ ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œæ¯”å¦‚æˆ‘ä»¬ dict ä¸­çš„å…ƒç´ æ˜¯ ï¼š 123456789[ \"group 1\": [ p1, p2 ], \"group 2\": [ p4 ]] è°ƒç”¨ filter åï¼Œæˆ‘ä»¬åªä¿ç•™æ•°é‡å¤§äº 2 çš„é›†åˆï¼š 123456[ \"group 1\": [ p1, p2 ]] æ€»ç»“ä»¥ä¸Šå°±æ˜¯ Swift 4.0 å¯¹äº Dictionary çš„ä¸»è¦æ”¹è¿›ã€‚ è¿™äº›æ–°å¢çš„å·¥å…·æ–¹æ³•å¯¹äºæé«˜æˆ‘ä»¬å¼€å‘æ•ˆç‡å’Œä»£ç è´¨é‡éƒ½æœ‰å¸®åŠ©ï¼Œå¸Œæœ›è¿™é‡Œçš„ä»‹ç»å¯¹ä½ æœ‰å¸®åŠ©ã€‚ å…³äº Dictionary æ›´å®Œæ•´çš„ä¿¡æ¯ï¼Œå¤§å®¶è¿˜å¯ä»¥å‚è€ƒè‹¹æœå®˜æ–¹çš„æ–‡æ¡£ï¼Œè¿˜æœ‰ Swift Blog ä¸­çš„ä»‹ç»ã€‚ å‚è€ƒæ–‡çŒ®Dictionary å®˜æ–¹æ–‡æ¡£ï¼šhttps://developer.apple.com/documentation/swift/dictionarySwift Blog: https://swift.org/blog/dictionary-and-set-improvements/","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"Swift","slug":"Swift","permalink":"https://reversescale.github.io/tags/Swift/"}]},{"title":"Swift 4.0 æ–°ç‰¹å¾æ±‡æ€»åŠæ¼”ç¤º","slug":"Swift 4 New feature","date":"2018-03-09T13:16:27.000Z","updated":"2018-11-16T12:16:08.813Z","comments":true,"path":"2018/03/09/Swift 4 New feature/","link":"","permalink":"https://reversescale.github.io/2018/03/09/Swift 4 New feature/","excerpt":"Swift åœ¨ä¸æ–­çš„ç‰ˆæœ¬è¿­ä»£ä¸­ï¼Œç”±äºå…¶ ABI å°šä¸ç¨³å®šï¼Œæ‰€ä»¥ç»™å¼€å‘è€…å¸¦æ¥è®¸å¤šçš„æŒ‘æˆ˜ï¼Œä½†ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œè¿™é—¨è¯­è¨€æ‰æœ‰æ— é™å¯èƒ½~","text":"Swift åœ¨ä¸æ–­çš„ç‰ˆæœ¬è¿­ä»£ä¸­ï¼Œç”±äºå…¶ ABI å°šä¸ç¨³å®šï¼Œæ‰€ä»¥ç»™å¼€å‘è€…å¸¦æ¥è®¸å¤šçš„æŒ‘æˆ˜ï¼Œä½†ä¹Ÿæ­£å› ä¸ºå¦‚æ­¤ï¼Œè¿™é—¨è¯­è¨€æ‰æœ‰æ— é™å¯èƒ½~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo Key Paths æ–°è¯­æ³•key-path é€šå¸¸æ˜¯ç”¨åœ¨é”®å€¼ç¼–ç ï¼ˆKVCï¼‰ä¸é”®å€¼è§‚å¯Ÿï¼ˆKVOï¼‰ä¸Šçš„ï¼ŒKVCã€KVO ç›¸å…³å†…å®¹å¯ä»¥å‚è€ƒæˆ‘ä¹‹å‰å†™çš„è¿™ç¯‡æ–‡ç« ï¼šSwift - åå°„ï¼ˆReflectionï¼‰çš„ä»‹ç»ä¸ä½¿ç”¨æ ·ä¾‹ï¼ˆé™„KVCä»‹ç»ï¼‰ 1.Swift 3 ä¹‹å‰ä½¿ç”¨çš„æ˜¯ String ç±»å‹çš„ key-Path1234567891011121314151617//ç”¨æˆ·ç±»class User: NSObject&#123; @objc var name:String = &quot;&quot; //å§“å @objc var age:Int = 0 //å¹´é¾„&#125; //åˆ›å»ºä¸€ä¸ªUserå®ä¾‹å¯¹è±¡let user1 = User()user1.name = &quot;hangge&quot;user1.age = 100 //ä½¿ç”¨KVCå–å€¼let name = user1.value(forKey: &quot;name&quot;)print(name) //ä½¿ç”¨KVCèµ‹å€¼user1.setValue(&quot;hangge.com&quot;, forKey: &quot;name&quot;) å…·ä½“æ˜¾ç¤ºå¦‚ä¸‹ï¼š 2.åˆ°äº† Swift 3 æ–°å¢äº† #keyPath() å†™æ³•ä½¿ç”¨ #keyPath() å†™æ³•ï¼Œå¯ä»¥é¿å…æˆ‘ä»¬å› ä¸ºæ‹¼å†™é”™è¯¯è€Œå¼•å‘é—®é¢˜ã€‚1234567891011121314151617//ç”¨æˆ·ç±»class User: NSObject&#123; @objc var name:String = &quot;&quot; //å§“å @objc var age:Int = 0 //å¹´é¾„&#125; //åˆ›å»ºä¸€ä¸ªUserå®ä¾‹å¯¹è±¡let user1 = User()user1.name = &quot;hangge&quot;user1.age = 100 //ä½¿ç”¨KVCå–å€¼let name = user1.value(forKeyPath: #keyPath(User.name))print(name) //ä½¿ç”¨KVCèµ‹å€¼user1.setValue(&quot;hangge.com&quot;, forKeyPath: #keyPath(User.name)) 3.Swift 4 ä¸­ç›´æ¥ç”¨ \\ ä½œä¸ºå¼€å¤´åˆ›å»º KeyPathæ–°çš„æ–¹å¼ä¸ä»…ä½¿ç”¨æ›´åŠ ç®€å•ï¼Œè€Œä¸”æœ‰å¦‚ä¸‹ä¼˜ç‚¹ï¼š ç±»å‹å¯ä»¥å®šä¹‰ä¸º classã€struct å®šä¹‰ç±»å‹æ—¶æ— éœ€åŠ ä¸Š @objc ç­‰å…³é”®å­— æ€§èƒ½æ›´å¥½ ç±»å‹å®‰å…¨å’Œç±»å‹æ¨æ–­ï¼Œä¾‹å¦‚ï¼šuser1.value(forKeyPath: #keyPath(User.name)) è¿”å›çš„ç±»å‹æ˜¯ Anyï¼Œuser1[keyPath: \\User.name] ç›´æ¥è¿”å› String ç±»å‹ å¯ä»¥åœ¨æ‰€æœ‰å€¼ç±»å‹ä¸Šä½¿ç”¨ï¼ˆ1ï¼‰æ¯”å¦‚ä¸Šé¢çš„æ ·ä¾‹åœ¨ Swift4 ä¸­å¯ä»¥è¿™ä¹ˆå†™ï¼š1234567891011121314151617//ç”¨æˆ·ç±»class User: NSObject&#123; var name:String = &quot;&quot; //å§“å var age:Int = 0 //å¹´é¾„&#125; //åˆ›å»ºä¸€ä¸ªUserå®ä¾‹å¯¹è±¡let user1 = User()user1.name = &quot;hangge&quot;user1.age = 100 //ä½¿ç”¨KVCå–å€¼let name = user1[keyPath: \\User.name]print(name) //ä½¿ç”¨KVCèµ‹å€¼user1[keyPath: \\User.name] = &quot;hangge.com&quot; ï¼ˆ2ï¼‰keyPath å®šä¹‰åœ¨å¤–é¢ä¹Ÿæ˜¯å¯ä»¥çš„ï¼š123456let keyPath = \\User.name let name = user1[keyPath: keyPath]print(name) user1[keyPath: keyPath] = &quot;hangge.com&quot; ï¼ˆ3ï¼‰å¯ä»¥ä½¿ç”¨ appending æ–¹æ³•å‘å·²å®šä¹‰çš„ Key Path åŸºç¡€ä¸Šå¡«åŠ æ–°çš„ Key Pathã€‚12let keyPath1 = \\User.phonelet keyPath2 = keyPath1.appending(path: \\.number) ç±»ä¸åè®®çš„ç»„åˆç±»å‹åœ¨ Swift 4 ä¸­ï¼Œå¯ä»¥æŠŠç±»ï¼ˆClassï¼‰å’Œåè®®ï¼ˆProtocolï¼‰ç”¨ &amp; ç»„åˆåœ¨ä¸€èµ·ä½œä¸ºä¸€ä¸ªç±»å‹ä½¿ç”¨ã€‚ ä½¿ç”¨æ ·ä¾‹1ï¼š12345678910111213protocol MyProtocol &#123; &#125; class View &#123; &#125; class ViewSubclass: View, MyProtocol &#123; &#125; class MyClass &#123; var delegate: (View &amp; MyProtocol)?&#125; let myClass = MyClass()myClass.delegate = ViewSubclass() //è¿™ä¸ªç¼–è¯‘æ­£å¸¸myClass.delegate = View() //è¿™ä¸ªç¼–è¯‘æŠ¥é”™: å…·ä½“é”™è¯¯ä¿¡æ¯å¦‚ä¸‹ï¼š ä½¿ç”¨æ ·ä¾‹2ï¼š123456789101112131415161718192021protocol Shakeable &#123; func shake()&#125; extension UIButton: Shakeable &#123; func shake() &#123; /* ... */ &#125;&#125; extension UISlider: Shakeable &#123; func shake() &#123; /* ... */ &#125;&#125; func shakeEm(controls: [UIControl &amp; Shakeable]) &#123; for control in controls where control.isEnabled &#123; control.shake() &#125;&#125; ä¸‹æ ‡æ”¯æŒæ³›å‹1.ä¸‹æ ‡çš„è¿”å›ç±»å‹æ”¯æŒæ³›å‹æœ‰æ—¶å€™æˆ‘ä»¬ä¼šå†™ä¸€äº›æ•°æ®å®¹å™¨ï¼ŒSwift æ”¯æŒé€šè¿‡ä¸‹æ ‡æ¥è¯»å†™å®¹å™¨ä¸­çš„æ•°æ®ã€‚ä½†æ˜¯å¦‚æœå®¹å™¨ç±»ä¸­çš„æ•°æ®ç±»å‹å®šä¹‰ä¸ºæ³›å‹ï¼Œè¿‡å»ä¸‹æ ‡è¯­æ³•å°±åªèƒ½è¿”å› Anyï¼Œåœ¨å–å‡ºå€¼åéœ€è¦ç”¨ as? æ¥è½¬æ¢ç±»å‹ã€‚ç°åœ¨ Swift 4 å®šä¹‰ä¸‹æ ‡ä¹Ÿå¯ä»¥ä½¿ç”¨æ³›å‹äº†ã€‚12345678910111213141516171819202122struct GenericDictionary&lt;Key: Hashable, Value&gt; &#123; private var data: [Key: Value] init(data: [Key: Value]) &#123; self.data = data &#125; subscript&lt;T&gt;(key: Key) -&gt; T? &#123; return data[key] as? T &#125;&#125; //å­—å…¸ç±»å‹: [String: Any]let earthData = GenericDictionary(data: [&quot;name&quot;: &quot;Earth&quot;, &quot;population&quot;: 7500000000, &quot;moons&quot;: 1]) //è‡ªåŠ¨è½¬æ¢ç±»å‹ï¼Œä¸éœ€è¦åœ¨å†™ &quot;as? String&quot;let name: String? = earthData[&quot;name&quot;]print(name) //è‡ªåŠ¨è½¬æ¢ç±»å‹ï¼Œä¸éœ€è¦åœ¨å†™ &quot;as? Int&quot;let population: Int? = earthData[&quot;population&quot;]print(population) 2.ä¸‹æ ‡ç±»å‹åŒæ ·æ”¯æŒæ³›å‹12345678910111213141516extension GenericDictionary &#123; subscript&lt;Keys: Sequence&gt;(keys: Keys) -&gt; [Value] where Keys.Iterator.Element == Key &#123; var values: [Value] = [] for key in keys &#123; if let value = data[key] &#123; values.append(value) &#125; &#125; return values &#125;&#125; // Arrayä¸‹æ ‡let nameAndMoons = earthData[[&quot;moons&quot;, &quot;name&quot;]] // [1, &quot;Earth&quot;]// Setä¸‹æ ‡let nameAndMoons2 = earthData[Set([&quot;moons&quot;, &quot;name&quot;])] // [1, &quot;Earth&quot;] Codable åºåˆ—åŒ–å¦‚æœè¦å°†ä¸€ä¸ªå¯¹è±¡æŒä¹…åŒ–ï¼Œéœ€è¦æŠŠè¿™ä¸ªå¯¹è±¡åºåˆ—åŒ–ã€‚è¿‡å»çš„åšæ³•æ˜¯å®ç° NSCoding åè®®ï¼Œä½†å®ç° NSCoding åè®®çš„ä»£ç å†™èµ·æ¥å¾ˆç¹çï¼Œå°¤å…¶æ˜¯å½“å±æ€§éå¸¸å¤šçš„æ—¶å€™ã€‚Swift 4 ä¸­å¼•å…¥äº† Codable åè®®ï¼Œå¯ä»¥å¤§å¤§å‡è½»äº†æˆ‘ä»¬çš„å·¥ä½œé‡ã€‚æˆ‘ä»¬åªéœ€è¦è®©éœ€è¦åºåˆ—åŒ–çš„å¯¹è±¡ç¬¦åˆ Codable åè®®å³å¯ï¼Œä¸ç”¨å†å†™ä»»ä½•å…¶ä»–çš„ä»£ç ã€‚1234struct Language: Codable &#123; var name: String var version: Int&#125; 1.Encode æ“ä½œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŠŠç¬¦åˆäº† Codable åè®®çš„å¯¹è±¡ encode æˆ JSON æˆ–è€… PropertyListã€‚12345678let swift = Language(name: &quot;Swift&quot;, version: 4) //encodedå¯¹è±¡let encodedData = try JSONEncoder().encode(swift) //ä»encodedå¯¹è±¡è·å–Stringlet jsonString = String(data: encodedData, encoding: .utf8)print(jsonString) 2.Decode æ“ä½œ12let decodedData = try JSONDecoder().decode(Language.self, from: encodedData)print(decodedData.name, decodedData.version) SubtringSwift 4 ä¸­æœ‰ä¸€ä¸ªå¾ˆå¤§çš„å˜åŒ–å°±æ˜¯ String å¯ä»¥å½“åš Collection æ¥ç”¨ï¼Œå¹¶ä¸æ˜¯å› ä¸º String å®ç°äº† Collection åè®®ï¼Œè€Œæ˜¯ String æœ¬èº«å¢åŠ äº†å¾ˆå¤š Collection åè®®ä¸­çš„æ–¹æ³•ï¼Œä½¿å¾— String åœ¨ä½¿ç”¨æ—¶çœ‹ä¸Šå»å°±æ˜¯ä¸ª Collectionã€‚1234567let str = &quot;hangge.com&quot; print(str.prefix(5)) // &quot;hangg&quot;print(str.suffix(5)) // &quot;e.com&quot; print(str.dropFirst()) // &quot;angge.com&quot;print(str.dropLast()) // &quot;hangge.co&quot; æ¯”å¦‚ä¸Šé¢çš„æ ·ä¾‹ï¼Œæˆ‘ä»¬ä½¿ç”¨ä¸€äº› Collection åè®®çš„æ–¹æ³•å¯¹å­—ç¬¦ä¸²è¿›è¡Œæˆªå–ï¼Œåªä¸è¿‡å®ƒä»¬çš„è¿”å›ç»“æœä¸æ˜¯ String ç±»å‹ï¼Œè€Œæ˜¯ Swift 4 æ–°å¢çš„ Substring ç±»å‹ã€‚ 1.ä¸ºä½•è¦å¼•å…¥ Substringï¼Ÿæ—¢ç„¶æˆ‘ä»¬æƒ³è¦çš„åˆ°çš„å°±æ˜¯å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆç›´æ¥è¿”å› String å°±å¥½äº†ï¼Œä¸ºä»€ä¹ˆè¿˜è¦å¤šæ­¤ä¸€ä¸¾è¿”å› Substringã€‚åŸå› åªæœ‰ä¸€ä¸ªï¼šæ€§èƒ½ã€‚å…·ä½“å¯ä»¥å‚è€ƒä¸‹å›¾ï¼šå½“æˆ‘ä»¬ç”¨ä¸€äº› Collection çš„æ–¹å¼å¾—åˆ° String é‡Œçš„ä¸€éƒ¨åˆ†æ—¶ï¼Œåˆ›å»ºçš„éƒ½æ˜¯ Substringã€‚Substring ä¸åŸ String æ˜¯å…±äº«ä¸€ä¸ª Storageã€‚è¿™æ„å‘³æˆ‘ä»¬åœ¨æ“ä½œè¿™ä¸ªéƒ¨åˆ†çš„æ—¶å€™ï¼Œæ˜¯ä¸éœ€è¦é¢‘ç¹çš„å»åˆ›å»ºå†…å­˜ï¼Œä»è€Œä½¿å¾— Swift 4 çš„ String ç›¸å…³æ“ä½œå¯ä»¥è·å–æ¯”è¾ƒé«˜çš„æ€§èƒ½ã€‚è€Œå½“æˆ‘ä»¬æ˜¾å¼åœ°å°† Substring è½¬æˆ String çš„æ—¶å€™ï¼Œæ‰ä¼š Copy ä¸€ä»½ String åˆ°æ–°çš„å†…å­˜ç©ºé—´æ¥ï¼Œè¿™æ—¶æ–°çš„ String å’Œä¹‹å‰çš„ String å°±æ²¡æœ‰å…³ç³»äº†ã€‚ 2.ä½¿ç”¨ Substring çš„æ³¨æ„äº‹é¡¹ç”±äº Substring ä¸åŸ String æ˜¯å…±äº«å­˜å‚¨ç©ºé—´çš„ï¼Œåªè¦æˆ‘ä»¬ä½¿ç”¨äº† Substringï¼ŒåŸ String å°±ä¼šå­˜åœ¨å†…å­˜ç©ºé—´ä¸­ã€‚åªæœ‰ Substring è¢«é‡Šæ”¾ä»¥åï¼Œæ•´ä¸ª String æ‰ä¼šè¢«é‡Šæ”¾ã€‚è€Œä¸” Substring ç±»å‹æ— æ³•ç›´æ¥èµ‹å€¼ç»™éœ€è¦ String ç±»å‹çš„åœ°æ–¹ï¼Œæˆ‘ä»¬å¿…é¡»ç”¨ String() åŒ…ä¸€å±‚ã€‚å½“ç„¶è¿™æ—¶ç³»ç»Ÿå°±ä¼šé€šè¿‡å¤åˆ¶åˆ›å»ºå‡ºä¸€ä¸ªæ–°çš„å­—ç¬¦ä¸²å¯¹è±¡ï¼Œä¹‹ååŸå­—ç¬¦ä¸²å°±ä¼šè¢«é‡Šæ”¾ã€‚ 3.ä½¿ç”¨æ ·ä¾‹è¿™é‡Œå¯¹ String è¿›è¡Œæ‰©å±•ï¼Œæ–°å¢ä¸€ä¸ª subString æ–¹æ³•ã€‚ç›´æ¥å¯ä»¥æ ¹æ®èµ·å§‹ä½ç½®ï¼ˆInt ç±»å‹ï¼‰å’Œéœ€è¦çš„é•¿åº¦ï¼ˆInt ç±»å‹ï¼‰ï¼Œæ¥æˆªå–å‡ºå­å­—ç¬¦ä¸²ã€‚123456789101112extension String &#123; //æ ¹æ®å¼€å§‹ä½ç½®å’Œé•¿åº¦æˆªå–å­—ç¬¦ä¸² func subString(start:Int, length:Int = -1) -&gt; String &#123; var len = length if len == -1 &#123; len = self.count - start &#125; let st = self.index(startIndex, offsetBy:start) let en = self.index(st, offsetBy:len) return String(self[st ..&lt; en]) &#125;&#125; ä½¿ç”¨æ ·ä¾‹ï¼š1234let str1 = &quot;æ¬¢è¿è®¿é—®hangge.com&quot;let str2 = str1.subString(start: 4, length: 6)print(&quot;åŸå­—ç¬¦ä¸²ï¼š\\(str1)&quot;)print(&quot;æˆªå–å‡ºçš„å­—ç¬¦ä¸²ï¼š\\(str2)&quot;) è¿è¡Œç»“æœå¦‚ä¸‹ï¼š æ³¨æ„ï¼šè¿™ä¸ªæ–¹æ³•æœ€åæˆ‘ä»¬ä¼šå°† Substring æ˜¾å¼åœ°è½¬æˆ String å†è¿”å›ã€‚ åºŸé™¤ swap æ–¹æ³•ï¼ˆ1ï¼‰è¿‡å»æˆ‘ä»¬ä¼šä½¿ç”¨ swap(_:_:) æ¥å°†ä¸¤ä¸ªå˜é‡çš„å€¼è¿›è¡Œäº¤æ¢ï¼š1234var a = 1var b = 2swap(&amp;a, &amp;b)print(a, b) ï¼ˆ2ï¼‰åé¢ swap() æ–¹æ³•å°†ä¼šè¢«åºŸå¼ƒï¼Œå»ºè®®ä½¿ç”¨ tupleï¼ˆå…ƒç»„ï¼‰ç‰¹æ€§æ¥å®ç°å€¼äº¤æ¢ï¼Œä¹Ÿåªéœ€è¦ä¸€å¥è¯å°±èƒ½å®ç°ï¼š1234var a = 1var b = 2(b, a) = (a, b)print(a, b) ä½¿ç”¨ tuple æ–¹å¼çš„å¥½å¤„æ˜¯ï¼Œå¤šä¸ªå˜é‡å€¼ä¹Ÿå¯ä»¥ä¸€èµ·è¿›è¡Œäº¤æ¢ï¼š12345var a = 1var b = 2var c = 3(a, b, c) = (b, c, a)print(a, b, c) ï¼ˆ3ï¼‰è¡¥å……ä¸€ä¸‹ï¼šç°åœ¨æ•°ç»„å¢åŠ äº†ä¸ª swapAt æ–¹æ³•å¯ä»¥å®ç°ä¸¤ä¸ªå…ƒç´ çš„ä½ç½®äº¤æ¢ã€‚1234var fruits = [&quot;apple&quot;, &quot;pear&quot;, &quot;grape&quot;, &quot;banana&quot;]//äº¤æ¢å…ƒç´ ä½ç½®ï¼ˆç¬¬2ä¸ªå’Œç¬¬3ä¸ªå…ƒç´ ä½ç½®è¿›è¡Œäº¤æ¢ï¼‰fruits.swapAt(1, 2)print(fruits) å‡å°‘éšå¼ @objc è‡ªåŠ¨æ¨æ–­1.è¿‡å»çš„æƒ…å†µï¼ˆSwift 3ï¼‰ï¼ˆ1ï¼‰åœ¨é¡¹ç›®ä¸­å¦‚æœæƒ³æŠŠ Swift å†™çš„ API æš´éœ²ç»™ Objective-C è°ƒç”¨ï¼Œéœ€è¦å¢åŠ  @objcã€‚åœ¨ Swift 3 ä¸­ï¼Œç¼–è¯‘å™¨ä¼šåœ¨å¾ˆå¤šåœ°æ–¹ä¸ºæˆ‘ä»¬éšå¼çš„åŠ ä¸Š @objcã€‚ï¼ˆ2ï¼‰æ¯”å¦‚å½“ä¸€ä¸ªç±»ç»§æ‰¿äº NSObjectï¼Œé‚£ä¹ˆè¿™ä¸ªç±»çš„æ‰€æœ‰æ–¹æ³•éƒ½ä¼šè¢«éšå¼çš„åŠ ä¸Š @objcã€‚1234class MyClass: NSObject &#123; func print() &#123; &#125; // åŒ…å«éšå¼çš„ @objc func show() &#123; &#125; // åŒ…å«éšå¼çš„ @objc&#125; ï¼ˆ3ï¼‰ä½†è¿™æ ·åšå¾ˆå¤šå¹¶ä¸éœ€è¦æš´éœ²ç»™ Objective-C ä¹Ÿè¢«åŠ ä¸Šäº† @objcã€‚è€Œå¤§é‡ @objc ä¼šå¯¼è‡´äºŒè¿›åˆ¶æ–‡ä»¶å¤§å°çš„å¢åŠ ã€‚ 2.ç°åœ¨çš„æƒ…å†µï¼ˆSwift 4ï¼‰ï¼ˆ1ï¼‰åœ¨ Swift 4 ä¸­éšå¼ @objc è‡ªåŠ¨æ¨æ–­åªä¼šå‘ç”Ÿåœ¨ä¸‹é¢è¿™ç§å¿…é¡»è¦ä½¿ç”¨ @objc çš„æƒ…å†µï¼š è¦†ç›–çˆ¶ç±»çš„ Objective-C æ–¹æ³• ç¬¦åˆä¸€ä¸ª Objective-C çš„åè®® ï¼ˆ2ï¼‰å¤§å¤šæ•°åœ°æ–¹å¿…é¡»æ‰‹å·¥æ˜¾ç¤ºåœ°åŠ ä¸Š @objcã€‚1234class MyClass: NSObject &#123; @objc func print() &#123; &#125; //æ˜¾ç¤ºçš„åŠ ä¸Š @objc @objc func show() &#123; &#125; //æ˜¾ç¤ºçš„åŠ ä¸Š @objc&#125; ï¼ˆ3ï¼‰å¦‚æœåœ¨ç±»å‰åŠ ä¸Š @objcMembersï¼Œé‚£ä¹ˆå®ƒã€å®ƒçš„å­ç±»ã€æ‰©å±•é‡Œçš„æ–¹æ³•éƒ½ä¼šéšå¼çš„åŠ ä¸Š @objcã€‚123456789@objcMembersclass MyClass: NSObject &#123; func print() &#123; &#125; //åŒ…å«éšå¼çš„ @objc func show() &#123; &#125; //åŒ…å«éšå¼çš„ @objc&#125; extension MyClass &#123; func baz() &#123; &#125; //åŒ…å«éšå¼çš„ @objc&#125; ï¼ˆ4ï¼‰å¦‚æœåœ¨æ‰©å±•ï¼ˆextensionï¼‰å‰åŠ ä¸Š @objcï¼Œé‚£ä¹ˆè¯¥æ‰©å±•é‡Œçš„æ–¹æ³•éƒ½ä¼šéšå¼çš„åŠ ä¸Š @objcã€‚123456class SwiftClass &#123; &#125; @objc extension SwiftClass &#123; func foo() &#123; &#125; //åŒ…å«éšå¼çš„ @objc func bar() &#123; &#125; //åŒ…å«éšå¼çš„ @objc&#125; ï¼ˆ5ï¼‰å¦‚æœåœ¨æ‰©å±•ï¼ˆextensionï¼‰å‰åŠ ä¸Š @nonobjcï¼Œé‚£ä¹ˆè¯¥æ‰©å±•é‡Œçš„æ–¹æ³•éƒ½ä¸ä¼šéšå¼çš„åŠ ä¸Š @objcã€‚12345678@objcMembersclass MyClass : NSObject &#123; func wibble() &#123; &#125; //åŒ…å«éšå¼çš„ @objc&#125; @nonobjc extension MyClass &#123; func wobble() &#123; &#125; //ä¸ä¼šåŒ…å«éšå¼çš„ @objc&#125;","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"Swift","slug":"Swift","permalink":"https://reversescale.github.io/tags/Swift/"}]},{"title":"ç§»åŠ¨ç«¯ iOS å¹´ç»ˆå·¥ä½œæ€»ç»“ - çº¯å¹²è´§è¯·è‡ªå¤‡é…’æ°´","slug":"iOS 2017","date":"2018-02-26T15:56:27.000Z","updated":"2018-11-16T12:08:25.843Z","comments":true,"path":"2018/02/26/iOS 2017/","link":"","permalink":"https://reversescale.github.io/2018/02/26/iOS 2017/","excerpt":"æ—¶é—´åŒ†åŒ†ï¼Œä¸€è½¬çœ¼ 2017 å¹´å·²ç»è¿‡å»äº†ï¼Œè¿™ä¸€å¹´ä¾æ—§åœ¨ä¸æ–­å­¦ä¹ ï¼Œåšç§¯è€Œè–„å‘~","text":"æ—¶é—´åŒ†åŒ†ï¼Œä¸€è½¬çœ¼ 2017 å¹´å·²ç»è¿‡å»äº†ï¼Œè¿™ä¸€å¹´ä¾æ—§åœ¨ä¸æ–­å­¦ä¹ ï¼Œåšç§¯è€Œè–„å‘~ ä¸»é¢˜ï¼šå‘å±• å†…å®¹å¤§çº²è§‚ç‚¹ï¼š Swift å‘å±•è§‚ ReactNative å‘å±•è§‚ è¿›é˜¶ï¼š æ¨¡å—åŒ– Pods ä¾èµ–åº“åŠç»„ä»¶åŒ– ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ + è‡ªåŠ¨åŒ–æ‰“åŒ…æµ‹è¯• + çº¿ä¸Šè´¨é‡ç›‘æ§ ç®¡ç†ï¼š å›¢é˜Ÿæ ¸å¿ƒç»„æˆæ¶æ„ ç¡¬ä»¶è®¾å¤‡æŠ•å…¥ ä¾‹ä¼šå’Œæ–‡æ¡£åŒ– ç»„ç»‡ CodeReview å·¥å…·ï¼š Gitlab åŠ Git ç›¸å…³è§„èŒƒ Sketch è®¾è®¡å·¥å…· + Zeplin æ ‡æ³¨å·¥å…· æˆæœï¼š Github åŸåˆ›å¼€æºé¡¹ç›® 90+ï¼Œå…±è®¡ 400+ è´¡çŒ®åŠ› å‚ä¸ç»´æŠ¤å¼€æºé¡¹ç›® fastlane 20.5kï¼ˆè‡³2018.02.08ï¼‰ å®Œæˆ Swifter åŠŸèƒ½å±•ç¤ºåº”ç”¨ç ”å‘ è§‚ç‚¹Swift å‘å±•è§‚Apple åœ¨ WWDC 2017 å¤§ä¼šä¸Šå‘å¸ƒ Swift 4ï¼ŒSwift 4 å¸¦æ¥äº†æ›´å¿«ã€æ›´å®¹æ˜“ä½¿ç”¨çš„ String å®ç°ï¼Œå¯ä»¥ä¿æŒ Unicode çš„æ­£ç¡®æ€§ï¼Œå¹¶å¢åŠ å¯¹åˆ›å»ºã€ä½¿ç”¨å¹¿å‘Šç®¡ç†å­ä¸²çš„æ”¯æŒï¼Œå®ƒæé«˜äº†å¼€å‘è€…åˆ›å»ºã€ä½¿ç”¨å’Œç®¡ç†é›†åˆç±»å‹çš„èƒ½åŠ›ï¼Œå®ƒæ”¯æŒç»“æ„åŒ–æšä¸¾ç±»å‹çš„å½’æ¡£å¹¶å…è®¸å¯¹å¤–éƒ¨æ ¼å¼è¿›è¡Œç±»å‹å®‰å…¨çš„åºåˆ—åŒ–ï¼ŒåŒ…æ‹¬ JSON å’Œ plistã€‚ æ—¢ç„¶æåˆ°äº† WWDCï¼ˆhttps://developer.apple.com/wwdc/ï¼‰ï¼Œç›¸ä¿¡ Swift çš„å‘å±•è§‚å°±æ²¡æœ‰å¤ªå¤šäº‰è®®äº†ï¼Œè¿‘å‡ å¹´æ‰€æœ‰çš„å®˜æ–¹æ¼”ç¤ºè§†é¢‘éƒ½æ˜¯åŸºäº Swift æ¥æ¼”ç¤ºçš„ï¼Œä½œä¸º iOS çš„å¼€å‘äººå‘˜å¯èƒ½ä¼šç»§ç»­ä½¿ç”¨ Objective-Cï¼Œä½†æ˜¯å¦‚æœå¯¹ Swift æ˜¯æŒæŠ—æ‹’å¿ƒç†çš„ï¼Œé‚£æ— ç–‘å¯¹è‡ªèº«å‘å±•æ˜¯ä¸è´Ÿè´£ä»»çš„ã€‚ Apple äº 2017 å¹´å®£å¸ƒ Swift 5 åä¼šé”å®š ABIï¼Œä¹Ÿå°±æ ‡å¿—ç€è¿™é—¨è¯­è¨€ä¼šæ­£å¼ä½œä¸º iOSã€macOS çš„ä¸»æµè¯­è¨€ã€‚åŒå¹´ 12 æœˆï¼ŒApple å®£å¸ƒä¼šç€æ‰‹è®¡åˆ’ iOS å’Œ macOS çš„åº”ç”¨å±‚é¢åˆå¹¶ã€‚é…åˆ Apple ä¸€ç›´ä»¥æ¥çš„å¯¹ Swift å¹¼å„¿æ•™è‚²ä»¥åŠåœ¨ AIã€AR ç­‰é¢†åŸŸçš„æ¨è¿›ï¼Œä¸éš¾çœ‹å‡ºè¿™é—¨è¯­è¨€æœªæ¥çš„å‘å±•æ½œåŠ›ã€‚ ReactNative å‘å±•è§‚æåˆ° ReactNative å°±ä¸å¾—ä¸è¯´ FaceBookï¼Œå…¶å®ç°åœ¨ä¸»æµçš„ç§»åŠ¨ç«¯å¼€å‘è§„èŒƒå°±æ˜¯è¿™å®¶å…¬å¸è®¾è®¡çš„ã€‚å½“ç„¶é™¤äº† React ç¤¾åŒºç”Ÿæ€åœˆçš„åŠ æŒå’Œ Facebook çš„å¤§åŠ›æ¨å¹¿ä»¥å¤–ï¼Œå¦å¤–ä¸€ä¸ªæœ€ä¸»è¦çš„åŸå› å°±æ˜¯å…¶åœ¨å¼€å‘æ•ˆç‡å’Œåº”ç”¨æ€§èƒ½æ–¹é¢å–å¾—äº†ä¸€ä¸ªæ¯”è¾ƒå¥½çš„å¹³è¡¡ï¼š å¼€å‘æ•ˆç‡é€šè¿‡ JS å·¥ç¨‹å®è·µï¼Œé€»è¾‘è·¨å¹³å°å¤ç”¨å¾—åˆ°æå¤§æå‡ æ€§èƒ½åˆ™é€šè¿‡å…¨ Native çš„ UI å±‚å¾—åˆ°æ»¡è¶³ è·¨å¹³å°è¿™ä¸€ç‰¹æ€§å¯¹äºå°å…¬å¸çš„å¸å¼•åŠ›åˆ™æ›´ä½“ç°åœ¨èŠ‚çº¦ç”¨äººæˆæœ¬ä¸Šï¼Œå¯¹ç®€å•çš„éœ€æ±‚èƒ½åšåˆ°ä¸€ç«¯å¤šç”¨ï¼Œéšæ—¶å˜æ›´çº¿ä¸Šå†…å®¹ã€‚ å¯¹äºå·²ç»æ­£åœ¨è¿è¥çš„é¡¹ç›®ï¼Œå®Œå…¨åˆ‡ ReactNative æ€»æ˜¯ä¸å¤ªç°å®ï¼Œå…¶å®å¤§å¤šæ•°å‚å•†çš„æ–¹æ³•æ˜¯å¯¹è¿è¥å¼•æµæœ‰å½±å“çš„å…³é”®æ€§é¡µé¢ï¼ˆå¦‚ï¼šé¦–é¡µï¼‰è¿›è¡Œ ReactNative æ”¹ç‰ˆï¼Œè¿™é‡Œå¯èƒ½å°±ä¼šå¼•å…¥ä¸€ä¸ª æ¨¡å—åŒ– çš„æ¦‚å¿µï¼Œåé¢ä¼šæœ‰è®²åˆ°ã€‚ å¯¹äºæƒ³è¦å…¥é—¨çš„æœ‹å‹ï¼Œæ…•è¯¾ç½‘ä¸Šä¸€ä¸ªå…¥é—¨çº§ ReactNative æ•™å­¦è¿˜ä¸é”™ã€‚ æ•™å­¦è§†é¢‘ï¼šhttp://coding.imooc.com/class/89.html æºç ï¼šhttps://github.com/crazycodeboy/GitHubPopular/ è¿›é˜¶æ¨¡å—åŒ–æ¨¡å—åŒ–ã€ç»„ä»¶åŒ–æˆ‘ååŠå¹´ä¸€ç›´åœ¨è°ƒç ”çš„è¯¾é¢˜ï¼Œå¯¹è¿™äº›çš„ç ”ç©¶ä¹Ÿç»™æˆ‘å¸¦æ¥äº†ä»é‡å˜åˆ°è´¨å˜çš„æå‡ã€‚ ä»€ä¹ˆæ˜¯æ¨¡å—åŒ–ï¼Ÿ é‚£ä¹ˆä»€ä¹ˆæ˜¯æ¨¡å—åŒ–å‘¢ï¼Ÿã€Š Java åº”ç”¨æ¶æ„è®¾è®¡ï¼šæ¨¡å—åŒ–æ¨¡å¼ä¸ OSGi ã€‹ä¸€ä¹¦ä¸­å¯¹å®ƒçš„å®šä¹‰æ˜¯ï¼šæ¨¡å—åŒ–æ˜¯ä¸€ç§å¤„ç†å¤æ‚ç³»ç»Ÿåˆ†è§£ä¸ºæ›´å¥½çš„å¯ç®¡ç†æ¨¡å—çš„æ–¹å¼ã€‚ æˆ‘ä»¬å¯ä»¥æŠŠè½¯ä»¶çœ‹åšæ˜¯ä¸€è¾†æ±½è½¦ï¼Œå¼€å‘ä¸€æ¬¾è½¯ä»¶çš„è¿‡ç¨‹å°±æ˜¯ç”Ÿäº§ä¸€è¾†æ±½è½¦çš„è¿‡ç¨‹ã€‚ä¸€è¾†æ±½è½¦ç”±è½¦æ¶ã€å‘åŠ¨æœºã€å˜æ•°ç®±ã€è½¦è½®ç­‰ä¸€ç³»åˆ—æ¨¡å—ç»„æˆï¼›åŒæ ·ï¼Œä¸€æ¬¾å¤§å‹å•†ä¸šè½¯ä»¶ä¹Ÿæ˜¯ç”±å„ä¸ªä¸åŒçš„æ¨¡å—ç»„æˆçš„ã€‚ æ±½è½¦çš„è¿™äº›æ¨¡å—æ˜¯ç”±ä¸åŒçš„å·¥å‚ç”Ÿäº§çš„ï¼Œä¸€è¾† BMW çš„å‘åŠ¨æœºå¯èƒ½æ˜¯ç”±ä½äºå¾·å›½çš„å·¥å‚ç”Ÿäº§çš„ï¼Œå®ƒçš„è‡ªåŠ¨å˜æ•°ç®±å¯èƒ½æ˜¯ Jatcoï¼ˆä¸–ç•Œä¸‰å¤§å˜é€Ÿç®±å‚å•†ä¹‹ä¸€ï¼‰ä½äºæ—¥æœ¬çš„å·¥å‚ç”Ÿäº§çš„ï¼Œè½¦è½®å¯èƒ½æ˜¯ä¸­å›½çš„å·¥å‚ç”Ÿäº§çš„ï¼Œæœ€åäº¤ç»™åæ™¨å®é©¬çš„å·¥å‚ç»Ÿä¸€ç»„è£…æˆä¸€è¾†å®Œæ•´çš„æ±½è½¦ã€‚è¿™å°±ç±»ä¼¼äºæˆ‘ä»¬åœ¨è½¯ä»¶å·¥ç¨‹é¢†åŸŸé‡Œè¯´çš„å¤šå›¢é˜Ÿå¹¶è¡Œå¼€å‘ï¼Œæœ€åå°†å„ä¸ªå›¢é˜Ÿå¼€å‘çš„æ¨¡å—ç»Ÿä¸€æ‰“åŒ…æˆæˆ‘ä»¬å¯ä½¿ç”¨çš„ App ã€‚ ä¸€æ¬¾å‘åŠ¨æœºã€ä¸€æ¬¾å˜æ•°ç®±éƒ½ä¸å¯èƒ½åªåº”ç”¨äºä¸€ä¸ªè½¦å‹ï¼Œæ¯”å¦‚åŒä¸€æ¬¾ Jatco çš„ 6AT è‡ªåŠ¨å˜é€Ÿç®±æ—¢å¯èƒ½è¢«å®‰è£…åœ¨ BMW çš„è½¦å‹ä¸Šï¼Œä¹Ÿå¯èƒ½è¢«å®‰è£…åœ¨ Mazda çš„è½¦å‹ä¸Šã€‚è¿™å°±å¦‚åŒè½¯ä»¶å¼€å‘é¢†åŸŸé‡Œçš„æ¨¡å—é‡ç”¨ã€‚ åˆ°äº†å†¬å¤©ï¼Œç‰¹åˆ«æ˜¯åœ¨åŒ—æ–¹æˆ‘ä»¬å¯èƒ½éœ€è¦å¼€ç€è½¦èµ°é›ªè·¯ï¼Œä¸ºäº†å®‰å…¨èµ·è§å¾€å¾€æˆ‘ä»¬ä¼šå°†æ±½è½¦çš„å…¬è·¯èƒå‡çº§ä¸ºé›ªåœ°èƒï¼›è½®èƒå¯ä»¥å¾ˆè½»æ˜“çš„æ›´æ¢ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸè°ˆåˆ°çš„ä½è€¦åˆã€‚ä¸€ä¸ªæ¨¡å—çš„å‡çº§æ›¿æ¢ä¸ä¼šå½±å“åˆ°å…¶å®ƒæ¨¡å—ï¼Œä¹Ÿä¸ä¼šå—å…¶å®ƒæ¨¡å—çš„é™åˆ¶ï¼›åŒæ—¶è¿™ä¹Ÿç±»ä¼¼äºæˆ‘ä»¬åœ¨è½¯ä»¶å¼€å‘é¢†åŸŸæåˆ°çš„å¯æ’æ‹”ã€‚ 20180906 æ›´æ–° å†è°ˆæ¨¡å—åŒ–ã€ç»„ä»¶åŒ–ã€æ’ä»¶åŒ–å®šä¹‰ æ¨¡å—åŒ–ï¼šä¸€ä¸ªå¯å®ç°çš„å•å…ƒï¼Œæ ¸å¿ƒæ˜¯å†…èšå’Œåˆ†ç¦»ï¼Œå¦‚ç™»å½•æ¨¡å—çš„æŠ½ç¦» ç»„ä»¶åŒ–ï¼šä¹Ÿç§°æ„ä»¶ï¼Œæœ€ç†æƒ³æƒ…å†µä¸‹æ˜¯ä¸ä¸šåŠ¡æ— å…³ï¼Œå¼ºè°ƒå¤ç”¨ï¼Œå¦‚å¯å¤ç”¨ Library æ’ä»¶åŒ–ï¼šä¸ç»„ä»¶åŒ–ä¸åŒï¼Œç»„ä»¶åŒ–åœ¨ç¼–è¯‘æ—¶åˆå¹¶æ¨¡å—ï¼Œæ’ä»¶åŒ–åœ¨è¿è¡Œæ—¶åˆå¹¶æ¨¡å—ï¼Œå¦‚å¯å®ç°è¿œç¨‹æ›¿æ¢åŠŸèƒ½ æ¨¡å—åŒ–åˆ†å±‚è®¾è®¡ ä¸Šé¢çš„ç±»æ¯”å¾ˆæ¸…æ™°çš„è¯´æ˜çš„æ¨¡å—åŒ–å¸¦æ¥çš„å¥½å¤„ï¼š å¤šå›¢é˜Ÿå¹¶è¡Œå¼€å‘æµ‹è¯•ï¼› æ¨¡å—é—´è§£è€¦ã€é‡ç”¨ï¼› å¯å•ç‹¬ç¼–è¯‘æ‰“åŒ…æŸä¸€æ¨¡å—ï¼Œæå‡å¼€å‘æ•ˆç‡ã€‚ åœ¨ã€Šå®‰å±…å®¢ Android é¡¹ç›®æ¶æ„æ¼”è¿›ã€‹è¿™ç¯‡æ–‡ç« ä¸­ï¼Œä½œè€…ä»‹ç»äº†å®‰å±…å®¢ Android ç«¯çš„æ¨¡å—åŒ–è®¾è®¡æ–¹æ¡ˆï¼Œè¿™é‡Œä½œè€…è¿˜æ˜¯æ‹¿å®ƒæ¥ä¸¾ä¾‹ã€‚ä½†é¦–å…ˆè¦å¯¹æœ¬æ–‡ä¸­çš„ç»„ä»¶å’Œæ¨¡å—åšä¸ªåŒºåˆ«å®šä¹‰ï¼š ç»„ä»¶ï¼šæŒ‡çš„æ˜¯å•ä¸€çš„åŠŸèƒ½ç»„ä»¶ï¼Œå¦‚åœ°å›¾ç»„ä»¶ï¼ˆMapSDKï¼‰ã€æ”¯ä»˜ç»„ä»¶ï¼ˆAnjukePayï¼‰ã€è·¯ç”±ç»„ä»¶ï¼ˆRouterï¼‰ç­‰ç­‰ï¼› æ¨¡å—ï¼šæŒ‡çš„æ˜¯ç‹¬ç«‹çš„ä¸šåŠ¡æ¨¡å—ï¼Œå¦‚æ–°æˆ¿æ¨¡å—ï¼ˆNewHouseModuleï¼‰ã€äºŒæ‰‹æˆ¿æ¨¡å—ï¼ˆSecondHouseModuleï¼‰ã€å³æ—¶é€šè®¯æ¨¡å—ï¼ˆInstantMessagingModuleï¼‰ç­‰ç­‰ï¼›æ¨¡å—ç›¸å¯¹äºç»„ä»¶æ¥è¯´ç²’åº¦æ›´å¤§ã€‚ é’ˆå¯¹æ¨¡å—åŒ–ä½œè€…çš„å›¢é˜Ÿä¹Ÿå®šä¹‰äº†ä¸€äº›è‡ªå·±çš„æ¸¸æˆè§„åˆ™: å¯¹äº Business Module Layerï¼Œå„ä¸šåŠ¡æ¨¡å—ä¹‹é—´ä¸å…è®¸å­˜åœ¨ç›¸äº’ä¾èµ–å…³ç³»ï¼Œå®ƒä»¬ä¹‹é—´çš„è·³è½¬é€šè®¯é‡‡ç”¨è·¯ç”±æ¡†æ¶ Router æ¥å®ç°ï¼ˆåé¢ä¼šä»‹ç» Router æ¡†æ¶çš„å®ç°ï¼‰; å¯¹äº Business Component Layerï¼Œå•ä¸€ä¸šåŠ¡ç»„ä»¶åªèƒ½å¯¹åº”æŸä¸€é¡¹å…·ä½“çš„ä¸šåŠ¡ï¼Œä¸ªæ€§åŒ–éœ€æ±‚å¯¹å¤–éƒ¨æä¾›æ¥å£è®©è°ƒç”¨æ–¹å®šåˆ¶; åˆç†æ§åˆ¶å„ç»„ä»¶å’Œå„ä¸šåŠ¡æ¨¡å—çš„æ‹†åˆ†ç²’åº¦ï¼Œå¤ªå°çš„å…¬æœ‰æ¨¡å—ä¸è¶³ä»¥æ„æˆå•ç‹¬ç»„ä»¶æˆ–è€…æ¨¡å—çš„ï¼Œä½œè€…å…ˆæ”¾åˆ°ç±»ä¼¼äº CommonBusiness çš„ç»„ä»¶ä¸­ï¼Œåœ¨åæœŸä¸æ–­çš„é‡æ„è¿­ä»£ä¸­è§†æƒ…å†µè¿›è¡Œè¿›ä¸€æ­¥çš„æ‹†åˆ†; ä¸Šå±‚çš„å…¬æœ‰ä¸šåŠ¡æˆ–è€…åŠŸèƒ½æ¨¡å—å¯ä»¥é€æ­¥ä¸‹æ”¾åˆ°ä¸‹å±‚ï¼Œåˆç†æŠŠæ¡å¥½åº¦å°±å¥½ï¼› å„ Layer é—´ä¸¥ç¦åå‘ä¾èµ–ï¼Œæ¨ªå‘ä¾èµ–å…³ç³»ç”±å„ä¸šåŠ¡ Leader å’ŒæŠ€æœ¯å°ç»„å•†è®¨å†³å®šã€‚ è‡ªä» Oasis Feng åœ¨å»å¹´çš„ MDCC2016 ä¸Šåˆ†äº«äº†æ¨¡å—åŒ–çš„ç»éªŒåï¼Œæ¨¡å—åŒ–åœ¨ Android ç¤¾åŒºè¶Šæ¥è¶Šå¤šçš„è¢«æèµ·ã€‚ä½œè€…è‡ªç„¶ä¹Ÿä¸è½ä¿—çš„å»åšäº†ä¸€äº›ç ”ç©¶å’Œæ¢ç´¢ã€‚å®‰å±…å®¢ç°åœ¨é¢ä¸´å¾ˆå¤šé—®é¢˜ï¼šä¾‹å¦‚å…¨é‡ç¼–è¯‘æ—¶é—´å¤ªé•¿ï¼ˆæˆ‘è¿™å°13æ¬¾çš„ MacBook Pro ä¸Šæ‰“ä¸€æ¬¡åŒ…å¾—èŠ±åå¤šåˆ†é’Ÿï¼‰ï¼›ä¾‹å¦‚æ–°æˆ¿ã€äºŒæ‰‹æˆ¿ã€ç§Ÿæˆ¿ç­‰ç­‰æ¨¡å—é—´è€¦åˆä¸¥é‡ï¼Œä¸åˆ©äºå¤šå›¢é˜Ÿå¹¶è¡Œå¼€å‘æµ‹è¯•ï¼›å¦å¤–åœ¨17å¹´åˆå®‰å±…å®¢é‡æ–°å°†ç§Ÿæˆ¿ App æ¡èµ·æ¨å¹¿ï¼Œå•ç‹¬è®©äººæ¥å¼€å‘ç»´æŠ¤ä¸€ä¸ªä¸‰å¹´å‰çš„é¡¹ç›®å¹¶ä¸åˆ’ç®—ï¼Œæ‰€ä»¥ä½œè€…å¸Œæœ›èƒ½ç›´æ¥ä»ç°åœ¨çš„å®‰å±…å®¢ç”¨æˆ·ç«¯ä¸­æ‹†åˆ†å‡ºç§Ÿæˆ¿æ¨¡å—ä½œä¸ºä¸€ä¸ªå•ç‹¬çš„ App å‘å¸ƒä¸Šçº¿ã€‚è¿™æ ·çœ‹æ¥æ¨¡å—åŒ–ä¼¼ä¹æ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚ æ‰€ä»¥ä½œè€…åšæ¨¡å—åŒ–çš„ç›®çš„å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š ä¸šåŠ¡æ¨¡å—é—´è§£è€¦ å•ä¸ªä¸šåŠ¡æ¨¡å—å•ç‹¬ç¼–è¯‘æ‰“åŒ…ï¼ŒåŠ å¿«ç¼–è¯‘é€Ÿåº¦ å¤šå›¢é˜Ÿé—´å¹¶è¡Œå¼€å‘ã€æµ‹è¯• è§£å†³å¥½ç§ŸAppéœ€è¦å•ç‹¬ç»´æŠ¤çš„é—®é¢˜ï¼Œé™ä½ç ”å‘æˆæœ¬ å…³äºæ¨¡å—åŒ–ç»„ä»¶åŒ–çš„ç”ŸåŠ¨è§£è¯»æ¥è‡ªå®‰å±…å®¢ Android ç»„ç»„é•¿å¼ ç£Šçš„åšå®¢ http://baronzhang.com Pods ä¾èµ–åº“åŠç»„ä»¶åŒ–ç»„ä»¶åŒ–ä¸æ¨¡å—åŒ–å®‰å±…å®¢çš„ Android å›¢é˜Ÿå†…éƒ¨æˆç«‹äº†æŠ€æœ¯å°ç»„ï¼ŒåŸºç¡€ç»„ä»¶çš„å¼€å‘æ˜¯æŠ€æœ¯å°ç»„å¾ˆé‡è¦çš„ä¸€éƒ¨åˆ†å·¥ä½œï¼›æ¨¡å—åŒ–æ›´å¤šçš„æ˜¯ç°æœ‰çš„æ–¹æ¡ˆå—åˆ°æ¥è‡ªä¸šåŠ¡ä¸Šçš„æŒ‘æˆ˜ä»¥åŠå—åˆ°äº† Oasis Feng åœ¨ MDCC ä¸Šçš„åˆ†äº«å’Œæ•´ä¸ªå¤§ç¯å¢ƒçš„å¯å‘ï¼Œç°åœ¨æ­£å¤„äºè®¾è®¡è§„åˆ’å’Œ Demo å¼€å‘çš„é˜¶æ®µã€‚ ç»„ä»¶åŒ–ç»„ä»¶åŒ–ä¸æ˜¯ä¸ªæ–°æ¦‚å¿µï¼Œé€šä¿—çš„è®²ç»„ä»¶åŒ–å°±æ˜¯åŸºäºå¯é‡ç”¨çš„ç›®çš„ï¼Œå°†ä¸€ä¸ªå¤§çš„è½¯ä»¶ç³»ç»Ÿæ‹†åˆ†æˆä¸€ä¸ªä¸ªç‹¬ç«‹ç»„ä»¶ã€‚ ç»„ä»¶åŒ–çš„å¸¦æ¥çš„å¥½å¤„ä¸è¨€è€Œå–»ï¼š é¿å…é‡å¤é€ è½®å­ï¼ŒèŠ‚çœå¼€å‘ç»´æŠ¤æˆæœ¬ï¼› é™ä½é¡¹ç›®å¤æ‚æ€§ï¼Œæå‡å¼€å‘æ•ˆç‡ï¼› å¤šä¸ªå›¢é˜Ÿå…¬ç”¨åŒä¸€ä¸ªç»„ä»¶ï¼Œåœ¨ä¸€å®šå±‚åº¦ä¸Šç¡®ä¿äº†æŠ€æœ¯æ–¹æ¡ˆçš„ç»Ÿä¸€æ€§ã€‚ ç°åœ¨çš„å®‰å±…å®¢æœ‰æ˜¯ä¸‰ä¸ªä¸šåŠ¡å›¢é˜Ÿï¼šå®‰å±…å®¢ç”¨æˆ· Appã€ç»çºªäºº Appã€é›†å®¢å®¶ Appã€‚ä¸ºäº†é¿å…å„ä¸ªä¸šåŠ¡å›¢é˜Ÿé‡å¤é€ è½®å­ï¼Œå›¢é˜Ÿä¸­ä¹Ÿéœ€è¦æœ‰ä¸€å®šçš„æŠ€æœ¯æ²‰æ·€ï¼Œå› æ­¤ç»„ä»¶åŒ–æ˜¯å¿…é¡»çš„ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦æä¾›æ›´å¤šçš„ã€èŒèƒ½å•ä¸€ã€æ€§èƒ½æ›´ä¼˜çš„ç»„ä»¶ä¾›ä¸šåŠ¡å›¢é˜Ÿä½¿ç”¨ã€‚æ ¹æ®ä¸šåŠ¡ç›¸å…³æ€§ï¼Œæˆ‘ä»¬å°†è¿™äº›ç»„ä»¶åˆ†ä¸ºï¼šåŸºç¡€ç»„ä»¶å’Œä¸šåŠ¡ç»„ä»¶ã€‚ é˜¿é‡Œæ¶æ„ç»„åŒæ ·æ˜¯ç»„ä»¶åŒ–çš„å…ˆé©±è€…ï¼Œä»¥ä¸‹æ˜¯é˜¿é‡Œæ¶æ„ç»„ Evans å¯¹ç»„ä»¶åŒ–çš„è§‚ç‚¹ï¼š é¦–å…ˆï¼Œæˆ‘çš„ç†è§£åˆ†å—åŒ–åº”è¯¥æ˜¯æœ‰å››ç§ï¼Œç»„ä»¶åŒ–+æ¨¡å—åŒ–+æ’ä»¶åŒ–+è§£è€¦ ç¬¬ä¸€ï¼Œç»„ä»¶å’Œç»„ä»¶å…¶å®æ˜¯æ²¡æœ‰ä»€ä¹ˆé¬¼æ˜ç¡®çš„çº¦æŸ ï¼Œå› ä¸ºç»„ä»¶ä¸€èˆ¬éƒ½æ˜¯å•ç‹¬å¼€å‘ã€å•ç‹¬æµ‹è¯•ï¼Œä¸èƒ½ç›´æ¥æ”¾åˆ°ä¸»é¡¹ç›®ä¸­å¼€å‘ï¼Œæµ‹è¯•ä¹Ÿæ˜¯å•ç‹¬é’ˆå¯¹æ€§çš„æµ‹è¯• ï¼ˆé‡Œé¢æ¶‰åŠåˆ°çŸ­é“¾+ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸ+â€¦.ï¼‰ ç¬¬äºŒï¼Œæ¨¡å—åŒ–æˆ‘çš„ç†è§£æ˜¯ï¼Œæ€ä¹ˆåšå¥½projectçš„æ¨¡å—åŒ–çš„æ‹†åˆ†ï¼Œæˆ‘ä»¬å†…éƒ¨ä¸€ç›´åœ¨è¯´è¶Šåº•å±‚çš„æ¨¡å—ï¼Œåº”è¯¥è¶Šç¨³å®šï¼Œè¶ŠæŠ½è±¡ï¼Œè¶Šå…·æœ‰é«˜å¤ç”¨åº¦ï¼Œä½†æ˜¯å…¶å®æœ‰ä¸€ä¸ªå£å’å°±æ˜¯æ€ä¹ˆå»æå‡æ¨¡å—çš„å¤ç”¨åº¦ï¼Œæ€ä¹ˆå»å¿«é€Ÿå…·å¤‡å¤ç”¨æ€§é«˜äºä»£ç å¤ç”¨æ€§ï¼Œè¿™æˆ‘ä»¬å°±è¦åšå¥½æ¯ä¸ªæ¨¡å—åªåšå¥½ä¸€ä»¶äº‹æƒ…ï¼Œæ¨¡å—åŒ–ç»“æ„è¦æ›´åŠ æ¸…æ™°ï¼Œæ¯ä¸ªæ¨¡å—éƒ½åªåšä¸€ä»¶äº‹æƒ…ï¼Œå…·æœ‰è‰¯å¥½çš„å»¶å±•æ€§å’Œæ‹“å±•æ€§ï¼Œä½†æ„¿ä¸è¦å‡ºç°ä¸‹å±‚æ¨¡å—ä¾èµ–ä¸Šå±‚æ¨¡å—çš„ç°è±¡ï¼Œä¸šåŠ¡æ¨¡å—ä¹‹é—´ä¹Ÿå°½é‡ä¸è¦è€¦åˆã€‚å¥½å¤„æ˜¯åŒæ ·çš„åŠŸèƒ½æ¨¡å—ï¼Œå¯ä»¥åœ¨å¤šä¸ªappä¸­å¤ç”¨ï¼Œä¸šåŠ¡éš”ç¦»äº†è·¨å›¢é˜Ÿå¼€å‘ä»£ç æ§åˆ¶å’Œç‰ˆæœ¬é£é™©éƒ½å˜å°äº†ã€‚ ç¬¬ä¸‰ï¼Œè§£è€¦å…¶å®ç†è§£å¾ˆç®€å•å°±æ˜¯åœ¨åŸºäºæ¨¡å—è®¾è®¡åŸåˆ™ä¸Š, è®©æ¨¡å—ä¹‹é—´æ²¡æœ‰å¾ªç¯ä¾èµ–, è®©ä¸šåŠ¡æ¨¡å—ä¹‹é—´è§£é™¤ä¾èµ–ï¼Œä¸ç›¸äº’è°ƒç”¨ã€‚ æ¦‚å†µçš„ç†è§£å°±æ˜¯ ç»„ä»¶åŒ–ï¼šå•ç‹¬å¼€å‘ã€æµ‹è¯•ã€ç»´æŠ¤çš„å¼€å‘æ¨¡å¼ æ¨¡å—åŒ–ï¼šå¯¹ Project è¿›è¡Œæ‹†åˆ†ï¼Œæ ¹æ®ä¸šåŠ¡ã€åŠŸèƒ½è¿›è¡Œåˆ†ç±» è§£è€¦ï¼šæ¨¡å—è®¾è®¡åŸåˆ™ä¸Š, è®©æ¨¡å—ä¹‹é—´æ²¡æœ‰éå¿…è¦ä¾èµ– è€Œç»„ä»¶åŒ–ç°åœ¨ä¸»æµçš„åšæ³•æ˜¯é€šè¿‡ CocoaPods å¯¹è¦åŒ…è£…çš„å†…å®¹è¿›è¡Œæ‰“åŒ…ï¼Œæäº¤åˆ°å…¬å¸çš„ç§æœ‰åº“ï¼ˆå¼€æºé¡¹ç›®æ˜¯å…¬æœ‰åº“ï¼‰ï¼Œè¿›è¡Œæ—¥å¸¸ç»´æŠ¤åŠå¼€å‘ã€‚ ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ + è‡ªåŠ¨åŒ–æ‰“åŒ…æµ‹è¯• + çº¿ä¸Šè´¨é‡ç›‘æ§ç¯å¢ƒè‡ªåŠ¨åˆ‡æ¢ Debug å’Œ Release ä»…ä»…æ˜¯ç¼–è¯‘é€‰é¡¹çš„ä¸åŒï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¦åŒºåˆ† Debug å’Œ Release ç‰ˆæœ¬å‘¢ï¼Ÿ Debug å’Œ Releaseï¼Œä¸»è¦æ˜¯é’ˆå¯¹å…¶é¢å‘çš„ç›®æ ‡ä¸åŒçš„è€Œè¿›è¡ŒåŒºåˆ†çš„ã€‚ Debug é€šå¸¸ç§°ä¸ºè°ƒè¯•ç‰ˆæœ¬ï¼Œé€šè¿‡ä¸€ç³»åˆ—ç¼–è¯‘é€‰é¡¹çš„é…åˆï¼Œç¼–è¯‘çš„ç»“æœé€šå¸¸åŒ…å«è°ƒè¯•ä¿¡æ¯ï¼Œè€Œä¸”ä¸åšä»»ä½•ä¼˜åŒ–ï¼Œä¸ºå¼€å‘äººå‘˜æä¾›å¼ºå¤§çš„åº”ç”¨ç¨‹åºè°ƒè¯•èƒ½åŠ›ã€‚ è€Œ Release é€šå¸¸ç§°ä¸ºå‘å¸ƒç‰ˆæœ¬ï¼Œæ˜¯ä¸ºç”¨æˆ·ä½¿ç”¨çš„ï¼Œä¸€èˆ¬å®¢æˆ·ä¸å…è®¸åœ¨å‘å¸ƒç‰ˆæœ¬ä¸Šè¿›è¡Œè°ƒè¯•ã€‚æ‰€ä»¥ä¸ä¿å­˜è°ƒè¯•ä¿¡æ¯ï¼ŒåŒæ—¶ï¼Œå®ƒå¾€å¾€è¿›è¡Œäº†å„ç§ä¼˜åŒ–ï¼Œä»¥æœŸè¾¾åˆ°ä»£ç æœ€å°å’Œé€Ÿåº¦æœ€ä¼˜ã€‚ä¸ºç”¨æˆ·çš„ä½¿ç”¨æä¾›ä¾¿åˆ©ã€‚ å¯¹äºä¸€äº›ä¼ä¸šç‰ˆåº”ç”¨æˆ–è€…æœ‰å†…éƒ¨æµ‹è¯•çš„éœ€æ±‚å…¶å®è¿˜å¯ä»¥æ–°å¢ Beta ç‰ˆï¼Œæ”¶é›†æ ¸å¿ƒç”¨æˆ·çš„å»ºè®®æˆ–è€…æµ‹è¯•æ–°å¼€å‘çš„åŠŸèƒ½æ¨¡å—ï¼Œå¯¹åé¦ˆåšå‡ºè¿…é€Ÿååº”ï¼Œçµæ´»æ§åˆ¶ã€‚ ç”±äºä¹‹å‰å¼•å…¥äº†ç»„ä»¶åŒ–å¼€å‘æ¨¡å¼ï¼Œæ‰€æœ‰æˆ‘åˆåŠ å…¥äº† UnitTestï¼ˆå•å…ƒæµ‹è¯•ï¼‰æ¨¡å¼ï¼Œåªè¦ç”¨äºå¯¹ç»„ä»¶çš„åˆ†ç¦»åŒ–æµ‹è¯•ï¼Œå¿«é€Ÿå®šä½é—®é¢˜ã€‚ åˆ‡æ¢ç¯å¢ƒçš„åŒæ—¶ä¼šå¯¹åº”åˆ‡æ¢åº”ç”¨çš„å›¾æ ‡ï¼Œèƒ½æœ‰æ•ˆé¿å…æµ‹è¯•ç¯èŠ‚ä¸­çš„ç¯å¢ƒæ··æ·†å’Œé™ä½è¾¨åˆ«æˆæœ¬ã€‚ è‡ªåŠ¨åŒ–æ‰“åŒ…æµ‹è¯• å…³äºè‡ªåŠ¨åŒ–æ‰“åŒ…å°±ä¸å¾—ä¸è¯´åœ¨åˆ›ä¸šå…¬å¸çš„ç»å†ï¼Œé‚£æ—¶å¼€å‘ä»»åŠ¡é‡ï¼Œææµ‹å‰å¸¸å¸¸åŠ ç­åˆ°æ™šä¸Š 12 ç‚¹ï¼Œå°±ç®— bug ä¿®å®Œï¼Œä¹Ÿè¦ç­‰åŠä¸ªå°æ—¶çœ‹ç€ Xcode ä¸æ…Œä¸å¿™çš„æ‰“åŒ…å®Œæˆä¸Šä¼ æµ‹è¯•å¹³å°å‘é‚®ä»¶æ‰èƒ½å®‰å¿ƒå›å®¶ã€‚ é‰´äºè¿™ç§æƒ¨ç—›ç»å†ï¼Œåˆ©ç”¨é—²æš‡æ—¶é—´å°±æäº†ä¸ªè‡ªåŠ¨æ‰“åŒ…è„šæœ¬ï¼ŒåæœŸåˆæ•´ç†ä¸€éå¹¶é€‚é… Xcode 8.2 ä¹‹åçš„ç‰ˆæœ¬ã€‚ åšçš„äº†ä¸‰æ­¥é…ç½®ï¼Œæœç»æ±¡æŸ“ï¼Œä¸€è¡Œå‘½ä»¤è‡ªåŠ¨ä¸Šä¼ ã€‚ ä¹Ÿæ˜¯é‰´äº Xcode ç‰ˆæœ¬å‡çº§åçš„è‹¦é€¼é€‚é…ç»å†ï¼Œæœ€ç»ˆé€‰æ‹©äº†å¼€æºçš„ fastlane åŒ…ï¼Œä»æ­¤æ­ä¸Šäº†ç»„ç»‡çš„å°ç«è½¦ï¼Œé…åˆ Testflight ç»ˆäºå¯ä»¥æ”¾å¿ƒçš„ç©è€äº†â€¦ FastLane æ˜¯ä¸€ç§é…ç½® iOS å’Œ Android è‡ªåŠ¨åŒ– Beta éƒ¨ç½²å’Œå‘å¸ƒçš„æœ€ç®€å•çš„æ–¹æ³•ä¹‹ä¸€ã€‚å®ƒå¯ä»¥ç®€åŒ–ä¸€äº›ä¹å‘³ã€å•è°ƒã€é‡å¤çš„å·¥ä½œï¼Œåƒæˆªå›¾ã€ä»£ç ç­¾åä»¥åŠå‘å¸ƒ Appã€‚ä¹Ÿèƒ½æ— ç¼è¡”æ¥è’²å…¬è‹±ã€Firç­‰æµ‹è¯•å¹³å°ï¼Œè¿™é…¸çˆ½â€¦ çœæ—¶ï¼šæ¯æ¬¡å°†æ–°ç‰ˆæœ¬æ¨é€åˆ°å•†åº—æˆ–Betaæµ‹è¯•æœåŠ¡æ—¶ï¼Œéƒ½å¯èŠ‚çœæ—¶é—´ã€‚ é›†æˆï¼šé›†æˆå½“å‰å¼€å‘ç¯å¢ƒä¸­æ‰€æœ‰å­˜åœ¨çš„å·¥å…·å’ŒæœåŠ¡ã€‚ å¼€æºï¼š100%åŸºäºMITè®¸å¯å¼€æºã€‚ ç®€å•ï¼šç®€å•çš„è®¾ç½®åŠ©æ‰‹ï¼Œå‡ åˆ†é’Ÿé…ç½®å³å¯ä½¿ç”¨ã€‚ è¿è¡Œï¼šåŸºäºä½ çš„appå’Œæ•°æ®ï¼Œè¿è¡Œåœ¨æœ¬åœ°æœºå™¨ä¸Šã€‚ CIï¼šé›†æˆå‡ ä¹æ‰€æœ‰CIç³»ç»Ÿã€‚ æ”¯æŒï¼šæ”¯æŒiOSã€Macä»¥åŠAndroid åº”ç”¨ã€‚ è‡ªå®šä¹‰ï¼šæ ¹æ®è‡ªèº«éœ€è¦æ‰©å±•å’Œå®šåˆ¶fastlaneï¼Œä¸ä¾èµ–ä»»ä½•äººã€‚ å‘½ä»¤è¡Œï¼šä¸éœ€è¦è®°ä½é™¤fastlaneä»¥å¤–çš„ä»»ä½•å‘½ä»¤ã€‚ é…ç½®ï¼šå¯ä»¥åœ¨ä»»ä½•ç”µè„‘ä¸Šé…ç½®ï¼ŒåŒ…æ‹¬CIæœåŠ¡å™¨ã€‚ å¯¹äº Testflightï¼Œå°±åƒæ²¡æ•…äº‹çš„å“åŒå­¦æ‰€è¯´çš„ã€‚ Testflight æœ‰ä¸ªè¾ƒå¤§çš„ä½¿ç”¨é—¨æ§›ï¼Œéœ€è¦æ”¶é›†ç”¨æˆ·çš„é‚®ç®±ï¼Œä¹‹ååœ¨ Testflight é‡Œè¾“å…¥è‹¹æœå‘å‡ºçš„é‚€è¯·ç æ‰èƒ½å¼€å§‹æµ‹è¯•ã€‚å¾ˆå¤šç”¨æˆ·å«Œéº»çƒ¦å°±é€€å‡ºäº†ï¼Œè¿è¥è®¤ä¸ºè¿™æ ·ä¼šç»™æµ‹è¯•å¸¦æ¥å¾ˆå¤§çš„ä¸ä¾¿ã€‚ä½†æ˜¯å†·é™äº†å¿ƒæ€åå…¶å®äº‹æƒ…å¹¶æ²¡æœ‰é‚£ä¹ˆç³Ÿç³•ã€‚çœŸæ­£å¯¹è¿™ä¸ªäº§å“æœ‰å…´è¶£çš„ç”¨æˆ·ä¸ä¼šå› ä¸ºè¦å¡«ä¸ªé‚®ç®±å°±æ”¾å¼ƒäº†ã€‚é‚£äº›æµå¤±çš„åªæ˜¯æ™®é€šçš„ç”¨æˆ·ã€‚ç”¨æˆ·ä½¿ç”¨äº† Testflight åï¼Œåç»­çš„æµ‹è¯•åŒ…çš„å‘å¸ƒä¹Ÿä¼šæ”¶åˆ°æ›´æ–°ã€‚ä¸ä¼šåƒä¼ä¸šç‰ˆé‚£æ ·ï¼Œåªèƒ½æ‰‹åŠ¨çš„å‘Šè¯‰ç”¨æˆ·æˆ‘ä»¬æœ‰æ–°çš„æµ‹è¯•åŒ…ã€‚å½“ beta æµ‹è¯•æ´»è·ƒç”¨æˆ·è¶…è¿‡ 100 ä¸ªä¼šæœ‰ä¸€ä¸ªè´¨å˜ã€‚è¿™äº›éƒ½æ˜¯ç§¯æçš„é‡åº¦ç”¨æˆ·ï¼Œä¸€ç¾¤é‡åº¦ç”¨æˆ·ä½¿ç”¨ä½ çš„æ–°ç‰ˆæœ¬å‡ å¤©ï¼Œè‡³å°‘å¯ä»¥ä¿è¯æ ¸å¿ƒä¸šåŠ¡é€»è¾‘æ˜¯æ²¡æœ‰çº°æ¼çš„ã€‚ è¿™é‡Œæ¨èé…åˆæµ‹è¯•çš„ SDK è´¨é‡ç›‘æ§æœåŠ¡â€”â€”Bugtagsï¼ŒBugtags å¯ä»¥é€šè¿‡æ‚¬æµ®çª—æˆ–è€…æ‘‡ä¸€æ‘‡çš„æ–¹å¼è¿›è¡Œæˆªå›¾ï¼Œå¹¶å°†æ•è·çš„ bug å›¾ç‰‡ä¸Šä¼ åˆ°æµ‹è¯•å¹³å°ï¼Œå…¶è‡ªèº«ä¹ŸåŒ…æ‹¬ Crash çš„è‡ªåŠ¨ä¸Šä¼ ã€‚ çº¿ä¸Šè´¨é‡ç›‘æ§Crashlytics æˆç«‹äº2011å¹´ï¼Œæ˜¯ä¸“é—¨ä¸ºç§»åŠ¨åº”ç”¨å¼€è€…å‘æä¾›çš„ä¿å­˜å’Œåˆ†æåº”ç”¨å´©æºƒä¿¡æ¯çš„å·¥å…·ã€‚ Crashlytics ä¸ä¼šæ¼æ‰ä»»ä½•åº”ç”¨å´©æºƒä¿¡æ¯ã€‚åœ¨å‘ç”Ÿå´©æºƒåï¼Œç”¨æˆ·å†æ¬¡è¿›å…¥ APP å¹¶è”ç½‘æƒ…å†µä¸‹ï¼Œæ—¥å¿—è‡ªåŠ¨ä¸Šä¼ ã€‚ Crashlytics å¯ä»¥è±¡ Bug ç®¡ç†å·¥å…·é‚£æ ·ï¼Œç®¡ç†è¿™äº›å´©æºƒæ—¥å¿—ã€‚ä¾‹å¦‚ï¼šCrashlytics ä¼šæ ¹æ®æ¯ç§ç±»å‹çš„ Crash çš„å‡ºç°é¢‘ç‡ä»¥åŠå½±å“çš„ç”¨æˆ·é‡æ¥è‡ªåŠ¨è®¾ç½®ä¼˜å…ˆçº§ã€‚å¯¹äºæ¯ç§ç±»å‹çš„ Crashï¼ŒCrashlytics é™¤äº†ä¼šåƒä¸€èˆ¬çš„å·¥å…·æä¾› Call Stack å¤–ï¼Œè¿˜ä¼šæ˜¾ç¤ºæ›´å¤šç›¸å…³çš„æœ‰åŠ©äºè¯Šæ–­çš„ä¿¡æ¯ï¼Œä¾‹å¦‚ï¼šè®¾å¤‡æ˜¯å¦è¶Šç‹±ï¼Œå½“æ—¶çš„å†…å­˜é‡ï¼Œå½“æ—¶çš„ iOS ç‰ˆæœ¬ç­‰ã€‚å¯¹äºä¿®å¤æ‰çš„ Crash æ—¥å¿—ï¼Œå¯ä»¥åœ¨ Crashlytics çš„åå°å°†å…¶å…³æ‰ã€‚ Crashlytics å¯ä»¥æ¯å¤©å’Œæ¯å‘¨å°†å´©æºƒä¿¡æ¯æ±‡æ€»å‘åˆ°ä½ çš„é‚®ç®±ã€‚ æä¾›åœ¨çº¿çš„æŠ¥å‘Šï¼Œè§£é‡Šå´©æºƒåŸå› ï¼Œç”šè‡³èƒ½ç»™å‡ºæ˜¯å“ªä¸€è¡Œä»£ç å¯¼è‡´çš„å´©æºƒã€‚ Crashlytics æœ‰é…å¥—çš„ macOS åº”ç”¨ Fabric ç”¨æˆ·ä½“éªŒå€¼å¾—å›½å†… SDK æœåŠ¡å•†å­¦ä¹ ã€‚ 2013 å¹´ Twitter å¯¹ Crashlytics è¿›è¡Œäººæ‰å’ŒæœåŠ¡çš„å¤šé‡æ”¶è´­ï¼Œä¸€å¹´å Google æ”¶è´­ Firebaseï¼Œä»æ­¤ Fabric å’Œ Firebase è¿™å¯¹å¥½åŸºå‹å°±æˆä¸ºäº†åº”ç”¨å´©æºƒæŠ¥å‘Šçš„é»„é‡‘æ­æ¡£ã€‚ ç®¡ç†å›¢é˜Ÿæ ¸å¿ƒç»„æˆæ¶æ„å…³äºå›¢é˜Ÿçš„è§‚ç‚¹ï¼Œæˆ‘åŸºæœ¬å’Œæ²¡æ•…äº‹çš„å“åŒå­¦çœ‹æ³•ä¸€è‡´ï¼Œé™¤äº†æŠ€æœ¯çš„ç¡¬æŒ‡æ ‡ï¼Œåœ¨æ—©æœŸå›¢é˜Ÿè¿˜æœ‰ä¸€ä¸ªå·¥ç¨‹å›¢é˜Ÿæ–‡åŒ–çš„é—®é¢˜ã€‚ä¸€ä¸ªå‡ åä¸ªäººçš„é¡¹ç›®ï¼Œé‡Œé¢æŸä¸ªç‰¹å®šçš„äººçš„ç§¯ææ€§å¯¹äºé¡¹ç›®å…¶å®æ˜¯ä¸å¤ªé‡è¦çš„ã€‚ä»–åªè¦å®Œæˆåº”è¯¥å®Œæˆçš„å·¥ä½œã€‚ç”šè‡³å’Œå…¶ä»–äººä¸è¯´è¯ä¹Ÿå½±å“ä¸å¤§ã€‚ä¸€ä¸ªå¤§çš„é¡¹ç›®ä¹Ÿä¸èƒ½å› ä¸ºä»»ä½•ä¸€ä¸ªäººä¸åœ¨äº†å°±è¿è¡Œä¸ä¸‹å»ã€‚ æˆ‘ä¹‹å‰æ€è€ƒè¿‡å›¢é˜Ÿæ–‡åŒ–æ˜¯ä»€ä¹ˆï¼Œæ€ä¹ˆå½¢å®¹å›¢é˜Ÿæ–‡åŒ–ã€‚åæ¥çœ‹åˆ°ä¸€ä¸ªè¯´æ³•æ„Ÿè§‰æŒºè´´åˆ‡ã€‚æ–‡åŒ–æ˜¯ç©ºæ°”ï¼Œæ— å¤„ä¸åœ¨ã€‚å…¬å¸æ²¡æœ‰è§„å®šä¸‹ç­åç¤¾äº¤å¹³å°ä¸Šçœ‹åˆ°ç”¨æˆ·åé¦ˆéœ€è¦ä½ å»å›åº”ï¼Œä¹Ÿä¸ä¼šè§„å®šä½ å‘ç°å…¶ä»–éƒ¨é—¨çš„äº§å“æœ‰é—®é¢˜æ˜¯ä¸å½“å›äº‹è¿˜æ˜¯åº”è¯¥å»å’Œå…¶ä»–éƒ¨é—¨çš„äººæ²Ÿé€šï¼Œåˆæˆ–è€…çœ‹åˆ°ä¸€ä¸ªæ›´å¥½çš„å»ºè®®æ˜¯ä¸æ˜¯è¦å’Œå…¬å¸æå‡ºæ¥ã€‚è¿™äº›è¡Œä¸ºèƒŒåçš„æ”¯æ’‘å°±æ˜¯å›¢é˜Ÿæ–‡åŒ–ã€‚åœ¨å›¢é˜Ÿé‡Œçš„äººå†³å®šäº†ä»·å€¼è§‚ã€‚ æŠ€æœ¯å›¢é˜Ÿåšäº‹å°±åƒå¤ä»£çš„å…«æŠ¬å¤§è½¿ï¼Œå…¬å¸ä¸šåŠ¡å°±åƒè½¿å­é‡Œçš„å°å¨˜å­ï¼Œå›¢é˜Ÿæ–‡åŒ–å°±åƒæŠ¬è½¿å­æ—¶å–Šçš„å·å­ï¼Œå›¢é˜Ÿé‡Œçš„æ¯ä¸ªäººå°±åƒæ˜¯æŠ¬è½¿å­çš„è½¦å¤«ã€‚æŠ¬è½¿å­çš„å¤§å¤šæ•°äººèµ°çš„å¿«ï¼Œæ¯ä¸ªäººçš„æ­¥å­é½ï¼Œé‚£è½¿å­é‡Œçš„å°å¨˜å­å°±åå¾—å¾ˆèˆ’æœï¼Œå¦‚æœå“ªä¸ªç¯èŠ‚å‡ºç°é—®é¢˜éƒ½ä¼šå¯¹åè½¿å­çš„äººæœ‰å½±å“ã€‚ æ‰€ä»¥ï¼Œè½¦å¤«æ°´å¹³è¦æŒ‘å¥½ï¼Œå·å­è¦å“äº®ææ°”ï¼Œæ¯ä¸ªäººçš„æ­¥ä¼è¦åè°ƒï¼Œè½¿å­å°±èƒ½å¹³ç¨³ä¸Šè·¯ï¼Œå¯æ˜¯å¦‚æœæƒ³å¿«ç‚¹èµ¶è·¯ï¼Œé‚£å¯èƒ½å°±è¦å°è¯•ä¸åŒçš„æŠ¬è½¿å§¿åŠ¿ï¼Œæ¢æ›´å“äº®çš„å·å­ï¼Œæ’ç»ƒæ›´åè°ƒæ­¥å­ï¼Œç”šè‡³æ¢ä¸ªæ›´è½»çš„è½¿å­ã€æ¢ä¸ªè½®å­â€¦ ç¡¬ä»¶è®¾å¤‡æŠ•å…¥æ¥ç€ä¸Šé¢çš„â€œèŠ±è½¿â€è¯´ï¼Œç¡¬ä»¶æŠ•å…¥çš„é‡è¦æ€§å°±ä¸è¨€è€Œå–»äº†ï¼Œåˆ«äººå·²ç»æ¢ä¸Šäº†å¸¦è½®å­çš„é©¬è½¦äº†ï¼Œå½“ç„¶è·‘çš„é£å¿«ã€‚ æ‹¿ Swift çš„ç¼–è¯‘é€Ÿåº¦è®²ï¼ŒMacBook Air å’Œ MacBook Pro çš„å¤„ç†å™¨èŠ¯ç‰‡å’Œå†…å­˜å®¹é‡å†³å®šäº†ä¸¤ç§ç”µè„‘çš„ç¼–è¯‘è€—æ—¶å¯èƒ½ç›¸å·®1å€å·¦å³ï¼Œè€Œä¸€å—å¤–æ¥æ˜¾ç¤ºå±èƒ½èŠ‚çœçš„é¢‘ç¹æ“ä½œæ›´æ˜¯ä»¥å°‘ç§¯å¤šã€‚ å¦‚æœæŠŠä¸€ä¸ªå·¥ç¨‹å¸ˆçš„è–ªèµ„æ¢ç®—æˆæ—¶è–ªï¼Œé…åˆç¡¬ä»¶è®¾å¤‡æµªè´¹æ‰çš„æ—¶é—´ï¼Œå°†æ˜¯ä¸€ç¬”ä¸é‚£ä¹ˆæ˜æ™ºçš„å¼€é”€ï¼Œå½“ç„¶å¦‚æœä½ çš„å·¥ç¨‹å¸ˆæ¯å¤©åªæ˜¯å–å‡‰æ°´çœ‹æ–°é—»ï¼Œé‚£è¯·é…ç»™ä»–ä¸€ä¸ªä¿æ¸©æ¯å’Œè€èŠ±é•œ~ ä¾‹ä¼šå’Œæ–‡æ¡£åŒ–æœ‰å“ªäº›ä¼šï¼Ÿ å½“æˆ‘æ‰“ç®—å†™è¿™ä¸ªä¸»é¢˜æ—¶ï¼Œåæ€äº†ä¸‹è¿‡å»éƒ½å‚åŠ è¿‡å“ªäº›ä¼šè®®ï¼Œå‘ç°æœ‰æ—¶ä¼šè«åå…¶å¦™çš„å°±å‚åŠ äº†ä¸€äº›å®Œå…¨æ— æ„ä¹‰çš„ä¼šè®®ã€‚ä¸‹é¢æˆ‘ä»¬å…ˆçœ‹çœ‹ä¸€èˆ¬ç¨‹åºå‘˜éƒ½ä¼šç¢°åˆ°å“ªäº›ä¼šè®®ã€‚ éœ€æ±‚ä¼š è¿™ç±»ä¼šè®®ä¸€èˆ¬æ˜¯äº§å“æˆ–é¡¹ç›®ç»ç†å¬é›†ï¼Œç»„ç»‡å‚ä¸é¡¹ç›®çš„ç¨‹åºå‘˜ä¸€èµ·è®¨è®ºéœ€æ±‚å¹¶ç¡®å®šæ’æœŸã€‚è¿™ç±»ä¼šè®®å®¹æ˜“å‡ºçš„é—®é¢˜æ˜¯ï¼Œç¨‹åºå‘˜åˆ°äº†ä¼šä¸Šæ‰ç¬¬ä¸€æ¬¡çŸ¥é“éœ€æ±‚ï¼Œå¹¶é™·å…¥åˆ°éœ€æ±‚ç»†èŠ‚çš„æ— ä¼‘æ­¢è®¨è®ºä¸­ã€‚æ›´å¥½çš„æ–¹å¼æ˜¯æå‰è®©ç¨‹åºå‘˜è¯¦ç»†äº†è§£éœ€æ±‚ï¼Œä¼šä¸Šåªéœ€æ•²å®šæ’æœŸå¹¶è®©äº’ç›¸æœ‰åä½œä¾èµ–çš„ç¨‹åºå‘˜ä¹‹é—´è¾¾æˆä¸€è‡´å’Œå½¢æˆæ‰¿è¯ºã€‚ è®¨è®ºä¼š è¿™ç±»ä¼šè®®çš„åœºæ™¯æ¯”è¾ƒå¹¿æ³›ï¼Œæ¯”å¦‚ï¼šé¡¹ç›®è¿›è¡Œè¿‡ç¨‹ä¸­åŒç»„ç¨‹åºå‘˜ä¹‹é—´å°±è®¾è®¡æˆ–å®ç°çš„è®¨è®ºï¼Œæˆ–ä¸å…¶ä»–ç»„é¡¹ç›®åˆä½œäººä¹‹é—´çš„è®¨è®ºç­‰ç­‰ã€‚è¿™ç±»ä¼šè®®å®¹æ˜“å‡ºç°çš„é—®é¢˜æ˜¯ä¸´æ—¶æŠŠä¸€å †äººæ‹‰åˆ°ä¼šä¸Šï¼Œç„¶åé™·å…¥æ··ä¹±çš„è‡ªç”±è®¨è®ºï¼Œå¤±å»ç„¦ç‚¹ã€‚ è¿˜æœ‰ä¸€ç±»è®¨è®ºä¼šå«å¤´è„‘é£æš´ä¼šï¼Œä¹Ÿæ˜¯å®¹æ˜“æŠŠä¸€å †äººæ‹‰åˆ°ä¼šä¸Šï¼Œå¼€åŠ¨å¤´è„‘é£æš´ã€‚å¦‚ä»Šé—æ†¾çš„é¢†æ‚Ÿåˆ°è¿™æ˜¯æœ€æ²¡æ•ˆç‡ä¹Ÿæ²¡æ•ˆæœçš„æ–¹å¼ã€‚å¤´è„‘é£æš´ä¼šéœ€è¦å°±å¾…è§£å†³çš„é—®é¢˜è®©å‚ä¸äººå‘˜æå‰å‡†å¤‡ï¼Œæœé›†æˆ–é˜…è¯»ææ–™ï¼Œä¸åŒäººä»ä¸åŒè§’åº¦å„è‡ªæå‡ºè‡ªå·±çš„è§‚ç‚¹æˆ–æ–¹æ¡ˆï¼Œç„¶ååˆ°äº†ä¼šä¸Šå°†æ‰€æœ‰è§‚ç‚¹å’Œæ–¹æ¡ˆåˆ—å‡ºæ¥ï¼Œå†å¼€åŠ¨å¤´è„‘ï¼Œç¢°æ’è¿æ¥ä¸€ä¸‹ï¼Œçœ‹çœ‹èƒ½ä¸èƒ½é£æš´å‡ºä¸€äº›æ–°çš„è§‚ç‚¹æˆ–æ–¹æ¡ˆå»æœ‰æ•ˆè§£å†³é—®é¢˜ã€‚ å‘¨ä¾‹ä¼š ä¸€èˆ¬æ¥è¯´ä¸€ä¸ªéƒ¨é—¨æˆ–å°ç»„éƒ½ä¼šæ¯å‘¨å¼€ä¸ªä¾‹ä¼šï¼Œä¾‹ä¼šå®¹æ˜“è¢«å½“ä½œæ—¥å¸¸çš„ä¾‹è¡Œå·¥ä½œè€Œä¸è¢«é‡è§†ã€‚ä¾‹ä¼šåº”è¯¥æœ‰å›ºå®šçš„æ—¶é—´å’Œè®®ç¨‹ï¼Œè€Œä¸”ä¾‹ä¼šæ˜¯ä¸€ç¾¤ç»å¸¸ä¸€èµ·å·¥ä½œå¹¶ç†Ÿæ‚‰çš„äººå¼€ä¼šã€‚è™½ç„¶å¼€ä¾‹ä¼šçš„äººéƒ½åœ¨åŒä¸€ä¸ªéƒ¨é—¨ï¼Œä½†å¹¶ä¸æ„å‘³ç€ä»–ä»¬éƒ½ä¼šç›¸äº’åˆä½œå®ŒæˆåŒä¸€ä¸ªé¡¹ç›®æˆ–äº‹æƒ…ã€‚æ‰€ä»¥ï¼Œä¾‹ä¼šæ˜¯é€šè¿‡äº†è§£å„è‡ªå·¥ä½œæ¥å®Œæˆäº†è§£æ•´ä¸ªéƒ¨é—¨æˆ–å°ç»„å·¥ä½œè¿›å±•çš„æœºä¼šï¼Œè€Œä¸æ˜¯æ¯å‘¨å›ºå®šçš„ä¼‘é—²æ—¶å…‰ã€‚å½“ç„¶æˆ‘ä»¬ä¹Ÿå¯ä»¥åœ¨æ¯å‘¨çš„ä¾‹ä¼šç•™å‡ºä¸€æ®µè‡ªç”±è®¨è®ºæ—¶é—´ï¼Œå¯ä»¥ç•…æ‰€æ¬²è¨€ï¼Œå¢åŠ å·¥ä½œä¹‹å¤–äº¤æµã€‚ é™¤äº†å‘¨ä¾‹ä¼šï¼Œæœ‰äº›å®æ–½æ•æ·æ–¹æ³•çš„å›¢é˜Ÿä¹Ÿä¼šå¼€æ¯æ—¥ç«™ç«‹ä¼šï¼Œæ¯æ—¥ç«™ç«‹ä¼šçš„ä¸€èˆ¬å†…å®¹æ˜¯ï¼š æ˜¨å¤©å¹²äº†ä»€ä¹ˆ ä»Šå¤©è®¡åˆ’å¹²ä»€ä¹ˆ é‡åˆ°äº†ä»€ä¹ˆéšœç¢ æ¯æ—¥ç«™ç«‹ä¼šè®®çš„ä¸»è¦ç›®çš„æ˜¯è®©å›¢é˜Ÿæˆå‘˜äº’ç›¸äº¤æµäº’é€šå·¥ä½œæƒ…å†µï¼Œè€Œä¸æ˜¯ä¸ºäº†è®©ç»ç†ä»¬äº†è§£æƒ…å†µè€Œå¬å¼€çš„ä¼šè®®ã€‚æ¯æ—¥ç«™ç«‹ä¼šä¸æ˜¯ä¸€ä¸ªå›¢é˜Ÿçš„äººç«™ä¸€åœˆå„è‡ªè¯´ä¸‹å·¥ä½œæƒ…å†µï¼Œå› ä¸ºæ›¾ç»å‘ç°å½¼æ­¤å¹¶ä¸å…³å¿ƒå¯¹æ–¹å·¥ä½œå†…å®¹çš„äººç«™ä¸€åœˆå¼€è¿™ä¸ªç«™ç«‹ä¼šï¼Œå…¶æ„ä¹‰ä½•åœ¨ï¼Ÿ åˆ†äº«ä¼š éƒ¨é—¨å†…ã€å…¬å¸å†…æˆ–è¡Œä¸šå†…éƒ½ä¼šæœ‰å„ç±»ä¸åŒè§„æ¨¡åˆ†äº«ä¼šï¼Œæƒ³æ¸…æ¥šä½ ä¸ºä»€ä¹ˆè¦å»å‚åŠ ä¸€ä¸ªåˆ†äº«ä¼šï¼Ÿä¸€èˆ¬æ¥è¯´æˆ‘åªæœ‰ä¸¤ä¸ªåŸå› ï¼Œæˆ‘å¯¹åˆ†äº«çš„å†…å®¹æ„Ÿå…´è¶£ï¼Œè¿™åº”è¯¥æ˜¯å¤§éƒ¨åˆ†äººå‚ä¼šçš„åŸå› ã€‚å¦ä¸€ä¸ªï¼Œå³ä½¿åˆ†äº«å†…å®¹æˆ‘å·²ç»å¾ˆç†Ÿæ‚‰ï¼Œé‚£ä¹ˆå‚ä¼šçš„åŸå› ä¸€èˆ¬å°±æ˜¯å¯¹åˆ†äº«äººæ„Ÿå…´è¶£ï¼Œæƒ³è¦å»é€šè¿‡è¿™ä¸ªåˆ†äº«äº†è§£åˆ†äº«äººã€‚ è¿˜æœ‰ä¸€ç§æƒ…å†µå¯èƒ½æ˜¯ç¢äºé¢å­å‚åŠ ä¸€äº›å®Œå…¨æ²¡å…´è¶£çš„åˆ†äº«ä¼šï¼Œæ©ï¼Œè¿™ç§è¿˜æ˜¯å°½é‡è§„é¿å§ã€‚ ä¸´æ—¶ä¼š æ€»ä¼šç¢°åˆ°è¿™ç§æƒ…å†µï¼Œçªç„¶æœ‰ä¸ªäººè¿‡æ¥å«ä½ ä¸´æ—¶å»å‚åŠ ä¸ªä¼šï¼Œç„¶åä½ å°±ä¸€è„¸æ‡µé€¼çš„å»äº†ã€‚è¿™ç§ä¼šä¼¼ä¹å±äºèº«ä¸ç”±å·±ï¼Œä¸å¥½è§„é¿ï¼Œè¿™ç±»ä¼šè®®å¤šæ˜¯éè®¡åˆ’æ€§çš„ä»»åŠ¡é©±åŠ¨å‹ä¼šè®®ã€‚è‹±ç‰¹å°”å‰ CEO å®‰è¿ªÂ·æ ¼é²å¤«è¯´è¿‡ï¼š åœ¨ç°å®ä¸­ï¼Œæœ‰ 20% çš„æƒ…å†µè¿˜å¾—é ä»»åŠ¡å¯¼å‘ä¼šè®®æ¥è§£å†³ã€‚ä½†å¦‚æœç»ç†äººå°†è¶…è¿‡ 25% çš„æ—¶é—´ç”¨åœ¨åº”æ€¥çš„ä»»åŠ¡å¯¼å‘ä¼šè®®ä¸Šï¼Œè¿™ä¸ªç»„ç»‡å°±ä¸€å®šæœ‰äº†æ¯›ç—…ã€‚è¿™ç§ç±»å‹çš„ä¼šè®®éšæ—¶å¬å¼€ï¼Œè€Œä¸”ä¼šé’ˆå¯¹å…·ä½“æƒ…å†µäº§ç”Ÿå†³ç­–ï¼Œè‹¥è¿™ç§ä¸´æ—¶ç´§æ€¥çš„ä»»åŠ¡é©±åŠ¨ä¼šè®®å¤ªå¤šäº†ï¼Œé‚£é—®é¢˜è‚¯å®šå‡ºåœ¨å¹³æ—¶çš„å·¥ä½œä¸­ã€‚ æ€»ç»“ä¼š å¯èƒ½æ˜¯é¡¹ç›®ä¸Šçº¿æˆ–äº§å“å‘å¸ƒåçš„æ€»ç»“ä¼šï¼Œä¹Ÿå¯èƒ½æ˜¯çº¿ä¸Šæ•…éšœåçš„ç»éªŒæ•™è®­æ€»ç»“ä¼šã€‚æˆ‘ä»¥å‰å¼€è¿‡çš„å¾ˆå¤šæ€»ç»“ä¼šéƒ½å˜æˆäº†é¢†å¯¼çš„æ€»ç»“ä¼šï¼Œå…³äºè¿™ç±»ä¼šå¤§å®¶æœ‰ä»€ä¹ˆå¥½æƒ³æ³•å—ï¼Ÿ å¯¹äºä»¥ä¸Šè¿™äº›åƒå¥‡ç™¾æ€ªçš„ä¼šè®®ï¼Œäºæ˜¯æœ‰äººåˆ¶ä½œäº†è¿™å¹…æ¼«ç”»ï¼š å…¶å®å‘¢ï¼Œå‡¡äº‹éƒ½æœ‰ä¸¤é¢æ€§ï¼Œæœ€éš¾æŠŠæ§çš„æ°¸è¿œæ˜¯äººï¼Œä½œä¸ºæœ‰æ•ˆçš„è®¨è®ºæ´»åŠ¨ï¼Œä¼šè®®æœ¬äº‹æ²¡æœ‰é—®é¢˜ï¼Œç²¾è€•ç»†ä½œä¹Ÿä¼šåœ¨ä¸€å®šç¨‹åº¦ä¸Šä¿è¯è´¨é‡ã€‚é‡è¦çš„æ˜¯ä¼šè®®çš„æ°”æ°›ã€ä¸»é¢˜ä»¥åŠæ§åœºåŠ›ã€‚ é«˜æ•ˆä¼šè®®çš„ä¸‰ä¸ªè¦è¯€ï¼š1.æå‰é€šçŸ¥è®®é¢˜å¹¶å‘ç»™å‚ä¼šäººç›¸å…³èµ„æ–™ï¼Œä¸è¦æ±‚å¯å‚åŠ å¯ä¸å‚åŠ çš„äºº2.ä¼šè®®å¿…é¡»æœ‰ä¸»æŒäººï¼Œå¼•å¯¼å¤§å®¶æ—¶åˆ»ç›¯ä½ä¼šè®®ä¸»é¢˜3.è¦æœ‰ä¼šè®®çºªè¦ï¼Œä¼šåå¯¹ä¼šè®®ç»“è®ºã€è¡ŒåŠ¨è®¡åˆ’ã€è´Ÿè´£äººã€è¿›åº¦è¡¨å’Œè€ƒæ ¸ç›®æ ‡çš„æç‚¼æ€»ç»“ æˆ‘ä¹‹å‰é‡åˆ°ä¸€ä¸ªé¡¹ç›®é¢†å¯¼å°±å¾ˆæœ‰ç‰¹è‰²ï¼Œç”±äºé‡‡å–å°é—­å¼æ•æ·å¼€å‘æ¨¡å¼ï¼Œéœ€è¦æ¯å¤©ç¡®å®šå·¥ä½œå†…å®¹ï¼Œè°ƒèŠ‚å„éƒ¨é—¨é—´å·¥ä½œè¿›å±•ï¼Œæ‰€ä»¥éœ€è¦æ¯å¤©åšåˆä¼šï¼Œä½†æ˜¯å½“æ—¶å¹¶ä¸æ¯ç‡¥è€Œä¸”å›¢é˜Ÿåä½œèæ´½ï¼Œå› ä¸ºåœ¨ä¾‹ä¼šè¿‡åæœ‰ç»„ç»‡æŠ½ç­¾ä¹°é¥®æ–™ã€é›¶é£Ÿå’Œæƒ©ç½šå€’éœ‰é¬¼çš„æ´»åŠ¨ï¼Œå¦‚ä»Šæƒ³æ¥ï¼Œä»–ç¡®å®æ˜¯ä¸€ä¸ªä¼˜ç§€çš„ç»„ç»‡è€…ã€‚ ä»¥ä¸Šè¿™äº›ä¼šè®®å†…å®¹æ¥è‡ªåšå®¢å›­çš„ mindwindï¼Œè®©æˆ‘ä»¬åŒæƒ…ä»–ä¸€åˆ»é’Ÿ~ æ–‡æ¡£åŒ–æ–‡æ¡£åŒ–å’Œä¾‹ä¼šä¸€æ ·æ˜¯å……æ»¡äº‰è®®çš„ä¸¾æªï¼Œæœ¬è´¨ä¸Šæ˜¯ä¸ºäº†è®©ä¸€åˆ‡æœ‰æ®å¯æŸ¥ï¼Œæ–¹ä¾¿åæœŸæŸ¥é˜…å’Œå‡å°‘äº¤æ¥å·¥ä½œè´Ÿæ‹…ã€‚ä½†ä¹Ÿä¸ä¹åå¯¹è€…ï¼Œè®¤ä¸ºæ˜¯åœ¨æµªè´¹æ—¶é—´ï¼Œå½¢åŠ¿ä¸»ä¹‰ã€‚ è¿˜æ˜¯ä¸€æ ·çš„é“ç†ï¼Œç¨³å®šçš„æ–¹æ³•ä¸ä¼šé”™ï¼Œéš¾æŠŠæ¡çš„æ˜¯ä¸ªäººã€‚æŠŠæ¯ä¸€ä¸ªè´¦å·å¯†ç æ•´ç†ä¿å­˜ä¹Ÿæ˜¯æ–‡æ¡£åŒ–ã€‚ä¿æŒä¼šè®®è®°å½•ã€å·¥ä½œèŠå¤©æ—¥å¿—ä¹Ÿèƒ½åœ¨å¿…è¦æ—¶ä¸æ¥å—é£æ¥çš„æ¨ªâ€œé”…â€~ ç»„ç»‡ CodeReviewè¿˜æ˜¯å¼•ç”¨æ²¡æ•…äº‹çš„å“åŒå­¦çš„è¯ï¼ŒCode review æ˜¯ä¸€ä»¶ç¥å¥‡çš„äº‹æƒ…ã€‚æ‰€æœ‰æœ‰ç´ å…»çš„å·¥ç¨‹å¸ˆéƒ½è§‰å¾— code review å¥½ï¼Œæ®æˆ‘ä»¬æ‰€çŸ¥å›½å¤–å¾ˆå¤šä¼˜ç§€çš„ IT ä¼ä¸šéƒ½å¾ˆæ³¨é‡ code reviewï¼Œä½†æ˜¯åœ¨å›½å†…å´å¾ˆå°‘çœ‹åˆ°æœ‰å›¢é˜Ÿæ‰§è¡Œ code reviewã€‚æˆ–è€…ä¸­å°å›¢é˜Ÿé‡Œå¾ˆå°‘çœ‹åˆ° code reviewã€‚ ä½œä¸ºä¸€ä¸ª leaderï¼Œåœ¨ review çš„æ—¶å€™å¸®åŠ©æˆå‘˜æˆé•¿ï¼Œå’Œåªæ˜¯çœ‹ä¸‹ä»£ç æ˜¯ä¸æ˜¯èƒ½å®ŒæˆåŠŸèƒ½æœ€åä¼šå¼•å‘ä¸åŒçš„ç»“æœã€‚çœ‹è¿‡ä¸€å¥å¾ˆæœ‰è§¦åŠ¨çš„è¯ï¼Œç°åœ¨å¾ˆå¤š leader çŸ¥é“è‡ªå·±çš„å·¥ä½œé‡Œéœ€è¦ç®¡ç†å…¶ä»–äººï¼Œä½†æ˜¯å´å¿½ç•¥äº†è¿˜éœ€è¦ lead ã€‚è€å®è¯´æ¨è¿› code review ç¡®å®é‡åˆ°å¾ˆå¤šé˜»åŠ›ã€‚æœ‰å›¢é˜Ÿé‡Œçš„ä¹Ÿæœ‰å›¢é˜Ÿå¤–çš„ã€‚å›¢é˜Ÿå¤–çš„çœ‹æ³•æ˜¯ code review æ‹–æ…¢äº†é¡¹ç›®è¿›åº¦ã€‚æˆ‘ä½œä¸ºä¸€ä¸ªæ ¸å¿ƒçš„å¼€å‘æˆå‘˜ï¼Œæ¯å¤©è¶…è¿‡ 20% çš„æ—¶é—´æ˜¯æ²¡æœ‰å¯è§çš„å·¥ä½œäº§å‡ºçš„ã€‚æœ‰æ—¶åˆ«äººå†™çš„æœ‰é—®é¢˜è¢«æˆ‘æ‰“å›å»æ”¹ï¼Œä¸€ä¸ªå·²ç»å®Œæˆçš„åŠŸèƒ½åˆå¤šèŠ±äº†å‡ ä¸ªå°æ—¶ã€‚å›¢é˜Ÿå†…é‡åˆ°çš„é—®é¢˜æ˜¯ï¼Œå¾ˆå¤šæˆå‘˜ä¸ç†è§£è¿™é¡¹å·¥ä½œèƒŒåçš„ä»·å€¼ã€‚ åŒæ ·çš„æ„Ÿè§¦æ¥è‡ªä¸Šé¢æåˆ°çš„é‚£å®¶å…¬å¸ï¼Œè´Ÿè´£æˆ‘ä»¬çš„å°ç»„ç»„é•¿æ˜¯ä¸€åæœ‰ç€ 6 å¹´ç§»åŠ¨ç«¯å¼€å‘ç»éªŒçš„ä¼˜ç§€å·¥ç¨‹å¸ˆï¼Œåœ¨ä¸€å¥—ä¸¥æ ¼çš„ä»£ç è§„èŒƒè¦æ±‚å’Œ code review çš„é”»ç‚¼ä¸‹ï¼Œæˆ‘çš„æˆé•¿å‡ ä¹æ˜¯è‚‰çœ¼å¯è§çš„ï¼ˆå¯¹æ¯”å›çœ‹ä¹‹å‰çš„ä»£ç ï¼‰ï¼Œä»–å¯¹æˆ‘ä»¬çš„æŒ‡å¯¼ä¹Ÿæ˜¯æ— ç§ä¸”ä¸“ä¸šçš„ï¼Œä»¥è‡³äºæˆ‘ç°åœ¨ä¾ç„¶åœ¨æ„Ÿè°¢ç€ä»–ã€‚ CodeReview çš„æ–¹å¼ å¼€ Code Review ä¼šè®® å›¢é˜Ÿå†…éƒ¨ä¼šæ•´ç† Check List å›¢é˜Ÿå†…éƒ¨æˆå‘˜äº¤æ¢ä»£ç  æ‰¾å‡ºå¯ä¼˜åŒ–æ–¹æ¡ˆ å¤šé—®é—®é¢˜ï¼Œä¾‹å¦‚ï¼šâ€œè¿™å—å„¿æ˜¯æ€ä¹ˆå·¥ä½œçš„ï¼Ÿâ€ã€â€œå¦‚æœæœ‰XXX æƒ…å†µï¼Œä½ è¿™ä¸ªæ€ä¹ˆå¤„ç†ï¼Ÿâ€ åŒºåˆ†é‡ç‚¹ï¼Œä¼˜å…ˆæŠ“ä½è®¾è®¡ï¼Œå¯è¯»æ€§ï¼Œå¥å£®æ€§ç­‰é‡ç‚¹é—®é¢˜ æ•´ç†å¥½çš„ç¼–ç å®è·µï¼Œç”¨æ¥ä½œä¸º Code Review çš„å‚è€ƒ CodeReview çš„å†…å®¹ [1]æ¶æ„/è®¾è®¡/å¸¸è§„1.å•ä¸€èŒè´£åŸåˆ™è¿™æ˜¯ç»å¸¸è¢«è¿èƒŒçš„åŸåˆ™ã€‚ä¸€ä¸ªç±»åªèƒ½å¹²ä¸€ä¸ªäº‹æƒ…ï¼Œä¸€ä¸ªæ–¹æ³•æœ€å¥½ä¹Ÿåªå¹²ä¸€ä»¶äº‹æƒ…ã€‚æ¯”è¾ƒå¸¸è§çš„è¿èƒŒæ˜¯ä¸€ä¸ªç±»æ—¢å¹²UIçš„äº‹æƒ…ï¼Œåˆå¹²é€»è¾‘çš„äº‹æƒ…ï¼Œè¿™ä¸ªåœ¨ä½è´¨é‡çš„å®¢æˆ·ç«¯ä»£ç é‡Œå¾ˆå¸¸è§2.è¡Œä¸ºæ˜¯å¦ç»Ÿä¸€ï¼Œä¾‹å¦‚ï¼š1)ç¼“å­˜æ˜¯å¦ç»Ÿä¸€2)é”™è¯¯å¤„ç†æ˜¯å¦ç»Ÿä¸€3)é”™è¯¯æç¤ºæ˜¯å¦ç»Ÿä¸€4)å¼¹å‡ºæ¡†æ˜¯å¦ç»Ÿä¸€5)â€¦â€¦3.ä»£ç æ±¡æŸ“ä»£ç æœ‰æ²¡æœ‰å¯¹å…¶ä»–æ¨¡å—å¼ºè€¦åˆ4.é‡å¤ä»£ç â€“&gt;åº”è¯¥æŠ½å–5.å¼€é—­åŸåˆ™6.é¢å‘æ¥å£ç¼–ç¨‹7.å¥å£®æ€§1)æ˜¯å¦è€ƒè™‘çº¿ç¨‹å®‰å…¨2)æ•°æ®è®¿é—®æ˜¯å¦ä¸€è‡´æ€§3)è¾¹ç•Œå¤„ç†æ˜¯å¦å®Œæ•´4)é€»è¾‘æ˜¯å¦å¥å£®5)æ˜¯å¦æœ‰å†…å­˜æ³„æ¼6)æœ‰æ²¡æœ‰å¾ªç¯ä¾èµ–7)æœ‰æ²¡æœ‰é‡æŒ‡é’ˆ8)æ˜¯å¦æ£€æŸ¥äº†æ•°ç»„çš„â€œè¶Šç•Œâ€œé”™è¯¯9)â€¦â€¦8.é”™è¯¯å¤„ç†9.æ”¹åŠ¨æ˜¯ä¸æ˜¯å¯¹ä»£ç çš„æå‡æ–°çš„æ”¹åŠ¨æ˜¯æ‰“è¡¥ä¸ï¼Œè®©ä»£ç è´¨é‡ç»§ç»­æ¶åŒ–ï¼Œè¿˜æ˜¯å¯¹ä»£ç è´¨é‡åšäº†ä¿®å¤10.æ•ˆç‡/æ€§èƒ½1)å…³é”®ç®—æ³•çš„æ—¶é—´å¤æ‚åº¦å¤šå°‘ï¼Ÿæœ‰æ²¡æœ‰å¯èƒ½æœ‰æ½œåœ¨çš„æ€§èƒ½ç“¶é¢ˆ2)å®¢æˆ·ç«¯ç¨‹åºå¯¹é¢‘ç¹æ¶ˆæ¯å’Œè¾ƒå¤§æ•°æ®ç­‰è€—æ—¶æ“ä½œæ˜¯å¦å¤„ç†å¾—å½“ [2]ä»£ç é£æ ¼1.å¯è¯»æ€§è¡¡é‡å¯è¯»æ€§çš„å¯ä»¥æœ‰å¾ˆå¥½å®è·µçš„æ ‡å‡†ï¼Œå°±æ˜¯ Reviewer èƒ½å¦éå¸¸å®¹æ˜“çš„ç†è§£è¿™ä¸ªä»£ç ã€‚å¦‚æœä¸æ˜¯ï¼Œé‚£æ„å‘³ç€ä»£ç çš„å¯è¯»æ€§è¦è¿›è¡Œæ”¹è¿›2.å‘½å1)å‘½åå¯¹å¯è¯»æ€§éå¸¸é‡è¦2)æ˜¯å¦è·Ÿç³»ç»Ÿå±æ€§å‘½åé€ æˆå†²çª3)è‹±è¯­ç”¨è¯å°½é‡å‡†ç¡®ä¸€ç‚¹ï¼Œå¿…è¦æ—¶å¯ä»¥æŸ¥å­—å…¸3.å‡½æ•°é•¿åº¦/ç±»é•¿åº¦1)å‡½æ•°å¤ªé•¿çš„ä¸å¥½é˜…è¯»2)ç±»å¤ªé•¿äº†ï¼Œæ£€æŸ¥æ˜¯å¦è¿åçš„ å•ä¸€èŒè´£ åŸåˆ™4.æ³¨é‡Šæ°åˆ°å¥½å¤„çš„æ³¨é‡Š,ä¸æ˜¯æ³¨é‡Šè¶Šå¤šè¶Šå¥½5.å‚æ•°ä¸ªæ•°ä¸è¦å¤ªå¤šï¼Œä¸€èˆ¬ä¸è¦è¶…è¿‡ 3 ä¸ª å·¥å…·Gitlab åŠ Git ç›¸å…³è§„èŒƒGitlabå¯¹äºä»£ç ä»“åº“å¼€æºé¦–é€‰ GitHubï¼Œä¸å¼€æºç°åœ¨ä¹Ÿæœ‰è®¸å¤šæœåŠ¡å•†ï¼Œå¦‚ï¼šGitee ç­‰ï¼Œå¦‚æœæœ‰é’±ä»»æ€§ GitHub æ™®é€šçš„å›¢é˜Ÿå¥—é¤æ¯ä¸ªæœˆæ¯äºº 9 åˆ€ï¼Œä½†æˆ‘ç›¸ä¿¡å¤§å¤šæ•°ä¸­å°ä¼ä¸šä¼šé€‰æ‹© Gitlabã€‚ è¿˜æœ‰å°±æ˜¯æœåŠ¡ç«¯å¦‚æœè¦è‡ªå·±é…ç½® CI æœåŠ¡ä¸å¤ªæ–¹ä¾¿ã€‚å¦‚æœéƒ¨ç½²åœ¨è‡ªå·±çš„æœåŠ¡å™¨ä¸Šï¼Œå…¶ä»–ä¸€äº›æœåŠ¡è„šæœ¬ä¹Ÿéƒ¨ç½²åœ¨ä¸€èµ·ï¼Œä¼šæœ‰å¾ˆå¤§çš„è‡ªä¸»æƒã€‚ç»¼åˆä¹‹åé€‰æ‹©äº†ä¸»æµçš„ Gitlabã€‚ ç¬¬ä¸‰æ–¹ä»“åº“éƒ½å¯èƒ½é‡åˆ°çˆ¶çˆ±å¦‚å±±èˆ¬çš„ç»´æŠ¤æ—¶æœŸã€‚ Git ç›¸å…³è§„èŒƒGit ç›¸æ¯” SVN èƒ½é¿å…å¤§å¤šæ•°éäººä¸ºé—®é¢˜ï¼Œè¿™ç‚¹ç›¸ä¿¡å·²ç»ä¸éœ€è¦è®ºè¯äº†ã€‚ä½†æ˜¯é‚£äº›äººä¸ºçš„é—®é¢˜æ€ä¹ˆåŠï¼Œé‚£å½“ç„¶éœ€è¦è§„èŒƒäº†ã€‚ é¦–å…ˆï¼Œåšå¥½åˆ†å·¥ï¼Œç‰¹åˆ«æ˜¯ Storyboard å’Œ XIB å¤šç§ï¼Œå°½é‡é¿å…å‡ºç°å¤šäººä¿®æ”¹åŒä¸€ä¸ªæ–‡ä»¶ã€‚ æ¯ä¸ªäººçš„æ‰€æœ‰å¼€å‘å·¥ä½œéƒ½åªåœ¨è‡ªå·±çš„åˆ†æ”¯å¼€å‘ã€‚ä¾‹å¦‚å°æ˜å¼€å‘ï¼Œä½ å°±åœ¨æœ¬åœ°åˆ‡æ¢åˆ°è‡ªå·±çš„ xiaoming_gittutorial åˆ†æ”¯ç„¶åè¿›è¡Œå¼€å‘ã€‚ æ¯ä¸ªäººåªå…è®¸åœ¨è‡ªå·±çš„åˆ†æ”¯ç›´æ¥pushè¿œç¨‹åˆ†æ”¯ã€‚ åˆå¹¶çš„æ—¶å€™å¿…é¡»éµå¾ªä»¥ä¸‹æ¡ä»¶ï¼š é¦–å…ˆï¼Œæœ¬åœ°åˆ‡æ¢åˆ°developåˆ†æ”¯ã€‚pull```123* ä¾‹å¦‚ä½ æ˜¯å°æ˜ï¼Œé‚£ä¹ˆåœ¨ pull åˆ°è¿œç¨‹çš„ develop æœ€æ–°çš„å†…å®¹ä¹‹åã€‚```git merge xiaoming_gittutorial å¦‚æœå‡ºç° conflict é‚£ä¹ˆæ¸…é™¤ conflict ä¹‹åï¼Œcommit ç„¶åæŠŠæœ¬åœ° develop push åˆ°è¿œç¨‹çš„ developã€‚ æ¯å®Œæˆä¸€ä¸ªåŠŸèƒ½å°±æäº¤ä¸€æ¬¡ï¼Œä¸è¦ç´¯è®¡ä»£ç ã€‚ ä¿è¯ä¸»åˆ†æ”¯ä»£ç æ°¸è¿œå¯è¿è¡Œï¼Œç‰ˆæœ¬å®Œæ•´ï¼ˆç”¨äºè„šæœ¬è‡ªåŠ¨åŒ–å‘æµ‹è¯•åŒ…ï¼‰ã€‚ è¿™æ ·çš„æµç¨‹æœ‰ä»€ä¹ˆå¥½å¤„å‘¢ï¼Ÿ å‡ ä¹ä¸ä¼šå‡ºç° conflictã€‚ ä½ æ°¸è¿œä¹Ÿä¸ä¼šæ±¡æŸ“ develop åˆ†æ”¯ã€‚ æ¯æ¬¡éƒ½æ˜¯åœ¨æœ¬åœ° merge å®Œæ¸…é™¤äº† conflict ä¹‹åå† push ä¼šè¿œç«¯ï¼Œé‚£ä¹ˆåˆ«äººæ›´æ–°æœ¬åœ° develop åˆ†æ”¯ï¼Œå†åˆå¹¶çš„æ—¶å€™ï¼Œå°±ç®—å‡ºç° conflict ä¹Ÿåªä¼šæ˜¯è‡ªå·±æœ€æ–°ä»£ç äº§ç”Ÿçš„ conflictã€‚ Sketch è®¾è®¡å·¥å…· + Zeplin æ ‡æ³¨å·¥å…·ç§»åŠ¨ç«¯ä¹Ÿå±äºå‰ç«¯ï¼Œæ˜¯åšç›´æ¥å’Œç”¨æˆ·æ‰“äº¤é“çš„äº‹æƒ…ï¼Œå½“ç„¶ä¹ŸåŒ…æ‹¬è®¾è®¡ç‹®ï¼Œè®¾è®¡ç‹®æ˜¯ä¸€ç§å¾ˆå‰å®³çš„çŒ«ç§‘åŠ¨ç‰©ï¼Œä»–ä»¬æœ‰ç€ä»¤äººææƒ§çš„åƒç´ çœ¼å’Œè¡€ç»Ÿä¸­çš„å¼ºè¿«ç—‡ã€‚ï¼ˆä»¥ä¸Šæˆ‘å–å¤šäº†è¯´çš„ï¼Œä¸è¦å½“çœŸå“ˆ~ï¼‰ Sketch ä½œä¸ºä¸€æ¬¾ç§»åŠ¨æ—¶ä»£è®¾è®¡å¸ˆæ–°å® ï¼Œè‡ªç„¶æœ‰å…¶å­˜åœ¨çš„é“ç†ã€‚ è‡ªåŠ¨ä¿å­˜å’Œç‰ˆæœ¬ç®¡ç† çŸ¢é‡ç¼–è¾‘å’Œå®Œç¾åƒç´  æ™ºèƒ½å‚è€ƒçº¿ è‡ªç”±ç¼–è¾‘å…ƒç´  å¸ƒå°”è¿ç®— å•å›¾å±‚å¤šé‡æ··åˆæ¨¡å¼ å››èˆäº”å…¥åƒç´ æ•°å€¼å–æ•´ å…±äº«æ ·å¼å’Œç»„ä»¶ ä¼˜ç§€çš„è¾“å‡º åˆ†é…é—´è· ç§»åŠ¨è®¾å¤‡æ¨¡ç‰ˆ è‡ªå¸¦æ ¼æ … å‡ºè‰²çš„æ–‡å­—æ¸²æŸ“ ä¸°å¯Œçš„æ’ä»¶ï¼ˆæ ‡æ³¨ã€å†…å®¹å¡«å……ï¼‰ å¤šç§è½¯ä»¶é«˜åº¦é…åˆ æ—‹è½¬å¤åˆ¶ æ‰‹æœºå®æ—¶é¢„è§ˆ Zeplin é¢å‘çš„ç”¨æˆ·æ˜¯è®¾è®¡å¸ˆå’Œå‰ç«¯ï¼ˆWebã€Mobileï¼‰å·¥ç¨‹å¸ˆï¼Œç›¸å½“äºåšçš„æ˜¯ä¸­é—´æ¡¥æ¢è¿™ä¸€å—ï¼Œæ ¸å¿ƒåŠŸèƒ½ä¸ºæ ‡æ³¨ã€Style Guideã€å¤‡æ³¨æ–‡æ¡£ä¸ç®€å•çš„å›¢é˜Ÿåä½œã€‚ sketchæ”¯æŒå¤šç”»æ¿ï¼Œä¾¿äºåŒæ—¶é¢„è§ˆï¼Œå ç”¨å†…å­˜è¾ƒpså°å¾ˆå¤š sketchæ”¯æŒå¯¼å‡ºflintoï¼Œä¾¿äºåˆ¶ä½œäº¤äº’åŠ¨æ•ˆåŸå‹ zeplinè§£æ”¾è®¾è®¡å¸ˆçš„åŒæ‰‹ï¼Œä»æ­¤å‘Šåˆ«åˆ‡å›¾å’Œæ ‡æ³¨ zepliné™ä½å·¥ç¨‹å¸ˆçš„æ²Ÿé€šæˆæœ¬ï¼Œæé«˜è®¾è®¡è¿˜åŸåº¦ Abstract å°±æ˜¯ä¸€ä¸ªå€ŸåŠ© Git å¯¹ Sketch æ–‡ä»¶è¿›è¡Œç‰ˆæœ¬æ§åˆ¶çš„è½¯ä»¶ã€‚ è¯¦æƒ…å‚è§ã€ŠGit ä¸ Sketch çš„ç¥å¥‡é‚‚é€…ï¼šAbstractã€‹ï¼ˆhttps://sspai.com/post/40595ï¼‰ æˆæœå¹´ç»ˆæ€»ç»“ Github åŸåˆ›å¼€æºé¡¹ç›® 90+ï¼Œå…±è®¡ 400+ è´¡çŒ®åŠ› å‚ä¸ç»´æŠ¤å¼€æºé¡¹ç›® fastlane 20.5kï¼ˆè‡³2018.02.08ï¼‰ å®Œæˆ Swifter åŠŸèƒ½å±•ç¤ºåº”ç”¨ç ”å‘ Swifter æ˜¯ä¸€æ¬¾åŸºäº Swift å¼€å‘çš„ï¼Œé‡‡ç”¨ MVVM æ¨¡å¼ã€RxSwift å‡½æ•°å¼å“åº”ç¼–ç¨‹ã€ç»„ä»¶åŒ–å’Œ ReactNative ç­‰æŠ€æœ¯çš„æŠ€æœ¯ç¤ºä¾‹åº”ç”¨ã€‚","categories":[{"name":"Summary","slug":"Summary","permalink":"https://reversescale.github.io/categories/Summary/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"è®© Async å¸®ä½ è§£å†³çº¿ç¨‹é—®é¢˜","slug":"Library Async","date":"2018-02-23T03:56:27.000Z","updated":"2018-11-16T12:09:19.724Z","comments":true,"path":"2018/02/23/Library Async/","link":"","permalink":"https://reversescale.github.io/2018/02/23/Library Async/","excerpt":"çº¿ç¨‹è¿™ç§ä¸œè¥¿ä¸€èˆ¬å°è£…æ¯”è¾ƒæ·±ï¼Œå¾ˆå¾®è§‚ï¼Œä¹Ÿå¾ˆè€ƒå¯Ÿè®¡ç®—æœºåŸºç¡€çŸ¥è¯†ï¼Œè™½ç„¶ç³»ç»Ÿä¸ºæˆ‘ä»¬å°è£…çš„ GCDã€NSOperation å·²ç»å¾ˆå¥½ç”¨äº†ï¼Œä½†æ˜¯æˆ‘å‘ç°äº†ä¸ªæ›´å¥½ç”¨çš„~","text":"çº¿ç¨‹è¿™ç§ä¸œè¥¿ä¸€èˆ¬å°è£…æ¯”è¾ƒæ·±ï¼Œå¾ˆå¾®è§‚ï¼Œä¹Ÿå¾ˆè€ƒå¯Ÿè®¡ç®—æœºåŸºç¡€çŸ¥è¯†ï¼Œè™½ç„¶ç³»ç»Ÿä¸ºæˆ‘ä»¬å°è£…çš„ GCDã€NSOperation å·²ç»å¾ˆå¥½ç”¨äº†ï¼Œä½†æ˜¯æˆ‘å‘ç°äº†ä¸ªæ›´å¥½ç”¨çš„~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo ğŸ¤– è¦æ±‚ iOS 9.0+ Xcode 9.0+ Swift 4 ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ 1.å±•ç¤ºé¡µ 2.å±•ç¤ºé¡µ 3.å±•ç¤ºé¡µ å¸¸è§åœºæ™¯åˆ—è¡¨ è€—æ—¶æ“ä½œåœºæ™¯ç¤ºä¾‹ é»‘ç§‘æŠ€æ“ä½œåœºæ™¯ç¤ºä¾‹ ğŸ¯ å®‰è£…æ–¹æ³•åœ¨ iOS, ä½ éœ€è¦åœ¨ Podfile ä¸­æ·»åŠ .12345source &apos;https://github.com/CocoaPods/Specs.git&apos;platform :ios, &apos;9.0&apos;use_frameworks!pod &apos;AsyncSwift&apos; ğŸ›  é…ç½®è€—æ—¶æ“ä½œè¿™æ˜¯åº”ç”¨æœ€å¹¿æ³›çš„åœºæ™¯ï¼Œä¸ºäº†é¿å…é˜»å¡ä¸»çº¿ç¨‹ï¼Œå°†è€—æ—¶æ“ä½œæ”¾åœ¨å­çº¿ç¨‹å¤„ç†ï¼Œç„¶ååœ¨ä¸»çº¿ç¨‹ä½¿ç”¨å¤„ç†ç»“æœã€‚æ¯”å¦‚è¯»å–æ²™ç›’ä¸­çš„ä¸€äº›æ•°æ®ï¼Œç„¶åå°†è¯»å–çš„æ•°æ®å±•ç¤ºåœ¨ UIï¼Œè¿™ä¸ªåœºæ™¯è¿˜æœ‰å‡ ä¸ªç»†åˆ†ï¼š1.1 æ‰§è¡Œä¸€ä¸ªè€—æ—¶æ“ä½œåå›è°ƒä¸»çº¿ç¨‹123456Async.background &#123;print(\"A: This is run on the \\(qos_class_self().description) (expected \\(QOS_CLASS_BACKGROUND.description))\") sleep(2)&#125;.main &#123; print(\"B: This is run on the \\(qos_class_self().description) (expected \\(qos_class_main().description)), after the previous block\")&#125; 1.2 ä¸²è¡Œè€—æ—¶æ“ä½œ æ¯ä¸€æ®µå­ä»»åŠ¡ä¾èµ–ä¸Šä¸€ä¸ªä»»åŠ¡å®Œæˆï¼Œå…¨éƒ¨å®Œæˆåå›è°ƒä¸»çº¿ç¨‹ï¼š1234567891011let backgroundBlock = Async.background &#123; print(\"This is run on the first\\(qos_class_self().description) (expected \\(QOS_CLASS_BACKGROUND.description))\") sleep(2) print(\"This is run on the second \\(qos_class_self().description) (expected \\(QOS_CLASS_BACKGROUND.description))\") sleep(2)&#125;// Run other code here...backgroundBlock.main &#123; print(\"This is run on the \\(qos_class_self().description) (expected \\(qos_class_main().description)), after the previous block\")&#125; 1.3 å¹¶å‘è€—æ—¶æ“ä½œ æ¯ä¸€æ®µå­ä»»åŠ¡ç‹¬ç«‹ï¼Œæ‰€æœ‰å­ä»»åŠ¡å®Œæˆåå›è°ƒä¸»çº¿ç¨‹ï¼š12345678910111213141516Async.main &#123; print(\"This is run on the \\(qos_class_self().description) (expected \\(qos_class_main().description))\") // Prints: \"This is run on the Main (expected Main) count: 1 (expected 1)\" &#125;.userInteractive &#123; print(\"This is run on the \\(qos_class_self().description) (expected \\(QOS_CLASS_USER_INTERACTIVE.description))\") // Prints: \"This is run on the Main (expected Main) count: 2 (expected 2)\" &#125;.userInitiated &#123; print(\"This is run on the \\(qos_class_self().description) (expected \\(QOS_CLASS_USER_INITIATED.description)) \") // Prints: \"This is run on the User Initiated (expected User Initiated) count: 3 (expected 3)\" &#125;.utility &#123; print(\"This is run on the \\(qos_class_self().description) (expected \\(QOS_CLASS_UTILITY.description)) \") // Prints: \"This is run on the Utility (expected Utility) count: 4 (expected 4)\" &#125;.background &#123; print(\"This is run on the \\(qos_class_self().description) (expected \\(QOS_CLASS_BACKGROUND.description)) \") // Prints: \"This is run on the User Interactive (expected User Interactive) count: 5 (expected 5)\"&#125; å»¶æ—¶æ‰§è¡Œå»¶æ—¶ä¸€æ®µæ—¶é—´åæ‰§è¡Œä»£ç ï¼Œä¸€èˆ¬è§äºæ‰“å¼€ App ä¸€æ®µæ—¶é—´åï¼Œå¼¹å‡ºæ±‚å¥½è¯„å¯¹è¯æ¡†ã€‚123456let seconds = 3.0Async.main(after: seconds) &#123; print(\"Is called after 3 seconds\")&#125;.background(after: 6.0) &#123; print(\"At least 3.0 seconds after previous block, and 6.0 after Async code is called\")&#125; å…¶ä»–ç”¨æ³•è¯·è§ Demoã€‚ ğŸ˜¬ è”ç³» å¾®ä¿¡ : WhatsXie é‚®ä»¶ : ReverseScale@iCloud.com åšå®¢ : https://reversescale.github.io","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"é—¨ç½—å¸(Monero XMR)ç»™ä½ æœ€è½»å·§çš„çŸ¿å·¥ç”Ÿæ´»(åŒ…æ•™åŒ…ä¼š)","slug":"Monero XMR","date":"2018-02-08T18:56:27.000Z","updated":"2018-11-16T12:10:01.852Z","comments":true,"path":"2018/02/09/Monero XMR/","link":"","permalink":"https://reversescale.github.io/2018/02/09/Monero XMR/","excerpt":"ä½ å‘å¾€èººç€èµšé’±å—ï¼Ÿä½ æƒ³ä¸åŠªåŠ›å·¥ä½œå°±å®ç°è´¢åŠ¡è‡ªç”±å—ï¼Ÿä½ æƒ³ä»€ä¹ˆéƒ½ä¸åšå°±æœ‰æ•°ä¸å®Œçš„é’±å—ï¼Ÿæ´—æ´—ç¡å§~","text":"ä½ å‘å¾€èººç€èµšé’±å—ï¼Ÿä½ æƒ³ä¸åŠªåŠ›å·¥ä½œå°±å®ç°è´¢åŠ¡è‡ªç”±å—ï¼Ÿä½ æƒ³ä»€ä¹ˆéƒ½ä¸åšå°±æœ‰æ•°ä¸å®Œçš„é’±å—ï¼Ÿæ´—æ´—ç¡å§~ ä»2017å¹´8æœˆ21æ—¥å¼€å§‹ï¼ŒXMRä¸€è·¯èµ°é«˜ï¼Œä»$55å·¦å³ï¼Œä¸€è·¯ä¸Šæ¶¨ï¼Œåˆ°æœ¬æ–‡å†™ä½œæ—¶ï¼Œå·²ç»è¾¾åˆ°$269ï¼ˆâ‰ˆï¿¥1,699ï¼‰ã€‚æ•°æ®æ¥æºï¼šCrypto coins mining profit calculator compared to Ethereum é—¨ç½—å¸ï¼ˆMoneroï¼Œä»£å·XMRï¼‰æ˜¯ä¸€ä¸ªåˆ›å»ºäº2014å¹´4æœˆå¼€æºåŠ å¯†è´§å¸ï¼Œå®ƒç€é‡äºéšç§ã€åˆ†æƒå’Œå¯æ‰©å±•æ€§ã€‚ä¸è‡ªæ¯”ç‰¹å¸è¡ç”Ÿçš„è®¸å¤šåŠ å¯†è´§å¸ä¸åŒï¼ŒMoneroåŸºäºCryptoNoteåè®®ï¼Œå¹¶åœ¨åŒºå—é“¾æ¨¡ç³ŠåŒ–æ–¹é¢æœ‰æ˜¾è‘—çš„ç®—æ³•å·®å¼‚ã€‚Moneroçš„æ¨¡å—åŒ–ä»£ç ç»“æ„å¾—åˆ°äº†æ¯”ç‰¹å¸æ ¸å¿ƒç»´æŠ¤è€…ä¹‹ä¸€çš„Wladimir J. van der Laançš„èµèµã€‚Moneroè‡´åŠ›äºæˆä¸ºå¯ä»£æ›¿çš„ä¸å¯è¿½è¸ªçš„ç”µå­è´§å¸ã€‚ç›¸æ¯”æ¯”ç‰¹å¸åŠå…¶åˆ†å‰ï¼ŒMoneroå…·æœ‰æ›´é«˜ç¨‹åº¦çš„åŒ¿åæ€§ã€‚ Moneroäº2014å¹´4æœˆ18æ—¥å‘å¸ƒã€‚ é«˜æ¶¨çš„å¸ä»·ä½¿å¾—åœ¨å›½å†…ä¸€ç›´é»˜é»˜æ— é—»çš„XMRç¬é—´æˆä¸ºç„¦ç‚¹ï¼Œç°åœ¨å·²ç»å˜æˆæŒ–çŸ¿æ”¶ç›Šæœ€é«˜çš„å¸ç§ä¹‹ä¸€ã€‚ä»¥1060 3Gä¸ºä¾‹ï¼Œåœ¨ä¸è¶…é¢‘çš„æƒ…å†µä¸‹ï¼ŒæŒ–æ˜XMRçš„é€Ÿåº¦åœ¨430H/så·¦å³ï¼Œä¸è®¡ç”µè´¹ï¼Œå•å¡æ—¥æ”¶ç›Šè¾¾åˆ°$1.62ï¼Œè¶…è¿‡äº†ä¹‹å‰æ”¶ç›Šä¹‹ç‹ETHã€‚ å¦‚ä½•æŒ–çŸ¿ï¼Ÿ ä½œä¸ºçŸ¿å·¥ï¼Œå¤§å®¶æœ€å…³å¿ƒçš„åº”è¯¥è¿˜æ˜¯æ€ä¹ˆæŒ–çŸ¿äº†ï¼Œä¸‹é¢å°±å‘å¤§å®¶ä»‹ç»ä¸€ä¸‹æŒ–çŸ¿çš„æœ€è½»å·§å§¿åŠ¿ã€‚ è·å¾—ä¸€ä¸ªé’±åŒ…åœ°å€ï¼ˆæ¨èï¼‰ä½¿ç”¨åœ¨çº¿é’±åŒ…ï¼šhttps://mymonero.com/ç‰¹ç‚¹ï¼šä½¿ç”¨æ–¹ä¾¿ï¼Œå®‰å…¨æ€§å·® æˆ–è€…åœ¨XMRçš„å®˜æ–¹ç½‘ç«™ä¸‹è½½é’±åŒ… Appï¼šMonero: Downloads(https://getmonero.org/downloads/)ç‰¹ç‚¹ï¼šç›¸å¯¹å®‰å…¨ï¼Œæ–¹ä¾¿æ€§å·® å‚ä¸æŒ–çŸ¿åœ¨ç½‘ä¸Šï¼Œä½ å¯èƒ½çœ‹åˆ°è¿‡è®¸è®¸å¤šå¤šç¡¬ä»¶é©±åŠ¨çš„æŒ–çŸ¿æ–¹å¼ï¼Œç»„åˆå¤šå°‘æ˜¾å¡çš„çŸ¿æ± ï¼Œä½†æ˜¯è¿™é‡Œçš„ä¸»é¢˜æ˜¯â€œæœ€è½»å·§â€ï¼Œæ‰€ä»¥æˆ‘ä»¬åªåšå¸®å·¥å¥½äº†ã€‚ Coinhiveæ˜¯ä¸€ä¸ªæä¾›æ¶æ„JSè„šæœ¬çš„ç½‘ç«™å¹³å°ï¼ˆhttps://coinhive.comï¼‰ï¼Œå…è®¸æ”»å‡»è€…å°†è„šæœ¬æŒ‚åœ¨åˆ°è‡ªå·±çš„æˆ–å…¥ä¾µçš„ç½‘ç«™ä¸Šï¼Œæ‰€æœ‰è®¿é—®è¯¥ç½‘ç«™çš„ç”¨æˆ·éƒ½å¯èƒ½æˆä¸ºé—¨ç½—å¸çš„æŒ–æ˜çŸ¿å·¥ã€‚è¯¥å·¥å…·åœ¨ç½‘ç»œçŠ¯ç½ªåˆ†å­ä¸­é—´è¿…é€Ÿæ‰©æ•£ï¼Œä¿¨ç„¶å·²ç»æˆä¸ºäº†äº’è”ç½‘çš„â€œMartin Shkreliâ€ã€‚ Coinhiveå·¥å…·å…¶å®æ˜¯ä¸€ä¸ªJavaåº“ï¼Œç”¨æˆ·è®¿é—®åŠ è½½è¯¥JSçš„ç½‘ç«™åï¼ŒCoinhiveçš„JSä»£ç åº“åœ¨ç”¨æˆ·çš„æµè§ˆå™¨ä¸Šè¿è¡Œï¼Œå¼€å§‹ä¸ºç½‘ç«™æ‰€æœ‰è€…æŒ–æ˜é—¨ç½—å¸ï¼Œæ¶ˆè€—çš„æ˜¯ç”¨æˆ·è‡ªå·±çš„CPUèµ„æºã€‚ ä¸å¾—ä¸è¯´ï¼Œè¿™ä¸ªæƒ³æ³•ç›¸å½“åœ°æœ‰åˆ›æ„ï¼Coinhiveäº9æœˆ14æ—¥æ¨å‡ºï¼Œä½œè€…å‘ç«™é•¿ä»¬æ¨å¹¿Coinhiveæ—¶å£°ç§°ï¼Œç«™é•¿ä»¬åŠ è½½äº†Coinhive JSå°±å¯ä»¥å®ç°ç›ˆåˆ©ï¼šå®ƒä»…è€—è´¹è®¿é—®ç”¨æˆ·çš„å°‘éƒ¨åˆ†CPUï¼Œå°±å¯ä»¥ä¸ºç½‘ç«™æ‰€æœ‰è€…èµšå–åˆ©æ¶¦ï¼Œç”¨äºæ”¯æŒä»–ä»¬çš„ä¸šåŠ¡ï¼Œå†ä¹Ÿä¸ç”¨æ·»åŠ å„ç§çƒ¦äººçš„å¹¿å‘Šäº†ã€‚ è¿™ä¸€æƒ³æ³•è·å¾—äº†æŸäº›äººçš„æ”¯æŒï¼Œåœ¨The Pirate Bayï¼ˆå…¨çƒçŸ¥åçš„BTä¸‹è½½ç½‘ç«™ï¼‰è¯•è¿è¡Œäº†ä¸¤å¤©åï¼Œç”±äºç”¨æˆ·çš„è´Ÿé¢åé¦ˆï¼Œæœ€åæ”¾å¼ƒäº†ã€‚ æœªå¼€æƒ…å†µä¸‹ CPU å ç”¨ï¼š ç†è®ºä¸Šä½ å¯ä»¥ä½¿ç”¨é—²ç½®çš„é‚£ 54.08% è¿›è¡ŒæŒ–çŸ¿ï¼Œå®æµ‹å¯¹ CPU çš„è´Ÿè·è¿˜æ˜¯å¾ˆå¤§çš„ä¸‹å›¾æ˜¯å¼€é€š100 Threads ä¸‹å¤„ç†å™¨å ç”¨æƒ…å†µï¼š çŸ¿å·¥åˆ†æˆä¹‹å‰å·²ç»ä»‹ç»è¿‡è¿™ç§æœºåˆ¶çš„åŸç†äº†ï¼Œè½»é‡ä¹Ÿæ³¨å®šç€æ”¶ç›Šä¸ä¼šå¤ªé«˜ï¼Œä½†æ˜¯ç®€å•çš„ä½¿ç”¨å´å¯ä»¥ä¸ºä½ çœä¸‹å¤§æŠŠæ—¶é—´ï¼Œç›¸ä¿¡ä½ çš„æ—¶é—´æ‰æ˜¯æœ€å®è´µçš„ã€‚ ä¸Šé¢é‚£äº›å¯¹äºåˆšåˆšæ¥è§¦çš„ä½ å¯èƒ½ä¸æ˜¯å¾ˆå—ç”¨ï¼Œé‚£æ¥çœ‹çœ‹ä¸‹é¢è¿™äº› ä»¥ä¸ºè¿™æ ·ä»¥åæ¯å¤©çš„æ—©é¤é’±å°±æœ‰äº†ï¼ŸğŸ˜†é‚£ä½ æœ€å¥½ä»”ç»†è¯»è¯»ä¸‹é¢çš„ä¸œè¥¿â€¦","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"Blockchain","slug":"Blockchain","permalink":"https://reversescale.github.io/tags/Blockchain/"}]},{"title":"iOS æ¨¡å—åŒ–è·¯ç”±ä¹‹ JLRoute","slug":"Library JLRoute","date":"2018-02-01T13:56:27.000Z","updated":"2018-11-16T12:09:27.900Z","comments":true,"path":"2018/02/01/Library JLRoute/","link":"","permalink":"https://reversescale.github.io/2018/02/01/Library JLRoute/","excerpt":"åŸºäº JLRoute å®ç°çš„æ¨¡å—åŒ–è·¯ç”±ï¼Œæ”¯æŒè‡ªåŠ¨æ³¨å†Œæ˜ å°„è¡¨ã€Url è·³è½¬åŸç”Ÿé¡µé¢ã€WebView é¡µé¢å’Œ ReactNative é¡µé¢ã€è·³è½¬ä¼ å‚åŠå›è°ƒç­‰~","text":"åŸºäº JLRoute å®ç°çš„æ¨¡å—åŒ–è·¯ç”±ï¼Œæ”¯æŒè‡ªåŠ¨æ³¨å†Œæ˜ å°„è¡¨ã€Url è·³è½¬åŸç”Ÿé¡µé¢ã€WebView é¡µé¢å’Œ ReactNative é¡µé¢ã€è·³è½¬ä¼ å‚åŠå›è°ƒç­‰~ æ¨¡å—åŒ–å·²ç»æˆä¸ºè°ƒå‰‚åºå¤§é¡¹ç›®ç»“æ„çš„ä¸€å‰‚è‰¯è¯ï¼Œå¯¹é¡¹ç›®çš„å¼€å‘ã€ç»´æŠ¤å’Œåç»­çš„æ‰©å±•çš„å¥½å¤„å·²ç»ä¸è¨€è€Œå–»ã€‚ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo ğŸ¤– è¦æ±‚ iOS 8.0+ Xcode 7.0+ ğŸ¯ å®‰è£…æ–¹æ³•å®‰è£…åœ¨ iOS, ä½ éœ€è¦åœ¨ Podfile ä¸­æ·»åŠ .1234567891011121314151617source &apos;https://github.com/CocoaPods/Specs.git&apos;platform :ios, &apos;9.0&apos;use_frameworks!pod &apos;JLRoutes&apos;, &apos;~&gt; 2.0.1&apos;# &apos;node_modules&apos;ç›®å½•ä¸€èˆ¬ä½äºæ ¹ç›®å½•ä¸­# ä½†æ˜¯å¦‚æœä½ çš„ç»“æ„ä¸åŒï¼Œé‚£ä½ å°±è¦æ ¹æ®å®é™…è·¯å¾„ä¿®æ”¹ä¸‹é¢çš„`:path`pod &apos;React&apos;, :path =&gt; &apos;./node_modules/react-native&apos;, :subspecs =&gt; [ &apos;Core&apos;, &apos;RCTText&apos;, &apos;RCTNetwork&apos;, &apos;RCTWebSocket&apos;, # è¿™ä¸ªæ¨¡å—æ˜¯ç”¨äºè°ƒè¯•åŠŸèƒ½çš„ # åœ¨è¿™é‡Œç»§ç»­æ·»åŠ ä½ æ‰€éœ€è¦çš„æ¨¡å—]# å¦‚æœä½ çš„RNç‰ˆæœ¬ &gt;= 0.42.0ï¼Œè¯·åŠ å…¥ä¸‹é¢è¿™è¡Œpod &quot;Yoga&quot;, :path =&gt; &quot;./node_modules/react-native/ReactCommon/yoga&quot; å¯åŠ¨ ReactNative ç¯å¢ƒ1.ä¿®æ”¹é¡¹ç›®ModuleARNPageViewController.m IP è·³è½¬åœ°å€ 2.è¿›å…¥é¡¹ç›®æ‰€åœ¨ç›®å½•ï¼Œè¿è¡Œ(é¦–æ¬¡è¿è¡Œéœ€è¦ npm install) 1npm start ğŸ›  JLRoutesçš„å·¥ä½œæµç¨‹å’ŒåŸç†å•ä¸€çš„Schemeæ³¨å†Œè¿‡ç¨‹ï¼š 1.è°ƒç”¨æ³¨å†Œæ–¹æ³•ï¼ˆç”¨æˆ·æ³¨å†ŒroutePatternï¼Œé»˜è®¤ä¼˜å…ˆçº§0ï¼‰ 1- (void)addRoute:(NSString *)routePattern handler:(BOOL (^__nullable)(NSDictionary&lt;NSString *, id&gt; *parameters))handlerBlock; 2.è·¯ç”±è§£æï¼ˆè¿™äº›è§£æè·Ÿæˆ‘ä»¬è®¾ç½®è·¯ç”±çš„è§„åˆ™æœ‰ç›´æ¥å…³ç³»ï¼‰ (1)åˆ¤æ–­æ¥å£URLæ˜¯å¦è®¾ç½®å¯é€‰æ€§URLå¹¶å°†å¯¹åº”çš„URLå°è£…æˆJLRRouteDefinitionå¯¹è±¡ (2)å°†JLRRouteDefinitionå¯¹è±¡è£…è½½è¿›ä¸€ä¸ªå¯å˜æ•°ç»„ï¼Œå†…å­˜ä¿ç•™äº†æ‰€æœ‰çš„å¯¹è±¡ï¼ï¼ ï¼ˆJLRRouteDefinitionå¯¹è±¡åŒ…æ‹¬æœ‰è·¯å¾„ï¼Œå‚æ•°è§£æï¼Œblockç­‰ä¿¡æ¯ï¼‰ å•ä¸€çš„Schemeè°ƒç”¨è¿‡ç¨‹ï¼š1.è°ƒç”¨URL 1+ (BOOL)routeURL:(NSURL *)URL 2.è§£æURLï¼Œå°†å‚æ•°ï¼Œè·¯ç”±ä¿¡æ¯å°è£…æˆJLRRouteRequestå¯¹è±¡ 1- (instancetype)initWithURL:(NSURL *)URL alwaysTreatsHostAsPathComponent:(BOOL)alwaysTreatsHostAsPathComponent 3.ç»™JLrouteRequestå¯¹è±¡å’Œè·¯ç”±æ•°ç»„é‡Œçš„JLRRouteDefinitionå¯¹è±¡ä½œæ¯”å¯¹ï¼Œå¹¶ä¸”è¿”å›JLRRouteResponse å¯¹è±¡æŠ½å‡ºå‚æ•°å’ŒURLåœ¨æ•°ç»„é‡Œ 1JLRRouteResponse *response = [route routeResponseForRequest:request decodePlusSymbols:shouldDecodePlusSymbols]; 4.è°ƒç”¨JLRRouteResponse å¯¹è±¡é‡Œé¢çš„å›è°ƒæ–¹æ³• 1[route callHandlerBlockWithParameters:finalParameters]; JLRoutesçš„URLæ³¨å†Œè§„åˆ™ï¼š 1.æ™®é€šæ³¨å†Œ 123456JLRoutes *routes = [JLRoutes globalRoutes];[routes addRoute:@&quot;/user/view/:userID&quot; handler:^BOOL(NSDictionary *parameters) &#123;NSString *userID = parameters[@&quot;userID&quot;]; // defined in the route by specifying &quot;:userID&quot;// present UI for viewing user with ID &apos;userID&apos;return YES; // return YES to say we have handled the route&#125;]; URLé‡Œï¼Œåˆ†å·è¡¨ç¤ºè¿™ä¸ªæ˜¯å‚æ•° å¦å¤–ä¸€ç§æ³¨å†Œæ–¹å¼ï¼Œä¸‹æ ‡æ³¨å†Œæ³• 123JLRoutes.globalRoutes[@&quot;/route/:param&quot;] = ^BOOL(NSDictionary *parameters) &#123;// ...&#125;; å¦‚ä½•æŒ‰ç…§ä»¥ä¸Šçš„æ–¹å¼æ³¨å†Œï¼Œåœ¨ä»»ä½•æ—¶åˆ»ï¼ˆåŒ…æ‹¬åœ¨å…¶å®ƒçš„APPï¼‰ä½ éƒ½å¯ä»¥è°ƒç”¨è¿™ä¸ªURLã€‚ 12NSURL *viewUserURL = [NSURL URLWithString:@&quot;myapp://user/view/joeldev&quot;];[[UIApplication sharedApplication] openURL:viewUserURL]; åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œåœ¨parmameterså­—å…¸é‡Œé¢çš„userIDä¼šä¼ ç»™blockï¼Œå®ƒæ˜¯ä¸€ä¸ªé”®å€¼å¯¹ã€‚â€userIDâ€: â€œjoeldevâ€ã€‚ç»™UIå±‚æˆ–è€…ä»»ä½•éœ€è¦å®ƒçš„åœ°æ–¹ç”¨çš„ã€‚ å­—å…¸å‚æ•°ï¼š å­—å…¸å‚æ•°æ€»åŒ…æ‹¬è‡³å°‘ä¸€ä¸‹3ä¸ªé”®ï¼š 12345&#123;&quot;JLRouteURL&quot;: &quot;(the NSURL that caused this block to be fired)&quot;,&quot;JLRoutePattern&quot;: &quot;(the actual route pattern string)&quot;,&quot;JLRouteScheme&quot;: &quot;(the route scheme, defaults to JLRoutesGlobalRoutesScheme)&quot;&#125; å¤„ç†Block ä½ ä¼šå‘ç°ï¼Œæ¯ä¸ªæ³¨å†Œçš„blockéƒ½ä¼šè¿”å›ä¸€ä¸ªYESã€‚è¿™ä¸ªå€¼ï¼Œå¦‚æœä½ è¿”å›NOï¼ŒJLRoutesä¼šè·³è¿‡è¿™ä¸ªåŒ¹é…ï¼Œç„¶åç»§ç»­å»åŒ¹é…å…¶å®ƒçš„ã€‚ å¦‚æœä½ çš„blockè®¾ç½®æˆnilï¼Œå®ƒä¼šé»˜è®¤è¿”å›YESã€‚ 2.å¤æ‚æ³¨å†Œ 1234567[[JLRoutes globalRoutes] addRoute:@&quot;/:object/:action/:primaryKey&quot; handler:^BOOL(NSDictionary *parameters) &#123;NSString *object = parameters[@&quot;object&quot;];NSString *action = parameters[@&quot;action&quot;];NSString *primaryKey = parameters[@&quot;primaryKey&quot;];// stuffreturn YES;&#125;]; è¿™ä¸ªåœ°å€ä¼šè¢«åŒ¹é…å¾ˆå¤šURLï¼Œå¦‚/user/view/joeldev or /post/edit/123ã€‚è¿™äº›URLä¸Šçš„æ˜¯å‚æ•°ã€‚ 12NSURL *editPost = [NSURL URLWithString:@&quot;myapp://post/edit/123?debug=true&amp;foo=bar&quot;];[[UIApplication sharedApplication] openURL:editPost]; è¿™æ—¶ï¼Œpramaterå­—å…¸å°±ä¼šæ˜¯ä»¥ä¸‹è¿™æ ·çš„ï¼ˆä¼ å‚ï¼‰ 12345678910&#123;&quot;object&quot;: &quot;post&quot;,&quot;action&quot;: &quot;edit&quot;,&quot;primaryKey&quot;: &quot;123&quot;,&quot;debug&quot;: &quot;true&quot;,&quot;foo&quot;: &quot;bar&quot;,&quot;JLRouteURL&quot;: &quot;myapp://post/edit/123?debug=true&amp;foo=bar&quot;,&quot;JLRoutePattern&quot;: &quot;/:object/:action/:primaryKey&quot;,&quot;JLRouteScheme&quot;: &quot;JLRoutesGlobalRoutesScheme&quot;&#125; 3.Schemeï¼ˆæœ‰æ²¡æœ‰å¤šæ€çš„æ„Ÿè§‰ï¼‰ JLRoutesæ”¯æŒç”¨æŒ‡å®šçš„URL schemeæ¥åˆ›å»ºè·¯ç”±ã€‚ç›¸åŒçš„schemeæ‰èƒ½è¢«åŒ¹é…ã€‚é»˜è®¤åœ°ï¼Œæ‰€æœ‰çš„URLä¼šè®¾ç½®è¿›global schemeã€‚ 123456789101112[[JLRoutes globalRoutes] addRoute:@&quot;/foo&quot; handler:^BOOL(NSDictionary *parameters) &#123;// This block is called if the scheme is not &apos;thing&apos; or &apos;stuff&apos; (see below)return YES;&#125;];[[JLRoutes routesForScheme:@&quot;thing&quot;] addRoute:@&quot;/foo&quot; handler:^BOOL(NSDictionary *parameters) &#123;// This block is called for thing://fooreturn YES;&#125;];[[JLRoutes routesForScheme:@&quot;stuff&quot;] addRoute:@&quot;/foo&quot; handler:^BOOL(NSDictionary *parameters) &#123;// This block is called for stuff://fooreturn YES;&#125;]; å¦‚æœä½ è°ƒç”¨çš„ä½¿ç”¨ï¼Œæ˜¯è¿™æ ·è°ƒç”¨çš„ 123[[JLRoutes globalRoutes] addRoute:@&quot;/global&quot; handler:^BOOL(NSDictionary *parameters) &#123;return YES;&#125;]; å®ƒåªä¼šè°ƒç”¨global schemeçš„å¯¹åº”çš„URLã€‚ä¸ä¼šè°ƒç”¨ting schemeé‡Œé¢å¯¹åº”çš„URLã€‚ å½“ç„¶ï¼Œä½ å¯ä»¥è®¾ç½®ï¼Œå¦‚æœæŒ‡å®šçš„schemeæ²¡æœ‰è¿™ä¸ªURLï¼Œå»æŸ¥è¯¢global scheme æœ‰æ²¡æœ‰ã€‚ä½ éœ€è¦è®¾ç½®ä¸€ä¸ªå±æ€§ã€‚ 1[JLRoutes routesForScheme:@&quot;thing&quot;].shouldFallbackToGlobalRoutes = YES; 3.é€šé…ç¬¦çš„è®¾ç½®URLçš„æ–¹å¼ é€šé…ç¬¦ä¸ºï¼š* é€šé…ç¬¦ç¬¦åé¢æ‰€æœ‰çš„URLä¸Šçš„å‚æ•°éƒ½ä¼šä»¥ä¸€ä¸ªæ•°ç»„ä¿å­˜åœ¨parameterså­—å…¸é‡Œé¢çš„JLRouteWildcardComponentsKeyå¯¹åº”çš„valueé‡Œã€‚ ä¾‹å¦‚ï¼Œå¦‚æœä½ æ³¨å†ŒURLå¦‚ä¸‹: 123456789[[JLRoutes globalRoutes] addRoute:@&quot;/wildcard/*&quot; handler:^BOOL(NSDictionary *parameters) &#123;NSArray *pathComponents = parameters[JLRouteWildcardComponentsKey];if ([pathComponents count] &gt; 0 &amp;&amp; [pathComponents[0] isEqualToString:@&quot;joker&quot;]) &#123;// the route matched; do stuffreturn YES;&#125;// not interested unless the joker&apos;s in itreturn NO;&#125;]; å¦‚æœè°ƒç”¨çš„URLå¼€å§‹æ˜¯ï¼wildcardï¼Œè¿™ä¸ªè·¯ç”±å°±å¯èƒ½è¢«è§¦å‘ï¼ï¼å¦‚æœç¬¬ä¸€ä¸ªå‚æ•°æ˜¯jokerï¼Œå°±è¢«è§¦å‘ï¼Œå¦‚æœä¸æ˜¯ï¼Œå°±è¢«æ‹’ç»è§¦å‘ã€‚ã€‚ã€‚ 4.é€‰æ‹©æ€§è·¯ç”± å¦‚æœè·¯ç”±åœ°å€è®¾ç½®æ ·å¼æœ‰æ‹¬å·ï¼Œå¦‚ï¼š/the(/foo/:a)(/bar/:b)ï¼Œå…¶å®å®ƒä»£è¡¨çš„URLæœ‰å¦‚ä¸‹ï¼š 1234/the/foo/:a/bar/:b/the/foo/:a/the/bar/:b/the 5.æŸ¥è¯¢Routes ä¸‹é¢çš„æ–¹å¼ï¼Œä½ å¯ä»¥æŸ¥çœ‹Routesé‡Œæ‰€æœ‰æ³¨å†Œçš„URL Routesã€‚ 1234/// All registered routes, keyed by scheme+ (NSDictionary &lt;NSString *, NSArray &lt;JLRRouteDefinition *&gt; *&gt; *)allRoutes;/// Return all registered routes in the receiving scheme namespace.- (NSArray &lt;JLRRouteDefinition *&gt; *)routes; è‡ªå®šä¹‰è·¯ç”±è§£æå¦‚æœä½ æƒ³è‡ªå·±å®šåˆ¶ä¸€ä¸ªè·¯ç”±ç¼–è¾‘ï¼Œä½ å¯ä»¥ç»§æ‰¿JLRouteDefinitionå¹¶ä¸”ç”¨ addRouteï¼šæ–¹æ³•å»æ·»åŠ ä½ è‡ªå®šä¹‰ç±»çš„å¯¹è±¡ã€‚ ğŸ“ è°ƒç ”æ¥æºJLRoutesï¼šhttps://github.com/joeldev/JLRoutes JLRoutesèµ„æ–™åšå®¢ï¼šhttps://www.varsiri.com/archives/305 ğŸ˜¬ è”ç³» å¾®ä¿¡ : WhatsXie é‚®ä»¶ : ReverseScale@iCloud.com åšå®¢ : https://reversescale.github.io","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iPhone X + iOS 11 é€‚é…æŒ‡å—","slug":"iPhone X iOS 11","date":"2017-09-30T09:56:27.000Z","updated":"2018-11-16T12:08:45.619Z","comments":true,"path":"2017/09/30/iPhone X iOS 11/","link":"","permalink":"https://reversescale.github.io/2017/09/30/iPhone X iOS 11/","excerpt":"åŒ—äº¬æ—¶é—´ä»Šå¤©å‡Œæ™¨1ç‚¹ï¼Œè‹¹æœå†ä¸€æ¬¡è®©å…¨ä¸–ç•Œæ²¸è…¾ã€‚iPhone X å¸¦ç»™æˆ‘ä»¬çš„æœ€å¤§æ”¹å˜ï¼šå…¨å± Super Retinaæ˜¾ç¤ºå±ã€‚å®ƒæä¾›äº†æ›´å¤šçš„å†…å®¹æ˜¾ç¤ºç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿè¥é€ äº†æ›´åŠ æ·±å…¥çš„æ²‰æµ¸æ„Ÿã€‚ä½œä¸º iOS å¼€å‘è€…ï¼Œåœ¨ä¸ºå¼ºå¤§çš„ Face ID å’Œå…¨é¢å±æ¬£å–œçš„åŒæ—¶ï¼Œæˆ‘æ›´æ‹…å¿§â€œé½åˆ˜æµ·â€çš„é€‚é…ï¼ ä¸‹é¢ç»“åˆå®˜æ–¹çš„äººæœºäº¤äº’æŒ‡å—ï¼Œæ¥äº†è§£ä¸‹å¦‚ä½•è®¾è®¡ App æ‰èƒ½åœ¨iPhone X å’Œå…¶ä»–æ‰€æœ‰ iOS è®¾å¤‡ä¸Šéƒ½çœ‹èµ·æ¥å¾ˆæ£’~","text":"åŒ—äº¬æ—¶é—´ä»Šå¤©å‡Œæ™¨1ç‚¹ï¼Œè‹¹æœå†ä¸€æ¬¡è®©å…¨ä¸–ç•Œæ²¸è…¾ã€‚iPhone X å¸¦ç»™æˆ‘ä»¬çš„æœ€å¤§æ”¹å˜ï¼šå…¨å± Super Retinaæ˜¾ç¤ºå±ã€‚å®ƒæä¾›äº†æ›´å¤šçš„å†…å®¹æ˜¾ç¤ºç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿè¥é€ äº†æ›´åŠ æ·±å…¥çš„æ²‰æµ¸æ„Ÿã€‚ä½œä¸º iOS å¼€å‘è€…ï¼Œåœ¨ä¸ºå¼ºå¤§çš„ Face ID å’Œå…¨é¢å±æ¬£å–œçš„åŒæ—¶ï¼Œæˆ‘æ›´æ‹…å¿§â€œé½åˆ˜æµ·â€çš„é€‚é…ï¼ ä¸‹é¢ç»“åˆå®˜æ–¹çš„äººæœºäº¤äº’æŒ‡å—ï¼Œæ¥äº†è§£ä¸‹å¦‚ä½•è®¾è®¡ App æ‰èƒ½åœ¨iPhone X å’Œå…¶ä»–æ‰€æœ‰ iOS è®¾å¤‡ä¸Šéƒ½çœ‹èµ·æ¥å¾ˆæ£’~ å‰è¨€åŒ—äº¬æ—¶é—´ä»Šå¤©å‡Œæ™¨1ç‚¹ï¼Œè‹¹æœå†ä¸€æ¬¡è®©å…¨ä¸–ç•Œæ²¸è…¾ã€‚iPhone X å¸¦ç»™æˆ‘ä»¬çš„æœ€å¤§æ”¹å˜ï¼šå…¨å± Super Retinaæ˜¾ç¤ºå±ã€‚å®ƒæä¾›äº†æ›´å¤šçš„å†…å®¹æ˜¾ç¤ºç©ºé—´ï¼ŒåŒæ—¶ä¹Ÿè¥é€ äº†æ›´åŠ æ·±å…¥çš„æ²‰æµ¸æ„Ÿã€‚ä½œä¸º iOS å¼€å‘è€…ï¼Œåœ¨ä¸ºå¼ºå¤§çš„ Face ID å’Œå…¨é¢å±æ¬£å–œçš„åŒæ—¶ï¼Œæˆ‘æ›´æ‹…å¿§â€œé½åˆ˜æµ·â€çš„é€‚é…ï¼ ä¸‹é¢ç»“åˆå®˜æ–¹çš„äººæœºäº¤äº’æŒ‡å—ï¼Œæ¥äº†è§£ä¸‹å¦‚ä½•è®¾è®¡ App æ‰èƒ½åœ¨iPhone X å’Œå…¶ä»–æ‰€æœ‰ iOS è®¾å¤‡ä¸Šéƒ½çœ‹èµ·æ¥å¾ˆæ£’ã€‚ ç†è®ºéƒ¨åˆ†å±å¹•å°ºå¯¸ åœ¨ç«–å±ä¸‹ï¼ŒiPhone X ä¸Šçš„æ˜¾ç¤ºçš„å®½åº¦ä¸ iPhone 6ï¼ŒiPhone 7å’Œ iPhone 8çš„4.7è‹±å¯¸æ˜¾ç¤ºå±çš„å®½åº¦ä¿æŒä¸€è‡´ã€‚ç„¶è€Œï¼ŒiPhone X æ¯”4.7è‹±å¯¸æ˜¾ç¤ºå±é«˜äº†145ä¸ªç‚¹ï¼Œè¿™å¯¼è‡´å¢åŠ äº†å¤§çº¦20ï¼…çš„å‚ç›´é«˜åº¦å†…å®¹ã€‚ å¤§å®¶åœ¨ä¸ºè®¾è®¡å¸ˆæ‚²ä¼¤çš„åŒæ—¶ä¹Ÿä¸è¦å¿˜è®°æ·»åŠ å¯åŠ¨å›¾ï¼ˆLaunchImage or LaunchScreen.storyboardï¼‰å‘¦~ å®‰å…¨åŒº åœ¨ iPhone X å¸ƒå±€ä¸­ï¼Œæœ€å…³é”®çš„æ˜¯ï¼šå¿…é¡»ç¡®ä¿å¸ƒå±€å¡«æ»¡å±å¹•ï¼ŒåŒæ—¶åˆä¸ä¼šè¢«è®¾å¤‡çš„åœ†è§’ï¼Œä¼ æ„Ÿå™¨å¤–å£³æˆ–ç”¨äºè®¿é—®ä¸»å±å¹•çš„æŒ‡ç¤ºç¯æ‰€é®ç›–ï¼Œè‹¹æœä¸ºç§°æ­¤åŒºåŸŸä¸ºâ€œå®‰å…¨åŒºâ€ã€‚ å¯å–œçš„æ˜¯ï¼Œå¤§å¤šæ•°æ ‡å‡†çš„ç³»ç»Ÿæä¾›çš„UIå…ƒç´ å’Œæ§ä»¶ï¼ˆå¦‚ navigation barsï¼Œtables å’Œ collectionsï¼‰éƒ½å·²ç»ä¸ºæ–°å¤–å½¢åšäº†å¾ˆå¥½çš„é€‚é…ã€‚ èƒŒæ™¯å·²ç»å»¶ä¼¸åˆ°æ˜¾ç¤ºå™¨çš„è¾¹ç¼˜ï¼Œå¹¶ä¸”UIå…ƒä»¶è¢«å¾ˆæ°å½“åœ°æ’å…¥å’Œå®šä½åœ¨å®‰å…¨åŒºåŸŸã€‚ å› æ­¤ï¼Œå¯¹äºå…·æœ‰è‡ªå®šä¹‰å¸ƒå±€çš„ Appï¼Œæ”¯æŒiPhone X ä¹Ÿåº”è¯¥æ¯”è¾ƒå®¹æ˜“ï¼Œç‰¹åˆ«æ˜¯å¦‚æœä½¿ç”¨äº† AutoLayout å¹¶éµå®ˆå®‰å…¨åŒºåŸŸ(safe area)å’Œè¾¹è·å¸ƒå±€(margin layout)æŒ‡å—ã€‚è¿™äº›åœ¨ä¸Šæ–‡éƒ½å·²ç»æœ‰è¿‡è¾ƒè¯¦ç»†çš„é˜è¿°ã€‚ ä¸‹é¢è¯´å‡ ç‚¹éœ€è¦ç‰¹åˆ«æ³¨æ„çš„ï¼š åœ¨ iPhone X ä¸Šé¢„è§ˆ App: åœ¨æ‹¿åˆ°æ–°æœºä¹‹å‰ï¼Œä¹Ÿå¯ä»¥å…ˆä½¿ç”¨ Simulator æ¥é¢„è§ˆå’Œæ£€æŸ¥ä¸‹å¸ƒå±€é—®é¢˜ã€‚ ä½†æ˜¯ä¸€äº›ä¾èµ–ç¡¬ä»¶çš„åŠŸèƒ½ï¼Œå¦‚å›¾åƒæ•ˆæœå’Œäº¤äº’ä½“éªŒï¼Œæœ€å¥½è¿˜æ˜¯åœ¨çœŸæœºä¸Šé¢„è§ˆã€‚ å§‹ç»ˆä¿æŒå…¨å±ä½“éªŒ: ç¡®ä¿èƒŒæ™¯å»¶ä¼¸åˆ°æ˜¾ç¤ºåŒºåŸŸçš„è¾¹ç¼˜ï¼Œä»¥åŠå‚ç›´å¯æ»šåŠ¨çš„å¸ƒå±€ï¼ˆå¦‚ tables å’Œ collectionsï¼‰ä¸€ç›´å»¶ç»­åˆ°åº•éƒ¨ã€‚ é˜²æ­¢è¾¹ç¼˜å†…å®¹è¢«è£å‰ª: ä¸€èˆ¬æ¥è¯´ï¼Œå†…å®¹åº”è¯¥æ˜¯å±…ä¸­å¯¹ç§°çš„ï¼Œè¿™æ ·å®ƒåœ¨ä»»ä½•æ–¹å‘çœ‹èµ·æ¥éƒ½ä¼šå¾ˆæ£’ï¼Œä¸ä¼šè¢«è¾¹è§’è§’æˆ–è®¾å¤‡å¤–å£³å¤¹ä½ï¼Œæˆ–è¢«ä¸»å±å¹•çš„æŒ‡ç¤ºå™¨é®æŒ¡ã€‚ ä¸ºäº†è·å¾—æœ€ä½³æ•ˆæœï¼Œè¯·ä½¿ç”¨æ ‡å‡†çš„ç³»ç»Ÿç•Œé¢å…ƒç´ å’Œ AutoLayout æ„å»ºç•Œé¢ã€‚ æ‰€æœ‰ App éƒ½åº”éµå¾ª UIKit å®šä¹‰çš„å®‰å…¨åŒºåŸŸå’Œå¸ƒå±€è¾¹è·ï¼Œå› ä¸ºè¿™äº›åŒºåŸŸå¯ä»¥æ ¹æ®è®¾å¤‡å’Œä¸Šä¸‹æ–‡è¿›è¡Œé€‚å½“çš„å¡«å……ã€‚ å®‰å…¨åŒºåŸŸè¿˜å¯ä»¥é˜²æ­¢å†…å®¹è¦†ç›–status bar, navigation bar, toolbar, ä»¥åŠ tab bar. æ³¨æ„ status bar çš„é«˜åº¦: status bar åœ¨iPhone X ä¸Šæ¯”åœ¨å…¶ä»– iPhoneä¸Šæ›´é«˜ã€‚ å¦‚æœå‡å®šä½ å›ºå®š status bar çš„é«˜åº¦ç”¨äºå°†å†…å®¹å®šä½åœ¨ status bar çš„ä¸‹æ–¹ï¼Œé‚£ä¹ˆç°åœ¨å¿…é¡»æ›´æ–°ä½ çš„çš„ Appï¼Œæ‰èƒ½æ ¹æ®ç”¨æˆ·çš„è®¾å¤‡åŠ¨æ€å®šä½å†…å®¹ã€‚ ç‰¹åˆ«éœ€è¦æ³¨æ„ï¼Œå½“åå°ä»»åŠ¡ï¼ˆå¦‚å½•éŸ³å’Œä½ç½®è·Ÿè¸ªï¼‰å¤„äºæ´»åŠ¨çŠ¶æ€æ—¶ï¼ŒiPhone Xä¸Šçš„çŠ¶æ€æ ä¸ä¼šæ”¹å˜é«˜åº¦ã€‚ é‡æ–°è€ƒè™‘éšè— status bar: iPhone X è¾ƒä¹‹æ˜¾ç¤ºé«˜åº¦ä¸º4.7â€œiPhone çš„æ˜¾ç¤ºå±æä¾›äº†æ›´å¤šçš„å†…å®¹å‚ç›´ç©ºé—´ï¼Œstatus bar å æ®çš„åªæ˜¯æ‰©å±•å‡ºæ¥çš„å±å¹•åŒºåŸŸã€‚å†µä¸” status bar æ›´ç›´è§‚çš„æ˜¾ç¤ºç”¨æˆ·æœ‰ç”¨çš„ä¿¡æ¯ï¼Œå¦‚æœéè¦éšè—çŠ¶æ€æ ï¼Œé‚£æœ€å¥½ç”¨ä¸è¿™äº›ä¿¡æ¯åŒç­‰é‡è¦çš„å†…å®¹æ›¿ä»£ã€‚ æ³¨æ„é•¿å®½æ¯”å·®å¼‚: iPhone X å…·æœ‰ä¸åŒäº4.7â€œiPhone çš„é•¿å®½æ¯”ã€‚å› æ­¤ï¼Œå…¨å±4.7è‹±å¯¸iPhone å›¾å½¢åœ¨iPhone X ä¸Šå…¨å±æ˜¾ç¤ºæ—¶å‡ºç°è£å‰ªæˆ– letterboxing ã€‚åŒæ ·ï¼Œå…¨å±iPhone X å›¾å½¢å…¨å±æ˜¾ç¤ºåœ¨4.7â€œiPhone ä¸Šæ—¶ä¹Ÿä¼šè¢«è£å‰ªæˆ– pillarboxing ï¼Œå› æ­¤è¦ç¡®ä¿é‡è¦çš„è§†è§‰å†…å®¹é€‚é…è¿™ä¸¤ç§å°ºå¯¸ã€‚ é¿å…äº¤äº’å¼æ§ä»¶å‡ºç°åœ¨å±å¹•åº•éƒ¨å’Œè§’è½: iPhone X æä¾›äº†æ˜¾ç¤ºå±åº•éƒ¨çš„æ»‘åŠ¨æ‰‹åŠ¿æ¥è®¿é—®ä¸»å±å¹•å’Œåº”ç”¨ç¨‹åºåˆ‡æ¢å™¨çš„æ–°äº¤äº’æ–¹å¼ï¼Œè¿™äº›æ‰‹åŠ¿å¯èƒ½ä¼šå–æ¶ˆåœ¨æ­¤åŒºåŸŸä¸­å®ç°çš„è‡ªå®šä¹‰æ‰‹åŠ¿ã€‚ å†µä¸”å±å¹•çš„ä¸¤ä¸ªè§’è½è¿‡å¤šå¤æ‚çš„äº¤äº’ä¹Ÿä¸æ˜¯æœ€ä½³ä½“éªŒçš„è‰¯å¥½å®è·µã€‚ ä¸è¦é®æŒ¡æˆ–è€…ç‰¹åˆ«ä¿®é¥°æ˜¾ç¤ºç‰¹æ€§æ¥å¼•èµ·ç”¨æˆ·æ³¨æ„: è¯·å‹¿å°è¯•éšè—è®¾å¤‡çš„åœ†è§’ã€ä¼ æ„Ÿå™¨å¤–å£³ï¼Œæˆ–è€…é€šè¿‡åœ¨å±å¹•é¡¶éƒ¨å’Œåº•éƒ¨æ”¾ç½®æ§ä»¶æ¥è®¿é—®ä¸»å±å¹•çš„å¼•å¯¼ã€‚ä¹Ÿè¦ç‰¹åˆ«æ³¨æ„ä¸è¦è¯•å›¾ä½¿ç”¨åƒæ‹¬å·ï¼Œè¾¹æ¡†æˆ–å„ç§ç¬¦å·ç­‰è§†è§‰ä¿®é¥°è¿™äº›ç‰¹æ®ŠåŒºåŸŸã€‚ ä¸ºäº†è½»æ¾è®¿é—®ä¸»å±å¹•å…è®¸è‡ªåŠ¨éšè—æŒ‡ç¤ºå™¨: å½“å¼€å¯è‡ªåŠ¨éšè—æ—¶ï¼Œå¦‚æœç”¨æˆ·ç¦»å¼€å±å¹•å‡ ç§’é’Ÿï¼ŒæŒ‡ç¤ºå™¨å°†æ¶ˆå¤±ã€‚ å½“ç”¨æˆ·å†æ¬¡è§¦æ‘¸å±å¹•æ—¶ï¼Œå®ƒä¼šé‡æ–°å‡ºç°ã€‚ è¿™ç§è¡Œä¸ºåº”è¯¥åªèƒ½ç”¨äºæå‡è§‚çœ‹ä½“éªŒï¼Œå¦‚æ’­æ”¾è§†é¢‘æˆ–ç…§ç‰‡å¹»ç¯ç‰‡ã€‚ è‰²å½©iPhone X çš„æ˜¾ç¤ºå™¨æ”¯æŒ P3 è‰²å½©ç©ºé—´ï¼Œå®ƒå¯ä»¥äº§ç”Ÿæ¯” sRGB æ›´ä¸°å¯Œï¼Œæ›´é¥±å’Œçš„é¢œè‰²ã€‚ å¯ä»¥ä½¿ç”¨ wide color æ¥å¢å¼ºè§†è§‰ä½“éªŒã€‚ å®ƒå¯ä»¥è®©ç…§ç‰‡å’Œè§†é¢‘æ›´åŠ é€¼çœŸç”ŸåŠ¨ã€‚ æ›´å¤šå†…å®¹å¯ä»¥å‚è€ƒå®˜ç½‘Color managementï¼ˆhttps://developer.apple.com/ios/human-interface-guidelines/visual-design/color/#color-managementï¼‰ æ‰‹åŠ¿æƒ³å¿…å¤§å®¶éƒ½åœ¨å‘å¸ƒä¼šä¸Šçœ‹åˆ°äº†ï¼ŒiPhone X ä¸Šçš„æ˜¾ç¤ºå±å¯ä»¥ä½¿ç”¨å±å¹•è¾¹ç¼˜æ‰‹åŠ¿æ¥è®¿é—®ä¸»å±å¹•ï¼Œåº”ç”¨ç¨‹åºåˆ‡æ¢å™¨ï¼Œé€šçŸ¥ä¸­å¿ƒå’Œæ§åˆ¶ä¸­å¿ƒã€‚é€‚åº”è¿™ä¸ªæ–°å˜åŒ–çš„åŒæ—¶ï¼Œå¯¹äºå¼€å‘è€…è¦ç‰¹åˆ«æ³¨æ„ï¼š é¿å…å¹²æ‰°ç³»ç»ŸèŒƒå›´çš„å±å¹•è¾¹ç¼˜æ‰‹åŠ¿:ç”¨æˆ·ä¾èµ–è¿™äº›æ‰‹åŠ¿åœ¨æ¯ä¸ª App ä¸­æ“ä½œï¼Œæ‰€ä»¥åœ¨æå°‘æ•°æƒ…å†µä¸‹ï¼Œæ¯”å¦‚æ¸¸æˆè¿™ç§å¼ºè°ƒæ²‰æµ¸å¼ä½“éªŒçš„ App å¯èƒ½éœ€è¦è‡ªå®šä¹‰çš„å±å¹•è¾¹ç¼˜æ‰‹åŠ¿ï¼Œä¼˜å…ˆçº§é«˜äºç³»ç»Ÿçš„æ‰‹åŠ¿ã€‚ è¿™ç§è¡Œä¸ºï¼ˆç§°ä¸ºè¾¹ç¼˜ä¿æŠ¤ï¼‰åº”è¯¥è°¨æ…ä½¿ç”¨ï¼Œå› ä¸ºå®ƒä½¿å¾—ç”¨æˆ·éš¾ä»¥è®¿é—®ç³»ç»Ÿçº§çš„æ“ä½œã€‚ æ›´å¤šå†…å®¹å‚è€ƒå®˜ç½‘Gestures ï¼ˆhttps://developer.apple.com/ios/human-interface-guidelines/user-interaction/gestures/ï¼‰ è¡¥å……çš„æ³¨æ„äº‹é¡¹ è®¤è¯æ–¹æ³•å‡†ç¡®:iPhone X æ”¯æŒ Face IDè¿›è¡Œèº«ä»½éªŒè¯ã€‚ å¦‚æœä½ çš„ App é›†æˆäº† Apple Pay æˆ–å…¶ä»–ç³»ç»Ÿèº«ä»½éªŒè¯åŠŸèƒ½ï¼Œè¯·åŠ¡å¿…æ³¨æ„ä¸è¦åœ¨ iPhone X ä¸Šå¼•ç”¨ Touch IDã€‚åŒæ ·åœ°ï¼Œä¹Ÿè¯·ç¡®ä¿ä¸è¦åœ¨æ”¯æŒTouch ID çš„è®¾å¤‡ä¸Šå¼•ç”¨ Face IDã€‚ æ›´è¯¦ç»†çš„å†…å®¹è¯·å‚è€ƒAuthentication(https://developer.apple.com/ios/human-interface-guidelines/user-interaction/authentication/) ä¸è¦é‡å¤å¢åŠ ç³»ç»Ÿæä¾›çš„é”®ç›˜åŠŸèƒ½:åœ¨ iPhone Xä¸Šï¼Œå³ä½¿ä½¿ç”¨è‡ªå®šä¹‰é”®ç›˜ï¼ŒEmoji / Globe æŒ‰é’®å’Œ Dictation æŒ‰é’®ä¹Ÿè‡ªåŠ¨æ˜¾ç¤ºåœ¨é”®ç›˜çš„ä¸‹æ–¹ã€‚ ä½ çš„ App ä¸èƒ½å½±å“è¿™äº›æŒ‰é’®ï¼Œå› æ­¤é¿å…åœ¨é”®ç›˜ä¸­é‡å¤å¢åŠ è¿™äº›æŒ‰é’®é€ æˆæ··ä¹±ã€‚ ç”±äº iPhone Xçš„å±å¹•æ¯”ä¾‹å‘ç”Ÿå˜åŒ–ï¼Œå¯¹äºé•¿æœŸé â€œç­‰æ¯”ç¼©æ”¾â€å®Œæˆé€‚é…çš„H5æ´»åŠ¨é¡µè€Œè¨€ä¹Ÿæœ‰ä¸å°çš„å½±å“ï¼Œéœ€è¦å¯¹é¡µé¢ç»“æ„è¿›è¡Œé€‚å½“å¾®è°ƒã€‚ æ›´è¯¦ç»†å†…å®¹è¯·å‚é˜…Custom-keyboards(https://developer.apple.com/ios/human-interface-guidelines/extensions/custom-keyboards/) åˆ¤æ–­ iPhone X æœºå‹ (Swift)å¦‚ä½•åˆ¤æ–­å½“å‰çš„è®¾å¤‡æ˜¯ iPhone X å‘¢ï¼Ÿæœ‰å¥½å‡ ç§åŠæ³•ï¼Œå¯ä»¥è€ƒè™‘å–å¾—ã€ŒiPhone 10,1ã€è¿™æ ·çš„ Module Name æ¥åˆ¤æ–­ï¼Œä¹Ÿå¯ä»¥ç”¨å±å¹•åˆ†è¾¨ç‡çš„å½¢å¼æ¥åˆ¤æ–­ã€‚æˆ‘è§‰å¾—è¦ç”¨å±å¹•åˆ†è¾¨ç‡çš„æ–¹å¼æ¥åšï¼Œå› ä¸ºè¿™æ˜¯ç›®å‰ä¸ºæ­¢æœ€ç®€å•ä¹Ÿæœ€ä¸å®¹æ˜“å‡ºé”™çš„ã€‚å› ä¸º iPhone X åªæœ‰ä¸€ç§åˆ†è¾¨ç‡ï¼Œé‚£å°±æ˜¯ 812pt x 375pt (@3xï¼‰ï¼Œä¸”æ²¡æœ‰ä»»ä½•å…¶ä»–è®¾å¤‡ç”¨äº†ä¸€æ ·çš„åˆ†è¾¨ç‡ï¼Œç‰¹åˆ«æ˜¯é«˜åº¦ã€‚ äºæ˜¯å†™äº†ä¸€ä¸ªåŸºäº UIDevice çš„æ‰©å±•ï¼ˆæˆ–è€…å…¶ä»–ä»»æ„æ–¹æ³•ä¹Ÿè¡Œï¼‰ï¼š 12345678extension UIDevice &#123; public func isX() -&gt; Bool &#123; if UIScreen.main.bounds.height == 812 &#123; return true &#125; return false &#125;&#125; åœ¨ä»£ç ä¸­ï¼Œå°±å¯ä»¥ç”¨ UIDevice.current.isX() æ¥åˆ¤æ–­æ˜¯ä¸æ˜¯è·‘åœ¨ iPhone X æœºå‹ä¸Šï¼Œç„¶ååšä¸€äº›æˆ–ä¸åšä¸€äº›ç‰¹æ®Šçš„ Hack äº†ã€‚ å½“ç„¶å¦‚æœä½ ä¹ æƒ¯ç”¨ä¸‰æ–¹åº“ï¼Œä¹Ÿå¯ä»¥å°è¯•â€œDeviceKitâ€ 1234567let device = Device()print(device) // prints, for example, \"iPhone X\"if device == .iPhoneX &#123; // Do something&#125; else &#123; // Do something else&#125; ä»£ç é€‚é…éƒ¨åˆ†å½“æˆ‘ä»¬èƒ½å¤Ÿåˆ¤æ–­å‡ºè®¾å¤‡å‹å·å°±å¯ä»¥é…åˆç³»ç»Ÿç‰ˆæœ¬è¿›è¡Œé€‚é…äº† é€‚é… UITableView ç»„ä»¶12345678if (@available(iOS 11.0, *)) &#123; self.contentInsetAdjustmentBehavior = .never self.estimatedRowHeight = 0 self.estimatedSectionHeaderHeight = 0 self.estimatedSectionFooterHeight = 0&#125; else &#123; // Fallback on earlier versions&#125; é€‚é… UIScrollView ç»„ä»¶12345if (@available(iOS 11.0, *)) &#123; scrollView?.contentInsetAdjustmentBehavior = .never&#125; else &#123; // Fallback on earlier versions&#125; UITableViewä¸­çš„sectionHeaderæˆ–è€…Footeræ˜¾ç¤ºä¸æ­£å¸¸è¿˜æœ‰çš„å‘ç°æŸäº›ç•Œé¢tableViewçš„sectionHeaderã€sectionFooteré«˜åº¦ä¸è®¾ç½®ä¸ç¬¦çš„é—®é¢˜ï¼Œåœ¨iOS11ä¸­å¦‚æœä¸å®ç°-tableView: viewForHeaderInSection:å’Œ-tableView: viewForFooterInSection:ï¼Œåˆ™-tableView: heightForHeaderInSection:å’Œ- tableView: heightForFooterInSection:ä¸ä¼šè¢«è°ƒç”¨ï¼Œå¯¼è‡´å®ƒä»¬éƒ½å˜æˆäº†é»˜è®¤é«˜åº¦ï¼Œè¿™æ˜¯å› ä¸ºtableViewåœ¨iOS11é»˜è®¤ä½¿ç”¨Self-Sizingï¼ŒtableViewçš„estimatedRowHeightã€estimatedSectionHeaderHeightã€estimatedSectionFooterHeightä¸‰ä¸ªé«˜åº¦ä¼°ç®—å±æ€§ç”±é»˜è®¤çš„0å˜æˆäº†UITableViewAutomaticDimensionï¼Œè§£å†³åŠæ³•ç®€å•ç²—æš´ï¼Œå°±æ˜¯å®ç°å¯¹åº”æ–¹æ³•æˆ–æŠŠè¿™ä¸‰ä¸ªå±æ€§è®¾ä¸º0ã€‚ 1234567if #available(iOS 11.0, *) &#123; tableView.estimatedRowHeight = 0; tableView.estimatedSectionHeaderHeight = 0; tableView.estimatedSectionFooterHeight = 0;&#125; else &#123; automaticallyAdjustsScrollViewInsets = false;&#125;; é€‚é…ç½‘é¡µåŠ è½½ä¸å…¨ä¸‹é¢æœ‰ç™½è¾¹1234if #available(iOS 11.0, *) &#123; webView.scrollView.contentInsetAdjustmentBehavior = .never&#125; else &#123;&#125;; é€‚é…iPhoneXä¸èƒ½é“ºæ»¡å±çš„é—®é¢˜ç»™Brand Assetsæ·»åŠ ä¸€å¼ 1125*2436å¤§å°çš„å›¾ç‰‡ æ‰“å¼€Assets.xcassetsæ–‡ä»¶å¤¹ï¼Œæ‰¾åˆ°Brand Assets å³é”®Show in Finder æ·»åŠ ä¸€å¼ 1125*2436å¤§å°çš„å›¾ç‰‡ ä¿®æ”¹Contents.jsonæ–‡ä»¶,æ·»åŠ å¦‚ä¸‹å†…å®¹ 123456789&#123;&quot;extent&quot; : &quot;full-screen&quot;,&quot;idiom&quot; : &quot;iphone&quot;,&quot;subtype&quot; : &quot;2436h&quot;,&quot;filename&quot; : &quot;1125_2436.pngâ€,&quot;minimum-system-version&quot; : &quot;11.0&quot;,&quot;orientation&quot; : &quot;portrait&quot;,&quot;scale&quot; : &quot;3x&quot;&#125; ä½¿ç”¨ LaunchScreen.storyboard è®¾ç½®å¯åŠ¨å›¾ ä½¿ç”¨ LaunchScreen.storyboard æ–‡ä»¶å°†ç®€å•è§†å›¾çº¦æŸå®šä½ï¼Œå®ç°å„ç§å°ºå¯¸çš„è‡ªé€‚åº”ã€‚ é€‚é…iPhoneX12345//é€‚é…iPhoneXlet LL_iPhoneX = (kScreenW == Double(375.0) &amp;&amp; kScreenH == Double(812.0) ?true:false)let kNavibarH = LL_iPhoneX ? Double(88.0) : Double(64.0)let kTabbarH = LL_iPhoneX ? Double(49.0+34.0) : Double(49.0)let kStatusbarH = LL_iPhoneX ? Double(44.0) : Double(20.0) Xcode9 æ‰“åŒ…æ³¨æ„äº‹é¡¹Xcode9 æ‰“åŒ…ç‰ˆæœ¬åªèƒ½æ˜¯8.2åŠä»¥ä¸‹ç‰ˆæœ¬,æˆ–è€…9.0åŠæ›´é«˜ç‰ˆæœ¬ Xcode9 ä¸æ”¯æŒ8.3å’Œ8.4ç‰ˆæœ¬ Xcode9 æ–°æ‰“åŒ…è¦åœ¨æ„å»ºç‰ˆæœ¬çš„æ—¶å€™åŠ å…¥1024*1024 AppSore icon Xcode9 æ²¿ç”¨äº†ä¹‹å‰çš„åˆ†åŒ…è®¾è®¡ï¼Œå¯ä»¥é…ç½®æ‰“å‡ºå¤šç§è®¾å¤‡çš„åŒ…æ–‡ä»¶ï¼Œç”¨æˆ·å®‰è£…æ—¶æ ¹æ®è®¾å¤‡ä¸åŒåˆ†åˆ«å®‰è£…ä¸åŒçš„APIåŒ…ï¼Œå‡å°å®‰è£…åŒ…å¤§å°ã€‚ iOS 11 ç›¸å†Œæƒé™å˜æ›´iOS11ä»¥å‰ï¼š NSPhotoLibraryUsageDescriptionï¼šè®¿é—®ç›¸å†Œå’Œå­˜å‚¨ç…§ç‰‡åˆ°ç›¸å†Œï¼ˆè¯»å†™ï¼‰ï¼Œä¼šå‡ºç°ç”¨æˆ·æˆæƒã€‚ iOS11ä¹‹åï¼š NSPhotoLibraryUsageDescriptionï¼šæ— éœ€æ·»åŠ ã€‚é»˜è®¤å¼€å¯è®¿é—®ç›¸å†Œæƒé™ï¼ˆè¯»ï¼‰ï¼Œæ— éœ€ç”¨æˆ·æˆæƒã€‚ NSPhotoLibraryAddUsageDescriptionï¼š æ·»åŠ å†…å®¹åˆ°ç›¸å†Œã€‚ï¼ˆå†™ï¼‰ï¼Œä¼šå‡ºç°ç”¨æˆ·æˆæƒã€‚","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS RAC çš„ä½¿ç”¨æ€»ç»“","slug":"Reactive Cocoa","date":"2017-07-16T14:56:27.000Z","updated":"2018-11-16T13:27:23.887Z","comments":true,"path":"2017/07/16/Reactive Cocoa/","link":"","permalink":"https://reversescale.github.io/2017/07/16/Reactive Cocoa/","excerpt":"Reactive Cocoa(ç®€ç§°RAC),æ˜¯ GitHub ä¸Šå¼€æºçš„ä¸€ä¸ªåº”ç”¨äº iOS å’Œ OS X å¼€å‘çš„ä¸€ä¸ªæ–°æ¡†æ¶ï¼ŒRACå…·æœ‰å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”è€…ç¼–ç¨‹çš„ç‰¹æ€§~","text":"Reactive Cocoa(ç®€ç§°RAC),æ˜¯ GitHub ä¸Šå¼€æºçš„ä¸€ä¸ªåº”ç”¨äº iOS å’Œ OS X å¼€å‘çš„ä¸€ä¸ªæ–°æ¡†æ¶ï¼ŒRACå…·æœ‰å‡½æ•°å¼ç¼–ç¨‹å’Œå“åº”è€…ç¼–ç¨‹çš„ç‰¹æ€§~ ReactiveCocoaè§£å†³çš„é—®é¢˜: 1.ä¼ ç»ŸiOSå¼€å‘è¿‡ç¨‹ä¸­,çŠ¶æ€ä»¥åŠçŠ¶æ€ä¹‹é—´ä¾èµ–è¿‡å¤šçš„é—®é¢˜ 2.ä¼ ç»ŸMVCæ¶æ„çš„é—®é¢˜:Controlleræ¯”è¾ƒå¤æ‚,å¯æµ‹è¯•æ€§å·® 3.æä¾›ç»Ÿä¸€çš„æ¶ˆæ¯ä¼ é€’æœºåˆ¶ é”®å€¼è§‚å¯Ÿâ€“ç›‘å¬ TF çš„å€¼å‘ç”Ÿå˜åŒ–123456789101112- (void)demo1&#123; @weakify(self); [self.tF.rac_textSignal subscribeNext:^(NSString *value) &#123; @strongify(self); self.value = value; &#125;]; //å½“self.valueçš„å€¼å˜åŒ–æ—¶è°ƒç”¨Blockï¼Œè¿™æ˜¯ç”¨KVOçš„æœºåˆ¶ï¼ŒRACå°è£…äº†KVO [RACObserve(self, value) subscribeNext:^(NSString *value) &#123; NSLog(@&quot;%@&quot;,value); &#125;];&#125; map çš„ä½¿ç”¨1234567891011121314151617- (void)demo2&#123; //åˆ›å»ºä¸€ä¸ªä¿¡å· RACSignal *signalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; //è¿™ä¸ªä¿¡å·é‡Œé¢æœ‰ä¸€ä¸ªNextäº‹ä»¶çš„ç»ç’ƒçƒå’Œä¸€ä¸ªcompleteäº‹ä»¶çš„ç»ç’ƒçƒ [subscriber sendNext:@&quot;å”±æ­Œ&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //å¯¹ä¿¡å·è¿›è¡Œæ”¹è¿›,å½“ä¿¡å·é‡Œé¢æµçš„æ˜¯å”±æ­Œ.å°±æ”¹è¿›ä¸º&apos;è·³èˆ&apos;è¿”è¿˜ç»™self.value RAC(self, tF.text) = [signalA map:^id(NSString *value) &#123; if ([value isEqualToString:@&quot;å”±æ­Œ&quot;]) &#123; return @&quot;è·³èˆ&quot;; &#125; return @&quot;&quot;; &#125;]; &#125; filter ä½¿ç”¨,ä½ å‘è¥¿ï¼Œä»–å°±å‘ä¸œï¼Œä»–å‘å·¦ï¼Œä½ å°±å‘å³1234567891011121314151617181920212223242526272829303132333435363738394041424344- (void)demo3&#123; //åˆ›å»ºä¸¤ä¸ªé€šé“,ä¸€ä¸ªä»Aæµå‡ºçš„é€šé“A,å’Œä¸€ä¸ªä»Bæµå‡ºçš„é€šé“B RACChannelTerminal *channelA = RACChannelTo(self, value); RACChannelTerminal *channelB = RACChannelTo(self, value2); //æ”¹é€ é€šé“A,ä½¿é€šè¿‡é€šé“Açš„å€¼,å¦‚æœç­‰äº&apos;è¥¿&apos;,å°±æ”¹ä¸º&apos;ä¸œ&apos; [[channelA map:^id(NSString *value) &#123; if ([value isEqualToString:@&quot;è¥¿&quot;]) &#123; NSLog(@&quot;ä¸œ&quot;); return @&quot;ä¸œ&quot;; &#125; NSLog(@&quot;====== %@&quot;,value); return value; &#125;] subscribe:channelB];//é€šé“Aæµå‘B //æ”¹é€ é€šé“B,ä½¿é€šè¿‡é€šé“Bçš„å€¼,å¦‚æœç­‰äº&apos;å·¦&apos;,å°±æ”¹ä¸º&apos;å³&apos;ä¼ å‡ºå» [[channelB map:^id(id value) &#123; if ([value isEqualToString:@&quot;å·¦&quot;]) &#123; NSLog(@&quot;å³&quot;); return @&quot;å³&quot;; &#125; NSLog(@&quot;====== %@&quot;,value); return value; &#125;] subscribe:channelA];//é€šé“Bæµå‘é€šé“A //KVOç›‘å¬valueAçš„å€¼çš„å˜åŒ–,è¿‡æ»¤valueAçš„å€¼,è¿”å›Yesè¡¨ç¤ºé€šè¿‡ //åªæœ‰valueæœ‰å€¼,æ‰å¯é€šè¿‡ [[RACObserve(self, value) filter:^BOOL(id value) &#123; return value ? YES : NO; &#125;] subscribeNext:^(id x) &#123; NSLog(@&quot;ä½ å‘%@&quot;,x); &#125;]; //KVOç›‘å¬value2çš„å˜åŒ– [[RACObserve(self, value2) filter:^BOOL(id value) &#123; return value ? YES: NO; &#125;] subscribeNext:^(id x) &#123; NSLog(@&quot;ä»–å‘%@&quot;,x); &#125;]; //ä¸‹é¢ä½¿valueçš„å€¼å’Œvalue2çš„å€¼å‘ç”Ÿæ”¹å˜ self.value = @&quot;è¥¿&quot;; self.value2 = @&quot;å·¦&quot;; &#125; ä»£ç†1)ä»£ç†çš„ç¬¬ä¸€ç§å†™æ³• .mæ–‡ä»¶123- (void)demo4&#123; [self.delegate makeAnApp:@&quot;12345ä¸Šå±±æ‰“è€è™&quot; String:@&quot;è€è™ä¸åœ¨å®¶,æ€ä¹ˆåŠ&quot;];&#125; .hæ–‡ä»¶12345- (void)makeAnApp:(NSString *)string String:(NSString *)string;@end@interface Base5Controller : UIViewController@property (nonatomic, assign)id&lt;ProgrammerDelegate&gt; delegate; ç¬¬ä¸€ä¸ªæ§åˆ¶å™¨çš„.h123456789101112131415161718192021222324Base5Controller *base = [[Base5Controller alloc] init]; // base.delegate = self; [self demo4]; // è¿™é‡Œæ˜¯ä¸ªå‘,å¿…é¡»å°†ä»£ç†æœ€åè®¾ç½®,å¦åˆ™ä¿¡å·æ˜¯æ— æ³•è®¢é˜…åˆ°çš„ // é›·çº¯å³°å¤§å¤§æ˜¯è¿™æ ·å­è§£é‡Šçš„:åœ¨è®¾ç½®ä»£ç†çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šç¼“å­˜è¿™ä¸ªä»£ç†å¯¹è±¡å®ç°äº†å“ªäº›ä»£ç æ–¹æ³• // å¦‚æœå°†ä»£ç†æ”¾åœ¨è®¢é˜…ä¿¡å·å‰è®¾ç½®,é‚£ä¹ˆå½“æ§åˆ¶å™¨æˆä¸ºä»£ç†æ—¶æ˜¯æ— æ³•ç¼“å­˜è¿™ä¸ªä»£ç†å¯¹è±¡å®ç°äº†å“ªäº›ä»£ç æ–¹æ³•çš„ base.delegate = self; [self.navigationController pushViewController:base animated:YES]; &#125; else &#123; [self.navigationController pushViewController:[cl new] animated:YES]; &#125;&#125;#pragma mark---demo4//ä½¿ç”¨RACä»£æ›¿ä»£ç†æ—¶,rac_signalForSelector: fromProtocol:è¿™ä¸ªä»£æ›¿ä»£ç†çš„æ–¹æ³•ä½¿ç”¨æ—¶,åˆ‡è®°è¦å°†selfè®¾ä¸ºä»£ç†è¿™å¥è¯æ”¾åœ¨è®¢é˜…ä»£ç†ä¿¡å·çš„åé¢å†™,å¦åˆ™ä¼šæ— æ³•æ‰§è¡Œ- (void)demo4&#123; //ä¸ºselfæ·»åŠ ä¸€ä¸ªä¿¡å·,è¡¨ç¤ºä»£ç†ProgrammerDelegateçš„makeAnApp; //RACTuple ç›¸å½“äºswiftä¸­çš„å…ƒç¥– [[self rac_signalForSelector:@selector(makeAnApp:String:) fromProtocol:@protocol(ProgrammerDelegate)] subscribeNext:^(RACTuple *x) &#123; //è¿™é‡Œå¯ä»¥ç«‹å³ä¸ºmakeAnAppçš„æ–¹æ³•è¦æ‰§è¡Œçš„ä»£ç  NSLog(@&quot;%@ &quot;,x.first); NSLog(@&quot;%@&quot;,x.second); &#125;];&#125; 2)æ–¹æ³•2 ä½¿ç”¨RACSubjectæ›¿ä»£ä»£ç†123456789101112131415161718192021/*** RACSubject:ä¿¡å·æä¾›è€…,è‡ªå·±å¯ä»¥å……å½“ä¿¡å·,åˆèƒ½å‘é€ä¿¡å·åˆ›å»ºæ–¹æ³•:1.åˆ›å»ºRACSubject2.è®¢é˜…ä¿¡å·3.å‘é€ä¿¡å·å·¥ä½œæµç¨‹:1.è®¢é˜…ä¿¡å·,å†…éƒ¨ä¿å­˜äº†è®¢é˜…è€…,å’Œè®¢é˜…è€…ç›¸åº”block2.å½“å‘é€ä¿¡å·çš„,éå†è®¢é˜…è€…,è°ƒç”¨è®¢é˜…è€…çš„nextBolckæ³¨:å¦‚æœè®¢é˜…ä¿¡å·,å¿…é¡»åœ¨å‘é€ä¿¡å·ä¹‹å‰è®¢é˜…ä¿¡å·,ä¸ç„¶æ”¶ä¸åˆ°ä¿¡å·,æœ‰åˆ©ç”¨åŒºåˆ«RACReplaySubject*/-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; RacSubjectController *racsub = [[RacSubjectController alloc] init]; racsub.subject = [RACSubject subject]; [racsub.subject subscribeNext:^(id x) &#123; NSLog(@&quot;è¢«é€šçŸ¥äº†%@&quot;,x); &#125;]; [self.navigationController pushViewController:racsub animated:YES];&#125; åœ¨RacSubjectController.hé‡Œé¢å£°æ˜å±æ€§1@property (nonatomic, strong) RACSubject *subject; .mé‡Œé¢è¿›è¡Œæ•°æ®çš„ä¼ é€’12345-(void)touchesBegan:(NSSet&lt;UITouch *&gt; *)touches withEvent:(UIEvent *)event&#123; if (self.subject) &#123; [self.subject sendNext:@1]; &#125;&#125; å¹¿æ’­12345678910111213141516//å‘é€é€šçŸ¥- (void)demo5&#123; NSNotificationCenter *center = [NSNotificationCenter defaultCenter]; //å‘é€å¹¿æ’­é€šçŸ¥ [center postNotificationName:@&quot;å¦‡å¥³ä¹‹å‹&quot; object:nil userInfo:@&#123;@&quot;æŠ€å·§&quot;:@&quot;ç”¨å¿ƒå¬&quot;&#125;];&#125;//æ¥æ”¶é€šçŸ¥NSNotificationCenter *center = [NSNotificationCenter defaultCenter];//RACçš„é€šçŸ¥ä¸éœ€è¦æˆ‘ä»¬æ‰‹åŠ¨ç§»é™¤//æ³¨å†Œå¹¿æ’­é€šçŸ¥RACSignal *siganl = [center rac_addObserverForName:@&quot;å¦‡å¥³ä¹‹å‹&quot; object:nil];//è®¾ç½®æ¥æ”¶é€šçŸ¥çš„å›è°ƒå¤„ç†[siganl subscribeNext:^(NSNotification *x) &#123; NSLog(@&quot;æŠ€å·§: %@&quot;,x.userInfo[@&quot;æŠ€å·§&quot;]);&#125;]; ä¸¤ä¸ªä¿¡å·ä¸²è”,ä¸¤ä¸ªç®¡ä¸²è”,ä¸€ä¸ªç®¡å¤„ç†å®Œè‡ªå·±çš„ä¸œè¥¿,ä¸‹ä¸€ä¸ªç®¡æ‰å¼€å§‹å¤„ç†è‡ªå·±çš„ä¸œè¥¿12345678910111213141516171819202122- (void)demo6&#123; //åˆ›å»ºä¸€ä¸ªä¿¡å·ç®¡A RACSignal *siganlA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;åƒé¥­&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //åˆ›å»ºä¸€ä¸ªä¿¡å·ç®¡B RACSignal *siganlB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;åƒçš„é¥±é¥±çš„,æ‰å¯ä»¥ç¡è§‰çš„&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //ä¸²è”ç®¡Aå’Œç®¡B RACSignal *concatSiganl = [siganlA concat:siganlB]; //ä¸²è”åçš„æ¥æ”¶ç«¯å¤„ç† ,ä¸¤ä¸ªäº‹ä»¶,èµ°ä¸¤æ¬¡,ç¬¬ä¸€ä¸ªæ‰“å°siggnalAçš„ç»“æœ,ç¬¬äºŒæ¬¡æ‰“å°siganlBçš„ç»“æœ [concatSiganl subscribeNext:^(id x) &#123; NSLog(@&quot;%@&quot;,x); &#125;];&#125; å¹¶è”,åªè¦æœ‰ä¸€ä¸ªç®¡æœ‰ä¸œè¥¿,å°±å¯ä»¥æ‰“å°123456789101112131415161718192021- (void)demo7&#123; //åˆ›å»ºä¿¡å·A RACSignal *siganlA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;çº¸å‚æ±¡æ°´&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //åˆ›å»ºä¿¡å·B RACSignal *siganlB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;ç”µé•€å‚æ±¡æ°´&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //å¹¶è”ä¸¤ä¸ªä¿¡å·,æ ¹ä¸Šé¢ä¸€æ ·,åˆ†ä¸¤æ¬¡æ‰“å° RACSignal *mergeSiganl = [RACSignal merge:@[siganlA,siganlB]]; [mergeSiganl subscribeNext:^(id x) &#123; NSLog(@&quot;%@&quot;,x); &#125;];&#125; ç»„åˆ,åªæœ‰ä¸¤ä¸ªä¿¡å·éƒ½æœ‰å€¼,æ‰å¯ä»¥ç»„åˆ1234567891011121314151617181920- (void)demo8&#123; //å®šä¹‰2ä¸ªè‡ªå®šä¹‰ä¿¡å· RACSubject *letters = [RACSubject subject]; RACSubject *numbers = [RACSubject subject]; //ç»„åˆä¿¡å· [[RACSignal combineLatest:@[letters,numbers] reduce:^(NSString *letter, NSString *number)&#123; return [letter stringByAppendingString:number]; &#125;] subscribeNext:^(id x) &#123; NSLog(@&quot;%@&quot;,x); &#125;]; //è‡ªå·±æ§åˆ¶å‘ç”Ÿä¿¡å·å€¼ [letters sendNext:@&quot;A&quot;]; [letters sendNext:@&quot;B&quot;]; [numbers sendNext:@&quot;1&quot;]; //æ‰“å°B1 [letters sendNext:@&quot;C&quot;];//æ‰“å°C1 [numbers sendNext:@&quot;2&quot;];//æ‰“å°C2&#125; åˆæµå‹ç¼©12345678910111213141516171819202122- (void)demo9&#123; //åˆ›å»ºä¿¡å·A RACSignal *siganlA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;çº¢&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //åˆ›å»ºä¿¡å·B RACSignal *siganlB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;ç™½&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //åˆæµåå¤„ç†çš„æ˜¯å‹ç¼©åŒ…,éœ€è¦è§£å‹åæ‰èƒ½å–åˆ°é‡Œé¢çš„å€¼ [[siganlA zipWith:siganlB] subscribeNext:^(id x) &#123; //è§£å‹ç¼© RACTupleUnpack(NSString *stringA, NSString *stringB) = x; NSLog(@&quot;%@ %@&quot;,stringA, stringB); &#125;];&#125; æ˜ å°„,æˆ‘å¯ä»¥ç‚¹çŸ³æˆé‡‘12345678910111213141516171819- (void)demo10&#123; RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:nil]; [subscriber sendCompleted]; return nil; &#125;]; //å¯¹ä¿¡å·è¿›è¡Œæ”¹é€ ,æ”¹&quot;çŸ³&quot;æˆ&quot;é‡‘&quot; siganl = [siganl map:^id(NSString *value) &#123; if ([value isEqualToString:@&quot;çŸ³&quot;]) &#123; return @&quot;é‡‘&quot;; &#125; return value; &#125;]; //æ‰“å°,ä¸è®ºä¿¡å·å‘é€çš„æ˜¯ä»€ä¹ˆ,è¿™ä¸€æ­¥éƒ½ä¼šèµ°çš„ [siganl subscribeNext:^(id x) &#123; NSLog(@&quot;%@&quot;,x); &#125;];&#125; è¿‡æ»¤,æœªæ»¡18å²,ç¦æ­¢å…¥å†…12345678910111213141516171819- (void)demo11&#123; RACSignal *singal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@(15)]; [subscriber sendNext:@(17)]; [subscriber sendNext:@(21)]; [subscriber sendNext:@(14)]; [subscriber sendNext:@(30)]; [subscriber sendCompleted]; return nil; &#125;]; //è¿‡æ»¤ä¿¡å·,æ‰“å° [[singal filter:^BOOL(NSNumber *value) &#123; //å¤§äº18å²çš„,æ‰å¯ä»¥é€šè¿‡ return value.integerValue &gt;= 18;//returnä¸ºyeså¯ä»¥é€šè¿‡ &#125;] subscribeNext:^(id x) &#123; NSLog(@&quot;%@&quot;,x); &#125;];&#125; ç§©åº(flattenMap æ–¹æ³•ä¹Ÿå¯ä»¥æ¢æˆ then æ–¹æ³•,æ•ˆæœä¸€æ ·)123456789101112131415161718192021222324252627282930313233-(void)demo12&#123; RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; NSLog(@&quot;æ‰“è›‹æ¶²&quot;); [subscriber sendNext:@&quot;è›‹æ¶²&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //å¯¹ä¿¡å·è¿›è¡Œç§©åºç§©åºçš„ç¬¬ä¸€æ­¥ siganl = [siganl flattenMap:^RACStream *(NSString *value) &#123; //å¤„ç†ä¸Šä¸€æ­¥çš„RACSiganlçš„ä¿¡å·value.è¿™é‡Œçš„value=@&quot;è›‹æ¶²&quot; NSLog(@&quot;æŠŠ%@å€’è¿›é”…é‡Œé¢ç…&quot;,value); return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;ç…è›‹&quot;]; [subscriber sendCompleted]; return nil; &#125;]; &#125;]; //å¯¹ä¿¡å·è¿›è¡Œç¬¬äºŒæ­¥å¤„ç† siganl = [siganl flattenMap:^RACStream *(id value) &#123; NSLog(@&quot;æŠŠ%@è£…è½½ç›˜é‡Œ&quot;,value); return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;ä¸Šèœ&quot;]; [subscriber sendCompleted]; return nil; &#125;]; &#125;]; //æœ€åæ‰“å° æœ€åå¸¦æœ‰===ä¸Šèœ [siganl subscribeNext:^(id x) &#123; NSLog(@&quot;====%@&quot;,x); &#125;];&#125; å‘½ä»¤12345678910111213-(void)demo13&#123; RACCommand *command = [[RACCommand alloc] initWithSignalBlock:^RACSignal *(id input) &#123; //æ‰“å°ï¼šä»Šå¤©æˆ‘æŠ•é™äº† //å‘½ä»¤æ‰§è¡Œä»£ç† NSLog(@&quot;%@æˆ‘æŠ•é™äº†&quot;,input); //è¿”å›ä¸€ä¸ªRACSignalä¿¡å· return [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; return nil; &#125;]; &#125;]; //æ‰§è¡Œå‘½ä»¤ [command execute:@&quot;ä»Šå¤©&quot;];&#125; å»¶è¿Ÿ12345678910111213- (void)demo14&#123; RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; NSLog(@&quot;ç­‰ç­‰æˆ‘,æˆ‘è¿˜æœ‰10så°±åˆ°äº†&quot;); [subscriber sendNext:@&quot;åŒ—æ&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //å»¶è¿Ÿ10sæ¥å—nextçš„ç»ç’ƒçƒ [[siganl delay:10] subscribeNext:^(id x) &#123; NSLog(@&quot;æˆ‘åˆ°äº†%@&quot;,x); &#125;];&#125; é‡æ”¾123456789101112131415161718- (void)demo15&#123; RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; NSLog(@&quot;ç”µå½±&quot;); [subscriber sendNext:@&quot;ç”µå½±&quot;]; [subscriber sendCompleted]; return nil; &#125;]; //åˆ›å»ºè¯¥æ™®é€šä¿¡å·çš„é‡å¤ä¿¡å· RACSignal *replaySiganl = [siganl replay]; //é‡å¤æ¥å—ä¿¡å· [replaySiganl subscribeNext:^(NSString *x) &#123; NSLog(@&quot;å°ç±³%@&quot;,x); &#125;]; [replaySiganl subscribeNext:^(NSString *x) &#123; NSLog(@&quot;å°çº¢%@&quot;,x); &#125;];&#125; å®šæ—¶â€”æ¯éš” 8 å°æ—¶æœç”¨ä¸€æ¬¡è¯12345678- (void)demo16&#123; //åˆ›å»ºå®šæ—¶å™¨ä¿¡å·.å®šæ—¶8å°æ—¶ RACSignal *siganl = [RACSignal interval:60 * 60 * 8 onScheduler:[RACScheduler mainThreadScheduler]]; //å®šæ—¶å™¨æ‰§è¡Œä»£ç  [siganl subscribeNext:^(id x) &#123; NSLog(@&quot;åƒè¯&quot;); &#125;];&#125; è¶…æ—¶12345678910111213141516171819202122- (void)demo17&#123; RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; NSLog(@&quot;æˆ‘å¿«åˆ°äº†&quot;); RACSignal *sendSiganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:nil]; [subscriber sendCompleted]; return nil; &#125;]; //å‘ç”Ÿä¿¡å·è¦1ä¸ªå°æ—¶10åˆ†é’Ÿæ‰åˆ° [[sendSiganl delay:60 * 70] subscribeNext:^(id x) &#123; //è¿™é‡Œæ‰å‘é€nextç»ç’ƒçƒåˆ°siganl [subscriber sendNext:@&quot;æˆ‘åˆ°äº†&quot;]; [subscriber sendCompleted]; &#125;]; return nil; &#125;]; [[siganl timeout:60 * 60 onScheduler:[RACScheduler mainThreadScheduler]] subscribeNext:^(id x) &#123; NSLog(@&quot;ç­‰äº†ä½ ä¸€ä¸ªå°æ—¶,ä½ ä¸€ç›´æ²¡æ¥,æˆ‘èµ°äº†&quot;); &#125;];&#125; é‡è¯•12345678910111213141516171819202122- (void)demo18&#123; __block int failedCount = 0; //åˆ›å»ºä¿¡å· RACSignal *siganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; if (failedCount &lt; 100) &#123; failedCount ++; NSLog(@&quot;æˆ‘å¤±è´¥äº†&quot;); [subscriber sendError:nil]; &#125;else&#123; NSLog(@&quot;ç»å†äº†æ•°ç™¾æ¬¡å,æˆ‘æˆåŠŸäº†&quot;); [subscriber sendNext:nil]; &#125; return nil; &#125;]; //é‡è¯• RACSignal *retrySiganl = [siganl retry]; //ç›´åˆ°å‘ç”Ÿnextçš„ç»ç’ƒçƒ [retrySiganl subscribeNext:^(id x) &#123; NSLog(@&quot;é‡è¦æˆåŠŸäº†&quot;); &#125;];&#125; èŠ‚æµ,ä¸å¥½æ„æ€,è¿™é‡Œæ¯ä¸€ç§’åªèƒ½é€šè¿‡ä¸€ä¸ªäºº,å¦‚æœ 1s å†…å‘ç”Ÿå¤šä¸ª,åªé€šè¿‡æœ€åä¸€ä¸ª1234567891011121314151617181920212223242526272829- (void)demo19&#123; RACSignal *signal = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; //å³ä½¿å‘é€ä¸€ä¸ªnextçš„ç»ç’ƒçƒ [subscriber sendNext:@&quot;A&quot;]; dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(1 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; [subscriber sendNext:@&quot;B&quot;]; &#125;); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(2 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; [subscriber sendNext:@&quot;C&quot;]; [subscriber sendNext:@&quot;D&quot;]; [subscriber sendNext:@&quot;E&quot;]; &#125;); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(3 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; [subscriber sendNext:@&quot;F&quot;]; &#125;); return nil; &#125;]; //å¯¹ä¿¡å·è¿›è¡ŒèŠ‚æµ,é™åˆ¶æ—¶é—´å†…ä¸€æ¬¡åªèƒ½é€šè¿‡ä¸€ä¸ªç»ç’ƒçƒ [[signal throttle:1] subscribeNext:^(id x) &#123; NSLog(@&quot;%@é€šè¿‡äº†&quot;,x); &#125;]; /* [2015-08-16 22:08:45.677]æ—…å®¢A [2015-08-16 22:08:46.737]æ—…å®¢B [2015-08-16 22:08:47.822]æ—…å®¢E [2015-08-16 22:08:48.920]æ—…å®¢F */&#125; æ¡ä»¶(takeUntil æ–¹æ³•,å½“ç»™å®šçš„ signal å®Œæˆå‰ä¸€ç›´å–å€¼)1234567891011121314151617181920212223242526- (void)demo20&#123; RACSignal *takeSiganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; //åˆ›å»ºä¸€ä¸ªå®šæ—¶å™¨ä¿¡å·,æ¯ä¸€ç§’è§¦å‘ä¸€æ¬¡ RACSignal *siganl = [RACSignal interval:1 onScheduler:[RACScheduler mainThreadScheduler]]; [siganl subscribeNext:^(id x) &#123; //åœ¨è¿™é‡Œå®šæ—¶å‘é€nextç»ç’ƒçƒ [subscriber sendNext:@&quot;ç›´åˆ°ä¸–ç•Œå°½å¤´&quot;]; &#125;]; return nil; &#125;]; //åˆ›å»ºæ¡ä»¶ä¿¡å· RACSignal *conditionSiganl = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; //è®¾ç½®5såå‘ç”Ÿcompleteç»ç’ƒçƒ dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(5 * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; NSLog(@&quot;ä¸–ç•Œçš„ä»Šå¤©åˆ°äº†,è¯·ä¸‹è½¦&quot;); [subscriber sendCompleted]; &#125;); return nil; &#125;]; //è®¾ç½®æ¡ä»¶,takeSiganlä¿¡å·åœ¨conditionSignalä¿¡å·æ¥æ”¶å®Œæˆå‰,ä¸æ–­å–å€¼ [[takeSiganl takeUntil:conditionSiganl] subscribeNext:^(id x) &#123; NSLog(@&quot;%@&quot;,x); &#125;];&#125; RACReplaySubject ä½¿ç”¨12345678910111213141516171819202122232425/*** RACReplaySubjectåˆ›å»ºæ–¹æ³• 1.åˆ›å»ºRACSubject 2.è®¢é˜…ä¿¡å· 3.å‘é€ä¿¡å· å·¥ä½œæµç¨‹: 1.è®¢é˜…ä¿¡å·,å†…éƒ¨ä¿å­˜äº†è®¢é˜…è€…,å’Œè®¢é˜…è€…ç›¸åº”çš„block 2.å½“å‘é€ä¿¡å·çš„,éå†è®¢é˜…è€…,è°ƒç”¨è®¢é˜…è€…çš„nextBlock 3.å‘é€çš„ä¿¡å·ä¼šä¿å­˜èµ·æ¥,å½“è®¢é˜…è€…è®¢é˜…ä¿¡å·çš„æ—¶å€™,ä¼šå°†ä¹‹å‰ä¿å­˜çš„ä¿¡å·,ä¸€ä¸ªä¸ªä½œç”¨äºæ–°çš„è®¢é˜…è€…,ä¿å­˜ä¿¡å·çš„å®¹é‡ç”±capacityå†³å®š,è¿™ä¹Ÿæ˜¯æœ‰åˆ«äºRACSubjectçš„*/-(void)RACReplaySubject&#123; RACReplaySubject *replaySubject = [RACReplaySubject subject]; [replaySubject subscribeNext:^(id x) &#123; NSLog(@&quot; 1 %@&quot;,x); &#125;]; [replaySubject subscribeNext:^(id x) &#123; NSLog(@&quot;2 %@&quot;,x); &#125;]; [replaySubject sendNext:@7]; [replaySubject subscribeNext:^(id x) &#123; NSLog(@&quot;3 %@&quot;,x); &#125;];&#125; rac_liftSelector:withSignals ä½¿ç”¨12345678910111213141516171819//è¿™é‡Œçš„rac_liftSelector:withSignals å°±æ˜¯å¹²è¿™ä»¶äº‹çš„ï¼Œå®ƒçš„æ„æ€æ˜¯å½“signalAå’ŒsignalBéƒ½è‡³å°‘sendNextè¿‡ä¸€æ¬¡ï¼Œæ¥ä¸‹æ¥åªè¦å…¶ä¸­ä»»æ„ä¸€ä¸ªsignalæœ‰äº†æ–°çš„å†…å®¹ï¼ŒdoA:withBè¿™ä¸ªæ–¹æ³•å°±ä¼šè‡ªåŠ¨è¢«è§¦å‘-(void)test&#123; RACSignal *sigalA = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; double delayInSeconds = 2.0; dispatch_time_t popTime = dispatch_time(DISPATCH_TIME_NOW, (int64_t)(delayInSeconds *NSEC_PER_SEC)); dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(popTime * NSEC_PER_SEC)), dispatch_get_main_queue(), ^&#123; [subscriber sendNext:@&quot;A&quot;]; &#125;); return nil; &#125;]; RACSignal *signalB = [RACSignal createSignal:^RACDisposable *(id&lt;RACSubscriber&gt; subscriber) &#123; [subscriber sendNext:@&quot;B&quot;]; [subscriber sendNext:@&quot;Another B&quot;]; [subscriber sendCompleted]; return nil; &#125;]; [self rac_liftSelector:@selector(doA:withB:) withSignals:sigalA,signalB, nil];&#125; æ¥æºï¼šç®€ä¹¦ä½œè€…æœªé­é›¨è¾° ã€ŠiOS RACçš„ä½¿ç”¨æ€»ç»“ã€‹","categories":[{"name":"Summary","slug":"Summary","permalink":"https://reversescale.github.io/categories/Summary/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"Jenkins + Fastlane è‡ªåŠ¨æ‰“åŒ…è„šæœ¬","slug":"AutoBuildScript","date":"2017-06-20T13:55:38.000Z","updated":"2018-11-17T07:36:42.180Z","comments":true,"path":"2017/06/20/AutoBuildScript/","link":"","permalink":"https://reversescale.github.io/2017/06/20/AutoBuildScript/","excerpt":"ä½¿ç”¨ Jenkins è¿è¡Œ Fastlane å‘½ä»¤ï¼Œå®ç°å®šæ—¶è‡ªåŠ¨æ‰“åŒ…ã€ä¿®æ”¹ç‰ˆæœ¬å·ã€ä¸Šä¼  Fir æˆ–è€… TestFlight ç­‰åŠŸèƒ½ï¼Œä»æ­¤å†ä¹Ÿä¸ç”¨è¢«å°ä¼™ä¼´è¿½ç€è¦æµ‹è¯•åŒ…ã€‚ ä¸‰æ­¥é…ç½®ï¼Œæœç»æ±¡æŸ“ï¼Œä¸€æ­¥æ“ä½œè‡ªåŠ¨ä¸Šä¼ ~","text":"ä½¿ç”¨ Jenkins è¿è¡Œ Fastlane å‘½ä»¤ï¼Œå®ç°å®šæ—¶è‡ªåŠ¨æ‰“åŒ…ã€ä¿®æ”¹ç‰ˆæœ¬å·ã€ä¸Šä¼  Fir æˆ–è€… TestFlight ç­‰åŠŸèƒ½ï¼Œä»æ­¤å†ä¹Ÿä¸ç”¨è¢«å°ä¼™ä¼´è¿½ç€è¦æµ‹è¯•åŒ…ã€‚ ä¸‰æ­¥é…ç½®ï¼Œæœç»æ±¡æŸ“ï¼Œä¸€æ­¥æ“ä½œè‡ªåŠ¨ä¸Šä¼ ~ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo ğŸ“º æ•…äº‹èƒŒæ™¯è®°å¾—å¤§çº¦ä¸¤å¹´å‰ï¼Œå½“æ—¶åœ¨åˆ›ä¸šå…¬å¸ï¼Œå¼€å‘ä»»åŠ¡é‡ï¼Œææµ‹å‰å¸¸å¸¸åŠ ç­åˆ°æ™šä¸Š 12 ç‚¹ï¼Œå°±ç®— bug ä¿®å®Œï¼Œä¹Ÿè¦çœ‹ç€ Xcode ä¸æ…Œä¸å¿™çš„èŠ±åŠä¸ªå¤šå°æ—¶æ‰“åŒ…å®Œæˆï¼Œå†ä¸Šä¼ æµ‹è¯•å¹³å°ï¼Œå‘äº†é‚®ä»¶æ‰èƒ½å®‰å¿ƒå›å®¶ã€‚é‰´äºè¿™ç§æƒ¨ç—›ç»å†ï¼Œåˆ©ç”¨é—²æš‡æ—¶é—´å°±æä¸€æè‡ªåŠ¨æ‰“åŒ…è„šæœ¬ï¼ŒåæœŸæœ‰é…ä¸Š Jenkinsï¼Œä»æ­¤è¿‡ä¸Šäº†æ²¡ç¾æ²¡è‡Šçš„ç”Ÿæ´»ã€‚ï¼ˆå·²é€‚é… Xcode 8.2 ä¹‹åç‰ˆæœ¬ï¼‰ ğŸš€ æ¡†æ¶çš„ä¼˜åŠ¿ 1.å¸‚é¢ä¸Šæ–‡ä»¶æœ€å°‘ï¼Œä½¿ç”¨æœ€ä¾¿æ·çš„è‡ªåŠ¨åŒ–æ‰“åŒ…è„šæœ¬ 2.å†—ä½™æ–¹æ³•å°‘ï¼Œç»“æ„æ¸…æ™°ï¼Œæ³¨é‡Šé½å…¨ 3.åŒæ—¶æ”¯æŒå¤šå¹³å°ä¸Šä¼ ï¼Œå¦‚ï¼šDirã€Firã€è’²å…¬è‹±ã€App Storeç­‰ 4.å…·å¤‡è¾ƒé«˜è‡ªå®šä¹‰æ€§ 5.[è‡ªç¼–è„šæœ¬çš„æ—¶ä»£] -&gt; [Fastlane çš„æ—¶ä»£] â–ˆâ—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â–ˆ ğŸš‚ è‡ªç¼–è„šæœ¬çš„æ—¶ä»£ [ğŸš‚ è‡ªç¼–è„šæœ¬çš„æ—¶ä»£] äº†è§£ä¸€ä¸‹å³å¯ï¼Œæœ‰äº›å‡†å¤‡å·¥ä½œæä¾›å‚è€ƒï¼Œå¦‚ç¯å¢ƒå·²ç»é…ç½®å¥½ï¼Œè¯·ç›´æ¥é˜…è¯» [ğŸš„ Fastlane çš„æ—¶ä»£] ç¬¬ä¸€æ­¥ å®‰è£…fir-cilfir-cli ä½¿ç”¨ Ruby æ„å»º, æ— éœ€ç¼–è¯‘, åªè¦å®‰è£…ç›¸åº” gem å³å¯. 12$ ruby -v # &gt; 1.9.3$ gem install fir-cli å¸¸è§çš„å®‰è£…é—®é¢˜(1)ä½¿ç”¨ç³»ç»Ÿè‡ªå¸¦çš„ Ruby å®‰è£…, éœ€ç¡®ä¿ ruby-dev å·²è¢«æ­£ç¡®çš„å®‰è£…: 12$ xcode-select --install # OS X ç³»ç»Ÿ$ sudo apt-get install ruby-dev # Linux ç³»ç»Ÿ (2)ç° Permission denied ç›¸å…³é”™è¯¯: è§£å†³ï¼šåœ¨å‘½ä»¤å‰åŠ ä¸Š sudo (3)å‡ºç° Gem::RemoteFetcher::FetchError ç›¸å…³é”™è¯¯: è§£å†³ï¼šæ›´æ¢ Ruby çš„æ·˜å®æº(ç”±äºå›½å†…ç½‘ç»œåŸå› , ä½ æ‡‚çš„), å¹¶å‡çº§ä¸‹ç³»ç»Ÿè‡ªå¸¦çš„ gem12345678$ gem sources --remove https://rubygems.org/$ gem sources -a https://ruby.taobao.org/$ gem sources -l*** CURRENT SOURCES ***https://ruby.taobao.org# è¯·ç¡®ä¿åªæœ‰ ruby.taobao.org, å¦‚æœæœ‰å…¶ä»–çš„æº, è¯· remove æ‰gem update --systemgem install fir-cli (4)Mac OS X 10.11 ä»¥åçš„ç‰ˆæœ¬, ç”±äº10.11å¼•å…¥äº† rootless, æ— æ³•ç›´æ¥å®‰è£… fir-cli, æœ‰ä»¥ä¸‹ä¸‰ç§è§£å†³åŠæ³•: æ–¹æ³•ä¸€ï¼š ä½¿ç”¨ Homebrew åŠ RVM å®‰è£… Ruby, å†å®‰è£… fir-cli(æ¨è)12345# Install Homebrew:$ ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;# Install RVM:$ \\curl -sSL https://get.rvm.io | bash -s stable --ruby$ gem install fir-cli æ–¹æ³•äºŒï¼š æŒ‡å®š fir-cli ä¸­ bin æ–‡ä»¶çš„ PATH1$ export PATH=/usr/local/bin:$PATH;gem install -n /usr/local/bin fir-cli æ–¹æ³•ä¸‰ï¼š é‡å†™ Ruby Gem çš„ bindir12$ echo &apos;gem: --bindir /usr/local/bin&apos; &gt;&gt; ~/.gemrc$ gem install fir-cli ç¬¬äºŒæ­¥ ç™»å½•fir.im å…ˆåˆ° https://fir.im åˆ›å»ºé¡¹ç›®ï¼Œå¾—åˆ° API Token å¹¶å¤åˆ¶ã€‚ 1fir login å‘½ä»¤ç”¨äºä½¿ç”¨ API token ç™»å½• fir.im, å¹¶ä½¿ç”¨å‘å¸ƒåº”ç”¨ç­‰ç›¸å…³å‘½ä»¤. 1fir me å‘½ä»¤ç”¨äºæŸ¥çœ‹å½“å‰ç™»å½•ç”¨æˆ·ä¿¡æ¯. æ˜¾ç¤ºä¿¡æ¯å¦‚ä¸‹ï¼š12345678$ fir login XXX_YOUR_API_TOKEN_XXXI, [2016-03-08T12:48:56.499435 #13043] INFO -- : Login succeed, previous user&apos;s email: xxx@fir.imI, [2016-03-08T12:48:56.507044 #13043] INFO -- : Login succeed, current user&apos;s email: xxx@fir.imI, [2016-03-08T12:48:56.507147 #13043] INFO -- :$ fir meI, [2016-03-08T12:48:14.175488 #12986] INFO -- : Login succeed, current user&apos;s email: xxx@fir.imI, [2016-03-08T12:48:14.175687 #12986] INFO -- : Login succeed, current user&apos;s name: xxxI, [2016-03-08T12:48:14.175765 #12986] INFO -- : ç¬¬ä¸‰æ­¥ ä¸‹è½½å¹¶é…ç½® shell è„šæœ¬1.æŠŠæ–‡ä»¶å¤¹å¯¼å…¥å·¥ç¨‹ç›®å½•æ ¹ç›®å½•ä¸‹ 2.é…ç½® shell è„šæœ¬ 12345678# éœ€è¦æ”¹åŠ¨çš„åœ°æ–¹ (æ ¹æ®é¡¹ç›®å…·ä½“ä¿¡æ¯æ”¹åŠ¨)PROJECT_NAME = &quot;***&quot; #é¡¹ç›®åç§°VERSION = &quot;1.0.0&quot; #æ‰“åŒ…ç‰ˆæœ¬å· ä¼šæ ¹æ®ä¸åŒçš„ç‰ˆæœ¬åˆ›å»ºæ–‡ä»¶å¤¹ï¼ˆä¸é¡¹ç›®æœ¬èº«çš„ç‰ˆæœ¬å·æ— å…³ï¼‰TAGREAT_NAME = &quot;***&quot; #é¡¹ç›®å¯¹åº”targetçš„åç§°å¦‚ &quot;Meifabao_User&quot; &quot;Miefabao_stylist&quot;CONFIGURATION = &quot;Release&quot; #æ‰“åŒ…çš„ç¯å¢ƒè®¾ç½® Release ç¯å¢ƒ Debug ç¯å¢ƒPROFILE = &quot;AdHoc&quot; #é…ç½®æ–‡ä»¶åˆ†ä¸ºå››ç§ AdHoc Dev AppStore Ent åˆ†åˆ«å¯¹åº”å››ç§é…ç½®æ–‡ä»¶OUTPUT = &quot;./Packge/%s&quot; %(CONFIGURATION) #æ‰“åŒ…å¯¼å‡ºipaæ–‡ä»¶è·¯å¾„ï¼ˆè¯·ç¡®ä¿ â€œ%sâ€ ä¹‹å‰çš„æ–‡ä»¶å¤¹æ­£ç¡®å¹¶å­˜åœ¨ï¼‰ æ ¹æ®å…·ä½“é¡¹ç›®å¡«å†™ 3.æ§åˆ¶å°åˆ°é¡¹ç›®æ‰€åœ¨ç›®å½•ä¸‹ï¼Œå¯åŠ¨è„šæœ¬(å¿…è¦æ—¶åŠ ç®¡ç†å‘˜æƒé™) å¯ä»¥å°† autobuild.py æ‹–æ‹½åˆ°æ§åˆ¶å°ï¼Œæ‰§è¡Œè„šæœ¬ æ³¨ï¼šå…¶ä»–çš„åŠŸèƒ½è„šæœ¬ç”±äºå®ç”¨æ€§ä¸é«˜ï¼ˆå…¶å®æˆ‘æ‡’å¾—æï¼‰ï¼Œæš‚æ—¶æ²¡æœ‰é€‚é…ï¼Œæœ‰å…´è¶£çš„æœ‹å‹å¯ä»¥è‡ªè¡Œé…ç½®è¯•ç”¨ï¼ŒåŒ…æ‹¬ï¼šé‚®ä»¶å‘é€ã€æ‰“åŒ… App Store ç­‰ç­‰ã€‚ å½“çœ‹åˆ° æ—¶ï¼Œæ‰“åŒ…å¥½çš„é¡¹ç›®å·²ç»èººåœ¨ä½ çš„ Fir æµ‹è¯•å¹³å°ä¸­äº†ã€‚ â–ˆâ—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â–ˆ ğŸš„ Fastlane çš„æ—¶ä»£2018.08.20 æ›´æ–°ï¼šJenkins + Fastlane + GitLab + fir (æˆ–è€…è’²å…¬è‹±) ç¬¬ä¸€æ­¥ å®‰è£… FastlaneFastlane æ˜¯ä¸€å¥—ä½¿ç”¨Rubyå†™çš„è‡ªåŠ¨åŒ–å·¥å…·é›†ï¼Œç”¨äºiOSå’ŒAndroidçš„è‡ªåŠ¨åŒ–æ‰“åŒ…ã€å‘å¸ƒç­‰å·¥ä½œï¼Œå¯ä»¥èŠ‚çœå¤§é‡çš„æ—¶é—´ 1sudo gem install fastlane --verbose ç¬¬äºŒæ­¥ ç§»åŠ¨è„šæœ¬è‡³é¡¹ç›®ç›®å½•ä¸‹æ ¹æ®æ³¨é‡Šå®Œå–„è„šæœ¬é…ç½®ä¿¡æ¯ è„šæœ¬è¯´æ˜ï¼š æ”¯æŒç‰ˆæœ¬å·è‡ªå¢é•¿ æ”¯æŒä¼ å…¥è‡ªå®šçš„å®ï¼Œç”¨äºåœ¨ä»£ç é‡Œä½¿ç”¨æ­¤é¢„ç¼–è¯‘çš„å®æ¥åŒºåˆ†å¼€å‘ç¯å¢ƒå’Œå‘å¸ƒç¯å¢ƒ æ”¯æŒè‡ªåŠ¨ä¸Šä¼ åˆ° fir å’Œ testflight ä¸Šä¼ æˆåŠŸåå¼¹çª—æç¤º ç¬¬ä¸‰æ­¥ ä¸Šä¼ ä¸Šä¼ åˆ° fir çš„ç”¨æ³•ï¼š1./build.sh -m &quot;xxxx_app_test&quot; -t test ä¸Šä¼ åˆ° testflight çš„ç”¨æ³•ï¼š1./build.sh -m &quot;xxxx_app_pro&quot; -t pro ç¬¬å››æ­¥ é…ç½® Jenkins Jenkins æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œæä¾›äº†ä¸€ç§æ˜“äºä½¿ç”¨çš„æŒç»­é›†æˆç³»ç»Ÿï¼Œä½¿å¼€å‘è€…ä»ç¹æ‚çš„é›†æˆä¸­è§£è„±å‡ºæ¥ï¼Œä¸“æ³¨äºæ›´ä¸ºé‡è¦çš„ä¸šåŠ¡é€»è¾‘å®ç°ä¸Šã€‚åŒæ—¶ Jenkins èƒ½å®æ–½ç›‘æ§é›†æˆä¸­å­˜åœ¨çš„é”™è¯¯ï¼Œæä¾›è¯¦ç»†çš„æ—¥å¿—æ–‡ä»¶å’Œæé†’åŠŸèƒ½ï¼Œè¿˜èƒ½ç”¨å›¾è¡¨çš„å½¢å¼å½¢è±¡åœ°å±•ç¤ºé¡¹ç›®æ„å»ºçš„è¶‹åŠ¿å’Œç¨³å®šæ€§ã€‚ 1ï¼‰ä¸‹è½½ Jenkinsï¼š ç‚¹å‡» http://mirrors.jenkins.io/war-stable/latest/jenkins.war ä¸‹è½½æœ€æ–°çš„Jenkins.war 2ï¼‰è¿è¡ŒæœåŠ¡å™¨ï¼š éœ€è¦å…ˆå®‰è£… java sdk ï¼ˆhttp://www.oracle.com/technetwork/java/javase/downloads/jdk8-downloads-2133151.htmlï¼‰ 1java -jar jenkins.war 3ï¼‰è¿è¡Œ Jenkins 1jenkins 4ï¼‰é…ç½® Jenkinsï¼š æµè§ˆå™¨æ‰“å¼€ http://localhost:8080/ è¾“å…¥å®‰å…¨å¯†ç ï¼Œå®‰å…¨å¯†ç å‘½ä»¤è¡Œè¾“å‡ºçš„ä¸€ä¸ªæ–‡ä»¶é‡Œé¢ã€‚ ç„¶åè‡ªåŠ¨å®‰è£…æ¨èçš„æ’ä»¶ï¼Œå¹¶æ–°å»ºç®¡ç†å‘˜è´¦å·å¯†ç ã€‚ 5ï¼‰å®‰è£…æ’ä»¶ ç™»å½•http://localhost:8080/ ï¼Œé€‰æ‹©ç³»ç»Ÿç®¡ç† - ç®¡ç†æ’ä»¶ã€‚åœ¨å¯é€‰æ’ä»¶ä¸­é€‰æ‹©GitLab Pluginï¼ŒGitlab Hook Pluginï¼Œå’Œ Cocoapod plugin è¿›è¡Œå®‰è£…ã€‚ 6ï¼‰æ„å»ºä»»åŠ¡ ç‚¹å‡»æ–°å»ºï¼Œè¾“å…¥åç§°ï¼Œæ„å»ºä¸€ä¸ªè‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ã€‚ é…ç½® Git ä»“åº“åœ°å€ï¼Œå¹¶æ·»åŠ  git è´¦å·ã€‚ é…ç½®æ„å»ºè„šæœ¬ é™„å½• æ‰§è¡Œè„šæœ¬è¿‡ç¨‹ä¸­é‡åˆ°çš„é—®é¢˜å’Œè§£å†³æ–¹æ¡ˆ 1ï¼‰fir: command not found è¿™ä¸ªæ˜¯å› ä¸ºæ²¡æœ‰å®‰è£…fir-cilï¼Œå¯¼è‡´æ‰¾ä¸åˆ°ç›¸åº”çš„å‘½ä»¤è¡Œï¼Œåªéœ€è¦å®‰è£…ä¸€ä¸‹å°±è¡Œäº†ï¼Œè¯¦æƒ…è§ä¸Šæ–‡å†™çš„å¦‚ä½•å®‰è£…fir-cilã€‚ 2ï¼‰README: No such file or directory é‚£æ˜¯å› ä¸ºä½ çš„è„šæœ¬ç›®å½•ä¸‹æ²¡æœ‰READMEçš„æ–‡ä»¶ï¼Œåªéœ€è¦å»ºä¸€ä¸ªREADMEçš„æ–‡ä»¶å°±è¡Œäº†ï¼Œæ‰“å¼€ç»ˆç«¯ï¼Œcdåˆ°å½“å‰ä½ç½®ï¼Œç„¶åæ‰§è¡Œä¸‹é¢çš„å‘½ä»¤ï¼š 1touch README 3ï¼‰ERROR â€“ : Token can not be blank è¿™ä¸ªåŸå› æ˜¯å› ä¸ºä½ æ²¡æœ‰ç™»å½•firå¯¼è‡´çš„ï¼Œä½ æ‰§è¡Œè¿™ä¸ªè„šæœ¬ä¹‹å‰åº”è¯¥å…ˆç™»å½•ä¸€ä¸‹firï¼Œè¯¦æƒ…è¯·çœ‹ä¸Šæ–‡å†™çš„ç™»å½•fir.imã€‚ 4ï¼‰ERROR â€“ : Code=14 (æ²¡æœ‰è¯•ç”¨çš„è®¾å¤‡ Domain=IDEDistributionErrorDomain Code=14 â€œNo applicable devices åŸå› ï¼šrvm ruby é…ç½®é”™è¯¯ è§£å†³ï¼šæ§åˆ¶å° rvm system â–ˆâ—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â–ˆ 2018.08.20 æ›´æ–°ï¼šJenkins ç›¸å…³è®¾ç½®5ï¼‰æŸ¥çœ‹ç«¯å£å ç”¨ ç«¯å£å ç”¨ ä½¿ç”¨ lsof ä¼šåˆ—ä¸¾æ‰€æœ‰å ç”¨çš„ç«¯å£åˆ—è¡¨ï¼š 1lsof ä½¿ç”¨lesså¯ä»¥ç”¨äºåˆ†é¡µå±•ç¤ºï¼Œå¦‚ï¼š 1lsof | less ä¹Ÿå¯ä»¥ä½¿ç”¨ -i æŸ¥çœ‹æŸä¸ªç«¯å£æ˜¯å¦è¢«å ç”¨ï¼Œå¦‚ï¼š 1lsof -i:3000 æ€æ­»è¿›ç¨‹ 1kill PIDï¼ˆè¿›ç¨‹çš„PIDï¼Œå¦‚2044ï¼‰ 6ï¼‰Jenkins æ”¹æ—¶åŒº http://your-jenkins/systemInfoï¼ŒæŸ¥çœ‹user.timezoneå˜é‡çš„å€¼ åœ¨jenkinsçš„ã€ç³»ç»Ÿç®¡ç†ã€‘-ã€è„šæœ¬å‘½ä»¤è¡Œã€‘é‡Œè¿è¡Œ 1System.setProperty(&apos;org.apache.commons.jelly.tags.fmt.timeZone&apos;, &apos;Asia/Shanghai&apos;) 7ï¼‰Jenkins æ„å»ºè¶…æ—¶ jenkinsçš„â€build timeout pluginâ€æ’ä»¶å¯ä»¥å¸®æˆ‘ä»¬å®Œæˆè¯¥ä»»åŠ¡ã€‚æˆ‘ä½¿ç”¨çš„æ˜¯jenkins-2.7.1, é»˜è®¤å°±å·²ç»å®‰è£…äº†è¯¥æ’ä»¶ï¼Œå¦‚æœé»˜è®¤æ²¡æœ‰å®‰è£…å¯åœ¨æ’ä»¶ç®¡ç†ä¸­æœç´¢è¿›è¡Œå®‰è£…ã€‚ 8ï¼‰Jenkins å®šæ—¶æ„å»ºå’ŒPoll SCMçš„åŒºåˆ« Build periodicallyï¼šå‘¨æœŸè¿›è¡Œé¡¹ç›®æ„å»ºï¼ˆæºç æ˜¯å¦å‘ç”Ÿå˜åŒ–æ²¡æœ‰å…³ç³»ï¼‰ Poll SCMï¼šå®šæ—¶æ£€æŸ¥æºç å˜æ›´ï¼Œå¦‚æœæœ‰æ›´æ–°å°±checkoutæœ€æ–°codeä¸‹æ¥ï¼Œç„¶åæ‰§è¡Œæ„å»ºåŠ¨ä½œ 12345678910111213æ¯15åˆ†é’Ÿæ„å»ºä¸€æ¬¡ï¼šH/15 * * * * æˆ– */5 * * * *æ¯å¤©8ç‚¹æ„å»ºä¸€æ¬¡ï¼š0 8 * * *æ¯å¤©8ç‚¹~17ç‚¹ï¼Œä¸¤å°æ—¶æ„å»ºä¸€æ¬¡ï¼š0 8-17/2 * * *å‘¨ä¸€åˆ°å‘¨äº”ï¼Œ8ç‚¹~17ç‚¹ï¼Œä¸¤å°æ—¶æ„å»ºä¸€æ¬¡ï¼š0 8-17/2 * * 1-5æ¯æœˆ1å·ã€15å·å„æ„å»ºä¸€æ¬¡ï¼Œé™¤12æœˆï¼šH H 1,15 1-11 **/5 * * * * ï¼ˆæ¯5åˆ†é’Ÿæ£€æŸ¥ä¸€æ¬¡æºç å˜åŒ–ï¼‰0 2 * * * ï¼ˆæ¯å¤©2:00 å¿…é¡»buildä¸€æ¬¡æºç ï¼‰ â–ˆâ—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â—¤â—¢â–ˆ ğŸ•¹ agvtool å‘½ä»¤è¡Œ2018.08.20 æ›´æ–°ï¼šç®¡ç†ç‰ˆæœ¬å· å¸¸ç”¨å‘½ä»¤è¡Œï¼š è®¾ç½® ç‰ˆæœ¬å· ä¸º 1.1.01xcrun agvtool new-marketing-version 1.1.0 è®¾ç½® build å· è‡ªåŠ¨åŠ 11xcrun agvtool next-version -all ç®€ä»‹agvtool æ˜¯ä¸€ä¸ªå‘½ä»¤è¡Œå·¥å…·ï¼Œå…è®¸ä½ è‡ªåŠ¨é€’å¢åˆ°ä¸‹ä¸€ä¸ªæœ€é«˜çš„æ•°é‡æˆ–å…·ä½“çš„æ•°å­—è¿™äº›æ•°å­—ã€‚ ä¿®æ”¹Xcodeçš„é»˜è®¤è®¾ç½®é»˜è®¤æƒ…å†µä¸‹ï¼Œåœ¨ä¸ä½¿ç”¨ä»»ä½•ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿã€‚è®¾ç½®ç‰ˆæœ¬ç³»ç»Ÿè‹¹æœé€šç”¨ç¡®ä¿ Xcode å°†åŒ…æ‹¬åœ¨ä½ çš„é¡¹ç›®ä¸­ç”Ÿæˆçš„æ‰€æœ‰agvtoolç‰ˆæœ¬ä¿¡æ¯ã€‚ ä¸Šå›¾ï¼šè®¾ç½®å½“å‰é¡¹ç›®çš„ç‰ˆæœ¬å’Œç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿçš„æ„å»ºè®¾ç½® è®¾ç½®ä½ çš„ç‰ˆæœ¬å·å’Œ bulid ç‰ˆæœ¬å·agvtool æŸ¥è¯¢åº”ç”¨ç¨‹åºçš„ Info.plist å¾—åˆ°ä½ çš„ç‰ˆæœ¬å’Œ bulid ç‰ˆæœ¬å·ã€‚ æ‰€ä»¥ç¡®ä¿ CFBundleVersion (Bundle version) å’Œ CFBundleShortVersionString (Bundle versions string, shortï¼‰çš„ key åœ¨ä½ çš„ Info.plist ä¸­ã€‚ ä¸Šå›¾ï¼šinfo.plist å‘½ä»¤è¡Œæ“ä½œæ›´æ–°ç‰ˆæœ¬å·é€€å‡ºXcodeï¼Œç„¶åå¯¼èˆªåˆ°åŒ…å«é¡¹ç›®çš„ç›®å½•ï¼Œè¿è¡Œä¸‹åˆ—å‘½ä»¤åœ¨ç»ˆç«¯åº”ç”¨ agvtool å±æ€§å·¥ä½œã€‚ è®¾ç½® ç‰ˆæœ¬å· ä¸º 1.1.01xcrun agvtool new-marketing-version 1.1.0 è®¾ç½® build å· è‡ªåŠ¨åŠ 11xcrun agvtool next-version -all è®¾ç½® build å·ä¸º 311xcrun agvtool new-version -all 31 æŸ¥çœ‹ Version Numbers1xcrun agvtool what-marketing-version æŸ¥çœ‹ Build Numbers1xcrun agvtool what-version ğŸ˜¬ è”ç³» å¾®ä¿¡ : WhatsXie é‚®ä»¶ : ReverseScale@iCloud.com åšå®¢ : https://reversescale.github.io","categories":[{"name":"Summary","slug":"Summary","permalink":"https://reversescale.github.io/categories/Summary/"}],"tags":[{"name":"Script","slug":"Script","permalink":"https://reversescale.github.io/tags/Script/"}]},{"title":"ä½¿ç”¨ CocoaPods å¯¹å…¬æœ‰åº“å¼€æºå’Œç§æœ‰åº“ç»„ä»¶","slug":"Open source library","date":"2017-01-22T13:56:27.000Z","updated":"2018-11-16T13:29:52.512Z","comments":true,"path":"2017/01/22/Open source library/","link":"","permalink":"https://reversescale.github.io/2017/01/22/Open source library/","excerpt":"æœ€è¿‘åœ¨ç ”ç©¶ä½¿ç”¨ CocoaPods å¯¹ iOS å·¥ç¨‹ç»„ä»¶åŒ–ï¼Œåˆ›å»ºå…¬æœ‰ Pod åº“å’Œç§æœ‰ Pod åº“æ–¹æ³•ï¼Œä¸ºäº†æ–¹ä¾¿æ•´ç†å’Œå­¦ä¹ å°±æ•´ç†äº†è¿™ç¯‡æ–‡ç« ~","text":"æœ€è¿‘åœ¨ç ”ç©¶ä½¿ç”¨ CocoaPods å¯¹ iOS å·¥ç¨‹ç»„ä»¶åŒ–ï¼Œåˆ›å»ºå…¬æœ‰ Pod åº“å’Œç§æœ‰ Pod åº“æ–¹æ³•ï¼Œä¸ºäº†æ–¹ä¾¿æ•´ç†å’Œå­¦ä¹ å°±æ•´ç†äº†è¿™ç¯‡æ–‡ç« ~ åˆ›å»ºå…¬æœ‰ Pod åº“æˆ–è€…ç§æœ‰ Pod åº“ï¼Œå®é™…ä¸ŠåŸç†æ˜¯ä¸€æ ·çš„ï¼Œéƒ½æ˜¯åŸºäº git æœåŠ¡å’Œ repo åè®®ï¼Œä¸ä¸€æ ·çš„æ˜¯ï¼Œä¸¤è€…çš„ç‰ˆæœ¬ç´¢å¼•æŸ¥è¯¢æ–¹å¼ä¸ä¸€æ ·ï¼Œå…¬æœ‰åº“çš„ podspec ç”± CocoaPods/Specs ç®¡ç†ï¼Œè€Œå†…éƒ¨ç§æœ‰ä½¿ç”¨çš„ pod åº“éœ€è¦è‡ªå·±å»ºç«‹ä¸€ä¸ªä»“åº“æ¥ç®¡ç† podspecã€‚ å®ç”¨ï¼šå¼€æºå…¬æœ‰åº“ä¾‹å­: æˆ‘æœ‰å°è£…è¿‡ä¸€ä¸ªå·¥å…·CollectionIndexToolsï¼ŒCollectionIndexTools å¯ä»¥ç»™ Collection æ·»åŠ ä¸€ä¸ªç±»ä¼¼ TableView å³ä¾§çš„ç´¢å¼•æ¡ï¼Œæˆ‘æƒ³é€šè¿‡ Podfile ä¸­æ·»åŠ  pod â€˜CollectionIndexToolsLibâ€™ å³å¯ä½¿ç”¨. æ³¨å†Œ CocoaPods è´¦æˆ·ä¿¡æ¯æƒ³è¦åˆ›å»ºä¸€ä¸ªå¼€æº pod åº“ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ³¨å†Œ CocoaPods, è¿™é‡Œä½¿ç”¨ trunk æ–¹å¼ï¼Œä½œä¸ºä¸€ä¸ª iOS å¼€å‘äººå‘˜ä½ ä¸€å®šå®‰è£…äº† CocoaPodsï¼Œé‚£ä¹ˆåªéœ€è¦åœ¨ç»ˆç«¯æ‰§è¡Œï¼š 1pod trunk register é‚®ç®±åœ°å€ &apos;ç”¨æˆ·å&apos; --verbose è¿™é‡Œæˆ‘ä»¬ä¸€èˆ¬ä½¿ç”¨ Github é‚®ç®±å’Œç”¨æˆ·åï¼Œç„¶ååœ¨ä½ çš„é‚®ç®±ä¸­ä¼šæ”¶åˆ°ç¡®è®¤é‚®ä»¶ï¼Œåœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»é“¾æ¥ç¡®è®¤å³æ³¨å†ŒæˆåŠŸï¼ŒæˆåŠŸä¹‹åå¯ä»¥ç»ˆç«¯æ‰§è¡Œï¼š 1pod trunk me æŸ¥çœ‹è‡ªå·±çš„æ³¨å†Œä¿¡æ¯ï¼Œä»¥åå½“ä½ æœ‰äº†è‡ªå·±çš„å¼€æºPodåº“ï¼Œä¹Ÿå¯ä»¥ç”¨æ­¤æ–¹å¼éšæ—¶æŸ¥çœ‹è‡ªå·±å‘å¸ƒè¿‡çš„Podsï¼š åˆ›å»ºå…±äº«åº“æ–‡ä»¶å¹¶ä¸Šä¼ åˆ°å…¬æœ‰ä»“åº“å…±äº«åº“éœ€è¦ä¸‰ä¸ªå¿…ä¸å¯å°‘çš„éƒ¨åˆ†: 1.å…±äº«æ–‡ä»¶å¤¹(æ–‡ä»¶å¤¹å­˜æ”¾ç€ä½ è¦å…±äº«çš„å†…å®¹, ä¹Ÿå°±æ˜¯å…¶ä»–äººpodå¾—åˆ°çš„æ–‡ä»¶, .podspecæ–‡ä»¶ä¸­çš„source_fileséœ€è¦æŒ‡å®šæ­¤æ–‡ä»¶è·¯å¾„åŠæ–‡ä»¶ç±»å‹); 2.LICENSEæ–‡ä»¶(é»˜è®¤ä¸€èˆ¬é€‰æ‹©MIT); 3.åº“æè¿°æ–‡ä»¶.podspec(æœ¬åº“çš„å„é¡¹ä¿¡æ¯æè¿°, éœ€è¦æäº¤ç»™CocoaPods, podé€šè¿‡è¿™ä¸ªæ–‡ä»¶æŸ¥æ‰¾åˆ°ä½ å…±äº«çš„åº“, .podspecæ–‡ä»¶çš„æ ¼å¼è§ç¬¬3ç‚¹). è¿™ä¸€æ­¥åˆ†ä¸¤ç§åœºæ™¯: åœºæ™¯ä¸€ï¼šå¦‚æœä½ å·²ç»æœ‰äº†ç°æˆçš„æƒ³è¦å…±äº«çš„æ–‡ä»¶,ä½ åªéœ€è¦æ»¡è¶³ä¸Šé¢ä¸‰ä¸ªéƒ¨åˆ†,å³å¯ä¸Šä¼ åˆ°å…¬æœ‰ä»“åº“å³å¯ç»§ç»­å…¶ä»–çš„æ­¥éª¤; åœºæ™¯äºŒï¼šä½ æƒ³è¦åˆ›å»ºä¸€ä¸ªå…¨æ–°çš„å·¥ç¨‹å»åšè‡ªå·±çš„å…±äº«, å¯ä»¥ä½¿ç”¨ç»ˆç«¯å‘½ä»¤: 1pod lib create CollectionIndexToolsLib éœ€è¦è¾“å…¥ä¸€äº›æ¨¡æ¿å‚æ•°ï¼š Cocoapods ä¼šè‡ªåŠ¨ç”Ÿæˆä¸€ä¸ªæ¨¡æ¿é¡¹ç›®ï¼Œç›®å½•ç»“æ„ï¼š 123456789101112131415CollectionIndexToolsLibâ”œâ”€â”€ Example #demo APPâ”‚ â”œâ”€â”€ CollectionIndexToolsLibâ”‚ â”œâ”€â”€ CollectionIndexToolsLib.xcodeprojâ”‚ â”œâ”€â”€ CollectionIndexToolsLib.xcworkspaceâ”‚ â”œâ”€â”€ Podfile #demo APP çš„ä¾èµ–æè¿°æ–‡ä»¶â”‚ â”œâ”€â”€ Podfile.lockâ”‚ â”œâ”€â”€ Pods #demo APP çš„ä¾èµ–æ–‡ä»¶â”‚ â””â”€â”€ Testsâ”œâ”€â”€ LICENSE #å¼€æºåè®® é»˜è®¤MITâ”œâ”€â”€ Pod #ç»„ä»¶çš„ç›®å½•â”‚ â”œâ”€â”€ Assets #èµ„æºæ–‡ä»¶â”‚ â””â”€â”€ Classes #ç±»æ–‡ä»¶â”œâ”€â”€ PodCollectionIndexToolsLib.podspec #ç¬¬ä¸‰æ­¥è¦åˆ›å»ºçš„podspecæ–‡ä»¶â””â”€â”€ README.md #markdownæ ¼å¼çš„README ç¼–è¾‘.podspecæ–‡ä»¶ä»¥CollectionIndexToolsLib.podspecä¸ºä¾‹:123456789101112131415161718192021Pod::Spec.new do |s| s.name = 'CollectionIndexToolsLib' s.version = '0.1.0' s.summary = 'Custom IndexTools similar to TableViews index bar' s.description = &lt;&lt;-DESC I believe you must have thought about adding an index like Table View to Collection View. I will give you one today. DESC s.homepage = 'https://github.com/ReverseScale/CollectionIndexToolsLib' s.license = 'MIT' s.author = &#123; 'ReverseScale' =&gt; 'reversescale@icloud.com' &#125; s.source = &#123; :git =&gt; 'https://github.com/ReverseScale/CollectionIndexToolsLib.git', :tag =&gt; s.version.to_s &#125; s.ios.deployment_target = '8.0' s.source_files = 'CollectionIndexToolsLib/Classes/**/*' s.requires_arc = trueend ç†è®ºä¸Šå‰é¢çš„è®¾ç½®å°±å¯ä»¥é€šè¿‡éªŒè¯ï¼Œä¸‹é¢æ˜¯æ³¨é‡Šå‚ç…§ï¼š1234567891011121314151617181920212223242526272829Pod::Spec.new do |s| s.name = \"PodTestLibrary\" #åç§° s.version = \"0.1.0\" #ç‰ˆæœ¬å· s.summary = \"Just Testing.\" #ç®€çŸ­ä»‹ç»ï¼Œä¸‹é¢æ˜¯è¯¦ç»†ä»‹ç» s.description = &lt;&lt;-DESC Testing Private Podspec. * Markdown format. * Don't worry about the indent, we strip it! DESC s.homepage = \"https://coding.net/u/wtlucky/p/podTestLibrary\" #ä¸»é¡µ,è¿™é‡Œè¦å¡«å†™å¯ä»¥è®¿é—®åˆ°çš„åœ°å€ï¼Œä¸ç„¶éªŒè¯ä¸é€šè¿‡ # s.screenshots = \"www.example.com/screenshots_1\", \"www.example.com/screenshots_2\" #æˆªå›¾ s.license = 'MIT' #å¼€æºåè®® s.author = &#123; \"wtlucky\" =&gt; \"wtlucky@foxmail.com\" &#125; #ä½œè€…ä¿¡æ¯ s.source = &#123; :git =&gt; \"https://coding.net/wtlucky/podTestLibrary.git\", :tag =&gt; \"0.1.0\" &#125; #é¡¹ç›®åœ°å€ï¼Œè¿™é‡Œä¸æ”¯æŒsshçš„åœ°å€ï¼ŒéªŒè¯ä¸é€šè¿‡ï¼Œåªæ”¯æŒHTTPå’ŒHTTPSï¼Œæœ€å¥½ä½¿ç”¨HTTPS # s.social_media_url = 'https://twitter.com/&lt;TWITTER_USERNAME&gt;' #å¤šåª’ä½“ä»‹ç»åœ°å€ s.platform = :ios, '7.0' #æ”¯æŒçš„å¹³å°åŠç‰ˆæœ¬ s.requires_arc = true #æ˜¯å¦ä½¿ç”¨ARCï¼Œå¦‚æœæŒ‡å®šå…·ä½“æ–‡ä»¶ï¼Œåˆ™å…·ä½“çš„é—®é¢˜ä½¿ç”¨ARC s.source_files = 'Pod/Classes/**/*' #ä»£ç æºæ–‡ä»¶åœ°å€ï¼Œ**/*è¡¨ç¤ºClassesç›®å½•åŠå…¶å­ç›®å½•ä¸‹æ‰€æœ‰æ–‡ä»¶ï¼Œå¦‚æœæœ‰å¤šä¸ªç›®å½•ä¸‹åˆ™ç”¨é€—å·åˆ†å¼€ï¼Œå¦‚æœéœ€è¦åœ¨é¡¹ç›®ä¸­åˆ†ç»„æ˜¾ç¤ºï¼Œè¿™é‡Œä¹Ÿè¦åšç›¸åº”çš„è®¾ç½® s.resource_bundles = &#123; 'PodTestLibrary' =&gt; ['Pod/Assets/*.png'] &#125; #èµ„æºæ–‡ä»¶åœ°å€ s.public_header_files = 'Pod/Classes/**/*.h' #å…¬å¼€å¤´æ–‡ä»¶åœ°å€ s.frameworks = 'UIKit' #æ‰€éœ€çš„frameworkï¼Œå¤šä¸ªç”¨é€—å·éš”å¼€ s.dependency 'AFNetworking', '~&gt; 2.3' #ä¾èµ–å…³ç³»ï¼Œè¯¥é¡¹ç›®æ‰€ä¾èµ–çš„å…¶ä»–åº“ï¼Œå¦‚æœæœ‰å¤šä¸ªéœ€è¦å¡«å†™å¤šä¸ªs.dependencyend ç¼–å†™å®Œæˆå, æˆ‘ä»¬éœ€è¦éªŒè¯.podspecæ–‡ä»¶çš„åˆæ³•æ€§, è¿™é‡Œéœ€è¦ç»ˆç«¯cdåˆ°.podspecæ–‡ä»¶æ‰€åœ¨æ–‡ä»¶å¤¹, æ‰§è¡Œ:å¿½è§†è­¦å‘Šï¼šâ€“allow-warnings 1pod lib lint CollectionIndexToolsLib.podspec å¦‚æœ‰è­¦å‘Šæˆ–è€…é”™è¯¯è¯·é‡æ–°æ£€æŸ¥ä½ çš„ç¼–å†™æ­£ç¡®æ€§ï¼Œå¦‚æœæ²¡æœ‰é—®é¢˜ä¼šå‡ºç°ï¼š 123-&gt; CollectionIndexToolsLib (0.1.0)CollectionIndexToolsLib passed validation. æ‰“tag, å‘å¸ƒä¸€ä¸ªreleaseç‰ˆæœ¬ä¸€åˆ‡å‡†å¤‡å°±ç»ªå, æˆ‘ä»¬éœ€è¦åœ¨ä½ çš„gitä»“åº“é‡Œé¢å­˜åœ¨ä¸€ä¸ªä¸.podspecæ–‡ä»¶ä¸­ä¸€è‡´çš„version, è¿™é‡Œä½ å¯ä»¥åœ¨ä½ çš„gitä»“åº“ä¸­çš„releasesä¸€é¡¹å»æ‰‹åŠ¨å‘å¸ƒ, ä¹Ÿå¯ä»¥åœ¨å½“å‰æ–‡ä»¶å¤¹ä¸‹ä½¿ç”¨ç»ˆç«¯å‘½ä»¤: 12git tag -m &apos;ğŸ”–:Releasing tags.&apos; &apos;0.1.0&apos;git push --tag #æ¨é€tagåˆ°è¿œç«¯ä»“åº“ æˆåŠŸä¹‹åå³å¯åœ¨ä½ çš„ releases é‡Œé¢çœ‹åˆ°è¿™ä¸ª tag çš„ç‰ˆæœ¬. å‘å¸ƒè‡ªå·±çš„åº“æè¿°æ–‡ä»¶podspecç»™cocoapodsåŒæ ·åœ¨è¿™ä¸ªæ–‡ä»¶å¤¹ä¸‹, ç»ˆç«¯æ‰§è¡Œ:å¿½è§†è­¦å‘Šï¼šâ€“allow-warnings 1pod trunk push CollectionIndexToolsLib.podspec å°†ä½ çš„åº“æ–‡ä»¶.podspecæ–‡ä»¶æäº¤åˆ°å…¬æœ‰çš„specsä¸Šé¢, è¿™ä¸€æ­¥åšçš„æ“ä½œæ˜¯éªŒè¯ä½ çš„podspecæ–‡ä»¶æ˜¯å¦åˆæ³•+æäº¤åˆ°specsä¸­(ç­‰åŒäºfork;commit;push)+å°†ä¸Šä¼ çš„podspecæ–‡ä»¶è½¬æˆjsonæ ¼å¼æ–‡ä»¶)ï¼ŒæˆåŠŸåä¼šå‡ºç°Congratsä¿¡æ¯ã€‚ æˆåŠŸä¸Šä¼ åç­‰å¾…ç‰‡åˆ»å°±å¯ä»¥ç”¨æŸ¥æ‰¾å‘½ä»¤æ‰¾åˆ°ä½ çš„åº“ï¼š 1pod search CollectionIndexToolsLib æ—¥åç»´æŠ¤æ›´æ–°å¼€æºåº“å¦‚æœæœ‰é”™è¯¯æˆ–è€…éœ€è¦è¿­ä»£ç‰ˆæœ¬,ä¿®æ”¹å·¥ç¨‹æ–‡ä»¶åæ¨é€åˆ°è¿œç«¯ä»“åº“å, éœ€è¦ä¿®æ”¹podspecä¸­çš„ç‰ˆæœ¬å·, å¹¶é‡æ–°æ‰“tagä¸Šä¼ , å†è¿›è¡Œæ–°ä¸€è½®çš„éªŒè¯å’Œå‘å¸ƒ.å¦‚æœåœ¨å¼€å‘è¿‡ç¨‹ä¸­å‘ç°æŸåŸºç¡€ç»„ä»¶å­˜åœ¨ bug éœ€è¦æ›´æ–° Podï¼Œå…·ä½“æ“ä½œæ­¥éª¤å¦‚ä¸‹ï¼š ä¿®æ”¹ podspec æ–‡ä»¶ä¸­çš„ s.version; ä¿®å¤ bug å¹¶å¯¹é¡¹ç›®æ‰“ tagï¼Œtag åç§°å’Œ s.version ä¸€ç›´å¹¶ push åˆ°è¿œç¨‹ä»“åº“ã€‚ éªŒè¯ podspec æ–‡ä»¶çš„æœ‰æ•ˆæ€§ï¼› æ¨é€ podspec æ–‡ä»¶åˆ°è¿œç¨‹ä»“åº“ï¼› æ‰§è¡Œ pod search RRCache éªŒè¯ç»“æœï¼› å®ç”¨ï¼šç»„ä»¶åŒ–ç§æœ‰åº“ç»„ä»¶åŒ–çš„å®ç”¨ä¹‹å¤„è¯·å‚è€ƒã€Šç§»åŠ¨ç«¯ iOS å¹´ç»ˆå·¥ä½œæ€»ç»“-çº¯å¹²è´§è¯·è‡ªå¤‡é…’æ°´ã€‹ï¼ˆhttps://juejin.im/post/5a934dfa6fb9a0634514d8a9ï¼‰ ç§æœ‰Podåº“å’Œå…¬æœ‰Podåº“çš„åˆ›å»ºæ–¹å¼æ²¡æœ‰ä»€ä¹ˆåŒºåˆ«, ä¸ä¸€æ ·çš„æ˜¯ç®¡ç†ä»–ä»¬çš„ spec repo ä¸ä¸€æ ·. æ‰€ä»¥æˆ‘ä»¬éœ€è¦è‡ªå·±åˆ›å»ºä¸€ä¸ªè·ŸCocoaPods/Specsç±»ä¼¼çš„ä»“åº“æ¥ç®¡ç†å†…éƒ¨åˆ›å»ºçš„Podåº“çš„podspecæ–‡ä»¶, ä¾›å†…éƒ¨äººå‘˜æ›´æ–°å’Œä¾èµ–ä½¿ç”¨å†…éƒ¨Podç»„ä»¶åº“. ç§æœ‰repoçš„æ„å»ºå½¢å¼æœ‰ä¸¤ç§, ä¸€ç§æ˜¯ç§æœ‰gitæœåŠ¡å™¨ä¸Šé¢åˆ›å»ºï¼Œä¸€ç§æ˜¯æœ¬æœºåˆ›å»º. æœ¬æœºåˆ›å»ºè¯·å‚è€ƒå®˜æ–¹æ–‡æ¡£:Private Pods, è¿™é‡Œä»‹ç»çš„æ˜¯åœ¨å…¬å¸å†…éƒ¨æ­å»ºçš„gitæœåŠ¡å™¨ä¸Šé¢åˆ›å»ºæ•´ä¸ªæœåŠ¡çš„æ–¹å¼. åˆ›å»ºä¸€ä¸ªgitä»“åº“ç”¨æ¥åšå†…éƒ¨ç§æœ‰åº“çš„Spec Repoåœ¨ç§æœ‰æœåŠ¡å™¨ä¸€ä¸ªä»“åº“,ä¸€ä¸ªç”¨æ¥å­˜æ”¾æ‰€æœ‰å…±äº«åº“çš„podspec, è¿™é‡Œåˆ›å»ºå¥½ä¹‹åçš„å†…éƒ¨SSHåè®®åœ°å€æ˜¯:https://gitee.com/WhatsXie/LibComponent.git, èŠ±é’±ä¹°gitçš„ç§æœ‰ä»“åº“æˆ–è€…ä½¿ç”¨å…¶ä»–å…è´¹çš„ç¬¬ä¸‰æ–¹gitæœåŠ¡(å¦‚Bitbucketç­‰)åˆ›å»ºçš„ç§æœ‰ä»“åº“ç»™åˆ°çš„http/httpsåœ°å€ä¹Ÿä¸€æ ·.ç»ˆç«¯è¾“å…¥å‘½ä»¤:1pod repo add LibComponent https://gitee.com/WhatsXie/LibComponent.git å°†LibComponentæ·»åŠ åˆ°æœ¬åœ°repo, æ·»åŠ æˆåŠŸåå¯ä»¥åœ¨/.cocoapods/repos/ç›®å½•ä¸‹å¯ä»¥çœ‹åˆ°å®˜æ–¹çš„specs:masterå’ŒåˆšåˆšåŠ å…¥çš„specs:LibComponent å¦‚æœæœ‰å…¶ä»–åˆä½œäººå‘˜å…±åŒä½¿ç”¨è¿™ä¸ªç§æœ‰Spec Repoçš„è¯åœ¨ä»–æœ‰å¯¹åº”Gitä»“åº“çš„æƒé™çš„å‰æä¸‹æ‰§è¡Œç›¸åŒçš„å‘½ä»¤æ·»åŠ è¿™ä¸ªSpec Repoå³å¯. åˆ›å»ºç§æœ‰Podç»„ä»¶åº“ç»§ç»­åˆ›å»ºä¸€ä¸ªç§æœ‰ä»“åº“,ç”¨æ¥å»ºç«‹éœ€è¦å…±äº«çš„å†…éƒ¨ç»„ä»¶, ä»¥RSGuidePageLibä¸ºä¾‹:https://gitee.com/WhatsXie/RSGuidePageLib.git å¯ä»¥åˆ›å»ºç¤ºä¾‹å·¥ç¨‹, åƒåˆ›å»ºå…¬æœ‰çš„åº“ä¸€æ ·, å¡«å†™è‡ªå·±çš„podspecæ–‡ä»¶ 1234567891011121314151617181920212223242526272829Pod::Spec.new do |s|s.name = 'RSGuidePageLib's.version = '0.3.0's.summary = 'Custom guide page package's.description = &lt;&lt;-DESCSwift implementation of the guide page package, support for multiple pictures and video guide pageDESCs.homepage = 'https://gitee.com/WhatsXie/RSGuidePageLib.git's.license = &#123; :type =&gt; 'MIT', :file =&gt; 'LICENSE' &#125;s.author = &#123; 'ReverseScale@icloud.com' =&gt; 'reversescale' &#125;s.source = &#123; :git =&gt; 'https://gitee.com/WhatsXie/RSGuidePageLib.git', :tag =&gt; s.version.to_s &#125;s.ios.deployment_target = '8.0's.swift_version = '3.2's.source_files = 'RSGuidePageLib/Classes/**/*'s.requires_arc = true å€¼å¾—æ³¨æ„çš„æ˜¯:podspecæ–‡ä»¶ä¸­çš„homepageå’Œsourceä¸æ”¯æŒsshåè®®åœ°å€,æ‰€ä»¥æˆ‘ä»¬å¾—æ”¾å…¥http/httpsåœ°å€. ä¸å…¬æœ‰åº“çš„åˆ›å»ºæ–¹å¼ä¸€æ ·, pod lib lint Category.podspecéªŒè¯æˆåŠŸä¹‹åpushåˆ°ä»“åº“, ç„¶åæ‰“tagå‘å¸ƒreleaseç‰ˆæœ¬. ç„¶åå°†podspecåŠ å…¥ç§æœ‰Sepc repoä¸­å…¬æœ‰åº“ä½¿ç”¨trunkæ–¹å¼å°†.podspecæ–‡ä»¶å‘å¸ƒåˆ°CocoaPods/Specs, å†…éƒ¨çš„podç»„ä»¶åº“åˆ™æ˜¯æ·»åŠ åˆ°æˆ‘ä»¬ç¬¬ä¸€æ­¥åˆ›å»ºçš„ç§æœ‰Spec repoä¸­å», åœ¨ç»ˆç«¯æ‰§è¡Œ:â€“allow-warnings å¿½ç•¥è­¦å‘Šâ€“private ç§æœ‰åº“ 1pod repo push LibComponent RSGuidePageLib.podspec æ·»åŠ æˆåŠŸä¹‹åLibComponentä¸­ä¼šåŒ…å«RSGuidePageLibåº“çš„podspecä¿¡æ¯, å¯ä»¥å‰å¾€~/.cocoapods/reposä¸‹çš„LibComponentæ–‡ä»¶å¤¹ä¸­æŸ¥çœ‹, åŒæ—¶gitæœåŠ¡å™¨ä¸­çš„è¿œç«¯ä¹Ÿæ›´æ–°äº†. ç§»é™¤ç§æœ‰Repo 1pod repo remove [name] æŸ¥æ‰¾å’Œä½¿ç”¨å†…éƒ¨ç»„ä»¶åº“æ‰§è¡Œpod search Categoryå°±èƒ½æŸ¥åˆ°åˆšåˆšåˆ›å»ºå¥½çš„Categoryåº“äº†, ç„¶ååœ¨æƒ³è¦ä½¿ç”¨æ­¤ç»„ä»¶çš„å·¥ç¨‹çš„Podfileä¸­åŠ å…¥pod â€˜Categoryâ€™, â€˜~&gt;1.0.1â€™å³å¯ä½¿ç”¨å†…éƒ¨ç»„ä»¶å•¦ï¼ å€¼å¾—æ³¨æ„çš„æ˜¯:å¿…é¡»åœ¨Podfileå‰é¢éœ€è¦æ·»åŠ ä½ çš„ç§æœ‰Spec repoçš„gitåœ°å€source, pod installæ—¶, æ‰èƒ½åœ¨ç§æœ‰repoä¸­æŸ¥æ‰¾åˆ°ç§æœ‰åº“, åƒè¿™æ ·: 1234567891011# Uncomment the next line to define a global platform for your projectsource &apos;https://github.com/CocoaPods/Specs.git&apos;source &apos;https://gitee.com/WhatsXie/LibComponent.git&apos;# platform :ios, &apos;9.0&apos;target &apos;Demo&apos; dopod &apos;RSGuidePageLib&apos;, &apos;~&gt;0.3.0â€™end ç»è¿‡æµ‹è¯•, è¿™ç§æ–¹å¼å¯ä»¥æŠŠä½ çš„æ‰€æœ‰å¯ä»¥æ‹†åˆ†å‡ºæ¥çš„ç»„ä»¶, ç”šè‡³æ˜¯ä¸šåŠ¡éƒ½æ¥ä½¿ç”¨Podç®¡ç†, è¿™æ ·è¾¾åˆ°äº†è§£è€¦å’Œå•é¡¹æ›´æ–°ä¼˜åŒ–ã€‚æŸäº›ç»„ä»¶ä¸å½±å“è€ç‰ˆæœ¬çš„ä¾èµ–ä½¿ç”¨, å‡ºç°é—®é¢˜ä¿®æ”¹Podfileä¸­çš„ä¾èµ–ç‰ˆæœ¬å³å¯éšæ—¶å›æ»š, ç»™å¼€å‘äº†å¸¦æ¥æå¤§çš„ä¾¿åˆ©ã€‚ å‚è€ƒé“¾æ¥ CocoaPodsåˆ›å»ºå…¬æœ‰å’Œç§æœ‰Podåº“æ–¹æ³•æ€»ç»“ï¼ˆhttps://www.aliyun.com/jiaocheng/376300.htmlï¼‰ CocoaPods Guides(https://guides.cocoapods.org) Private Pods(https://guides.cocoapods.org/making/private-cocoapods.html) æ‰‹æŠŠæ‰‹æ•™ä½ å‘å¸ƒä»£ç åˆ°CocoaPods(Trunkæ–¹å¼)(http://www.cnblogs.com/wengzilin/p/4742530.html) ä½¿ç”¨Cocoapodsåˆ›å»ºç§æœ‰podspec(http://blog.wtlucky.com/blog/2015/02/26/create-private-podspec/) COCOAPODSåˆ›å»ºç§æœ‰PODS(http://www.cnblogs.com/tufeibo/p/5654268.html) CocoaPods ç»„ä»¶åŒ–å®è·µ - ç§æœ‰Pod(https://www.jianshu.com/p/475d6b6d5600)","categories":[{"name":"Tips","slug":"Tips","permalink":"https://reversescale.github.io/categories/Tips/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"æœ€ç®€ä¾¿çš„æ–¹å¼è®©ä½ çš„åº”ç”¨æ¥å…¥ Emoji","slug":"Emoji Keyboard","date":"2016-11-20T03:56:27.000Z","updated":"2018-11-16T13:30:46.211Z","comments":true,"path":"2016/11/20/Emoji Keyboard/","link":"","permalink":"https://reversescale.github.io/2016/11/20/Emoji Keyboard/","excerpt":"ä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼ŒEmoji è¡¨æƒ…æ— å¤„ä¸åœ¨ã€‚å®ƒä»¬æ¯å¤©è¢«æ•°ç™¾ä¸‡äººä½¿ç”¨ï¼Œæˆ–å–œæˆ–æ‚²æˆ–çŒ¥çï¼Œæ˜¯ä¸€ä¸ªæ— ä¸ä¼¦æ¯”çš„è¡¨è¾¾å·¥å…·~","text":"ä¸çŸ¥é“ä»ä»€ä¹ˆæ—¶å€™å¼€å§‹ï¼ŒEmoji è¡¨æƒ…æ— å¤„ä¸åœ¨ã€‚å®ƒä»¬æ¯å¤©è¢«æ•°ç™¾ä¸‡äººä½¿ç”¨ï¼Œæˆ–å–œæˆ–æ‚²æˆ–çŒ¥çï¼Œæ˜¯ä¸€ä¸ªæ— ä¸ä¼¦æ¯”çš„è¡¨è¾¾å·¥å…·~ æˆ‘ä»¬ç›¸ä¿¡ï¼Œç”¨æˆ·ä¸åº”è¯¥è¢«é™åˆ¶åœ¨ Unicode åº“ä¸­ï¼Œæˆ‘ä»¬æ„å»ºäº†è¿™ä¸ªé”®ç›˜ï¼Œä»¥å¢åŠ æ‰€æœ‰ä¸æˆ‘ä»¬åˆä½œçš„åº”ç”¨ç¨‹åºçš„å‚ä¸åº¦ï¼Œä¿ç•™ç‡å’Œæ”¶å…¥ã€‚ ğŸ‘¨ğŸ»â€ğŸ’» Github Demo ğŸ¤– è¦æ±‚ iOS 9.0+ &amp; Android Xcode 9.0+ Swift / Objective-C ğŸš€ å‡†å¤‡å¼€å§‹Makemoji åº”ç”¨å†…é”®ç›˜æ˜¯æˆ‘ä»¬ SDK çš„æ ¸å¿ƒã€‚ è¿™æ˜¯ä¸€ä¸ªåŠ¨æ€æ§åˆ¶çš„è¡¨æƒ…ç¬¦å·é”®ç›˜ä¸ç´§å¯†é›†æˆçš„æ–‡æœ¬è¾“å…¥ï¼Œç”±æˆ‘ä»¬çš„CMSå’Œä»ªè¡¨æ¿æ”¯æŒã€‚ æ‚¨å¯ä»¥åˆ›å»ºè‡ªå·±çš„ç±»åˆ«ï¼Œä¸Šä¼  emoji / gifs å¹¶æ²¿ç€ unicode è¡¨æƒ…ç¬¦å·è·Ÿè¸ªå…¶ä½¿ç”¨æƒ…å†µã€‚ æˆ‘ä»¬çš„æ–‡æœ¬è¾“å…¥çš„è¾“å‡ºæ˜¯ä¸€ä¸ªç®€å•çš„ HTML æ¶ˆæ¯ï¼Œä»¥åŠä¸€ä¸ªçº¯æ–‡æœ¬ç‰ˆæœ¬å’Œæˆ‘ä»¬æ‰€è°“çš„â€œæ›¿ä»£â€ç‰ˆæœ¬ï¼Œå®ƒä½¿ç”¨ä¸€ä¸ªç®€å•çš„æ¨¡æ¿ç³»ç»Ÿã€‚ è¿™ä¸ªè¾“å‡ºå¯ä»¥ä¿å­˜åœ¨æ‚¨çš„è®¾å¤‡ä¸Šï¼Œåç«¯æˆ–æ‚¨é€‰æ‹©çš„ä»»ä½•åœ°æ–¹ã€‚ ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ å±•ç¤ºé¡µ å±•ç¤ºé¡µ å±•ç¤ºé¡µ è¾“å…¥å‰æ ·å¼ æ–‡å­—é”®ç›˜æ ·å¼ è¡¨æƒ…é”®ç›˜æ ·å¼ ğŸ¯ å®‰è£…æ–¹æ³•å®‰è£…åœ¨ iOS, ä½ éœ€è¦åœ¨ Podfile ä¸­æ·»åŠ .1pod &quot;Makemoji-SDK&quot; å¦‚æœä½ ä½¿ç”¨ Android, æ·»åŠ åœ¨å·¥ç¨‹ build.gradle ç›®å½•ä¸‹123456789dependencies &#123; compile &apos;com.makemoji:makemoji-sdk-android:0.9.777&apos;&#125; repositories &#123; jcenter() maven &#123; url &quot;https://dl.bintray.com/mm/maven/&quot; &#125;&#125; è®¾ç½®ä½ çš„ SDK Keyè¦è·å¾—æ‚¨çš„SDKå¯†é’¥ï¼Œè¯·å‘é€ç”µå­é‚®ä»¶è‡³sdk@makemoji.com è¦å¼€å§‹ä½¿ç”¨MakemojiSDKï¼Œæ‚¨å°†é¦–å…ˆè®¾ç½®æ‚¨çš„SDKå¯†é’¥ã€‚ iOS åœ¨ AppDelegate ä¸­:1#import &quot;MakemojiSDK.h&quot; 12345- (BOOL)application:(UIApplication *)application didFinishLaunchingWithOptions:(NSDictionary *)launchOptions &#123; // setup your SDK key [MakemojiSDK setSDKKey:@&quot;YOUR-SDK-KEY&quot;]; return YES;&#125; Android åœ¨ AndroidManifest.xml:123&lt;application android:name=&quot;com.makemoji.sbaar.mojilist.App&quot; ... å’Œ App.java12345public void onCreate()&#123; super.onCreate(); Moji.initialize(this,&quot;YOUR_KEY_HERE&quot;); //Moji.setUserId(&quot;Google ad id here if needed&quot;); // optional custom user id for analytics&#125; ğŸ›  é…ç½®è®¾ç½®å‡è®¾æ‚¨æœ‰ä¸€ä¸ªåº”ç”¨ç¨‹åºçš„èŠå¤©åŒºåŸŸï¼Œå¹¶ä¸”æ‚¨å¸Œæœ›ä½¿ç”¨æˆ‘ä»¬çš„é”®ç›˜æ¥è®©ç”¨æˆ·åœ¨å¯¹è¯ä¸­å…±äº«ç‹¬ç‰¹çš„è¡¨æƒ…ç¬¦å·ã€‚ è®©æˆ‘ä»¬å¼€å§‹è®¾ç½®æˆ‘ä»¬çš„æ–‡æœ¬è¾“å…¥å¯¹è±¡å±æ€§ã€‚ 1234#import &quot;METextInputView.h&quot;@interface ViewController : UIViewController &lt;METextInputViewDelegate&gt;@property (nonatomic, retain) METextInputView * meTextInputView; METextInputView æ˜¯ä¸€ä¸ªå®¹å™¨å¯¹è±¡ï¼Œå®ƒåŒ…å«å¯¼èˆª/è¶‹åŠ¿å›¾æ ä»¥åŠæ–‡æœ¬è¾“å…¥ã€‚ è¿™æ˜¯ä¸ºäº†è§£å†³è‹¹æœçš„InputAccessoryViewçš„æŸäº›æŠ€æœ¯é™åˆ¶ï¼Œå°½ç®¡è¿™ç§è¡Œä¸ºéå¸¸ç›¸ä¼¼ã€‚ åœ¨ viewDidLoad æˆ– init è§†å›¾æ§åˆ¶å™¨ä¸­ï¼Œåˆå§‹åŒ– METextInputViewã€‚12self.meTextInputView = [[METextInputView alloc] initWithFrame:CGRectZero];self.meTextInputView.delegate = self; æ‚¨éœ€è¦å°†è‡ªå·±åˆ†é…ç»™å§”æ‰˜ï¼Œä»¥ä¾¦å¬äº‹ä»¶çš„å›è°ƒï¼Œå¦‚ç‚¹å‡»å‘é€æˆ–ç…§ç›¸æœºæŒ‰é’®å’Œé”®ç›˜äº‹ä»¶ã€‚ æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬éœ€è¦ç¡®å®šæˆ‘ä»¬è¦åœ¨é¡µé¢ä¸Šä½¿ç”¨ä»€ä¹ˆç±»å‹çš„è¾“å…¥ã€‚ æµ®åŠ¨è¾“å…¥å¦‚æœä½ çš„åº”ç”¨ç¨‹åºéœ€è¦ä¸€ä¸ªæµ®åŠ¨çš„ iMessage ç±»å‹çš„æ–‡æœ¬è¾“å…¥ï¼Œä½ å¯ä»¥ç®€å•åœ°å°† METextInputView æ·»åŠ åˆ°ä½ çš„è§†å›¾ä¸­ã€‚ 1[self.view addSubview:self.meTextInputView]; è¿™ä¸ªé»˜è®¤æ¨¡å¼åœ¨é”®ç›˜ä¹‹åï¼Œéšç€ä¸€ä¸ªæ‘„åƒå¤´/å‘é€æŒ‰é’®ï¼Œå¹¶ä¸”å½“ç”¨æˆ·è¾“å…¥ä¸€ä¸ªé•¿æ¶ˆæ¯æ—¶ï¼Œæ‰©å±•åˆ°å…¨å±ã€‚ METextInputView éµå¾ª â€˜firstResponder` æ¨¡å¼æ¥éšè—/æ˜¾ç¤ºé”®ç›˜ã€‚ æœ‰å¾ˆå¤šæ–¹æ³•å¯ä»¥å®šåˆ¶è¿™ä¸ªè¾“å…¥å’Œå¯¼èˆªæ çš„å¤–è§‚å’Œæ„Ÿè§‰ã€‚ æˆ‘ä»¬å°†åœ¨ Customizations ä¸­ä»‹ç» åˆ†ç¦»çš„è¾“å…¥å¦‚æœæ‚¨éœ€è¦ä»é”®ç›˜åˆ†ç¦»çš„æ–‡æœ¬è¾“å…¥ï¼Œæ‚¨å°†éœ€è¦è°ƒç”¨ detachTextInputView æ–¹æ³•ï¼Œç„¶åå°† textInputContainerView æ·»åŠ åˆ°æ‚¨çš„è§†å›¾ã€‚ 12[self.meTextInputView detachTextInputView:YES];[self.view addSubview:self.meTextInputView.textInputContainerView]; ç”±äºâ€œå‘é€æŒ‰é’®â€å’Œâ€œæ‘„åƒå¤´â€æŒ‰é’®åœ¨æ­¤æ¨¡å¼ä¸‹å¤„äºéšè—çŠ¶æ€ï¼Œå› æ­¤æ‚¨éœ€è¦åœ¨ METextInputView çš„ sendMessage æ–¹æ³•ä¸Šé™„åŠ ä¸€ä¸ªæŒ‰é’®æ¥è§¦å‘æ•è·æ–‡æœ¬ã€‚ è¾“å…¥å¤§å°å˜åŒ–å½“ä½¿ç”¨æˆ‘ä»¬çš„æµ®åŠ¨è¾“å…¥æ—¶ï¼Œæ‚¨å°†å¸Œæœ›åœ¨æ˜¾ç¤ºé”®ç›˜æ—¶ä½¿ç”¨ didChangeFrame å§”æ‰˜å›è°ƒæ¥è°ƒæ•´å‘¨å›´çš„è§†å›¾ã€‚ 123-(void)meTextInputView:(METextInputView *)inputView didChangeFrame:(CGRect)frame &#123; self.tableView.frame = CGRectMake(self.tableView.frame.origin.x, self.tableView.frame.origin.y, self.tableView.frame.size.width, self.meTextInputView.frame.origin.y);&#125; å‘é€æ¶ˆæ¯Makemoji æ¶ˆæ¯ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šä¸€ä¸ªå®Œå…¨å½¢æˆçš„HTMLæ¶ˆæ¯ï¼Œä¸€ä¸ªASCIIå…¼å®¹çš„æ˜æ–‡æ¶ˆæ¯å’Œä¸€ä¸ª substitute æ¶ˆæ¯ã€‚ ä½ ä½¿ç”¨å“ªä¸€ä¸ªå–å†³äºä½ çš„æ¶ˆæ¯å­˜å‚¨æ˜¯å¦‚ä½•é…ç½®çš„ã€‚ æ›¿ä»£æ–‡æœ¬å…è®¸æ‚¨å°†å¸¦æœ‰Makemojiè¡¨æƒ…ç¬¦å·å ä½ç¬¦çš„æ˜æ–‡å­˜å‚¨ä¸ºæ–‡æœ¬çš„ä¸€éƒ¨åˆ†ã€‚ è¿™æ˜¯ä¸€ä¸ªç¤ºä¾‹æ¶ˆæ¯ã€‚ 12345&#123; html = &quot;&lt;p dir=\\&quot;auto\\&quot; style=\\&quot;margin-bottom:16px;font-family:&apos;.SF UI Text&apos;;font-size:16px;font-weight:bold;\\&quot;&gt;&lt;span style=\\&quot;color:#000000;\\&quot;&gt;Hey lets play &lt;/span&gt;&lt;img style=\\&quot;vertical-align:middle;width:20px;height:20px;\\&quot; src=\\&quot;https://d1tvcfe0bfyi6u.cloudfront.net/emoji/14-large@2x.png\\&quot; id=\\&quot;14\\&quot; link=\\&quot;\\&quot; name=\\&quot;Pacman\\&quot; /&gt;&lt;span style=\\&quot;color:#000000;\\&quot;&gt; at the &lt;/span&gt;&lt;img style=\\&quot;vertical-align:middle;width:20px;height:20px;\\&quot; src=\\&quot;https://d1tvcfe0bfyi6u.cloudfront.net/emoji/692-large@2x.png\\&quot; id=\\&quot;692\\&quot; name=\\&quot;Arcade\\&quot; link=\\&quot;\\&quot; /&gt;&lt;/p&gt;\\n&quot;; plaintext = &quot;Hey lets play at the \\n&quot;; substitute = &quot;Hey lets play [Pacman.E] at the [Arcade.BA]&quot;;&#125; å½“ç”¨æˆ·ç‚¹å‡» â€˜sendButtonæ—¶ï¼ŒdidTapSend` å§”æ‰˜å›è°ƒè¢«è§¦å‘ï¼Œå¹¶è¿”å›ä¸€ä¸ªåŒ…å«htmlï¼Œplaintextå’Œsubstituteæ¶ˆæ¯çš„å­—ç¬¦ä¸²çš„NSDictionaryã€‚ 12345-(void)meTextInputView:(METextInputView *)inputView didTapSend:(NSDictionary *)message &#123; // send message to your backend here [self.messages addObject:message]; [self.tableView reloadData];&#125; ç„¶åï¼Œæ‚¨å¯ä»¥å°†é€‰æ‹©çš„éƒ¨åˆ†å‘é€åˆ°åç«¯ä»¥å­˜å‚¨æ¶ˆæ¯ã€‚ æ˜¾ç¤ºæ¶ˆæ¯ç°åœ¨ä½ å·²ç»æœ‰Makemojiæ¶ˆæ¯äº†ï¼Œæˆ‘ä»¬éœ€è¦è®¾ç½®ä¸€ä¸ªæ˜¾ç¤ºå®ƒä»¬çš„æ–¹æ³•ã€‚ é€šå¸¸è¿™å°†åœ¨ UITableViewCell ä¸­ï¼Œä½†æ‚¨ä¹Ÿå¯ä»¥ä½¿ç”¨ä»»ä½•è‡ªå®šä¹‰è§†å›¾æ¥æ˜¾ç¤ºæ¶ˆæ¯ã€‚ æˆ‘ä»¬å·²ç»åŒ…æ‹¬ä¸€ä¸ªä¼˜åŒ–çš„UITableViewCellsç”¨äºæ˜¾ç¤ºHTMLæ¶ˆæ¯å’Œä¸€ç§æ–¹æ³•æ¥è‡ªåŠ¨ç¼“å­˜ä½ çš„è¡¨å•å…ƒæ ¼é«˜åº¦ã€‚ è¿™å¯ä»¥é˜²æ­¢ä»»ä½•ä¸å¿…è¦çš„è¡¨æƒ…ç¬¦å·å’Œæ–‡æœ¬å¸ƒå±€ï¼Œå¹¶æé«˜æ€§èƒ½ã€‚ è¿™é‡Œæ˜¯æˆ‘ä»¬æä¾›çš„ä¿¡æ¯æ˜¾ç¤ºçš„æ¦‚è¿°ã€‚ MESimpleTableViewCellè¿™ä¸ªå•å…ƒæ ¼æä¾›äº†ä¸€ä¸ªåŸºæœ¬çš„å¸ƒå±€ï¼Œé»˜è®¤æƒ…å†µä¸‹å°è¯•ä½¿ç”¨æ•´ä¸ªå•å…ƒæ ¼åŒºåŸŸã€‚ æ‚¨å°†ä½¿ç”¨æ­¤å•å…ƒæ ¼ä½œä¸ºå­ç±»å¿«é€Ÿå®ç°è‡ªå®šä¹‰è¡¨æ ¼å•å…ƒæ ¼ã€‚ MEChatTableViewCellèŠå¤©å•å…ƒæä¾›ä¸€ä¸ªiMessageï¼Œå¦‚èŠå¤©æ³¡æ³¡ï¼Œé—´è·ï¼Œå¯è®¾å®šçš„æ–¹å‘å’Œé¢œè‰²è®¾ç½®ã€‚ MECollectionViewCellç®€å•è¡¨æ ¼å•å…ƒæ ¼çš„é›†åˆè§†å›¾ç‰ˆæœ¬ã€‚ MEMessageViewå•å…ƒçš„åº•å±‚è§†å›¾ï¼Œæ¶ˆæ¯çš„æ ¸å¿ƒæ˜¾ç¤ºè§†å›¾ã€‚ æ›¿ä»£æ–‡å­—ä½¿ç”¨ substitute ç±»å‹çš„æ¶ˆæ¯æ—¶ï¼Œå¯ä»¥é€šè¿‡åœ¨ METextInputView ä¸Šä½¿ç”¨ä¸‹é¢çš„é™æ€æ–¹æ³•å°†å…¶è½¬æ¢å›HTML 1+(NSString *)convertSubstituedToHTML:(NSString *)substitute withFontName:(NSString *)fontName pointSize:(CGFloat)pointSize textColor:(UIColor *)color é«˜åº¦ç¼“å­˜ä½¿ç”¨ cellHeightForHTML æ–¹æ³•è·å–æ¶ˆæ¯çš„è¡Œé«˜ã€‚ æ­¤æ–¹æ³•ç¼“å­˜å•å…ƒé«˜åº¦ä»¥æé«˜æ€§èƒ½ã€‚ 123456789101112// determine row height with HTML- (CGFloat)tableView:(UITableView *)tableView heightForRowAtIndexPath:(NSIndexPath *)indexPath &#123; if (self.meTextInputView == nil) &#123; return 0; &#125; NSDictionary * message = [self.messages objectAtIndex:indexPath.row]; return [self.meTextInputView cellHeightForHTML:[message objectForKey:@&quot;html&quot;] atIndexPath:indexPath maxCellWidth:self.tableView.frame.size.width cellStyle:MECellStyleChat];&#125; æ‚¨å¯ä»¥é€šè¿‡é‡ç½® METextInputView ä¸Šçš„ cachedHeights å±æ€§æ¥æ‰‹åŠ¨é‡ç½® UITableViewCell é«˜åº¦ç¼“å­˜ã€‚ è¡¨æ ¼å•å…ƒæ ¼ä½¿ç”¨MEChatTableViewCellï¼Œæ‚¨å¯ä»¥ä½¿ç”¨setCellDisplayåœ¨å·¦ä¾§æˆ–å³ä¾§æ˜¾ç¤ºèŠå¤©æ°”æ³¡ã€‚ è¿™åº”è¯¥å‘ç”Ÿåœ¨ä¸ºæ¯ä¸ªæ¶ˆæ¯è®¾ç½®æ‚¨çš„HTMLä¹‹å‰ã€‚ 12345678910111213141516171819202122- (UITableViewCell *)tableView:(UITableView *)tableView cellForRowAtIndexPath:(NSIndexPath *)indexPath &#123; static NSString *CellIdentifier = @&quot;Cell&quot;; MEChatTableViewCell *cell = [tableView dequeueReusableCellWithIdentifier:CellIdentifier]; if (cell == nil) &#123; cell = [[MEChatTableViewCell alloc] initWithStyle:UITableViewCellStyleDefault reuseIdentifier:CellIdentifier]; &#125; // display chat cell on right side [cell setCellDisplay:MECellDisplayRight]; // display chat cell on left side if (indexPath.row % 2) &#123; [cell setCellDisplay:MECellDisplayLeft]; &#125; NSDictionary * message = [self.messages objectAtIndex:indexPath.row]; [cell setHTMLString:[message objectForKey:@&quot;html&quot;]]; return cell; &#125; Hypermoji - å¸¦æœ‰URLçš„è¡¨æƒ…ç¬¦å·æˆ‘ä»¬å·²ç»åˆ›å»ºäº†ä¸€ç§æ–°çš„æ–¹å¼æ¥å…±äº«å†…å®¹ï¼Œæµè§ˆç½‘é¡µï¼Œè§‚çœ‹è§†é¢‘æˆ–å¬éŸ³ä¹ï¼Œè€Œä¸ç”¨ç¦»å¼€Hypermojiçš„åº”ç”¨ç¨‹åºã€‚ è¦åœ¨Hypermojiï¼ˆå…·æœ‰URLé“¾æ¥çš„è¡¨æƒ…ç¬¦å·ï¼‰ä¸Šç‚¹å‡»æ—¶æ˜¾ç¤ºç½‘é¡µï¼Œè¯·ä½¿ç”¨ didTapHypermoji å§”æ‰˜å›è°ƒ 1234// handle tapping of links (Hypermoji)-(void)meTextInputView:(METextInputView *)inputView didTapHypermoji:(NSString*)urlString &#123; // open webview here&#125; ç›¸æœºæŒ‰é’®è¿™æ˜¯ä¸€ä¸ªæ ‡å‡†çš„UIButtonï¼Œå¯ä»¥ç”¨å›¾åƒæˆ–æ–‡æœ¬è¿›è¡Œè‡ªå®šä¹‰ã€‚ è¦å¤„ç†ç›¸æœºæŒ‰é’®çš„æ“ä½œï¼Œè¯·ä½¿ç”¨didTapCameraButtonå§”æ‰˜å›è°ƒã€‚ 123-(void)meTextInputView:(METextInputView *)inputView didTapCameraButton:(UIButton*)cameraButton &#123; // Present image controller&#125; è‡ªå®šä¹‰æ‚¨å¯ä»¥é€šè¿‡åœ¨ METextInputView ä¸Šè®¾ç½® displayCameraButton å±æ€§æ¥æ˜¾ç¤ºæˆ–éšè—å†…ç½®æ‘„åƒå¤´ 1self.meTextInputView.displayCameraButton = NO; æ‚¨å¯ä»¥é€šè¿‡åœ¨ METextInputView ä¸Šè®¾ç½® displaySendButton å±æ€§æ¥æ˜¾ç¤ºæˆ–éšè—å†…ç½®çš„å‘é€æŒ‰é’® 1self.meTextInputView.displaySendButton = NO; ä½¿ç”¨setFontä½ å¯ä»¥è®¾ç½®ä½ çš„æ–‡æœ¬è¾“å…¥çš„é»˜è®¤å­—ä½“ã€‚ 1[self.meTextInputView setFont:[UIFont systemFontOfSize:20]]; æ›´æ”¹å ä½ç¬¦æ–‡æœ¬çš„é¢œè‰² 1self.meTextInputView.placeholderLabel.textColor = [UIColor darkGrayColor]; æ§åˆ¶é”å®šçš„ç±»åˆ«æ‚¨å°†éœ€è¦ä¾¦å¬NSNotification MECategorySelectedLockedCategory æ¥ç¡®å®šä»€ä¹ˆæ—¶å€™é”å®šäº†ä¸€ä¸ªç±»åˆ«ã€‚ è¦è§£é”ä¸€ä¸ªç±»åˆ«ï¼Œæ‚¨éœ€è¦è°ƒç”¨ [MakemojiSDK unlockCategoryï¼š@â€œcategoryâ€] æ‚¨å¯ä»¥æ”¶å¬ â€˜MECategoryUnlockedSuccessNotificationå’ŒMECategoryUnlockedFailedNotification` ä»¥ç¡®å®šè§£é”å‘¼å«æ˜¯å¦æˆåŠŸã€‚ ğŸ“ åº”ç”¨ç¨‹åºæäº¤Makemoji SDK ä½¿ç”¨IDFAè·Ÿè¸ªIDæ¥ä¸ºæ‚¨çš„åº”ç”¨ç¨‹åºä¸­çš„è§†å›¾ï¼Œå…±äº«å’Œç‚¹å‡»è¿›è¡Œå½’å› ã€‚ å°†åº”ç”¨ç¨‹åºæäº¤åˆ° App Store æ—¶ï¼Œæ‚¨éœ€è¦æ£€æŸ¥â€œå°†æ­¤åº”ç”¨ç¨‹åºå®‰è£…åˆ°ä»¥å‰æŠ•æ”¾çš„å¹¿å‘Šâ€é€‰é¡¹ã€‚ ğŸ˜¬ è”ç³» å¾®ä¿¡ : WhatsXie é‚®ä»¶ : ReverseScale@iCloud.com åšå®¢ : https://reversescale.github.io","categories":[{"name":"Project","slug":"Project","permalink":"https://reversescale.github.io/categories/Project/"}],"tags":[{"name":"iOS","slug":"iOS","permalink":"https://reversescale.github.io/tags/iOS/"}]},{"title":"iOS å¼€å‘ä¸­å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼","slug":"Design patterns iOS","date":"2016-09-21T06:56:27.000Z","updated":"2018-11-16T13:25:33.846Z","comments":true,"path":"2016/09/21/Design patterns iOS/","link":"","permalink":"https://reversescale.github.io/2016/09/21/Design patterns iOS/","excerpt":"ä¹‹å‰æœ‰æœ‹å‹é—®åˆ°è®¾è®¡æ¨¡å¼ï¼Œä¾¿ç‰¹æ„æ‰¾äº†ä¸€ç¯‡æ–‡ç« ï¼Œä¸“é—¨ä»‹ç»åœ¨ iOS å¼€å‘ä¸­ï¼Œå¯¹è®¾è®¡æ¨¡å¼çš„å…·ä½“åº”ç”¨ï¼ŒåŒæ—¶æ¨èä¸€æœ¬ä¹¦ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹~","text":"ä¹‹å‰æœ‰æœ‹å‹é—®åˆ°è®¾è®¡æ¨¡å¼ï¼Œä¾¿ç‰¹æ„æ‰¾äº†ä¸€ç¯‡æ–‡ç« ï¼Œä¸“é—¨ä»‹ç»åœ¨ iOS å¼€å‘ä¸­ï¼Œå¯¹è®¾è®¡æ¨¡å¼çš„å…·ä½“åº”ç”¨ï¼ŒåŒæ—¶æ¨èä¸€æœ¬ä¹¦ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹~ ï¼ˆä¸€ï¼‰ä»£ç†æ¨¡å¼åº”ç”¨åœºæ™¯ï¼šå½“ä¸€ä¸ªç±»çš„æŸäº›åŠŸèƒ½éœ€è¦ç”±åˆ«çš„ç±»æ¥å®ç°ï¼Œä½†æ˜¯åˆä¸ç¡®å®šå…·ä½“ä¼šæ˜¯å“ªä¸ªç±»å®ç°ã€‚ä¼˜åŠ¿ï¼šè§£è€¦åˆæ•æ·åŸåˆ™ï¼šå¼€æ”¾-å°é—­åŸåˆ™å®ä¾‹ï¼štableviewçš„ æ•°æ®æºdelegateï¼Œé€šè¿‡å’Œprotocolçš„é…åˆï¼Œå®Œæˆå§”æ‰˜è¯‰æ±‚ã€‚åˆ—è¡¨rowä¸ªæ•°delegateè‡ªå®šä¹‰çš„delegate ï¼ˆäºŒï¼‰è§‚å¯Ÿè€…æ¨¡å¼åº”ç”¨åœºæ™¯ï¼šä¸€èˆ¬ä¸ºmodelå±‚å¯¹ï¼Œcontrollerå’Œviewè¿›è¡Œçš„é€šçŸ¥æ–¹å¼ï¼Œä¸å…³å¿ƒè°å»æ¥æ”¶ï¼Œåªè´Ÿè´£å‘å¸ƒä¿¡æ¯ã€‚ä¼˜åŠ¿ï¼šè§£è€¦åˆæ•æ·åŸåˆ™ï¼šæ¥å£éš”ç¦»åŸåˆ™ï¼Œå¼€æ”¾-å°é—­åŸåˆ™å®ä¾‹ï¼šNotificationé€šçŸ¥ä¸­å¿ƒï¼Œæ³¨å†Œé€šçŸ¥ä¸­å¿ƒï¼Œä»»ä½•ä½ç½®å¯ä»¥å‘é€æ¶ˆæ¯ï¼Œæ³¨å†Œè§‚å¯Ÿè€…çš„å¯¹è±¡å¯ä»¥æ¥æ”¶ã€‚kvoï¼Œé”®å€¼å¯¹æ”¹å˜é€šçŸ¥çš„è§‚å¯Ÿè€…ï¼Œå¹³æ—¶åŸºæœ¬æ²¡ç”¨è¿‡ã€‚ ï¼ˆä¸‰ï¼‰MVCæ¨¡å¼åº”ç”¨åœºæ™¯ï¼šæ˜¯ä¸€ä¸­éå¸¸å¤è€çš„è®¾è®¡æ¨¡å¼ï¼Œé€šè¿‡æ•°æ®æ¨¡å‹ï¼Œæ§åˆ¶å™¨é€»è¾‘ï¼Œè§†å›¾å±•ç¤ºå°†åº”ç”¨ç¨‹åºè¿›è¡Œé€»è¾‘åˆ’åˆ†ã€‚ä¼˜åŠ¿ï¼šä½¿ç³»ç»Ÿï¼Œå±‚æ¬¡æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜ï¼Œæ˜“äºç»´æŠ¤æ•æ·åŸåˆ™ï¼šå¯¹æ‰©å±•å¼€æ”¾-å¯¹ä¿®æ”¹å°é—­å®ä¾‹ï¼šmodel-å³æ•°æ®æ¨¡å‹ï¼Œview-è§†å›¾å±•ç¤ºï¼Œcontrollerè¿›è¡ŒUIå±•ç°å’Œæ•°æ®äº¤äº’çš„é€»è¾‘æ§åˆ¶ã€‚ ï¼ˆå››ï¼‰å•ä¾‹æ¨¡å¼åº”ç”¨åœºæ™¯ï¼šç¡®ä¿ç¨‹åºè¿è¡ŒæœŸæŸä¸ªç±»ï¼Œåªæœ‰ä¸€ä»½å®ä¾‹ï¼Œç”¨äºè¿›è¡Œèµ„æºå…±äº«æ§åˆ¶ã€‚ä¼˜åŠ¿ï¼šä½¿ç”¨ç®€å•ï¼Œå»¶æ—¶æ±‚å€¼ï¼Œæ˜“äºè·¨æ¨¡å—æ•æ·åŸåˆ™ï¼šå•ä¸€èŒè´£åŸåˆ™å®ä¾‹ï¼š[UIApplication sharedApplication]ã€‚æ³¨æ„äº‹é¡¹ï¼šç¡®ä¿ä½¿ç”¨è€…åªèƒ½é€šè¿‡ getInstanceæ–¹æ³•æ‰èƒ½è·å¾—ï¼Œå•ä¾‹ç±»çš„å”¯ä¸€å®ä¾‹ã€‚javaï¼ŒC++ä¸­ä½¿å…¶æ²¡æœ‰å…¬æœ‰æ„é€ å‡½æ•°ï¼Œç§æœ‰åŒ–å¹¶è¦†ç›–å…¶æ„é€ å‡½æ•°ã€‚object cä¸­ï¼Œé‡å†™allocWithZoneæ–¹æ³•ï¼Œä¿è¯å³ä½¿ç”¨æˆ·ç”¨ allocæ–¹æ³•ç›´æ¥åˆ›å»ºå•ä¾‹ç±»çš„å®ä¾‹ï¼Œè¿”å›çš„ä¹Ÿåªæ˜¯æ­¤å•ä¾‹ç±»çš„å”¯ä¸€é™æ€å˜é‡ã€‚ ï¼ˆäº”ï¼‰ç­–ç•¥æ¨¡å¼åº”ç”¨åœºæ™¯ï¼šå®šä¹‰ç®—æ³•æ—ï¼Œå°è£…èµ·æ¥ï¼Œä½¿ä»–ä»¬ä¹‹é—´å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ä¼˜åŠ¿ï¼šä½¿ç®—æ³•çš„å˜åŒ–ç‹¬ç«‹äºä½¿ç”¨ç®—æ³•çš„ç”¨æˆ·æ•æ·åŸåˆ™ï¼šæ¥å£éš”ç¦»åŸåˆ™ï¼›å¤šç”¨ç»„åˆï¼Œå°‘ç”¨ç»§æ‰¿ï¼›é’ˆå¯¹æ¥å£ç¼–ç¨‹ï¼Œè€Œéå®ç°ã€‚å®ä¾‹ï¼šæ’åºç®—æ³•ï¼ŒNSArrayçš„sortedArrayUsingSelectorï¼›ç»å…¸çš„é¸­å­ä¼šå«ï¼Œä¼šé£æ¡ˆä¾‹ã€‚æ³¨æ„äº‹é¡¹ï¼š1ï¼Œå‰¥ç¦»ç±»ä¸­æ˜“äºå˜åŒ–çš„è¡Œä¸ºï¼Œé€šè¿‡ç»„åˆçš„æ–¹å¼åµŒå…¥æŠ½è±¡åŸºç±»2ï¼Œå˜åŒ–çš„è¡Œä¸ºæŠ½è±¡åŸºç±»ä¸ºï¼Œæ‰€æœ‰å¯å˜å˜åŒ–çš„çˆ¶ç±»3ï¼Œç”¨æˆ·ç±»çš„æœ€ç»ˆå®ä¾‹ï¼Œé€šè¿‡æ³¨å…¥è¡Œä¸ºå®ä¾‹çš„æ–¹å¼ï¼Œè®¾å®šæ˜“å˜è¡Œä¸ºé˜²æ­¢äº†ç»§æ‰¿è¡Œä¸ºæ–¹å¼ï¼Œå¯¼è‡´æ— å…³è¡Œä¸ºæ±¡æŸ“å­ç±»ã€‚å®Œæˆäº†ç­–ç•¥å°è£…å’Œå¯æ›¿æ¢æ€§ã€‚ ï¼ˆå…­ï¼‰å·¥å‚æ¨¡å¼åº”ç”¨åœºæ™¯ï¼šå·¥å‚æ–¹å¼åˆ›å»ºç±»çš„å®ä¾‹ï¼Œå¤šä¸proxyæ¨¡å¼é…åˆï¼Œåˆ›å»ºå¯æ›¿æ¢ä»£ç†ç±»ã€‚ä¼˜åŠ¿ï¼šæ˜“äºæ›¿æ¢ï¼Œé¢å‘æŠ½è±¡ç¼–ç¨‹ï¼Œapplicationåªä¸æŠ½è±¡å·¥å‚å’Œæ˜“å˜ç±»çš„å…±æ€§æŠ½è±¡ç±»å‘ç”Ÿè°ƒç”¨å…³ç³»ã€‚æ•æ·åŸåˆ™ï¼šDIPä¾èµ–å€’ç½®åŸåˆ™å®ä¾‹ï¼šé¡¹ç›®éƒ¨ç½²ç¯å¢ƒä¸­ä¾èµ–å¤šä¸ªä¸åŒç±»å‹çš„æ•°æ®åº“æ—¶ï¼Œéœ€è¦ä½¿ç”¨å·¥å‚é…åˆproxyå®Œæˆæ˜“ç”¨æ€§æ›¿æ¢æ³¨æ„äº‹é¡¹ï¼šé¡¹ç›®åˆæœŸï¼Œè½¯ä»¶ç»“æ„å’Œéœ€æ±‚éƒ½æ²¡æœ‰ç¨³å®šä¸‹æ¥æ—¶ï¼Œä¸å»ºè®®ä½¿ç”¨æ­¤æ¨¡å¼ï¼Œå› ä¸ºå…¶åŠ£åŠ¿ä¹Ÿå¾ˆæ˜æ˜¾ï¼Œå¢åŠ äº†ä»£ç çš„å¤æ‚åº¦ï¼Œå¢åŠ äº†è°ƒç”¨å±‚æ¬¡ï¼Œå¢åŠ äº†å†…å­˜è´Ÿæ‹…ã€‚æ‰€ä»¥è¦æ³¨æ„é˜²æ­¢æ¨¡å¼çš„æ»¥ç”¨ã€‚ è®¾è®¡æ¨¡å¼å…­å¤§åŸåˆ™1ã€å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰å¼€é—­åŸåˆ™å°±æ˜¯è¯´å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚æ‰€ä»¥ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ï¼Œåé¢çš„å…·ä½“è®¾è®¡ä¸­æˆ‘ä»¬ä¼šæåˆ°è¿™ç‚¹ã€‚ 2ã€é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰é‡Œæ°ä»£æ¢åŸåˆ™(Liskov Substitution Principle LSP)é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚LSPæ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“è¡ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œè¡ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹â€œå¼€-é—­â€åŸåˆ™çš„è¡¥å……ã€‚å®ç°â€œå¼€-é—­â€åŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ã€‚è€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚â€”â€” From Baidu ç™¾ç§‘ 3ã€ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰è¿™ä¸ªæ˜¯å¼€é—­åŸåˆ™çš„åŸºç¡€ï¼Œå…·ä½“å†…å®¹ï¼šçœŸå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“ã€‚ 4ã€æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚è¿˜æ˜¯ä¸€ä¸ªé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦çš„æ„æ€ï¼Œä»è¿™å„¿æˆ‘ä»¬çœ‹å‡ºï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€ä¸ªè½¯ä»¶çš„è®¾è®¡æ€æƒ³ï¼Œä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ï¼Œä¸ºäº†å‡çº§å’Œç»´æŠ¤æ–¹ä¾¿ã€‚æ‰€ä»¥ä¸Šæ–‡ä¸­å¤šæ¬¡å‡ºç°ï¼šé™ä½ä¾èµ–ï¼Œé™ä½è€¦åˆã€‚ 5ã€è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆæœ€å°‘çŸ¥é“åŸåˆ™ï¼‰ï¼ˆDemeter Principleï¼‰ä¸ºä»€ä¹ˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå°±æ˜¯è¯´ï¼šä¸€ä¸ªå®ä½“åº”å½“å°½é‡å°‘çš„ä¸å…¶ä»–å®ä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚ 6ã€åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰åŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚ ã€ŠHead Firstè®¾è®¡æ¨¡å¼ã€‹http://pan.baidu.com/s/1nvTqSdj éªŒè¯ç ï¼šDG58","categories":[{"name":"Design Patterns","slug":"Design-Patterns","permalink":"https://reversescale.github.io/categories/Design-Patterns/"}],"tags":[{"name":"Book","slug":"Book","permalink":"https://reversescale.github.io/tags/Book/"}]},{"title":"GoF è®¾è®¡æ¨¡å¼ + æƒ…æ™¯å†ç°","slug":"Design patterns Gof","date":"2016-03-01T12:29:16.000Z","updated":"2018-11-16T13:25:39.532Z","comments":true,"path":"2016/03/01/Design patterns Gof/","link":"","permalink":"https://reversescale.github.io/2016/03/01/Design patterns Gof/","excerpt":"ã€ŠDesign Patterns: Elements of Reusable Object-Oriented Softwareã€‹ï¼ˆå³åè¿°ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ï¼‰ï¼Œç”± Erich Gammaã€Richard Helmã€Ralph Johnson å’Œ John Vlissides åˆè‘—ï¼ˆAddison-Wesleyï¼Œ1995ï¼‰ï¼Œè¿™å‡ ä½ä½œè€…å¸¸è¢«ç§°ä¸ºâ€å››äººç»„ï¼ˆGang of Fourï¼‰â€~","text":"ã€ŠDesign Patterns: Elements of Reusable Object-Oriented Softwareã€‹ï¼ˆå³åè¿°ã€Šè®¾è®¡æ¨¡å¼ã€‹ä¸€ä¹¦ï¼‰ï¼Œç”± Erich Gammaã€Richard Helmã€Ralph Johnson å’Œ John Vlissides åˆè‘—ï¼ˆAddison-Wesleyï¼Œ1995ï¼‰ï¼Œè¿™å‡ ä½ä½œè€…å¸¸è¢«ç§°ä¸ºâ€å››äººç»„ï¼ˆGang of Fourï¼‰â€~ è®¾è®¡æ¨¡å¼å’Œæƒ…æ™¯å†ç°åˆ›å»ºå‹æ¨¡å¼1ã€ABSTRACT FACTORYâ€”è¿½MMå°‘ä¸äº†è¯·åƒé¥­äº†ï¼Œéº¦å½“åŠ³çš„å¥—é¤å’Œè‚¯å¾·åŸºçš„å¥—é¤éƒ½æ˜¯MMçˆ±åƒçš„ä¸œè¥¿ï¼Œè™½ç„¶å£å‘³æœ‰æ‰€ä¸åŒï¼Œä½†ä¸ç®¡ä½ å¸¦MMå»éº¦å½“åŠ³æˆ–è‚¯å¾·åŸºï¼Œåªç®¡å‘æœåŠ¡å‘˜è¯´â€œä¸¤ä¸ªBå¥—é¤â€å°±è¡Œäº†ã€‚éº¦å½“åŠ³å’Œè‚¯å¾·åŸºå°±æ˜¯Bå¥—é¤çš„Abstract Factory, Bå¥—é¤é‡Œå«æœ‰æ±‰å ¡, é¸¡ç¿…å’Œé¥®æ–™. éº¦å½“åŠ³æˆ–è‚¯å¾·åŸºä¼šæ ¹æ®Bå¥—é¤çš„è§„æ ¼, è®©æ±‰å ¡Factory, é¸¡ç¿…Factory, é¥®æ–™Factoryåˆ†åˆ«ç”Ÿäº§å¯¹åº”Bå¥—é¤çš„ææ–™ã€‚æŠ½è±¡å·¥å‚æ¨¡å¼ï¼šå®¢æˆ·ç±»å’Œå·¥å‚ç±»åˆ†å¼€ã€‚æ¶ˆè´¹è€…ä»»ä½•æ—¶å€™éœ€è¦æŸå¥—äº§å“é›†åˆæ—¶ï¼Œåªéœ€å‘æŠ½è±¡å·¥å‚è¯·æ±‚å³å¯ã€‚æŠ½è±¡å·¥å‚ä¼šå†å‘å…·ä½“çš„å·¥å‚ç”Ÿäº§å‡ºç¬¦åˆäº§å“é›†è§„æ ¼çš„äº§å“ã€‚ 2ã€BUILDERâ€”MMæœ€çˆ±å¬çš„å°±æ˜¯â€œæˆ‘çˆ±ä½ â€è¿™å¥è¯äº†ï¼Œè§åˆ°ä¸åŒåœ°æ–¹çš„MM,è¦èƒ½å¤Ÿç”¨å¥¹ä»¬çš„æ–¹è¨€è·Ÿå¥¹è¯´è¿™å¥è¯å“¦ï¼Œæˆ‘æœ‰ä¸€ä¸ªå¤šç§è¯­è¨€ç¿»è¯‘æœºï¼Œä¸Šé¢æ¯ç§è¯­è¨€éƒ½æœ‰ä¸€ä¸ªæŒ‰é”®ï¼Œè§åˆ°MMæˆ‘åªè¦æŒ‰å¯¹åº”çš„é”®ï¼Œå®ƒå°±èƒ½å¤Ÿç”¨ç›¸åº”çš„è¯­è¨€è¯´å‡ºâ€œæˆ‘çˆ±ä½ â€è¿™å¥è¯äº†ï¼Œå›½å¤–çš„MMä¹Ÿå¯ä»¥è½»æ¾ææ‚ï¼Œè¿™å°±æ˜¯æˆ‘çš„â€œæˆ‘çˆ±ä½ â€builderã€‚ï¼ˆè¿™ä¸€å®šæ¯”ç¾å†›åœ¨ä¼Šæ‹‰å…‹ç”¨çš„ç¿»è¯‘æœºå¥½å–ï¼‰å»ºé€ æ¨¡å¼ï¼šå°†äº§å“çš„å†…éƒ¨è¡¨è±¡å’Œäº§å“çš„ç”Ÿæˆè¿‡ç¨‹åˆ†å‰²å¼€æ¥ï¼Œä»è€Œä½¿ä¸€ä¸ªå»ºé€ è¿‡ç¨‹ç”Ÿæˆå…·æœ‰ä¸åŒçš„å†…éƒ¨è¡¨è±¡çš„äº§å“å¯¹è±¡ã€‚å»ºé€ æ¨¡å¼ä½¿å¾—äº§å“å†…éƒ¨è¡¨è±¡å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ï¼Œå®¢æˆ·ä¸å¿…çŸ¥é“äº§å“å†…éƒ¨ç»„æˆçš„ç»†èŠ‚ã€‚å»ºé€ æ¨¡å¼å¯ä»¥å¼ºåˆ¶å®è¡Œä¸€ç§åˆ†æ­¥éª¤è¿›è¡Œçš„å»ºé€ è¿‡ç¨‹ã€‚ 3ã€FACTORY METHODâ€”è¯·MMå»éº¦å½“åŠ³åƒæ±‰å ¡ï¼Œä¸åŒçš„MMæœ‰ä¸åŒçš„å£å‘³ï¼Œè¦æ¯ä¸ªéƒ½è®°ä½æ˜¯ä¸€ä»¶çƒ¦äººçš„äº‹æƒ…ï¼Œæˆ‘ä¸€èˆ¬é‡‡ç”¨Factory Methodæ¨¡å¼ï¼Œå¸¦ç€MMåˆ°æœåŠ¡å‘˜é‚£å„¿ï¼Œè¯´â€œè¦ä¸€ä¸ªæ±‰å ¡â€ï¼Œå…·ä½“è¦ä»€ä¹ˆæ ·çš„æ±‰å ¡å‘¢ï¼Œè®©MMç›´æ¥è·ŸæœåŠ¡å‘˜è¯´å°±è¡Œäº†ã€‚å·¥å‚æ–¹æ³•æ¨¡å¼ï¼šæ ¸å¿ƒå·¥å‚ç±»ä¸å†è´Ÿè´£æ‰€æœ‰äº§å“çš„åˆ›å»ºï¼Œè€Œæ˜¯å°†å…·ä½“åˆ›å»ºçš„å·¥ä½œäº¤ç»™å­ç±»å»åšï¼Œæˆä¸ºä¸€ä¸ªæŠ½è±¡å·¥å‚è§’è‰²ï¼Œä»…è´Ÿè´£ç»™å‡ºå…·ä½“å·¥å‚ç±»å¿…é¡»å®ç°çš„æ¥å£ï¼Œè€Œä¸æ¥è§¦å“ªä¸€ä¸ªäº§å“ç±»åº”å½“è¢«å®ä¾‹åŒ–è¿™ç§ç»†èŠ‚ã€‚ 4ã€PROTOTYPEâ€”è·ŸMMç”¨QQèŠå¤©ï¼Œä¸€å®šè¦è¯´äº›æ·±æƒ…çš„è¯è¯­äº†ï¼Œæˆ‘æœé›†äº†å¥½å¤šè‚‰éº»çš„æƒ…è¯ï¼Œéœ€è¦æ—¶åªè¦copyå‡ºæ¥æ”¾åˆ°QQé‡Œé¢å°±è¡Œäº†ï¼Œè¿™å°±æ˜¯æˆ‘çš„æƒ…è¯prototypeäº†ã€‚ï¼ˆ100å—é’±ä¸€ä»½ï¼Œä½ è¦ä¸è¦ï¼‰åŸå§‹æ¨¡å‹æ¨¡å¼ï¼šé€šè¿‡ç»™å‡ºä¸€ä¸ªåŸå‹å¯¹è±¡æ¥æŒ‡æ˜æ‰€è¦åˆ›å»ºçš„å¯¹è±¡çš„ç±»å‹ï¼Œç„¶åç”¨å¤åˆ¶è¿™ä¸ªåŸå‹å¯¹è±¡çš„æ–¹æ³•åˆ›å»ºå‡ºæ›´å¤šåŒç±»å‹çš„å¯¹è±¡ã€‚åŸå§‹æ¨¡å‹æ¨¡å¼å…è®¸åŠ¨æ€çš„å¢åŠ æˆ–å‡å°‘äº§å“ç±»ï¼Œäº§å“ç±»ä¸éœ€è¦éå¾—æœ‰ä»»ä½•äº‹å…ˆç¡®å®šçš„ç­‰çº§ç»“æ„ï¼ŒåŸå§‹æ¨¡å‹æ¨¡å¼é€‚ç”¨äºä»»ä½•çš„ç­‰çº§ç»“æ„ã€‚ç¼ºç‚¹æ˜¯æ¯ä¸€ä¸ªç±»éƒ½å¿…é¡»é…å¤‡ä¸€ä¸ªå…‹éš†æ–¹æ³•ã€‚ 5ã€SINGLETONâ€”ä¿ºæœ‰6ä¸ªæ¼‚äº®çš„è€å©†ï¼Œå¥¹ä»¬çš„è€å…¬éƒ½æ˜¯æˆ‘ï¼Œæˆ‘å°±æ˜¯æˆ‘ä»¬å®¶é‡Œçš„è€å…¬Singletonï¼Œå¥¹ä»¬åªè¦è¯´é“â€œè€å…¬â€ï¼Œéƒ½æ˜¯æŒ‡çš„åŒä¸€ä¸ªäººï¼Œé‚£å°±æ˜¯æˆ‘ã€‚(åˆšæ‰åšäº†ä¸ªæ¢¦å•¦ï¼Œå“ªæœ‰è¿™ä¹ˆå¥½çš„äº‹)å•ä¾‹æ¨¡å¼ï¼šå•ä¾‹æ¨¡å¼ç¡®ä¿æŸä¸€ä¸ªç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œè€Œä¸”è‡ªè¡Œå®ä¾‹åŒ–å¹¶å‘æ•´ä¸ªç³»ç»Ÿæä¾›è¿™ä¸ªå®ä¾‹å•ä¾‹æ¨¡å¼ã€‚å•ä¾‹æ¨¡å¼åªåº”åœ¨æœ‰çœŸæ­£çš„â€œå•ä¸€å®ä¾‹â€çš„éœ€æ±‚æ—¶æ‰å¯ä½¿ç”¨ã€‚ ç»“æ„å‹æ¨¡å¼6ã€ADAPTERâ€”åœ¨æœ‹å‹èšä¼šä¸Šç¢°åˆ°äº†ä¸€ä¸ªç¾å¥³Sarahï¼Œä»é¦™æ¸¯æ¥çš„ï¼Œå¯æˆ‘ä¸ä¼šè¯´ç²¤è¯­ï¼Œå¥¹ä¸ä¼šè¯´æ™®é€šè¯ï¼Œåªå¥½æ±‚åŠ©äºæˆ‘çš„æœ‹å‹kentäº†ï¼Œä»–ä½œä¸ºæˆ‘å’ŒSarahä¹‹é—´çš„Adapterï¼Œè®©æˆ‘å’ŒSarahå¯ä»¥ç›¸äº’äº¤è°ˆäº†(ä¹Ÿä¸çŸ¥é“ä»–ä¼šä¸ä¼šè€æˆ‘)é€‚é…å™¨ï¼ˆå˜å‹å™¨ï¼‰æ¨¡å¼ï¼šæŠŠä¸€ä¸ªç±»çš„æ¥å£å˜æ¢æˆå®¢æˆ·ç«¯æ‰€æœŸå¾…çš„å¦ä¸€ç§æ¥å£ï¼Œä»è€Œä½¿åŸæœ¬å› æ¥å£åŸå› ä¸åŒ¹é…è€Œæ— æ³•ä¸€èµ·å·¥ä½œçš„ä¸¤ä¸ªç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚é€‚é…ç±»å¯ä»¥æ ¹æ®å‚æ•°è¿”è¿˜ä¸€ä¸ªåˆé€‚çš„å®ä¾‹ç»™å®¢æˆ·ç«¯ã€‚ 7ã€BRIDGEâ€”æ—©ä¸Šç¢°åˆ°MMï¼Œè¦è¯´æ—©ä¸Šå¥½ï¼Œæ™šä¸Šç¢°åˆ°MMï¼Œè¦è¯´æ™šä¸Šå¥½ï¼›ç¢°åˆ°MMç©¿äº†ä»¶æ–°è¡£æœï¼Œè¦è¯´ä½ çš„è¡£æœå¥½æ¼‚äº®å“¦ï¼Œç¢°åˆ°MMæ–°åšçš„å‘å‹ï¼Œè¦è¯´ä½ çš„å¤´å‘å¥½æ¼‚äº®å“¦ã€‚ä¸è¦é—®æˆ‘â€œæ—©ä¸Šç¢°åˆ°MMæ–°åšäº†ä¸ªå‘å‹æ€ä¹ˆè¯´â€è¿™ç§é—®é¢˜ï¼Œè‡ªå·±ç”¨BRIDGEç»„åˆä¸€ä¸‹ä¸å°±è¡Œäº†ã€‚æ¡¥æ¢æ¨¡å¼ï¼šå°†æŠ½è±¡åŒ–ä¸å®ç°åŒ–è„±è€¦ï¼Œä½¿å¾—äºŒè€…å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ï¼Œä¹Ÿå°±æ˜¯è¯´å°†ä»–ä»¬ä¹‹é—´çš„å¼ºå…³è”å˜æˆå¼±å…³è”ï¼Œä¹Ÿå°±æ˜¯æŒ‡åœ¨ä¸€ä¸ªè½¯ä»¶ç³»ç»Ÿçš„æŠ½è±¡åŒ–å’Œå®ç°åŒ–ä¹‹é—´ä½¿ç”¨ç»„åˆ/èšåˆå…³ç³»è€Œä¸æ˜¯ç»§æ‰¿å…³ç³»ï¼Œä»è€Œä½¿ä¸¤è€…å¯ä»¥ç‹¬ç«‹çš„å˜åŒ–ã€‚ 8ã€COMPOSITEâ€”Maryä»Šå¤©è¿‡ç”Ÿæ—¥ã€‚â€œæˆ‘è¿‡ç”Ÿæ—¥ï¼Œä½ è¦é€æˆ‘ä¸€ä»¶ç¤¼ç‰©ã€‚â€â€œå—¯ï¼Œå¥½å§ï¼Œå»å•†åº—ï¼Œä½ è‡ªå·±æŒ‘ã€‚â€â€œè¿™ä»¶Tæ¤æŒºæ¼‚äº®ï¼Œä¹°ï¼Œè¿™æ¡è£™å­å¥½çœ‹ï¼Œä¹°ï¼Œè¿™ä¸ªåŒ…ä¹Ÿä¸é”™ï¼Œä¹°ã€‚â€â€œå–‚ï¼Œä¹°äº†ä¸‰ä»¶äº†å‘€ï¼Œæˆ‘åªç­”åº”é€ä¸€ä»¶ç¤¼ç‰©çš„å“¦ã€‚â€â€œä»€ä¹ˆå‘€ï¼ŒTæ¤åŠ è£™å­åŠ åŒ…åŒ…ï¼Œæ­£å¥½é…æˆä¸€å¥—å‘€ï¼Œå°å§ï¼Œéº»çƒ¦ä½ åŒ…èµ·æ¥ã€‚â€â€œâ€¦â€¦â€ï¼ŒMMéƒ½ä¼šç”¨Compositeæ¨¡å¼äº†ï¼Œä½ ä¼šäº†æ²¡æœ‰ï¼Ÿåˆæˆæ¨¡å¼ï¼šåˆæˆæ¨¡å¼å°†å¯¹è±¡ç»„ç»‡åˆ°æ ‘ç»“æ„ä¸­ï¼Œå¯ä»¥ç”¨æ¥æè¿°æ•´ä½“ä¸éƒ¨åˆ†çš„å…³ç³»ã€‚åˆæˆæ¨¡å¼å°±æ˜¯ä¸€ä¸ªå¤„ç†å¯¹è±¡çš„æ ‘ç»“æ„çš„æ¨¡å¼ã€‚åˆæˆæ¨¡å¼æŠŠéƒ¨åˆ†ä¸æ•´ä½“çš„å…³ç³»ç”¨æ ‘ç»“æ„è¡¨ç¤ºå‡ºæ¥ã€‚åˆæˆæ¨¡å¼ä½¿å¾—å®¢æˆ·ç«¯æŠŠä¸€ä¸ªä¸ªå•ç‹¬çš„æˆåˆ†å¯¹è±¡å’Œç”±ä»–ä»¬å¤åˆè€Œæˆçš„åˆæˆå¯¹è±¡åŒç­‰çœ‹å¾…ã€‚ 9ã€DECORATORâ€”Maryè¿‡å®Œè½®åˆ°Sarlyè¿‡ç”Ÿæ—¥ï¼Œè¿˜æ˜¯ä¸è¦å«å¥¹è‡ªå·±æŒ‘äº†ï¼Œä¸ç„¶è¿™ä¸ªæœˆä¼™é£Ÿè´¹è‚¯å®šç©å®Œï¼Œæ‹¿å‡ºæˆ‘å»å¹´åœ¨åå±±é¡¶ä¸Šç…§çš„ç…§ç‰‡ï¼Œåœ¨èƒŒé¢å†™ä¸Šâ€œæœ€å¥½çš„çš„ç¤¼ç‰©ï¼Œå°±æ˜¯çˆ±ä½ çš„Fitaâ€ï¼Œå†åˆ°è¡—ä¸Šç¤¼å“åº—ä¹°äº†ä¸ªåƒæ¡†ï¼ˆå–ç¤¼å“çš„MMä¹Ÿå¾ˆæ¼‚äº®å“¦ï¼‰ï¼Œå†æ‰¾éš”å£æç¾æœ¯è®¾è®¡çš„Mikeè®¾è®¡äº†ä¸€ä¸ªæ¼‚äº®çš„ç›’å­è£…èµ·æ¥â€¦â€¦ï¼Œæˆ‘ä»¬éƒ½æ˜¯Decoratorï¼Œæœ€ç»ˆéƒ½åœ¨ä¿®é¥°æˆ‘è¿™ä¸ªäººå‘€ï¼Œæ€ä¹ˆæ ·ï¼Œçœ‹æ‡‚äº†å—ï¼Ÿè£…é¥°æ¨¡å¼ï¼šè£…é¥°æ¨¡å¼ä»¥å¯¹å®¢æˆ·ç«¯é€æ˜çš„æ–¹å¼æ‰©å±•å¯¹è±¡çš„åŠŸèƒ½ï¼Œæ˜¯ç»§æ‰¿å…³ç³»çš„ä¸€ä¸ªæ›¿ä»£æ–¹æ¡ˆï¼Œæä¾›æ¯”ç»§æ‰¿æ›´å¤šçš„çµæ´»æ€§ã€‚åŠ¨æ€ç»™ä¸€ä¸ªå¯¹è±¡å¢åŠ åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å¯ä»¥å†åŠ¨æ€çš„æ’¤æ¶ˆã€‚å¢åŠ ç”±ä¸€äº›åŸºæœ¬åŠŸèƒ½çš„æ’åˆ—ç»„åˆè€Œäº§ç”Ÿçš„éå¸¸å¤§é‡çš„åŠŸèƒ½ã€‚ 10ã€FACADEâ€”æˆ‘æœ‰ä¸€ä¸ªä¸“ä¸šçš„Nikonç›¸æœºï¼Œæˆ‘å°±å–œæ¬¢è‡ªå·±æ‰‹åŠ¨è°ƒå…‰åœˆã€å¿«é—¨ï¼Œè¿™æ ·ç…§å‡ºæ¥çš„ç…§ç‰‡æ‰ä¸“ä¸šï¼Œä½†MMå¯ä¸æ‡‚è¿™äº›ï¼Œæ•™äº†åŠå¤©ä¹Ÿä¸ä¼šã€‚å¹¸å¥½ç›¸æœºæœ‰Facadeè®¾è®¡æ¨¡å¼ï¼ŒæŠŠç›¸æœºè°ƒæ•´åˆ°è‡ªåŠ¨æ¡£ï¼Œåªè¦å¯¹å‡†ç›®æ ‡æŒ‰å¿«é—¨å°±è¡Œäº†ï¼Œä¸€åˆ‡ç”±ç›¸æœºè‡ªåŠ¨è°ƒæ•´ï¼Œè¿™æ ·MMä¹Ÿå¯ä»¥ç”¨è¿™ä¸ªç›¸æœºç»™æˆ‘æ‹å¼ ç…§ç‰‡äº†ã€‚é—¨é¢æ¨¡å¼ï¼šå¤–éƒ¨ä¸ä¸€ä¸ªå­ç³»ç»Ÿçš„é€šä¿¡å¿…é¡»é€šè¿‡ä¸€ä¸ªç»Ÿä¸€çš„é—¨é¢å¯¹è±¡è¿›è¡Œã€‚é—¨é¢æ¨¡å¼æä¾›ä¸€ä¸ªé«˜å±‚æ¬¡çš„æ¥å£ï¼Œä½¿å¾—å­ç³»ç»Ÿæ›´æ˜“äºä½¿ç”¨ã€‚æ¯ä¸€ä¸ªå­ç³»ç»Ÿåªæœ‰ä¸€ä¸ªé—¨é¢ç±»ï¼Œè€Œä¸”æ­¤é—¨é¢ç±»åªæœ‰ä¸€ä¸ªå®ä¾‹ï¼Œä¹Ÿå°±æ˜¯è¯´å®ƒæ˜¯ä¸€ä¸ªå•ä¾‹æ¨¡å¼ã€‚ä½†æ•´ä¸ªç³»ç»Ÿå¯ä»¥æœ‰å¤šä¸ªé—¨é¢ç±»ã€‚ 11ã€FLYWEIGHTâ€”æ¯å¤©è·ŸMMå‘çŸ­ä¿¡ï¼Œæ‰‹æŒ‡éƒ½ç´¯æ­»äº†ï¼Œæœ€è¿‘ä¹°äº†ä¸ªæ–°æ‰‹æœºï¼Œå¯ä»¥æŠŠä¸€äº›å¸¸ç”¨çš„å¥å­å­˜åœ¨æ‰‹æœºé‡Œï¼Œè¦ç”¨çš„æ—¶å€™ï¼Œç›´æ¥æ‹¿å‡ºæ¥ï¼Œåœ¨å‰é¢åŠ ä¸ŠMMçš„åå­—å°±å¯ä»¥å‘é€äº†ï¼Œå†ä¸ç”¨ä¸€ä¸ªå­—ä¸€ä¸ªå­—æ•²äº†ã€‚å…±äº«çš„å¥å­å°±æ˜¯Flyweightï¼ŒMMçš„åå­—å°±æ˜¯æå–å‡ºæ¥çš„å¤–éƒ¨ç‰¹å¾ï¼Œæ ¹æ®ä¸Šä¸‹æ–‡æƒ…å†µä½¿ç”¨ã€‚äº«å…ƒæ¨¡å¼ï¼šFLYWEIGHTåœ¨æ‹³å‡»æ¯”èµ›ä¸­æŒ‡æœ€è½»é‡çº§ã€‚äº«å…ƒæ¨¡å¼ä»¥å…±äº«çš„æ–¹å¼é«˜æ•ˆçš„æ”¯æŒå¤§é‡çš„ç»†ç²’åº¦å¯¹è±¡ã€‚äº«å…ƒæ¨¡å¼èƒ½åšåˆ°å…±äº«çš„å…³é”®æ˜¯åŒºåˆ†å†…è•´çŠ¶æ€å’Œå¤–è•´çŠ¶æ€ã€‚å†…è•´çŠ¶æ€å­˜å‚¨åœ¨äº«å…ƒå†…éƒ¨ï¼Œä¸ä¼šéšç¯å¢ƒçš„æ”¹å˜è€Œæœ‰æ‰€ä¸åŒã€‚å¤–è•´çŠ¶æ€æ˜¯éšç¯å¢ƒçš„æ”¹å˜è€Œæ”¹å˜çš„ã€‚å¤–è•´çŠ¶æ€ä¸èƒ½å½±å“å†…è•´çŠ¶æ€ï¼Œå®ƒä»¬æ˜¯ç›¸äº’ç‹¬ç«‹çš„ã€‚å°†å¯ä»¥å…±äº«çš„çŠ¶æ€å’Œä¸å¯ä»¥å…±äº«çš„çŠ¶æ€ä»å¸¸è§„ç±»ä¸­åŒºåˆ†å¼€æ¥ï¼Œå°†ä¸å¯ä»¥å…±äº«çš„çŠ¶æ€ä»ç±»é‡Œå‰”é™¤å‡ºå»ã€‚å®¢æˆ·ç«¯ä¸å¯ä»¥ç›´æ¥åˆ›å»ºè¢«å…±äº«çš„å¯¹è±¡ï¼Œè€Œåº”å½“ä½¿ç”¨ä¸€ä¸ªå·¥å‚å¯¹è±¡è´Ÿè´£åˆ›å»ºè¢«å…±äº«çš„å¯¹è±¡ã€‚äº«å…ƒæ¨¡å¼å¤§å¹…åº¦çš„é™ä½å†…å­˜ä¸­å¯¹è±¡çš„æ•°é‡ã€‚ 12ã€PROXYâ€”è·ŸMMåœ¨ç½‘ä¸ŠèŠå¤©ï¼Œä¸€å¼€å¤´æ€»æ˜¯â€œhi,ä½ å¥½â€,â€œä½ ä»å“ªå„¿æ¥å‘€ï¼Ÿâ€â€œä½ å¤šå¤§äº†ï¼Ÿâ€â€œèº«é«˜å¤šå°‘å‘€ï¼Ÿâ€è¿™äº›è¯ï¼ŒçœŸçƒ¦äººï¼Œå†™ä¸ªç¨‹åºåšä¸ºæˆ‘çš„Proxyå§ï¼Œå‡¡æ˜¯æ¥æ”¶åˆ°è¿™äº›è¯éƒ½è®¾ç½®å¥½äº†è‡ªåŠ¨çš„å›ç­”ï¼Œæ¥æ”¶åˆ°å…¶ä»–çš„è¯æ—¶å†é€šçŸ¥æˆ‘å›ç­”ï¼Œæ€ä¹ˆæ ·ï¼Œé…·å§ã€‚ä»£ç†æ¨¡å¼ï¼šä»£ç†æ¨¡å¼ç»™æŸä¸€ä¸ªå¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†å¯¹è±¡ï¼Œå¹¶ç”±ä»£ç†å¯¹è±¡æ§åˆ¶å¯¹æºå¯¹è±¡çš„å¼•ç”¨ã€‚ä»£ç†å°±æ˜¯ä¸€ä¸ªäººæˆ–ä¸€ä¸ªæœºæ„ä»£è¡¨å¦ä¸€ä¸ªäººæˆ–è€…ä¸€ä¸ªæœºæ„é‡‡å–è¡ŒåŠ¨ã€‚æŸäº›æƒ…å†µä¸‹ï¼Œå®¢æˆ·ä¸æƒ³æˆ–è€…ä¸èƒ½å¤Ÿç›´æ¥å¼•ç”¨ä¸€ä¸ªå¯¹è±¡ï¼Œä»£ç†å¯¹è±¡å¯ä»¥åœ¨å®¢æˆ·å’Œç›®æ ‡å¯¹è±¡ç›´æ¥èµ·åˆ°ä¸­ä»‹çš„ä½œç”¨ã€‚å®¢æˆ·ç«¯åˆ†è¾¨ä¸å‡ºä»£ç†ä¸»é¢˜å¯¹è±¡ä¸çœŸå®ä¸»é¢˜å¯¹è±¡ã€‚ä»£ç†æ¨¡å¼å¯ä»¥å¹¶ä¸çŸ¥é“çœŸæ­£çš„è¢«ä»£ç†å¯¹è±¡ï¼Œè€Œä»…ä»…æŒæœ‰ä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„æ¥å£ï¼Œè¿™æ—¶å€™ä»£ç†å¯¹è±¡ä¸èƒ½å¤Ÿåˆ›å»ºè¢«ä»£ç†å¯¹è±¡ï¼Œè¢«ä»£ç†å¯¹è±¡å¿…é¡»æœ‰ç³»ç»Ÿçš„å…¶ä»–è§’è‰²ä»£ä¸ºåˆ›å»ºå¹¶ä¼ å…¥ã€‚ è¡Œä¸ºæ¨¡å¼13ã€CHAIN OF RESPONSIBILITYâ€”æ™šä¸Šå»ä¸Šè‹±è¯­è¯¾ï¼Œä¸ºäº†å¥½å¼€æºœååˆ°äº†æœ€åä¸€æ’ï¼Œå“‡ï¼Œå‰é¢åäº†å¥½å‡ ä¸ªæ¼‚äº®çš„MMå“ï¼Œæ‰¾å¼ çº¸æ¡ï¼Œå†™ä¸Šâ€œHi,å¯ä»¥åšæˆ‘çš„å¥³æœ‹å‹å—ï¼Ÿå¦‚æœä¸æ„¿æ„è¯·å‘å‰ä¼ â€ï¼Œçº¸æ¡å°±ä¸€ä¸ªæ¥ä¸€ä¸ªçš„ä¼ ä¸Šå»äº†ï¼Œç³Ÿç³•ï¼Œä¼ åˆ°ç¬¬ä¸€æ’çš„MMæŠŠçº¸æ¡ä¼ ç»™è€å¸ˆäº†ï¼Œå¬è¯´æ˜¯ä¸ªè€å¤„å¥³å‘€ï¼Œå¿«è·‘!è´£ä»»é“¾æ¨¡å¼ï¼šåœ¨è´£ä»»é“¾æ¨¡å¼ä¸­ï¼Œå¾ˆå¤šå¯¹è±¡ç”±æ¯ä¸€ä¸ªå¯¹è±¡å¯¹å…¶ä¸‹å®¶çš„å¼•ç”¨è€Œæ¥èµ·æ¥å½¢æˆä¸€æ¡é“¾ã€‚è¯·æ±‚åœ¨è¿™ä¸ªé“¾ä¸Šä¼ é€’ï¼Œç›´åˆ°é“¾ä¸Šçš„æŸä¸€ä¸ªå¯¹è±¡å†³å®šå¤„ç†æ­¤è¯·æ±‚ã€‚å®¢æˆ·å¹¶ä¸çŸ¥é“é“¾ä¸Šçš„å“ªä¸€ä¸ªå¯¹è±¡æœ€ç»ˆå¤„ç†è¿™ä¸ªè¯·æ±‚ï¼Œç³»ç»Ÿå¯ä»¥åœ¨ä¸å½±å“å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹åŠ¨æ€çš„é‡æ–°ç»„ç»‡é“¾å’Œåˆ†é…è´£ä»»ã€‚å¤„ç†è€…æœ‰ä¸¤ä¸ªé€‰æ‹©ï¼šæ‰¿æ‹…è´£ä»»æˆ–è€…æŠŠè´£ä»»æ¨ç»™ä¸‹å®¶ã€‚ä¸€ä¸ªè¯·æ±‚å¯ä»¥æœ€ç»ˆä¸è¢«ä»»ä½•æ¥æ”¶ç«¯å¯¹è±¡æ‰€æ¥å—ã€‚ 14ã€COMMANDâ€”ä¿ºæœ‰ä¸€ä¸ªMMå®¶é‡Œç®¡å¾—ç‰¹åˆ«ä¸¥ï¼Œæ²¡æ³•è§é¢ï¼Œåªå¥½å€ŸåŠ©äºå¥¹å¼Ÿå¼Ÿåœ¨æˆ‘ä»¬ä¿©ä¹‹é—´ä¼ é€ä¿¡æ¯ï¼Œå¥¹å¯¹æˆ‘æœ‰ä»€ä¹ˆæŒ‡ç¤ºï¼Œå°±å†™ä¸€å¼ çº¸æ¡è®©å¥¹å¼Ÿå¼Ÿå¸¦ç»™æˆ‘ã€‚è¿™ä¸ï¼Œå¥¹å¼Ÿå¼Ÿåˆä¼ é€è¿‡æ¥ä¸€ä¸ªCOMMANDï¼Œä¸ºäº†æ„Ÿè°¢ä»–ï¼Œæˆ‘è¯·ä»–åƒäº†ç¢—æ‚é…±é¢ï¼Œå“ªçŸ¥é“ä»–è¯´ï¼šâ€œæˆ‘åŒæ—¶ç»™æˆ‘å§å§ä¸‰ä¸ªç”·æœ‹å‹é€COMMANDï¼Œå°±æ•°ä½ æœ€å°æ°”ï¼Œæ‰è¯·æˆ‘åƒé¢ã€‚â€ :-(å‘½ä»¤æ¨¡å¼ï¼šå‘½ä»¤æ¨¡å¼æŠŠä¸€ä¸ªè¯·æ±‚æˆ–è€…æ“ä½œå°è£…åˆ°ä¸€ä¸ªå¯¹è±¡ä¸­ã€‚å‘½ä»¤æ¨¡å¼æŠŠå‘å‡ºå‘½ä»¤çš„è´£ä»»å’Œæ‰§è¡Œå‘½ä»¤çš„è´£ä»»åˆ†å‰²å¼€ï¼Œå§”æ´¾ç»™ä¸åŒçš„å¯¹è±¡ã€‚å‘½ä»¤æ¨¡å¼å…è®¸è¯·æ±‚çš„ä¸€æ–¹å’Œå‘é€çš„ä¸€æ–¹ç‹¬ç«‹å¼€æ¥ï¼Œä½¿å¾—è¯·æ±‚çš„ä¸€æ–¹ä¸å¿…çŸ¥é“æ¥æ”¶è¯·æ±‚çš„ä¸€æ–¹çš„æ¥å£ï¼Œæ›´ä¸å¿…çŸ¥é“è¯·æ±‚æ˜¯æ€ä¹ˆè¢«æ¥æ”¶ï¼Œä»¥åŠæ“ä½œæ˜¯å¦æ‰§è¡Œï¼Œä½•æ—¶è¢«æ‰§è¡Œä»¥åŠæ˜¯æ€ä¹ˆè¢«æ‰§è¡Œçš„ã€‚ç³»ç»Ÿæ”¯æŒå‘½ä»¤çš„æ’¤æ¶ˆã€‚ 15ã€INTERPRETERâ€”ä¿ºæœ‰ä¸€ä¸ªã€Šæ³¡MMçœŸç»ã€‹ï¼Œä¸Šé¢æœ‰å„ç§æ³¡MMçš„æ”»ç•¥ï¼Œæ¯”å¦‚è¯´å»åƒè¥¿é¤çš„æ­¥éª¤ã€å»çœ‹ç”µå½±çš„æ–¹æ³•ç­‰ç­‰ï¼Œè·ŸMMçº¦ä¼šæ—¶ï¼Œåªè¦åšä¸€ä¸ªInterpreterï¼Œç…§ç€ä¸Šé¢çš„è„šæœ¬æ‰§è¡Œå°±å¯ä»¥äº†ã€‚è§£é‡Šå™¨æ¨¡å¼ï¼šç»™å®šä¸€ä¸ªè¯­è¨€åï¼Œè§£é‡Šå™¨æ¨¡å¼å¯ä»¥å®šä¹‰å‡ºå…¶æ–‡æ³•çš„ä¸€ç§è¡¨ç¤ºï¼Œå¹¶åŒæ—¶æä¾›ä¸€ä¸ªè§£é‡Šå™¨ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨è¿™ä¸ªè§£é‡Šå™¨æ¥è§£é‡Šè¿™ä¸ªè¯­è¨€ä¸­çš„å¥å­ã€‚è§£é‡Šå™¨æ¨¡å¼å°†æè¿°æ€æ ·åœ¨æœ‰äº†ä¸€ä¸ªç®€å•çš„æ–‡æ³•åï¼Œä½¿ç”¨æ¨¡å¼è®¾è®¡è§£é‡Šè¿™äº›è¯­å¥ã€‚åœ¨è§£é‡Šå™¨æ¨¡å¼é‡Œé¢æåˆ°çš„è¯­è¨€æ˜¯æŒ‡ä»»ä½•è§£é‡Šå™¨å¯¹è±¡èƒ½å¤Ÿè§£é‡Šçš„ä»»ä½•ç»„åˆã€‚åœ¨è§£é‡Šå™¨æ¨¡å¼ä¸­éœ€è¦å®šä¹‰ä¸€ä¸ªä»£è¡¨æ–‡æ³•çš„å‘½ä»¤ç±»çš„ç­‰çº§ç»“æ„ï¼Œä¹Ÿå°±æ˜¯ä¸€ç³»åˆ—çš„ç»„åˆè§„åˆ™ã€‚æ¯ä¸€ä¸ªå‘½ä»¤å¯¹è±¡éƒ½æœ‰ä¸€ä¸ªè§£é‡Šæ–¹æ³•ï¼Œä»£è¡¨å¯¹å‘½ä»¤å¯¹è±¡çš„è§£é‡Šã€‚å‘½ä»¤å¯¹è±¡çš„ç­‰çº§ç»“æ„ä¸­çš„å¯¹è±¡çš„ä»»ä½•æ’åˆ—ç»„åˆéƒ½æ˜¯ä¸€ä¸ªè¯­è¨€ã€‚ 16ã€ITERATORâ€”æˆ‘çˆ±ä¸Šäº†Maryï¼Œä¸é¡¾ä¸€åˆ‡çš„å‘å¥¹æ±‚å©šã€‚Maryï¼šâ€œæƒ³è¦æˆ‘è·Ÿä½ ç»“å©šï¼Œå¾—ç­”åº”æˆ‘çš„æ¡ä»¶â€æˆ‘ï¼šâ€œä»€ä¹ˆæ¡ä»¶æˆ‘éƒ½ç­”åº”ï¼Œä½ è¯´å§â€Maryï¼šâ€œæˆ‘çœ‹ä¸Šäº†é‚£ä¸ªä¸€å…‹æ‹‰çš„é’»çŸ³â€æˆ‘ï¼šâ€œæˆ‘ä¹°ï¼Œæˆ‘ä¹°ï¼Œè¿˜æœ‰å—ï¼Ÿâ€Maryï¼šâ€œæˆ‘çœ‹ä¸Šäº†æ¹–è¾¹çš„é‚£æ ‹åˆ«å¢…â€æˆ‘ï¼šâ€œæˆ‘ä¹°ï¼Œæˆ‘ä¹°ï¼Œè¿˜æœ‰å—ï¼Ÿâ€â€¦â€¦è¿­ä»£å­æ¨¡å¼ï¼šè¿­ä»£å­æ¨¡å¼å¯ä»¥é¡ºåºè®¿é—®ä¸€ä¸ªèšé›†ä¸­çš„å…ƒç´ è€Œä¸å¿…æš´éœ²èšé›†çš„å†…éƒ¨è¡¨è±¡ã€‚å¤šä¸ªå¯¹è±¡èšåœ¨ä¸€èµ·å½¢æˆçš„æ€»ä½“ç§°ä¹‹ä¸ºèšé›†ï¼Œèšé›†å¯¹è±¡æ˜¯èƒ½å¤ŸåŒ…å®¹ä¸€ç»„å¯¹è±¡çš„å®¹å™¨å¯¹è±¡ã€‚è¿­ä»£å­æ¨¡å¼å°†è¿­ä»£é€»è¾‘å°è£…åˆ°ä¸€ä¸ªç‹¬ç«‹çš„å­å¯¹è±¡ä¸­ï¼Œä»è€Œä¸èšé›†æœ¬èº«éš”å¼€ã€‚è¿­ä»£å­æ¨¡å¼ç®€åŒ–äº†èšé›†çš„ç•Œé¢ã€‚æ¯ä¸€ä¸ªèšé›†å¯¹è±¡éƒ½å¯ä»¥æœ‰ä¸€ä¸ªæˆ–ä¸€ä¸ªä»¥ä¸Šçš„è¿­ä»£å­å¯¹è±¡ï¼Œæ¯ä¸€ä¸ªè¿­ä»£å­çš„è¿­ä»£çŠ¶æ€å¯ä»¥æ˜¯å½¼æ­¤ç‹¬ç«‹çš„ã€‚è¿­ä»£ç®—æ³•å¯ä»¥ç‹¬ç«‹äºèšé›†è§’è‰²å˜åŒ–ã€‚ 17ã€MEDIATORâ€”å››ä¸ªMMæ‰“éº»å°†ï¼Œç›¸äº’ä¹‹é—´è°åº”è¯¥ç»™è°å¤šå°‘é’±ç®—ä¸æ¸…æ¥šäº†ï¼Œå¹¸äºå½“æ—¶æˆ‘åœ¨æ—è¾¹ï¼ŒæŒ‰ç…§å„è‡ªçš„ç­¹ç æ•°ç®—é’±ï¼Œèµšäº†é’±çš„ä»æˆ‘è¿™é‡Œæ‹¿ï¼Œèµ”äº†é’±çš„ä¹Ÿä»˜ç»™æˆ‘ï¼Œä¸€åˆ‡å°±OKå•¦ï¼Œä¿ºå¾—åˆ°äº†å››ä¸ªMMçš„ç”µè¯ã€‚è°ƒåœè€…æ¨¡å¼ï¼šè°ƒåœè€…æ¨¡å¼åŒ…è£…äº†ä¸€ç³»åˆ—å¯¹è±¡ç›¸äº’ä½œç”¨çš„æ–¹å¼ï¼Œä½¿å¾—è¿™äº›å¯¹è±¡ä¸å¿…ç›¸äº’æ˜æ˜¾ä½œç”¨ã€‚ä»è€Œä½¿ä»–ä»¬å¯ä»¥æ¾æ•£å¶åˆã€‚å½“æŸäº›å¯¹è±¡ä¹‹é—´çš„ä½œç”¨å‘ç”Ÿæ”¹å˜æ—¶ï¼Œä¸ä¼šç«‹å³å½±å“å…¶ä»–çš„ä¸€äº›å¯¹è±¡ä¹‹é—´çš„ä½œç”¨ã€‚ä¿è¯è¿™äº›ä½œç”¨å¯ä»¥å½¼æ­¤ç‹¬ç«‹çš„å˜åŒ–ã€‚è°ƒåœè€…æ¨¡å¼å°†å¤šå¯¹å¤šçš„ç›¸äº’ä½œç”¨è½¬åŒ–ä¸ºä¸€å¯¹å¤šçš„ç›¸äº’ä½œç”¨ã€‚è°ƒåœè€…æ¨¡å¼å°†å¯¹è±¡çš„è¡Œä¸ºå’Œåä½œæŠ½è±¡åŒ–ï¼ŒæŠŠå¯¹è±¡åœ¨å°å°ºåº¦çš„è¡Œä¸ºä¸Šä¸å…¶ä»–å¯¹è±¡çš„ç›¸äº’ä½œç”¨åˆ†å¼€å¤„ç†ã€‚ 18ã€MEMENTOâ€”åŒæ—¶è·Ÿå‡ ä¸ªMMèŠå¤©æ—¶ï¼Œä¸€å®šè¦è®°æ¸…æ¥šåˆšæ‰è·ŸMMè¯´äº†äº›ä»€ä¹ˆè¯ï¼Œä¸ç„¶MMå‘ç°äº†ä¼šä¸é«˜å…´çš„å“¦ï¼Œå¹¸äºæˆ‘æœ‰ä¸ªå¤‡å¿˜å½•ï¼Œåˆšæ‰ä¸å“ªä¸ªMMè¯´äº†ä»€ä¹ˆè¯æˆ‘éƒ½æ‹·è´ä¸€ä»½æ”¾åˆ°å¤‡å¿˜å½•é‡Œé¢ä¿å­˜ï¼Œè¿™æ ·å¯ä»¥éšæ—¶å¯Ÿçœ‹ä»¥å‰çš„è®°å½•å•¦ã€‚å¤‡å¿˜å½•æ¨¡å¼ï¼šå¤‡å¿˜å½•å¯¹è±¡æ˜¯ä¸€ä¸ªç”¨æ¥å­˜å‚¨å¦å¤–ä¸€ä¸ªå¯¹è±¡å†…éƒ¨çŠ¶æ€çš„å¿«ç…§çš„å¯¹è±¡ã€‚å¤‡å¿˜å½•æ¨¡å¼çš„ç”¨æ„æ˜¯åœ¨ä¸ç ´åå°è£…çš„æ¡ä»¶ä¸‹ï¼Œå°†ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€æ‰ä½ï¼Œå¹¶å¤–éƒ¨åŒ–ï¼Œå­˜å‚¨èµ·æ¥ï¼Œä»è€Œå¯ä»¥åœ¨å°†æ¥åˆé€‚çš„æ—¶å€™æŠŠè¿™ä¸ªå¯¹è±¡è¿˜åŸåˆ°å­˜å‚¨èµ·æ¥çš„çŠ¶æ€ã€‚ 19ã€OBSERVERâ€”æƒ³çŸ¥é“å’±ä»¬å…¬å¸æœ€æ–°MMæƒ…æŠ¥å—ï¼ŸåŠ å…¥å…¬å¸çš„MMæƒ…æŠ¥é‚®ä»¶ç»„å°±è¡Œäº†ï¼Œtomè´Ÿè´£æœé›†æƒ…æŠ¥ï¼Œä»–å‘ç°çš„æ–°æƒ…æŠ¥ä¸ç”¨ä¸€ä¸ªä¸€ä¸ªé€šçŸ¥æˆ‘ä»¬ï¼Œç›´æ¥å‘å¸ƒç»™é‚®ä»¶ç»„ï¼Œæˆ‘ä»¬ä½œä¸ºè®¢é˜…è€…ï¼ˆè§‚å¯Ÿè€…ï¼‰å°±å¯ä»¥åŠæ—¶æ”¶åˆ°æƒ…æŠ¥å•¦è§‚å¯Ÿè€…æ¨¡å¼ï¼šè§‚å¯Ÿè€…æ¨¡å¼å®šä¹‰äº†ä¸€ç§ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œè®©å¤šä¸ªè§‚å¯Ÿè€…å¯¹è±¡åŒæ—¶ç›‘å¬æŸä¸€ä¸ªä¸»é¢˜å¯¹è±¡ã€‚è¿™ä¸ªä¸»é¢˜å¯¹è±¡åœ¨çŠ¶æ€ä¸Šå‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼šé€šçŸ¥æ‰€æœ‰è§‚å¯Ÿè€…å¯¹è±¡ï¼Œä½¿ä»–ä»¬èƒ½å¤Ÿè‡ªåŠ¨æ›´æ–°è‡ªå·±ã€‚ 20ã€STATEâ€”è·ŸMMäº¤å¾€æ—¶ï¼Œä¸€å®šè¦æ³¨æ„å¥¹çš„çŠ¶æ€å“¦ï¼Œåœ¨ä¸åŒçš„çŠ¶æ€æ—¶å¥¹çš„è¡Œä¸ºä¼šæœ‰ä¸åŒï¼Œæ¯”å¦‚ä½ çº¦å¥¹ä»Šå¤©æ™šä¸Šå»çœ‹ç”µå½±ï¼Œå¯¹ä½ æ²¡å…´è¶£çš„MMå°±ä¼šè¯´â€œæœ‰äº‹æƒ…å•¦â€ï¼Œå¯¹ä½ ä¸è®¨åŒä½†è¿˜æ²¡å–œæ¬¢ä¸Šçš„MMå°±ä¼šè¯´â€œå¥½å•Šï¼Œä¸è¿‡å¯ä»¥å¸¦ä¸Šæˆ‘åŒäº‹ä¹ˆï¼Ÿâ€ï¼Œå·²ç»å–œæ¬¢ä¸Šä½ çš„MMå°±ä¼šè¯´â€œå‡ ç‚¹é’Ÿï¼Ÿçœ‹å®Œç”µå½±å†å»æ³¡å§æ€ä¹ˆæ ·ï¼Ÿâ€ï¼Œå½“ç„¶ä½ çœ‹ç”µå½±è¿‡ç¨‹ä¸­è¡¨ç°è‰¯å¥½çš„è¯ï¼Œä¹Ÿå¯ä»¥æŠŠMMçš„çŠ¶æ€ä»ä¸è®¨åŒä¸å–œæ¬¢å˜æˆå–œæ¬¢å“¦ã€‚çŠ¶æ€æ¨¡å¼ï¼šçŠ¶æ€æ¨¡å¼å…è®¸ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™æ”¹å˜è¡Œä¸ºã€‚è¿™ä¸ªå¯¹è±¡çœ‹ä¸Šå»è±¡æ˜¯æ”¹å˜äº†å®ƒçš„ç±»ä¸€æ ·ã€‚çŠ¶æ€æ¨¡å¼æŠŠæ‰€ç ”ç©¶çš„å¯¹è±¡çš„è¡Œä¸ºåŒ…è£…åœ¨ä¸åŒçš„çŠ¶æ€å¯¹è±¡é‡Œï¼Œæ¯ä¸€ä¸ªçŠ¶æ€å¯¹è±¡éƒ½å±äºä¸€ä¸ªæŠ½è±¡çŠ¶æ€ç±»çš„ä¸€ä¸ªå­ç±»ã€‚çŠ¶æ€æ¨¡å¼çš„æ„å›¾æ˜¯è®©ä¸€ä¸ªå¯¹è±¡åœ¨å…¶å†…éƒ¨çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œå…¶è¡Œä¸ºä¹Ÿéšä¹‹æ”¹å˜ã€‚çŠ¶æ€æ¨¡å¼éœ€è¦å¯¹æ¯ä¸€ä¸ªç³»ç»Ÿå¯èƒ½å–å¾—çš„çŠ¶æ€åˆ›ç«‹ä¸€ä¸ªçŠ¶æ€ç±»çš„å­ç±»ã€‚å½“ç³»ç»Ÿçš„çŠ¶æ€å˜åŒ–æ—¶ï¼Œç³»ç»Ÿä¾¿æ”¹å˜æ‰€é€‰çš„å­ç±»ã€‚ 21ã€STRATEGYâ€”è·Ÿä¸åŒç±»å‹çš„MMçº¦ä¼šï¼Œè¦ç”¨ä¸åŒçš„ç­–ç•¥ï¼Œæœ‰çš„è¯·ç”µå½±æ¯”è¾ƒå¥½ï¼Œæœ‰çš„åˆ™å»åƒå°åƒæ•ˆæœä¸é”™ï¼Œæœ‰çš„å»æµ·è¾¹æµªæ¼«æœ€åˆé€‚ï¼Œå•ç›®çš„éƒ½æ˜¯ä¸ºäº†å¾—åˆ°MMçš„èŠ³å¿ƒï¼Œæˆ‘çš„è¿½MMé”¦å›Šä¸­æœ‰å¥½å¤šStrategyå“¦ã€‚ç­–ç•¥æ¨¡å¼ï¼šç­–ç•¥æ¨¡å¼é’ˆå¯¹ä¸€ç»„ç®—æ³•ï¼Œå°†æ¯ä¸€ä¸ªç®—æ³•å°è£…åˆ°å…·æœ‰å…±åŒæ¥å£çš„ç‹¬ç«‹çš„ç±»ä¸­ï¼Œä»è€Œä½¿å¾—å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚ç­–ç•¥æ¨¡å¼ä½¿å¾—ç®—æ³•å¯ä»¥åœ¨ä¸å½±å“åˆ°å®¢æˆ·ç«¯çš„æƒ…å†µä¸‹å‘ç”Ÿå˜åŒ–ã€‚ç­–ç•¥æ¨¡å¼æŠŠè¡Œä¸ºå’Œç¯å¢ƒåˆ†å¼€ã€‚ç¯å¢ƒç±»è´Ÿè´£ç»´æŒå’ŒæŸ¥è¯¢è¡Œä¸ºç±»ï¼Œå„ç§ç®—æ³•åœ¨å…·ä½“çš„ç­–ç•¥ç±»ä¸­æä¾›ã€‚ç”±äºç®—æ³•å’Œç¯å¢ƒç‹¬ç«‹å¼€æ¥ï¼Œç®—æ³•çš„å¢å‡ï¼Œä¿®æ”¹éƒ½ä¸ä¼šå½±å“åˆ°ç¯å¢ƒå’Œå®¢æˆ·ç«¯ã€‚ 22ã€TEMPLATE METHODâ€”â€”çœ‹è¿‡ã€Šå¦‚ä½•è¯´æœå¥³ç”Ÿä¸ŠåºŠã€‹è¿™éƒ¨ç»å…¸æ–‡ç« å—ï¼Ÿå¥³ç”Ÿä»è®¤è¯†åˆ°ä¸ŠåºŠçš„ä¸å˜çš„æ­¥éª¤åˆ†ä¸ºå·§é‡ã€æ‰“ç ´åƒµå±€ã€å±•å¼€è¿½æ±‚ã€æ¥å»ã€å‰æˆã€åŠ¨æ‰‹ã€çˆ±æŠšã€è¿›å»å…«å¤§æ­¥éª¤(Template method)ï¼Œä½†æ¯ä¸ªæ­¥éª¤é’ˆå¯¹ä¸åŒçš„æƒ…å†µï¼Œéƒ½æœ‰ä¸ä¸€æ ·çš„åšæ³•ï¼Œè¿™å°±è¦çœ‹ä½ éšæœºåº”å˜å•¦(å…·ä½“å®ç°)ï¼›æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼šæ¨¡æ¿æ–¹æ³•æ¨¡å¼å‡†å¤‡ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå°†éƒ¨åˆ†é€»è¾‘ä»¥å…·ä½“æ–¹æ³•ä»¥åŠå…·ä½“æ„é€ å­çš„å½¢å¼å®ç°ï¼Œç„¶åå£°æ˜ä¸€äº›æŠ½è±¡æ–¹æ³•æ¥è¿«ä½¿å­ç±»å®ç°å‰©ä½™çš„é€»è¾‘ã€‚ä¸åŒçš„å­ç±»å¯ä»¥ä»¥ä¸åŒçš„æ–¹å¼å®ç°è¿™äº›æŠ½è±¡æ–¹æ³•ï¼Œä»è€Œå¯¹å‰©ä½™çš„é€»è¾‘æœ‰ä¸åŒçš„å®ç°ã€‚å…ˆåˆ¶å®šä¸€ä¸ªé¡¶çº§é€»è¾‘æ¡†æ¶ï¼Œè€Œå°†é€»è¾‘çš„ç»†èŠ‚ç•™ç»™å…·ä½“çš„å­ç±»å»å®ç°ã€‚ 23ã€VISITORâ€”æƒ…äººèŠ‚åˆ°äº†ï¼Œè¦ç»™æ¯ä¸ªMMé€ä¸€æŸé²œèŠ±å’Œä¸€å¼ å¡ç‰‡ï¼Œå¯æ˜¯æ¯ä¸ªMMé€çš„èŠ±éƒ½è¦é’ˆå¯¹å¥¹ä¸ªäººçš„ç‰¹ç‚¹ï¼Œæ¯å¼ å¡ç‰‡ä¹Ÿè¦æ ¹æ®ä¸ªäººçš„ç‰¹ç‚¹æ¥æŒ‘ï¼Œæˆ‘ä¸€ä¸ªäººå“ªæå¾—æ¸…æ¥šï¼Œè¿˜æ˜¯æ‰¾èŠ±åº—è€æ¿å’Œç¤¼å“åº—è€æ¿åšä¸€ä¸‹Visitorï¼Œè®©èŠ±åº—è€æ¿æ ¹æ®MMçš„ç‰¹ç‚¹é€‰ä¸€æŸèŠ±ï¼Œè®©ç¤¼å“åº—è€æ¿ä¹Ÿæ ¹æ®æ¯ä¸ªäººç‰¹ç‚¹é€‰ä¸€å¼ å¡ï¼Œè¿™æ ·å°±è½»æ¾å¤šäº†ï¼›è®¿é—®è€…æ¨¡å¼ï¼šè®¿é—®è€…æ¨¡å¼çš„ç›®çš„æ˜¯å°è£…ä¸€äº›æ–½åŠ äºæŸç§æ•°æ®ç»“æ„å…ƒç´ ä¹‹ä¸Šçš„æ“ä½œã€‚ä¸€æ—¦è¿™äº›æ“ä½œéœ€è¦ä¿®æ”¹çš„è¯ï¼Œæ¥å—è¿™ä¸ªæ“ä½œçš„æ•°æ®ç»“æ„å¯ä»¥ä¿æŒä¸å˜ã€‚è®¿é—®è€…æ¨¡å¼é€‚ç”¨äºæ•°æ®ç»“æ„ç›¸å¯¹æœªå®šçš„ç³»ç»Ÿï¼Œå®ƒæŠŠæ•°æ®ç»“æ„å’Œä½œç”¨äºç»“æ„ä¸Šçš„æ“ä½œä¹‹é—´çš„è€¦åˆè§£è„±å¼€ï¼Œä½¿å¾—æ“ä½œé›†åˆå¯ä»¥ç›¸å¯¹è‡ªç”±çš„æ¼”åŒ–ã€‚è®¿é—®è€…æ¨¡å¼ä½¿å¾—å¢åŠ æ–°çš„æ“ä½œå˜çš„å¾ˆå®¹æ˜“ï¼Œå°±æ˜¯å¢åŠ ä¸€ä¸ªæ–°çš„è®¿é—®è€…ç±»ã€‚è®¿é—®è€…æ¨¡å¼å°†æœ‰å…³çš„è¡Œä¸ºé›†ä¸­åˆ°ä¸€ä¸ªè®¿é—®è€…å¯¹è±¡ä¸­ï¼Œè€Œä¸æ˜¯åˆ†æ•£åˆ°ä¸€ä¸ªä¸ªçš„èŠ‚ç‚¹ç±»ä¸­ã€‚å½“ä½¿ç”¨è®¿é—®è€…æ¨¡å¼æ—¶ï¼Œè¦å°†å°½å¯èƒ½å¤šçš„å¯¹è±¡æµè§ˆé€»è¾‘æ”¾åœ¨è®¿é—®è€…ç±»ä¸­ï¼Œè€Œä¸æ˜¯æ”¾åˆ°å®ƒçš„å­ç±»ä¸­ã€‚è®¿é—®è€…æ¨¡å¼å¯ä»¥è·¨è¿‡å‡ ä¸ªç±»çš„ç­‰çº§ç»“æ„è®¿é—®å±äºä¸åŒçš„ç­‰çº§ç»“æ„çš„æˆå‘˜ç±»ã€‚ è®¾è®¡æ¨¡å¼ä¹‹é—´çš„å…³ç³»å›¾ï¼š è®¾è®¡æ¨¡å¼çš„å…­å¤§åŸåˆ™1ã€å¼€é—­åŸåˆ™ï¼ˆOpen Close Principleï¼‰å¼€é—­åŸåˆ™å°±æ˜¯è¯´å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ã€‚åœ¨ç¨‹åºéœ€è¦è¿›è¡Œæ‹“å±•çš„æ—¶å€™ï¼Œä¸èƒ½å»ä¿®æ”¹åŸæœ‰çš„ä»£ç ï¼Œå®ç°ä¸€ä¸ªçƒ­æ’æ‹”çš„æ•ˆæœã€‚æ‰€ä»¥ä¸€å¥è¯æ¦‚æ‹¬å°±æ˜¯ï¼šä¸ºäº†ä½¿ç¨‹åºçš„æ‰©å±•æ€§å¥½ï¼Œæ˜“äºç»´æŠ¤å’Œå‡çº§ã€‚æƒ³è¦è¾¾åˆ°è¿™æ ·çš„æ•ˆæœï¼Œæˆ‘ä»¬éœ€è¦ä½¿ç”¨æ¥å£å’ŒæŠ½è±¡ç±»ï¼Œåé¢çš„å…·ä½“è®¾è®¡ä¸­æˆ‘ä»¬ä¼šæåˆ°è¿™ç‚¹ã€‚ 2ã€é‡Œæ°ä»£æ¢åŸåˆ™ï¼ˆLiskov Substitution Principleï¼‰é‡Œæ°ä»£æ¢åŸåˆ™(Liskov Substitution Principle LSP)é¢å‘å¯¹è±¡è®¾è®¡çš„åŸºæœ¬åŸåˆ™ä¹‹ä¸€ã€‚ é‡Œæ°ä»£æ¢åŸåˆ™ä¸­è¯´ï¼Œä»»ä½•åŸºç±»å¯ä»¥å‡ºç°çš„åœ°æ–¹ï¼Œå­ç±»ä¸€å®šå¯ä»¥å‡ºç°ã€‚ LSPæ˜¯ç»§æ‰¿å¤ç”¨çš„åŸºçŸ³ï¼Œåªæœ‰å½“è¡ç”Ÿç±»å¯ä»¥æ›¿æ¢æ‰åŸºç±»ï¼Œè½¯ä»¶å•ä½çš„åŠŸèƒ½ä¸å—åˆ°å½±å“æ—¶ï¼ŒåŸºç±»æ‰èƒ½çœŸæ­£è¢«å¤ç”¨ï¼Œè€Œè¡ç”Ÿç±»ä¹Ÿèƒ½å¤Ÿåœ¨åŸºç±»çš„åŸºç¡€ä¸Šå¢åŠ æ–°çš„è¡Œä¸ºã€‚é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹â€œå¼€-é—­â€åŸåˆ™çš„è¡¥å……ã€‚å®ç°â€œå¼€-é—­â€åŸåˆ™çš„å…³é”®æ­¥éª¤å°±æ˜¯æŠ½è±¡åŒ–ã€‚è€ŒåŸºç±»ä¸å­ç±»çš„ç»§æ‰¿å…³ç³»å°±æ˜¯æŠ½è±¡åŒ–çš„å…·ä½“å®ç°ï¼Œæ‰€ä»¥é‡Œæ°ä»£æ¢åŸåˆ™æ˜¯å¯¹å®ç°æŠ½è±¡åŒ–çš„å…·ä½“æ­¥éª¤çš„è§„èŒƒã€‚â€”â€” From Baidu ç™¾ç§‘ 3ã€ä¾èµ–å€’è½¬åŸåˆ™ï¼ˆDependence Inversion Principleï¼‰è¿™ä¸ªæ˜¯å¼€é—­åŸåˆ™çš„åŸºç¡€ï¼Œå…·ä½“å†…å®¹ï¼šçœŸå¯¹æ¥å£ç¼–ç¨‹ï¼Œä¾èµ–äºæŠ½è±¡è€Œä¸ä¾èµ–äºå…·ä½“ã€‚ 4ã€æ¥å£éš”ç¦»åŸåˆ™ï¼ˆInterface Segregation Principleï¼‰è¿™ä¸ªåŸåˆ™çš„æ„æ€æ˜¯ï¼šä½¿ç”¨å¤šä¸ªéš”ç¦»çš„æ¥å£ï¼Œæ¯”ä½¿ç”¨å•ä¸ªæ¥å£è¦å¥½ã€‚è¿˜æ˜¯ä¸€ä¸ªé™ä½ç±»ä¹‹é—´çš„è€¦åˆåº¦çš„æ„æ€ï¼Œä»è¿™å„¿æˆ‘ä»¬çœ‹å‡ºï¼Œå…¶å®è®¾è®¡æ¨¡å¼å°±æ˜¯ä¸€ä¸ªè½¯ä»¶çš„è®¾è®¡æ€æƒ³ï¼Œä»å¤§å‹è½¯ä»¶æ¶æ„å‡ºå‘ï¼Œä¸ºäº†å‡çº§å’Œç»´æŠ¤æ–¹ä¾¿ã€‚æ‰€ä»¥ä¸Šæ–‡ä¸­å¤šæ¬¡å‡ºç°ï¼šé™ä½ä¾èµ–ï¼Œé™ä½è€¦åˆã€‚ 5ã€è¿ªç±³ç‰¹æ³•åˆ™ï¼ˆæœ€å°‘çŸ¥é“åŸåˆ™ï¼‰ï¼ˆDemeter Principleï¼‰ä¸ºä»€ä¹ˆå«æœ€å°‘çŸ¥é“åŸåˆ™ï¼Œå°±æ˜¯è¯´ï¼šä¸€ä¸ªå®ä½“åº”å½“å°½é‡å°‘çš„ä¸å…¶ä»–å®ä½“ä¹‹é—´å‘ç”Ÿç›¸äº’ä½œç”¨ï¼Œä½¿å¾—ç³»ç»ŸåŠŸèƒ½æ¨¡å—ç›¸å¯¹ç‹¬ç«‹ã€‚ 6ã€åˆæˆå¤ç”¨åŸåˆ™ï¼ˆComposite Reuse Principleï¼‰åŸåˆ™æ˜¯å°½é‡ä½¿ç”¨åˆæˆ/èšåˆçš„æ–¹å¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨ç»§æ‰¿ã€‚","categories":[{"name":"Design Patterns","slug":"Design-Patterns","permalink":"https://reversescale.github.io/categories/Design-Patterns/"}],"tags":[{"name":"Book","slug":"Book","permalink":"https://reversescale.github.io/tags/Book/"}]}]}