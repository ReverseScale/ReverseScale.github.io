<!DOCTYPE html>
<!--[if lte IE 8 ]>
<html class="ie" xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<![endif]-->
<!--[if (gte IE 9)|!(IE)]><!-->
<!--
***************  *      *     *
      8          *    *       *
      8          *  *         *
      8          **           *
      8          *  *         *
      8          *    *       *
      8          *      *     *
      8          *        *   ***********    -----Theme By Kieran(http://go.kieran.top)
-->
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en-US" lang="en-US">
<!--<![endif]-->

<head>
  <title>Objective-C Principle - ReactNative | Steven&#39;s Technology Blog</title>
  <!-- Meta data -->
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8" >
    <meta http-equiv="X-UA-Compatible" content="IE=edge"/>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta name="generator" content="Steven's Technology Blog">
    <meta name="author" content="Steven">
    <meta name="description" content="" />
    <meta name="keywords" content="" />

    <!-- Favicon, (keep icon in root folder) -->
    <link rel="Shortcut Icon" href="/img/favicon.ico" type="image/ico">

    <link rel="alternate" href="/atom.xml" title="Steven&#39;s Technology Blog" type="application/atom+xml">
    <link rel="stylesheet" href="/css/all.css" media="screen" type="text/css">
	
    <link rel="stylesheet" href="/highlightjs/vs.css" type="text/css">
    
    

    <!-- Custom stylesheet, (add custom styles here, always load last) -->
    <!-- Load our stylesheet for IE8 -->
    <!--[if IE 8]>
    <link rel="stylesheet" type="text/css" href="/css/ie8.css" />
    <![endif]-->

    <!-- Google Webfonts (Monserrat 400/700, Open Sans 400/600) -->
    <link href='//fonts.useso.com/css?family=Montserrat:400,700' rel='stylesheet' type='text/css'>
    <link href='//fonts.useso.com/css?family=Open+Sans:400,600' rel='stylesheet' type='text/css'>

    <!-- Load our fonts individually if IE8+, to avoid faux bold & italic rendering -->
    <!--[if IE]>
    <link href='http://fonts.useso.com/css?family=Montserrat:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Montserrat:700' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:400' rel='stylesheet' type='text/css'>
    <link href='http://fonts.useso.com/css?family=Open+Sans:600' rel='stylesheet' type='text/css'>
    <![endif]-->

    <!-- jQuery | Load our jQuery, with an alternative source fallback to a local version if request is unavailable -->
    <script src="/js/jquery-1.11.1.min.js"></script>
    <script>window.jQuery || document.write('<script src="js/jquery-1.11.1.min.js"><\/script>')</script>

    <!-- Load these in the <head> for quicker IE8+ load times -->
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="/js/html5shiv.min.js"></script>
    <script src="/js/respond.min.js"></script>
    <![endif]-->










  
  
  

  
  <style>.col-md-8.col-md-offset-2.opening-statement img{display:none;}</style>
</head>

<!--
<body class="post-template">
-->
<body id="index" class="lightnav animsition">

      <!-- ============================ Off-canvas navigation =========================== -->

    <div class="sb-slidebar sb-right sb-style-overlay sb-momentum-scrolling">
        <div class="sb-close" aria-label="Close Menu" aria-hidden="true">
            <img src="/img/close.png" alt="Close"/>
        </div>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu">
            <li><a href="/" class="animsition-link" title="Home">Home</a></li>
            <li><a href="/archives" class="animsition-link" title="archive">archives</a></li>
            <!-- Dropdown Menu -->
			 
            <li>
                <a class="sb-toggle-submenu">Works<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                        <li><a href="/tags/åšå®¢ï¼Œæ–‡ç« " target="_BLANK" class="animsition-link">æ–‡ç« </a></li>
                    
                        <li><a href="/tags/åšå®¢ï¼Œèµ„æ–™" target="_BLANK" class="animsition-link">èµ„æ–™</a></li>
                    
                </ul>
            </li>
            
            
        	<li>
        		<a class="sb-toggle-submenu">Categories<span class="sb-caret"></span></a>
            	<ul class="sb-submenu">
				  	
				    <li><a href="/categories/API/" class="animsition-link">API<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Android/" class="animsition-link">Android<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Git/" class="animsition-link">Git<small>(1)</small></a></li>
				    
				    <li><a href="/categories/HTML5/" class="animsition-link">HTML5<small>(5)</small></a></li>
				    
				    <li><a href="/categories/Markdown/" class="animsition-link">Markdown<small>(1)</small></a></li>
				    
				    <li><a href="/categories/PHP/" class="animsition-link">PHP<small>(1)</small></a></li>
				    
				    <li><a href="/categories/Tools/" class="animsition-link">Tools<small>(2)</small></a></li>
				    
				    <li><a href="/categories/Unity-3D/" class="animsition-link">Unity 3D<small>(1)</small></a></li>
				    
				    <li><a href="/categories/iOS/" class="animsition-link">iOS<small>(128)</small></a></li>
				    
				    <li><a href="/categories/å‰æ²¿æŠ€æœ¯/" class="animsition-link">å‰æ²¿æŠ€æœ¯<small>(5)</small></a></li>
				    
				    <li><a href="/categories/æ–‡ç« /" class="animsition-link">æ–‡ç« <small>(5)</small></a></li>
				    
				    <li><a href="/categories/è®¾è®¡/" class="animsition-link">è®¾è®¡<small>(4)</small></a></li>
				    
				</ul>
        	</li>
			
            
            <li>
                <a class="sb-toggle-submenu">Links<span class="sb-caret"></span></a>
                <ul class="sb-submenu">
                    
                    <li><a href="https://www.qtumist.com" class="animsition-link">é‡å­è®¡ç®—</a></li>
                    
                    <li><a href="https://blog.ibeats.top" class="animsition-link">CI_Knight</a></li>
                    
                </ul>
            </li>
            
        </ul>
        <!-- Lists in Slidebars -->
        <ul class="sb-menu secondary">
            <li><a href="/about.html" class="animsition-link" title="about">About</a></li>
            <li><a href="/atom.xml" class="animsition-link" title="rss">RSS</a></li>
        </ul>
    </div>
    
    <!-- ============================ END Off-canvas navigation =========================== -->

    <!-- ============================ #sb-site Main Page Wrapper =========================== -->

    <div id="sb-site">
        <!-- #sb-site - All page content should be contained within this id, except the off-canvas navigation itself -->

        <!-- ============================ Header & Logo bar =========================== -->

        <div id="navigation" class="navbar navbar-fixed-top">
            <div class="navbar-inner">
                <div class="container">
                    <!-- Nav logo -->
                    <div class="logo">
                        <a href="/" title="Logo" class="animsition-link">
                         <img src="/img/logo.png" alt="Logo" width="35px;"/> 
                        </a>
                    </div>
                    <!-- // Nav logo -->
                    <!-- Info-bar -->
                    <nav>
                        <ul class="nav">
                            <li><a href="/" class="animsition-link">Steven's Technology Blog</a></li>
                            <li class="nolink"><span>Always </span>Creative.</li>
                            
                            <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a></li>
                            
                            
                            <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a></li>
                            
                            
                            <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a></li>
                            
                            
                            <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a></li>
                            
                            
                            <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a></li>
                            
                            <li class="nolink"><span>Welcome!</span></li>
                        </ul>
                    </nav>
                    <!--// Info-bar -->
                </div>
                <!-- // .container -->
                <div class="learnmore sb-toggle-right">More</div>
                <button type="button" class="navbar-toggle menu-icon sb-toggle-right" title="More">
                <span class="sr-only">Toggle navigation</span>
                <span class="icon-bar before"></span>
                <span class="icon-bar main"></span>
                <span class="icon-bar after"></span>
                </button>
            </div>
            <!-- // .navbar-inner -->
        </div>

        <!-- ============================ Header & Logo bar =========================== -->


      
<section id="intro">
    <div class="container">
        <div class="row col-md-offset-2">
            <div class="col-md-8">
    			<span class="post-meta">
      <time datetime="2018-05-13T11:20:31.000Z" itemprop="datePublished">
          2018-05-13
      </time>
    
    
    | 
    <a href='/tags/åšå®¢ï¼Œæ–‡ç« /'>åšå®¢ï¼Œæ–‡ç« </a>
    
    
</span>
                <h1>Objective-C Principle - ReactNative</h1>
            </div>
        </div>
        <div class="col-md-8 col-md-offset-2">
      		<p>#OC åº•å±‚åŸç†æ€»ç»“ä¹‹ ReactNative é€šä¿¡</p>
<h2 id=""><a href="#" class="headerlink" title=""></a><a id="more"></a><!--more--></h2><p><img width="22" height="24" src="http://og1yl0w9z.bkt.clouddn.com/18-5-9/42814631.jpg">ï¼š<a href="https://github.com/ReverseScale/iOSPrinciple_ReactNative" target="_blank" rel="external">https://github.com/ReverseScale/iOSPrinciple_ReactNative</a></p>
<h3 id="åŸºæœ¬åŸç†"><a href="#åŸºæœ¬åŸç†" class="headerlink" title="åŸºæœ¬åŸç†"></a>åŸºæœ¬åŸç†</h3><p>é¦–å…ˆï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹åœ¨iOSä¸­Nativeå¦‚ä½•è°ƒç”¨JSã€‚ä»iOS7å¼€å§‹ï¼Œç³»ç»Ÿè¿›ä¸€æ­¥å¼€æ”¾äº†WebCore SDKï¼Œæä¾›JavaScriptå¼•æ“åº“ï¼Œä½¿å¾—æˆ‘ä»¬èƒ½å¤Ÿç›´æ¥ä¸å¼•æ“äº¤äº’æ‹¥æœ‰æ›´å¤šçš„æ§åˆ¶æƒã€‚å…¶ä¸­ï¼Œæœ‰ä¸¤ä¸ªæœ€åŸºç¡€çš„æ¦‚å¿µï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">JSContext <span class="comment">// JSä»£ç çš„ç¯å¢ƒï¼Œä¸€ä¸ªJSContextæ˜¯ä¸€ä¸ªå…¨å±€ç¯å¢ƒçš„å®ä¾‹</span></div><div class="line">JSValue <span class="comment">// åŒ…è£…äº†æ¯ä¸€ä¸ªå¯èƒ½çš„JSå€¼ï¼šå­—ç¬¦ä¸²ã€æ•°å­—ã€æ•°ç»„ã€å¯¹è±¡ã€æ–¹æ³•ç­‰</span></div></pre></td></tr></table></figure>
<p>é€šè¿‡è¿™ä¸¤ä¸ªç±»ï¼Œæˆ‘ä»¬èƒ½å¤Ÿéå¸¸æ–¹ä¾¿çš„å®ç°Javascriptä¸Nativeä»£ç ä¹‹é—´çš„äº¤äº’ï¼Œé¦–å…ˆæˆ‘ä»¬é€šè¿‡ä¸€ä¸ªç®€å•ç¤ºä¾‹æ¥è§‚å¯ŸNativeå¦‚ä½•è°ƒç”¨Javascriptä»£ç ï¼š</p>
<p>ğŸŒ°ï¼šNative -&gt; JavaScript</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å¤´æ–‡ä»¶</span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JSContext.h&gt;</span></span></div><div class="line"><span class="meta">#import <span class="meta-string">&lt;JavaScriptCore/JSValue.h&gt;</span></span></div><div class="line">- (<span class="keyword">void</span>)createJSContext &#123;</div><div class="line">    JSContext *context = [[JSContext alloc] init];</div><div class="line">    [context evaluateScript:<span class="string">@"var num = 5 + 5"</span>];</div><div class="line">    [context evaluateScript:<span class="string">@"var names = ['Grace', 'Ada', 'Margaret']"</span>];</div><div class="line">    [context evaluateScript:<span class="string">@"var triple = function(value) &#123; return value * 3 &#125;"</span>];</div><div class="line">    JSValue *tripleNum = [context evaluateScript:<span class="string">@"triple(num)"</span>];</div><div class="line">    JSValue *tripleFunction = context[<span class="string">@"triple"</span>];</div><div class="line">    JSValue *result = [tripleFunction callWithArguments:@[@<span class="number">5</span>]];</div><div class="line">    <span class="comment">// æ‰“å°ç»“æœ</span></div><div class="line">    <span class="built_in">NSLog</span>(<span class="string">@"JSContext function \ntripleNum:%@ \nresult:%@"</span>, tripleNum, result);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>é‚£ä¹ˆï¼ŒJSContextå¦‚ä½•è®¿é—®æˆ‘ä»¬æœ¬åœ°å®¢æˆ·ç«¯OCä»£ç å‘¢ï¼Ÿç­”æ¡ˆæ˜¯é€šè¿‡Blockså’ŒJSExportsåè®®ä¸¤ç§æ–¹å¼ã€‚<br>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªé€šè¿‡Blocksæ¥å®ç°JSè®¿é—®æœ¬åœ°ä»£ç çš„ç¤ºä¾‹ï¼š</p>
<p>ğŸŒ°ï¼šJavaScript -&gt; Native</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">context[<span class="string">@"testSay"</span>] = ^(<span class="built_in">NSString</span> *input) &#123;</div><div class="line">    <span class="built_in">NSMutableString</span> *mutableString = [input mutableCopy];</div><div class="line">    <span class="built_in">CFStringTransform</span>((__bridge <span class="built_in">CFMutableStringRef</span>)mutableString, <span class="literal">NULL</span>, kCFStringTransformToLatin, <span class="literal">NO</span>);</div><div class="line">    <span class="built_in">CFStringTransform</span>((__bridge <span class="built_in">CFMutableStringRef</span>)mutableString, <span class="literal">NULL</span>, kCFStringTransformStripCombiningMarks, <span class="literal">NO</span>);</div><div class="line">    <span class="keyword">return</span> mutableString;</div><div class="line">&#125;;</div><div class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [context evaluateScript:<span class="string">@"testSay('hello world')"</span>]);</div></pre></td></tr></table></figure>
<p>å…³äºJSCoreåº“çš„æ›´å¤šå­¦ä¹ ä»‹ç»ï¼Œè¯·çœ‹JavaScriptCoreã€‚</p>
<blockquote>
<p>Javaâ€‹Scriptâ€‹Core ç›¸å…³ä»‹ç» <a href="http://nshipster.cn/javascriptcore/" target="_blank" rel="external">http://nshipster.cn/javascriptcore/</a></p>
</blockquote>
<h3 id="React-Native-åˆå§‹åŒ–è¿‡ç¨‹è§£æ"><a href="#React-Native-åˆå§‹åŒ–è¿‡ç¨‹è§£æ" class="headerlink" title="React Native åˆå§‹åŒ–è¿‡ç¨‹è§£æ"></a>React Native åˆå§‹åŒ–è¿‡ç¨‹è§£æ</h3><p>åœ¨äº†è§£React-Nativeä¸­JS-&gt;Nativeçš„å…·ä½“è°ƒç”¨ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆåšä¸€äº›å‡†å¤‡å·¥ä½œï¼Œçœ‹çœ‹æ¡†æ¶ä¸­Native appçš„å¯åŠ¨è¿‡ç¨‹ã€‚æ‰“å¼€FBæä¾›çš„AwesomeProjectå®šä½åˆ°appDelegateçš„didFinishLaunchingWithOptionsæ–¹æ³•ä¸­ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// æŒ‡å®šJSé¡µé¢æ–‡ä»¶ä½ç½®</span></div><div class="line">jsCodeLocation = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://localhost:8081/index.ios.bundle?platform=ios&amp;dev=false"</span>];</div><div class="line"><span class="comment">// åˆ›å»ºReact Nativeè§†å›¾å¯¹è±¡</span></div><div class="line">RCTRootView *rootView = [[RCTRootView alloc] initWithBundleURL:jsCodeLocation</div><div class="line">moduleName:<span class="string">@"ReactExperiment"</span></div><div class="line">initialProperties:<span class="literal">nil</span></div><div class="line">launchOptions:launchOptions];</div><div class="line"><span class="keyword">self</span>.window = [[<span class="built_in">UIWindow</span> alloc] initWithFrame:[<span class="built_in">UIScreen</span> mainScreen].bounds];</div><div class="line"><span class="comment">// åˆ›å»ºVCï¼Œå¹¶ä¸”æŠŠReact Native Root Viewèµ‹å€¼ç»™VC</span></div><div class="line"><span class="built_in">UIViewController</span> *rootViewController = [<span class="built_in">UIViewController</span> new];</div><div class="line">rootViewController.view = rootView;</div><div class="line"><span class="keyword">self</span>.window.rootViewController = rootViewController;</div><div class="line">[<span class="keyword">self</span>.window makeKeyAndVisible];</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ä½¿ç”¨é›†æˆéå¸¸ç®€å•ï¼Œé‚£ä¹ˆRCTRootViewåˆ°åº•åšäº†å“ªäº›äº‹æƒ…æœ€åæ¸²æŸ“å°†è§†å›¾å‘ˆç°åœ¨ç”¨æˆ·é¢å‰å‘¢ï¼Ÿ<br>æˆ‘ä»¬ç»§ç»­è·Ÿç€ä»£ç å¾€ä¸‹åˆ†æå°±ä¼šçœ‹åˆ°æˆ‘ä»¬ä»Šå¤©çš„ä¸»è§’RCTBridgeã€‚</p>
<p>ğŸ¥Ÿï¼šRCTBridge</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">- (<span class="keyword">instancetype</span>)initWithBundleURL:(<span class="built_in">NSURL</span> *)bundleURL</div><div class="line">moduleName:(<span class="built_in">NSString</span> *)moduleName</div><div class="line">initialProperties:(<span class="built_in">NSDictionary</span> *)initialProperties</div><div class="line">launchOptions:(<span class="built_in">NSDictionary</span> *)launchOptions &#123;</div><div class="line">    RCTBridge *bridge = [[RCTBridge alloc] initWithBundleURL:bundleURL</div><div class="line">    moduleProvider:<span class="literal">nil</span></div><div class="line">    launchOptions:launchOptions];</div><div class="line">    <span class="keyword">return</span> [<span class="keyword">self</span> initWithBridge:bridge moduleName:moduleName initialProperties:initialProperties];</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>RCTBridgeæ˜¯Naitiveç«¯çš„bridgeï¼Œèµ·ç€æ¡¥æ¥ä¸¤ç«¯çš„ä½œç”¨ ã€‚äº‹å®ä¸Šå…·ä½“çš„å®ç°æ”¾ç½®åœ¨RCTBatchedBridgeä¸­ï¼Œåœ¨å®ƒçš„startæ–¹æ³•ä¸­æ‰§è¡Œäº†ä¸€ç³»åˆ—é‡è¦çš„åˆå§‹åŒ–å·¥ä½œã€‚è¿™éƒ¨åˆ†ä¹Ÿæ˜¯ReactNative SDKçš„ç²¾é«“æ‰€åœ¨ï¼ŒåŸºäºGCDå®ç°ä¸€å¥—å¼‚æ­¥åˆå§‹åŒ–ç»„ä»¶æ¡†æ¶ã€‚å¤§è‡´çš„å·¥ä½œæµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/18-5-11/60547481.jpg" alt=""></p>
<h4 id="1-Load-JS-Source-Codeï¼ˆå¹¶è¡Œï¼‰"><a href="#1-Load-JS-Source-Codeï¼ˆå¹¶è¡Œï¼‰" class="headerlink" title="1.Load JS Source Codeï¼ˆå¹¶è¡Œï¼‰"></a>1.Load JS Source Codeï¼ˆå¹¶è¡Œï¼‰</h4><p>åŠ è½½é¡µé¢æºç é˜¶æ®µã€‚è¯¥é˜¶æ®µä¸»è¦è´Ÿè´£ä»æŒ‡å®šçš„ä½ç½®ï¼ˆç½‘ç»œæˆ–è€…æœ¬åœ°ï¼‰åŠ è½½React Nativeé¡µé¢ä»£ç ã€‚ä¸initModuleså„æ¨¡å—åˆå§‹åŒ–è¿‡ç¨‹å¹¶è¡Œæ‰§è¡Œï¼Œé€šè¿‡GCDåˆ†ç»„é˜Ÿåˆ—ä¿è¯ä¸¤ä¸ªé˜¶æ®µå®Œæˆåæ‰ä¼šåŠ è½½è§£æé¡µé¢æºç ã€‚</p>
<h4 id="2-Init-Moduleï¼ˆåŒæ­¥ï¼‰"><a href="#2-Init-Moduleï¼ˆåŒæ­¥ï¼‰" class="headerlink" title="2.Init Moduleï¼ˆåŒæ­¥ï¼‰"></a>2.Init Moduleï¼ˆåŒæ­¥ï¼‰</h4><p>åˆå§‹åŒ–åŠ è½½React Nativeæ¨¡å—ã€‚è¯¥é˜¶æ®µä¼šå°†æ‰€æœ‰æ³¨å†Œçš„Nativeæ¨¡å—ç±»æ•´ç†ä¿å­˜åˆ°ä¸€ä¸ªä»¥Module Idä¸ºä¸‹æ ‡çš„æ•°ç»„å¯¹è±¡ä¸­ï¼ˆåŒæ—¶è¿˜ä¼šä¿å­˜ä¸€ä¸ªä»¥Module Nameä¸ºKeyçš„Dictionaryï¼Œç”¨äºåšç´¢å¼•æ–¹ä¾¿åç»­çš„æ¨¡å—æŸ¥æ‰¾ï¼‰ã€‚</p>
<p>æ•´ä¸ªæ¨¡å—çš„åŸºç¡€åˆå§‹åŒ–å’Œæ³¨å†Œè¿‡ç¨‹åœ¨ç³»ç»ŸLoad Classé˜¶æ®µå°±ä¼šå®Œæˆã€‚React Nativeå¯¹æ¨¡å—æ³¨å†Œçš„å®ç°è¿˜æ˜¯æ¯”è¾ƒå·§å¦™ã€æ–¹ä¾¿ï¼Œåªéœ€è¦å¯¹ç›®æ ‡ç±»æ·»åŠ ç›¸åº”çš„å®å³å¯ã€‚</p>
<ul>
<li>1.æ³¨å†Œæ¨¡å—ã€‚å®ç°RCTBridgeModuleåè®®ï¼Œå¹¶ä¸”åœ¨å“åº”çš„Implementionæ–‡ä»¶ä¸­æ·»åŠ RCT_EXPORT_MODULEå®ï¼Œè¯¥å®ä¼šä¸ºæ‰€åœ¨ç±»è‡ªåŠ¨æ·»åŠ ä¸€ä¸ª+loadæ–¹æ³•ï¼Œè°ƒç”¨RCTBridgeçš„RCTRegisterModuleå®ç°åœ¨Load Classé˜¶æ®µå°±å®Œæˆæ¨¡å—æ³¨å†Œå·¥ä½œã€‚</li>
<li>2.æ³¨å†Œå‡½æ•°ã€‚å¾…æ³¨å†Œå‡½æ•°æ‰€åœ¨çš„ç±»å¿…é¡»æ˜¯å·²æ³¨å†Œæ¨¡å—ï¼Œåœ¨éœ€è¦æ³¨å†Œçš„å‡½æ•°å‰æ·»åŠ RCT_EXPORT_MODULEå®å³å¯ã€‚</li>
</ul>
<p>å½“ç„¶è¿™é‡Œéœ€è¦æ³¨æ„çš„é—®é¢˜æ˜¯æ¨¡å—åˆå§‹åŒ–æ˜¯ä¸€ä¸ªåŒæ­¥ä»»åŠ¡ï¼Œå®ƒå¿…é¡»è¢«åŒæ­¥åŠ è½½ï¼Œæ‰€ä»¥å½“æ¨¡å—è¾ƒå¤šæ—¶åŠ¿å¿…ä¼šå¸¦æ¥é«˜å»¶è¿Ÿçš„é—®é¢˜ï¼Œä¹Ÿæ˜¯åœ¨æ–°çš„ç‰ˆæœ¬ä¸­SDKå°†Module Methodæ”¹ä¸ºLazy Loadçš„åŸå› ä¹‹ä¸€ã€‚</p>
<h4 id="3-Setup-JS-Executorï¼ˆå¹¶è¡Œï¼‰"><a href="#3-Setup-JS-Executorï¼ˆå¹¶è¡Œï¼‰" class="headerlink" title="3.Setup JS Executorï¼ˆå¹¶è¡Œï¼‰"></a>3.Setup JS Executorï¼ˆå¹¶è¡Œï¼‰</h4><p>åˆå§‹åŒ–JSå¼•æ“ã€‚React Nativeåœ¨0.18ä¸­å·²ç»å¾ˆå¥½çš„æŠ½è±¡äº†åŸæ¥äº†JSExecutorï¼Œç›®å‰å®ç°äº†RCTWebSocketExecutorå’ŒRCTJSCExecutorä¸¤ä¸ªè„šæœ¬å¼•æ“çš„å°è£…ï¼Œå‰è€…ç”¨äºé€šè¿‡WebSocketé“¾æ¥åˆ°Chromeè°ƒè¯•ï¼Œåè€…åˆ™æ˜¯å†…ç½®é»˜è®¤å¼•æ“ç›´æ¥é€šè¿‡IOS SDK JSContextæ¥å®ç°ç›¸å…³çš„é€»è¾‘ã€‚</p>
<p>å¦å¤–ï¼Œåœ¨æœ¬é˜¶æ®µè¿˜ä¼šé€šè¿‡block hookçš„æ–¹å¼æ³¨å†Œéƒ¨åˆ†æ ¸å¿ƒAPI</p>
<ul>
<li>1.nativeRequireModuleConfigï¼šç”¨äºåœ¨JSç«¯è·å–å¯¹åº”çš„Native Moduleï¼Œåœ¨0.14åçš„ç‰ˆæœ¬React Nativeå·²ç»å¯¹åˆå§‹åŒ–æ¨¡å—åšäº†éƒ¨åˆ†ä¼˜åŒ–ï¼ŒæŠŠå…³äºNative Module Methodéƒ¨åˆ†çš„åŠ è½½å·¥ä½œæ”¾ç½®åœ¨requireModuleConfigæ—¶æ‰åš</li>
<li>2.nativeLoggingHookï¼šè°ƒç”¨Nativeå†™å…¥æ—¥å¿—</li>
<li>3.nativeFlushQueueImmediateï¼šæ‰‹åŠ¨è§¦å‘æ‰§è¡Œå½“å‰Native Callé˜Ÿåˆ—ä¸­æ‰€æœ‰çš„Nativeå¤„ç†è¯·æ±‚</li>
<li>4.nativePerformanceNowï¼šç”¨äºæ€§èƒ½ç»Ÿè®¡ï¼Œè·å–å½“å‰Nativeçš„ç»å¯¹æ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</li>
</ul>
<p>å¯¹äºæ¨¡å—ç±»ä¸­æƒ³è¦å£°æ˜çš„æ–¹æ³•ï¼Œéœ€è¦æ·»åŠ RCT_EXPORT_METHODå®ã€‚å®ƒä¼šç»™æ–¹æ³•åæ·»åŠ â€ rct_export â€œå‰ç¼€ã€‚</p>
<p>ğŸŒ°ï¼šReact è°ƒç”¨ Native çš„ SVProgressHUD æç¤ºçª—</p>
<p>åœ¨ Native ä¸­å£°æ˜æ–¹æ³•<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">RCT_EXPORT_METHOD(calliOSActionWithOneParams:(<span class="built_in">NSString</span> *)name) &#123;</div><div class="line">    [SVProgressHUD setDefaultMaskType:SVProgressHUDMaskTypeBlack];</div><div class="line">    [SVProgressHUD showSuccessWithStatus:[<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"å‚æ•°ï¼š%@"</span>,name]];</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>åœ¨ React ä¸­è°ƒç”¨ calliOSActionWithOneParams æ–¹æ³•<br><figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">&lt;TouchableOpacity style=&#123;styles.calltonative&#125;</div><div class="line">    onPress=&#123;()=&gt;&#123;</div><div class="line">        RNCalliOSAction.calliOSActionWithOneParams(<span class="string">'hello'</span>);</div><div class="line">    &#125;&#125;&gt;</div><div class="line">    <span class="xml"><span class="tag">&lt;<span class="name">Text</span>&gt;</span>ç‚¹å‡»è°ƒç”¨ Native æ–¹æ³•, å¹¶ä¼ é€’ä¸€ä¸ªå‚æ•°<span class="tag">&lt;/<span class="name">Text</span>&gt;</span></span></div><div class="line">&lt;<span class="regexp">/TouchableOpacity&gt;</span></div></pre></td></tr></table></figure></p>
<h4 id="4-Module-Configï¼ˆå¹¶è¡Œï¼‰"><a href="#4-Module-Configï¼ˆå¹¶è¡Œï¼‰" class="headerlink" title="4.Module Configï¼ˆå¹¶è¡Œï¼‰"></a>4.Module Configï¼ˆå¹¶è¡Œï¼‰</h4><p>è¿™æ­¥å°†ç¬¬2æ­¥ä¸­çš„Nativeæ¨¡å—ç±»è½¬æ¢æˆJsonï¼Œä¿å­˜ä¸ºremoteModuleConfigã€‚æ³¨æ„åœ¨è¿™é‡Œè·å–åˆ°çš„åˆ—è¡¨å¹¶éå«æœ‰å®Œæ•´æ¨¡å—ä¿¡æ¯ï¼Œè€Œä»…ä»…æ˜¯ä¸€ä¸ªModule Listè€Œå·²ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">&#123;</div><div class="line"><span class="string">"remoteModuleConfig"</span>:[</div><div class="line">[</div><div class="line"><span class="string">"HTSimpleAPI"</span>, <span class="comment">// module</span></div><div class="line">],</div><div class="line">[</div><div class="line"><span class="string">"RCTViewManager"</span>,</div><div class="line">],</div><div class="line">[</div><div class="line"><span class="string">"HTTestView"</span>,</div><div class="line">],</div><div class="line">[</div><div class="line"><span class="string">"RCTAccessibilityManager"</span>,</div><div class="line">],</div><div class="line">...</div><div class="line">],</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<h4 id="JS-Source-Codeä»£ç åˆ†æ"><a href="#JS-Source-Codeä»£ç åˆ†æ" class="headerlink" title="JS Source Codeä»£ç åˆ†æ"></a>JS Source Codeä»£ç åˆ†æ</h4><p>JSçš„ä¸»å…¥å£index.ios.jsåœ¨æˆ‘ä»¬çœ‹æ¥åªæœ‰çŸ­çŸ­æ•°åè¡Œï¼Œç„¶è€Œè¿™ä¸æ˜¯æœ€ç»ˆæ‰§è¡Œçš„ä»£ç ã€‚React-Nativeé¡µé¢æºç éœ€è¦é€šè¿‡Transform Serverè½¬æ¢å¤„ç†ï¼Œå¹¶æŠŠè½¬åŒ–åçš„æ¨¡å—ä¸€èµ·åˆå¹¶ä¸ºä¸€ä¸ªbundle.jsï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºbuildBundleã€‚è½¬æ¢åçš„index.ios.bundleæ‰æ˜¯æœ€ç»ˆå¯è¢«Javascriptå¼•æ“ç›´æ¥è§£é‡Šè¿è¡Œçš„ä»£ç ã€‚ä¸‹é¢æˆ‘ä»¬æŒ‰ç…§ä¸»ç¨‹åºçš„é€»è¾‘æ¥åˆ†ææºç å‡ ä¸ªæ ¸å¿ƒæ¨¡å—å®ç°åŸç†ã€‚</p>
<p>åœ¨React Serverä¸­éœ€è¦æŸ¥çœ‹Bundleçš„æ¨¡å—æ˜ å°„å…³ç³»å¯ä»¥ç›´æ¥è®¿é—®ï¼š<a href="http://localhost:8081/index.ios.bundle.mapï¼ŒæŸ¥çœ‹ç›¸å…³ä¾èµ–å’ŒBundleçš„ç¼“å­˜åˆ™å¯ä»¥è®¿é—®ï¼š" target="_blank" rel="external">http://localhost:8081/index.ios.bundle.mapï¼ŒæŸ¥çœ‹ç›¸å…³ä¾èµ–å’ŒBundleçš„ç¼“å­˜åˆ™å¯ä»¥è®¿é—®ï¼š</a> <a href="http://localhost:8081/debug" target="_blank" rel="external">http://localhost:8081/debug</a></p>
<p>1.BatchedBridge</p>
<p>åœ¨ä¸Šä¸€éƒ¨åˆ†æˆ‘ä»¬çŸ¥é“ï¼ŒNativeå®Œæˆæ¨¡å—åˆå§‹åŒ–åä¼šé€šè¿‡Inject Json Configå°†é…ç½®ä¿¡æ¯åŒæ­¥è‡³JSé‡Œä¸­çš„å…¨å±€å˜é‡__fbBatchedBridgeConfigï¼Œæ‰“å¼€BatchedBridge.jsæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¦‚ä¸‹ä»£ç ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">__d(<span class="string">'BatchedBridge'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">global, require, module, exports</span>) </span>&#123; <span class="string">'use strict'</span>;</div><div class="line"><span class="keyword">var</span> MessageQueue=<span class="built_in">require</span>(<span class="string">'MessageQueue'</span>);</div><div class="line"><span class="keyword">var</span> BatchedBridge=<span class="keyword">new</span> MessageQueue(</div><div class="line">__fbBatchedBridgeConfig.remoteModuleConfig,</div><div class="line">__fbBatchedBridgeConfig.localModulesConfig);</div><div class="line"><span class="comment">//......</span></div><div class="line"><span class="built_in">Object</span>.defineProperty(global,<span class="string">'__fbBatchedBridge'</span>,&#123;<span class="attr">value</span>:BatchedBridge&#125;);</div><div class="line"><span class="built_in">module</span>.exports = BatchedBridge;</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>å¯¹äºè¿™æ®µä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥å¾—å‡ºä»¥ä¸‹å‡ ä¸ªç»“è®ºï¼š</p>
<ul>
<li>1.åœ¨JSç«¯ä¹Ÿå­˜åœ¨ä¸€ä¸ªbridgeæ¨¡å—BatchedBridgeï¼Œä¹Ÿæ˜¯ä¸Nativeå»ºç«‹åŒå‘é€šä¿¡çš„å…³é”®æ‰€åœ¨</li>
<li>2.BatchedBridgeæ˜¯ä¸€ä¸ªMessageQueueå®ä¾‹ï¼Œå®ƒåœ¨åˆ›å»ºæ—¶ä¼ å…¥äº†__fbBatchedBridgeConfigå€¼ä¿å­˜Nativeç«¯æ”¯æŒçš„æ¨¡å—åˆ—è¡¨é…ç½®</li>
</ul>
<p>BatchedBridgeåœ¨åˆ›å»ºæ—¶å°†è‡ªå·±å†™å…¥å…¨å±€å˜é‡<strong>fbBatchedBridgeä¸Šï¼Œè¿™æ ·Nativeå¯ä»¥é€šè¿‡JSContext[@â€</strong>fbBatchedBridgeâ€]è®¿é—®åˆ°JS bridgeå¯¹è±¡ã€‚</p>
<p>2.MessageQueue</p>
<p>æ¥ç€æˆ‘ä»¬ç»§ç»­çœ‹MessageQueueï¼Œå®ƒåœ¨æ•´ä¸ªé€šè®¯é“¾è·¯çš„æœºåˆ¶ä¸Šé¢æœ‰ç€é‡è¦ä½œç”¨ï¼Œé¦–å…ˆæˆ‘ä»¬æ¥è§‚å¯Ÿä¸€ä¸‹å®ƒçš„æ„é€ å‡½æ•°ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">constructor</span>(remoteModules, localModules) &#123;</div><div class="line"><span class="keyword">this</span>.RemoteModules = &#123;&#125;;</div><div class="line"><span class="keyword">this</span>._callableModules = &#123;&#125;;</div><div class="line"><span class="keyword">this</span>._queue = [[], [], [], <span class="number">0</span>];</div><div class="line"><span class="keyword">this</span>._moduleTable = &#123;&#125;;</div><div class="line"><span class="keyword">this</span>._methodTable = &#123;&#125;;</div><div class="line"><span class="keyword">this</span>._callbacks = [];</div><div class="line"><span class="keyword">this</span>._callbackID = <span class="number">0</span>;</div><div class="line"><span class="keyword">this</span>._callID = <span class="number">0</span>;</div><div class="line"><span class="comment">//......</span></div><div class="line"><span class="keyword">let</span> modulesConfig = <span class="keyword">this</span>._genModulesConfig(remoteModules);</div><div class="line"><span class="keyword">this</span>._genModules(modulesConfig);</div><div class="line"><span class="comment">//......</span></div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>ä»æ„é€ å‡½æ•°ï¼Œæˆ‘ä»¬å¤§è‡´èƒ½äº†è§£MessageQueueçš„å‡ ä¸ªä¿¡æ¯ï¼š</p>
<ul>
<li>1.RemoteModuleså±æ€§ï¼Œç”¨äºä¿å­˜Nativeç«¯æ¨¡å—é…ç½®</li>
<li>2.Callbackså±æ€§ç¼“å­˜jsçš„å›è°ƒæ–¹æ³•</li>
<li>3.Queueäº‹ä»¶é˜Ÿåˆ—ç”¨äºå¤„ç†å„ç±»äº‹ä»¶ç­‰</li>
</ul>
<p>åœ¨æ„é€ å‡½æ•°ä¸­ï¼Œè§£æNativeä¼ å…¥çš„remoteModules JSONï¼Œè½¬æ¢æˆJSå¯¹è±¡</p>
<p>3.Config Modules</p>
<p>æ ¹æ®ä¸Šä¸€æ­¥MessageQueueçš„é€»è¾‘ï¼Œç»§ç»­å¾€ä¸‹è·Ÿè¸ª_genModuleså‡½æ•°ï¼Œå¯ä»¥çœ‹åˆ°åœ¨MessageQueueå·²ç»å¯¹Nativeæ³¨å…¥çš„Module Configåšäº†ä¸€æ¬¡é¢„å¤„ç†ï¼Œå¦‚æœdebugæ¨¡å¼å¯ä»¥çœ‹åˆ°å¤§è‡´çš„æ•°æ®ç»“æ„ä¼šè½¬æ¢æˆå¦‚ä¸‹è¡¨ä¸­æ‰€ç¤ºç»“æ„ï¼ˆå…¶ä¸­HTSimepleAPIæ˜¯ä¸€ä¸ªè‡ªå®šä¹‰æ¨¡å—ï¼‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">config = [<span class="string">"HTSimpleAPI"</span>, <span class="built_in">Array</span>[<span class="number">1</span>]], moduleID = <span class="number">0</span></div><div class="line">config = <span class="literal">null</span>, moduleID = <span class="number">1</span></div><div class="line">config = <span class="literal">null</span>, moduleID = <span class="number">2</span></div><div class="line">config = [<span class="string">"RCTAccessibilityManager"</span>, <span class="built_in">Array</span>[<span class="number">3</span>]], moduleID = <span class="number">3</span></div></pre></td></tr></table></figure>
<p>è‡³äºè¿™æ ·çš„é¢„å¤„ç†æœ‰ä»€ä¹ˆä½œç”¨ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹åˆ†æï¼Œåé¢å†æ¥æ€»ç»“ã€‚</p>
<p>4.Lazily Config Methods</p>
<p>å¯¹äºNativeModuleï¼Œå®ƒä»¬åœ¨ä¸Šä¸€æ­¥ä¹‹ååªæœ‰ä¸€ä¸ªåŒ…å«Module Nameç­‰ç®€å•ä¿¡æ¯çš„Module Listçš„å¯¹è±¡ï¼Œåªæœ‰åœ¨å®é™…è°ƒç”¨äº†è¯¥æ¨¡å—ä¹‹åæ‰ä¼šåŠ è½½è¯¥æ¨¡å—çš„å…·ä½“ä¿¡æ¯ï¼ˆæ¯”å¦‚æš´éœ²çš„APIç­‰ï¼‰ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"><span class="keyword">const</span> NativeModules = &#123;&#125;;</div><div class="line"><span class="built_in">Object</span>.keys(RemoteModules).forEach(<span class="function">(<span class="params">moduleName</span>) =&gt;</span> &#123;</div><div class="line"><span class="built_in">Object</span>.defineProperty(NativeModules, moduleName, &#123;</div><div class="line"><span class="attr">enumerable</span>: <span class="literal">true</span>,</div><div class="line"><span class="attr">get</span>: <span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line"><span class="keyword">let</span> <span class="built_in">module</span> = RemoteModules[moduleName];</div><div class="line"><span class="keyword">if</span> (<span class="built_in">module</span> &amp;&amp; <span class="keyword">typeof</span> <span class="built_in">module</span>.moduleID === <span class="string">'number'</span> &amp;&amp; global.nativeRequireModuleConfig) &#123;</div><div class="line"><span class="keyword">const</span> json = global.nativeRequireModuleConfig(moduleName);</div><div class="line"><span class="keyword">const</span> config = json &amp;&amp; <span class="built_in">JSON</span>.parse(json);</div><div class="line"><span class="built_in">module</span> = config &amp;&amp; BatchedBridge.processModuleConfig(config, <span class="built_in">module</span>.moduleID);</div><div class="line">RemoteModules[moduleName] = <span class="built_in">module</span>;</div><div class="line">&#125;</div><div class="line"><span class="keyword">return</span> <span class="built_in">module</span>;</div><div class="line">&#125;,</div><div class="line">&#125;);</div><div class="line">&#125;);</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç å®šä¹‰äº†ä¸€ä¸ªå…¨å±€æ¨¡å—NativeModulesï¼Œéå†ä¹‹å‰å–åˆ°çš„remoteModulesï¼Œå°†æ¯ä¸€ä¸ªmoduleåœ¨NativeModuleså¯¹è±¡ä¸Šæ‰©å±•äº†ä¸€ä¸ªgetteræ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¸­é€šè¿‡nativeRequireModuleConfigè¿›ä¸€æ­¥åŠ è½½æ¨¡å—çš„è¯¦ç»†ä¿¡æ¯ï¼Œé€šè¿‡processModuleConfigå¯¹æ¨¡å—ä¿¡æ¯è¿›è¡Œé¢„å¤„ç†ã€‚è¿›ä¸€æ­¥åˆ†æä»£ç å°±å¯ä»¥å‘ç°è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯Nativeä¸­å®šä¹‰çš„å…¨å±€JS Blockï¼ˆnativeRequireModuleConfigï¼‰ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­çœ‹processModuleConfigä¸­å…·ä½“çš„ä»£ç é€»è¾‘ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">processModuleConfig(config, moduleID) &#123;</div><div class="line">    <span class="keyword">const</span> <span class="built_in">module</span> = <span class="keyword">this</span>._genModule(config, moduleID);</div><div class="line">    <span class="keyword">return</span> <span class="built_in">module</span>;</div><div class="line">&#125;</div><div class="line">_genMethod(<span class="built_in">module</span>, method, type) &#123;</div><div class="line"><span class="comment">//......</span></div><div class="line">    fn = <span class="function"><span class="keyword">function</span>(<span class="params">...args</span>) </span>&#123;</div><div class="line">    <span class="keyword">return</span> self.__nativeCall(<span class="built_in">module</span>, method, args, onFail, onSucc);</div><div class="line">&#125;;</div><div class="line"><span class="comment">//......</span></div><div class="line"><span class="keyword">return</span> fn;</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>processModuleConfigæ–¹æ³•çš„ä¸»è¦å·¥ä½œæ˜¯ç”Ÿæˆmethodsé…ç½®ï¼Œå¹¶å¯¹æ¯ä¸€ä¸ªmethodå°è£…äº†ä¸€ä¸ªé—­åŒ…fnï¼Œå½“è°ƒç”¨methodæ—¶ï¼Œä¼šè½¬æ¢æˆæˆè°ƒç”¨self.__nativeCall(moduleID, methodID, args, onFail, onSucc)æ–¹æ³•</p>
<p>é¢„å¤„ç†å®Œæˆåï¼Œåœ¨JavaScriptç¯å¢ƒä¸­çš„Moudle Configä¿¡æ¯æ‰ç®—å®Œæ•´ï¼ŒåŒ…å«Module Nameã€Native Methodç­‰ä¿¡æ¯ï¼Œå…·ä½“ä¿¡æ¯å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">config = [<span class="string">"HTSimpleAPI"</span>, <span class="built_in">Array</span>[<span class="number">1</span>]], moduleID = <span class="number">0</span></div><div class="line">methodName = <span class="string">"test"</span>, methodID = <span class="number">0</span></div><div class="line">config = <span class="literal">null</span>, moduleID = <span class="number">1</span></div><div class="line">config = <span class="literal">null</span>, moduleID = <span class="number">2</span></div><div class="line">config = [<span class="string">"RCTAccessibilityManager"</span>, <span class="built_in">Array</span>[<span class="number">3</span>]], moduleID = <span class="number">3</span></div><div class="line">methodName = <span class="string">"setAccessibilityContentSizeMultipliers"</span>, methodID = <span class="number">0</span></div><div class="line">methodName = <span class="string">"getMultiplier"</span>, methodID = <span class="number">1</span></div><div class="line">methodName = <span class="string">"getCurrentVoiceOverState"</span>, methodID = <span class="number">2</span></div></pre></td></tr></table></figure>
<p>è¿˜è®°å¾—ç¬¬äºŒéƒ¨åˆ†ç¬¬5æ­¥ä¸­Nativeç«¯ç”Ÿæˆçš„æ¨¡å—é…ç½®è¡¨å—ï¼Ÿç»“åˆå®ƒçš„ç»“æ„ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥ï¼šå¯¹äºModule&amp;Methodï¼Œåœ¨Nativeå’ŒJSç«¯éƒ½ä»¥æ•°ç»„çš„å½¢å¼å­˜æ”¾ï¼Œæ•°ç»„ä¸‹æ ‡å³ä¸ºå®ƒä»¬çš„ModuleIDå’ŒMethodIDã€‚</p>
<p>5.__nativeCall</p>
<p>åˆ†æå®ŒBridgeéƒ¨åˆ†çš„æ˜ å°„å…³ç³»ä»¥åŠæ¨¡å—åŠ è½½ï¼Œé‚£ä¹ˆæˆ‘ä»¬å†æ¥çœ‹çœ‹æœ€ç»ˆè°ƒç”¨Nativeä»£ç æ˜¯å¦‚ä½•å®ç°çš„ã€‚å½“JSè°ƒç”¨module.methodæ—¶ï¼Œå…¶å®è°ƒç”¨äº†self.<strong>nativeCall(module, method, args, onFail, onSucc)ï¼Œå¯¹äº</strong>nativeCallæ–¹æ³•ï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">__nativeCall(<span class="built_in">module</span>, method, params, onFail, onSucc) &#123;</div><div class="line">    <span class="keyword">if</span> (onFail || onSucc) &#123;</div><div class="line">    ......</div><div class="line">    onFail &amp;&amp; params.push(<span class="keyword">this</span>._callbackID);</div><div class="line">    <span class="keyword">this</span>._callbacks[<span class="keyword">this</span>._callbackID++] = onFail;</div><div class="line">    onSucc &amp;&amp; params.push(<span class="keyword">this</span>._callbackID);</div><div class="line">    <span class="keyword">this</span>._callbacks[<span class="keyword">this</span>._callbackID++] = onSucc;</div><div class="line">    &#125;</div><div class="line"><span class="keyword">this</span>._queue[MODULE_IDS].push(<span class="built_in">module</span>);</div><div class="line"><span class="keyword">this</span>._queue[METHOD_IDS].push(method);</div><div class="line"><span class="keyword">this</span>._queue[PARAMS].push(params);</div><div class="line">global.nativeFlushQueueImmediate(<span class="keyword">this</span>._queue);</div><div class="line">......</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç ä¸ºæ¯ä¸ªmethodåˆ›å»ºäº†ä¸€ä¸ªé—­åŒ…fnï¼Œåœ¨__nativeCallæ–¹æ³•ä¸­ï¼Œå¹¶ä¸”åœ¨è¿™é‡Œåšäº†ä¸¤ä»¶é‡è¦çš„å·¥ä½œï¼š</p>
<ul>
<li>1.æŠŠonFailå’ŒonSuccç¼“å­˜åˆ°_callbacksä¸­ï¼ŒåŒæ—¶æŠŠcallbackIDæ·»åŠ åˆ°params</li>
<li>2.æŠŠmoduleID, methodID, paramsæ”¾å…¥é˜Ÿåˆ—ä¸­ï¼Œå›è°ƒNativeä»£ç .</li>
</ul>
<p>__nativeCallå¦‚ä½•åšåˆ°å›è°ƒNativeä»£ç å‘¢ï¼Ÿçœ‹ç¬¬äºŒéƒ¨åˆ†ç¬¬3æ­¥ï¼Œåœ¨åˆå§‹åŒ–JSå¼•æ“JSExecutor Setupæ—¶ï¼ŒNativeç«¯æ³¨å†Œä¸€ä¸ªå…¨å±€blockå›è°ƒnativeFlushedQueueImmediateï¼ŒnativeCallåœ¨å¤„ç†å®Œæ¯•åï¼Œé€šè¿‡è¯¥å›è°ƒæŠŠé˜Ÿåˆ—ä½œä¸ºè¿”å›å€¼ä¼ ç»™Nativeã€‚nativeFlushedQueueImmediateçš„å®ç°å¦‚ä¸‹æ‰€ç¤ºã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">[self addSynchronousHookWithName:@<span class="string">"nativeFlushQueueImmediate"</span> usingBlock:^(NSArray *calls)&#123;</div><div class="line">RCTJSCExecutor *strongSelf = weakSelf;</div><div class="line">    <span class="keyword">if</span> (!strongSelf.valid || !calls) &#123;</div><div class="line">        <span class="keyword">return</span>;</div><div class="line">    &#125;</div><div class="line">[strongSelf-&gt;_bridge handleBuffer:calls batchEnded:NO];</div><div class="line">&#125;];</div></pre></td></tr></table></figure>
<p>è¿™é‡Œçš„handleBufferå°±æ˜¯Nativeç«¯è§£æJSçš„æ¨¡å—è°ƒç”¨æœ€åé€šè¿‡NSInvocationæœºåˆ¶è°ƒç”¨Nativeä»£ç å¯¹åº”çš„é€»è¾‘ã€‚æœ‰å…´è¶£çš„æœ‹å‹ç»§ç»­è·Ÿè¸ªhandleBufferä»£ç ä¼šå‘ç°ï¼Œä»–çš„å®ç°å’ŒReactåœ¨JSç«¯å®šä¹‰çš„MessageQueueæœ‰æƒŠäººçš„ç›¸ä¼¼ä¹‹å¤„ã€‚</p>
<p>6.Call JS function &amp; Callbacks</p>
<p>æœ€åï¼Œæˆ‘ä»¬å›è¿‡å¤´æ¥çœ‹çœ‹Nativeç«¯æ˜¯å¦‚ä½•è°ƒç”¨JSç«¯çš„ç›¸å…³é€»è¾‘çš„ï¼Œè¿™éƒ¨åˆ†æˆ‘ä»¬éœ€è¦å›åˆ°MessageQueue.jsä»£ç ä¸­æ¥ï¼Œå¯ä»¥çœ‹åˆ°MessageQueueæš´éœ²äº†3ä¸ªæ ¸å¿ƒæ–¹æ³•ï¼šâ€™invokeCallbackAndReturnFlushedQueueâ€™ã€â€™callFunctionReturnFlushedQueueâ€™ã€â€™flushedQueueâ€™ã€‚</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"><span class="comment">// å°†APIæš´éœ²åˆ°å…¨å±€ä½œç”¨åŸŸä¸­</span></div><div class="line">[</div><div class="line"><span class="string">'invokeCallbackAndReturnFlushedQueue'</span>,</div><div class="line"><span class="string">'callFunctionReturnFlushedQueue'</span>,</div><div class="line"><span class="string">'flushedQueue'</span>,</div><div class="line">].forEach(<span class="function">(<span class="params">fn</span>) =&gt;</span> <span class="keyword">this</span>[fn] = <span class="keyword">this</span>[fn].bind(<span class="keyword">this</span>));</div><div class="line">â€¦</div><div class="line"><span class="comment">// å£°æ˜å¸¦æœ‰è¿”å›å€¼çš„å‡½æ•°</span></div><div class="line">callFunctionReturnFlushedQueue(<span class="built_in">module</span>, method, args) &#123;</div><div class="line">guard(<span class="function"><span class="params">()</span> =&gt;</span> &#123;C</div><div class="line"><span class="keyword">this</span>.__callFunction(<span class="built_in">module</span>, method, args);</div><div class="line"><span class="keyword">this</span>.__callImmediates();</div><div class="line">&#125;);</div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.flushedQueue();</div><div class="line">&#125;</div><div class="line"><span class="comment">// å£°æ˜å¸¦æœ‰Callbackçš„å‡½æ•°</span></div><div class="line">invokeCallbackAndReturnFlushedQueue(cbID, args) &#123;</div><div class="line">guard(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</div><div class="line"><span class="keyword">this</span>.__invokeCallback(cbID, args);</div><div class="line"><span class="keyword">this</span>.__callImmediates();</div><div class="line">&#125;);</div><div class="line"><span class="keyword">return</span> <span class="keyword">this</span>.flushedQueue();</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>callFunctionReturnFlushedQueueç”¨äºå®ç°Nativeè°ƒç”¨å¸¦æœ‰è¿”å›å€¼çš„JSç«¯å‡½æ•°ï¼ˆè¿™é‡Œçš„è¿”å›å€¼ä¹Ÿæ˜¯é€šè¿‡Queueæ¥æ¨¡æ‹Ÿï¼‰ï¼›<br>invokeCallbackAndReturnFlushedQueueç”¨äºå®ç°Nativeè°ƒç”¨å¸¦æœ‰Callçš„JSç«¯å‡½æ•°ï¼ˆå¯ä»¥å°†Nativeçš„Callbackä½œä¸ºJSç«¯å‡½æ•°çš„å…¥å‚ï¼ŒJSç«¯æ‰§è¡Œå®Œåè°ƒç”¨Nativeçš„Callbackï¼‰ã€‚</p>
<p>å¯¹äºcallFunctionReturnFlushedQueueæ–¹æ³•ï¼Œå®ƒæœ€ç»ˆè°ƒç”¨çš„æ˜¯__callFunctionï¼š</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">__callFunction(<span class="built_in">module</span>, method, args) &#123;</div><div class="line">......</div><div class="line">var moduleMethods = <span class="keyword">this</span>._callableModules[<span class="built_in">module</span>];</div><div class="line">......</div><div class="line">moduleMethods[method].apply(moduleMethods, args);</div><div class="line">&#125;</div></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°ï¼Œæ­¤å¤„ä¼šæ ¹æ®Nativeä¼ å…¥çš„module, methodï¼Œè°ƒç”¨JSç«¯ç›¸åº”çš„æ¨¡å—å¹¶ä¼ å…¥å‚æ•°åˆ—è¡¨args.<br>åŒæ—¶æˆ‘ä»¬åˆå¯ä»¥è·å¾—å¯¹äºMessageQueueçš„å¦ä¸€æ¡æ¨æµ‹ï¼Œ_callableModulesç”¨æ¥å­˜æ”¾JSç«¯æš´éœ²ç»™Nativeçš„æ¨¡å—ï¼Œè¿›ä¸€æ­¥åˆ†ææˆ‘ä»¬å¯ä»¥å‘ç°SDKä¸­æ­£æ˜¯é€šè¿‡registerCallableModulesæ–¹æ³•æ³¨å†ŒJSç«¯æš´éœ²APIæ¨¡å—ã€‚</p>
<p>å¯¹äºJS bridgeæä¾›çš„è°ƒç”¨å›è°ƒæ–¹æ³•invokeCallbackAndReturnFlushedQueueï¼ŒåŸç†ä¸Šå’ŒcallFunctionå·®ä¸å¤šï¼Œä¸å†ç»†è¯´ã€‚</p>
<h4 id="JS-lt-gt-Native-é€šä¿¡åŸç†"><a href="#JS-lt-gt-Native-é€šä¿¡åŸç†" class="headerlink" title="JS &lt;-&gt; Native é€šä¿¡åŸç†"></a>JS &lt;-&gt; Native é€šä¿¡åŸç†</h4><p>1.Native-&gt;JS</p>
<p>ç»¼ä¸Šæ‰€è¿°ï¼Œåœ¨JSç«¯æä¾›callFunctionReturnFlushedQueueï¼ŒNative bridgeè°ƒç”¨JSç«¯æ–¹æ³•æ—¶ï¼Œåº”è¯¥ä½¿ç”¨è¿™ä¸ªæ–¹æ³•ã€‚æŸ¥çœ‹Nativeä»£ç å®ç°å¯çŸ¥ï¼ŒRCTBridgeå°è£…äº†enqueueJSCallæ–¹æ³•è°ƒç”¨JSï¼Œæ¢³ç†Native-&gt;JSçš„æ•´ä½“äº¤äº’æµç¨‹å¦‚ä¸‹å›¾æ‰€ç¤ºã€‚</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/18-5-11/44610127.jpg" alt=""></p>
<p>ä¹‹å‰å·²ç»è®ºè¿°è¿‡ï¼Œå¦‚æœåœ¨NATIVEç«¯éœ€è¦è‡ªå®šä¹‰æ¨¡å—æä¾›ç»™JSç«¯ä½¿ç”¨é‚£ä¹ˆè¯¥ç±»éœ€è¦å®ç°RCTBridgeModuleåè®® ã€‚</p>
<p>æ­¤å¤–ï¼ŒReact-Nativeæä¾›äº†å¦ä¸€ç§åŸºäºé€šçŸ¥çš„æ–¹å¼ï¼Œé€šè¿‡RCTEventDispatcherå‘é€æ¶ˆæ¯é€šçŸ¥ ã€‚eventDispatcherä½œä¸ºNative Bridgeçš„å±æ€§ï¼Œå°è£…äº†sendEventWithName:body:æ–¹æ³•ã€‚ä½¿ç”¨æ—¶ï¼ŒNativeä¸­ç±»åŒæ ·éœ€è¦å®ç°RCTBridgeModuleåè®®ï¼Œé€šè¿‡self.bridgeå‘é€é€šçŸ¥ï¼ŒJSç«¯å¯¹åº”äº‹ä»¶çš„EventEmitteræ·»åŠ ç›‘å¬å¤„ç†è°ƒç”¨ã€‚</p>
<blockquote>
<p>æŸ¥çœ‹sendEventæ–¹æ³•çš„ä»£ç å¯ä»¥å‘ç°ï¼Œè¿™ç§æ–¹å¼æœ¬è´¨ä¸Šè¿˜æ˜¯è°ƒç”¨enqueueJSCallæ–¹æ³•ã€‚å®˜æ–¹æ¨èæˆ‘ä»¬ä½¿ç”¨é€šçŸ¥çš„æ–¹å¼æ¥å®ç° Native-&gt;JSï¼Œè¿™æ ·å¯ä»¥å‡å°‘æ¨¡å—åˆå§‹åŒ–åŠ è½½è§£æçš„æ—¶é—´ã€‚</p>
</blockquote>
<p>2.JS-&gt;Native</p>
<p>æœ€åï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹JSå¦‚ä½•è°ƒç”¨Nativeã€‚ç­”æ¡ˆæ˜¯JSä¸ä¼šä¸»åŠ¨ä¼ é€’æ•°æ®ç»™Nativeï¼Œä¹Ÿä¸èƒ½ç›´æ¥è°ƒç”¨Nativeï¼ˆä¸€ç§æƒ…å†µé™¤å¤–ï¼Œåœ¨å…¥å£ç›´æ¥é€šè¿‡NativeModulesè°ƒç”¨APIï¼‰ï¼Œåªæœ‰åœ¨Nativeè°ƒç”¨JSæ—¶æ‰ä¼šé€šè¿‡è¿”å›å€¼è§¦å‘è°ƒç”¨ã€‚å› ä¸ºNativeæ˜¯åŸºäºäº‹ä»¶å“åº”æœºåˆ¶çš„ï¼Œæ¯”å¦‚è§¦æ‘¸äº‹ä»¶ã€å¯åŠ¨äº‹ä»¶ã€å®šæ—¶å™¨äº‹ä»¶ã€å›è°ƒäº‹ä»¶ç­‰ã€‚</p>
<p>å½“äº‹ä»¶å‘ç”Ÿæ—¶ï¼ŒNativeä¼šè°ƒç”¨JSç›¸åº”æ¨¡å—å¤„ç†ï¼Œå®Œæ¯•åå†é€šè¿‡è¿”å›å€¼æŠŠé˜Ÿåˆ—ä¼ é€’ç»™Nativeæ‰§è¡Œå¯¹åº”çš„ä»£ç ã€‚</p>
<p><img src="http://og1yl0w9z.bkt.clouddn.com/18-5-11/39019479.jpg" alt=""></p>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ•´ä¸ªè°ƒç”¨è¿‡ç¨‹å¯ä»¥å½’çº³ä¸ºï¼š</p>
<ul>
<li>1.JSæŠŠéœ€è¦Module, Method, args(CallbackID)ä¿å­˜åœ¨é˜Ÿåˆ—ä¸­ï¼Œ ä½œä¸ºè¿”å›å€¼é€šè¿‡blockså›è°ƒNative</li>
<li>2.Nativeè°ƒç”¨ç›¸åº”æ¨¡å—æ–¹æ³•ï¼Œå®Œæˆ</li>
<li>3.Nativeé€šè¿‡CallbackIDè°ƒç”¨JSå›è°ƒ</li>
</ul>
<h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>React Nativeçš„é€šè®¯åŸºç¡€å»ºç«‹åœ¨ä¼ ç»Ÿçš„JS Bridgeä¹‹ä¸Šï¼Œä¸è¿‡å¯¹äºBridgeå¤„ç†çš„MessageQueueæœºåˆ¶ã€æ¨¡å—å®šä¹‰ã€åŠ è½½æœºåˆ¶ä¸Šçš„å·§å¦™å¤„ç†æŒ‡çš„å€Ÿé‰´ã€‚å¯¹äºä¸Šè¿°çš„æ•´ä¸ªåŸç†è§£æå¯ä»¥æ¦‚æ‹¬ä¸ºä»¥ä¸‹å››ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>1.åœ¨å¯åŠ¨é˜¶æ®µï¼Œåˆå§‹åŒ–JSå¼•æ“ï¼Œç”ŸæˆNativeç«¯æ¨¡å—é…ç½®è¡¨å­˜äºä¸¤ç«¯ï¼Œå…¶ä¸­æ¨¡å—é…ç½®æ˜¯åŒæ­¥å–å¾—ï¼Œè€Œå„æ¨¡å—çš„æ–¹æ³•é…ç½®åœ¨è¯¥æ–¹æ³•è¢«çœŸæ­£è°ƒç”¨æ—¶æ‡’åŠ è½½ã€‚</li>
<li>2.Nativeå’ŒJSç«¯åˆ†åˆ«æœ‰ä¸€ä¸ªbridgeï¼Œå‘ç”Ÿè°ƒç”¨æ—¶ï¼Œè°ƒç”¨ç«¯bridgeæŸ¥æ‰¾æ¨¡å—é…ç½®è¡¨å°†è°ƒç”¨è½¬æ¢æˆ{moduleID, methodID, args(callbackID)}ï¼Œå¤„ç†ç«¯é€šè¿‡åŒä¸€ä»½æ¨¡å—é…ç½®è¡¨è½¬æ¢ä¸ºå®é™…çš„æ–¹æ³•å®ç°ã€‚</li>
<li>3.Native-&gt;JSï¼ŒåŸç†ä¸Šä½¿ç”¨JSCoreä»Nativeæ‰§è¡ŒJSä»£ç ï¼ŒReact-Nativeåœ¨æ­¤åŸºç¡€ä¸Šç»™æˆ‘ä»¬æä¾›äº†é€šçŸ¥å‘é€çš„æ‰§è¡Œæ–¹å¼ã€‚</li>
<li>4.JS-&gt;Nativeï¼ŒåŸç†ä¸ŠJSå¹¶ä¸ä¸»åŠ¨è°ƒç”¨Nativeï¼Œè€Œæ˜¯æŠŠæ–¹æ³•å’Œå‚æ•°(å›è°ƒ)ç¼“å­˜åˆ°é˜Ÿåˆ—ä¸­ï¼Œåœ¨Nativeäº‹ä»¶è§¦å‘å¹¶è®¿é—®JSåï¼Œé€šè¿‡blockså›è°ƒNativeã€‚</li>
</ul>

            <div class="clearfix"></div>
            <hr class="nogutter">
        </div>
        <nav class="pagination" role="pagination">
    
    <a class="pull-left" href="/2018/06/16/NamedTypes/" style="float: left;">
        â† Swift Principle - NamedTypes
    </a>
    
    
    <a class="pull-right" href="/2018/05/09/thread-p/">
        Objective-C Principle - Thread â†’
    </a>
    
</nav>

        <div class="duoshuo"></div>
    </div>
</section>


      
<!-- ============================ Footer =========================== -->

<footer>
    <div class="container">
            <div class="copy">
                <p>
                    &copy; 2014<script>new Date().getFullYear()>2010&&document.write("-"+new Date().getFullYear());</script>, Content By Steven. All Rights Reserved.
                </p>
                <p>Theme By <a href="//go.kieran.top" style="color: #767D84">Kieran</a></p>
            </div>
            <div class="social">
                <ul>
                    
                    <li><a href="https://github.com/ReverseScale" title="Github" target="_blank"><i class="icon-github"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://twitter.com/" title="Twitter" target="_blank"><i class="icon-twitter"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://www.facebook.com/" title="Facebook" target="_blank"><i class="icon-facebook"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="https://google.com/" title="Google-Plus" target="_blank"><i class="icon-google-plus"></i></a>&nbsp;</li>
                    
                    
                    <li><a href="http://www.weibo.com/5844576818/profile?rightmod=1&wvr=6&mod=personinfo&is_all=1" title="Sina-Weibo" target="_blank"><i class="icon-sina-weibo"></i></a>&nbsp;</li>
                    
                </ul>
            </div>
            <div class="clearfix"> </div>
        </div>
</footer>

<!-- ============================ END Footer =========================== -->
      <!-- Load our scripts -->
        
<!-- Resizable 'on-demand' full-height hero -->
<script type="text/javascript">
    
    var resizeHero = function () {
        var hero = $(".cover,.heightblock"),
            window1 = $(window);
        hero.css({
            "height": window1.height()
        });
    };
    
    resizeHero();
    
    $(window).resize(function () {
        resizeHero();
    });
</script>
<script src="/js/plugins.min.js"></script><!-- Bootstrap core and concatenated plugins always load here -->
<script src="/js/jquery.flexslider-min.js"></script><!-- Flexslider plugin -->
<script src="/js/scripts.js"></script><!-- Theme scripts -->

<!-- Initiate flexslider plugin -->
<script type="text/javascript">
    $(document).ready(function($) {
      $('.flexslider').flexslider({
        animation: "fade",
        prevText: "",
        nextText: "",
        directionNav: true
      });
    });
</script>

</body>
</html>
