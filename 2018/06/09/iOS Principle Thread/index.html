<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>ios principleï¼šthread | Evolution</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="Principle">
  
  
  
  
  <meta name="description" content="è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€~">
<meta name="keywords" content="Principle">
<meta property="og:type" content="article">
<meta property="og:title" content="iOS Principleï¼šThread">
<meta property="og:url" content="https://reversescale.github.io/2018/06/09/iOS Principle Thread/index.html">
<meta property="og:site_name" content="Evolution">
<meta property="og:description" content="è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€~">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141663cfa2?w=658&h=239&f=png&s=164477">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141b2eb525?w=759&h=55&f=png&s=31082">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141c69bbf1?w=700&h=58&f=png&s=37536">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141b47445e?w=747&h=54&f=png&s=30954">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141b10bb3e?w=750&h=132&f=png&s=70358">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141c59d0b8?w=212&h=39&f=png&s=10741">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef1442982f62?w=756&h=109&f=png&s=57893">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef14428ecf18?w=754&h=132&f=png&s=71804">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef1442851adc?w=753&h=211&f=png&s=110267">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef144468a6f0?w=756&h=212&f=png&s=109339">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef1444b73cbd?w=759&h=107&f=png&s=56815">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef14615756a6?w=758&h=112&f=png&s=56793">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef1464986694?w=665&h=118&f=png&s=75328">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef04224f6476?w=684&h=181&f=png&s=105710">
<meta property="og:updated_time" content="2018-11-18T05:37:42.197Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="iOS Principleï¼šThread">
<meta name="twitter:description" content="è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€~">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/6/5/163cef141663cfa2?w=658&h=239&f=png&s=164477">
  
    <link rel="alternate" href="/atom.xml" title="Evolution" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/docccc.png">
  <link rel="apple-touch-icon" href="/css/images/docccc.png">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>
  <script src="../../../../js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="../../../../css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css">
  

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 border-width: 0px;  margin-top: 0px;" href="#" data-toggle="modal" data-target="#myModal">
                  <img width="88px" height="88px" alt="Hike News" src="/css/images/docccc.png">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="../../../../index.html">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="../../../../js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-iOS Principle Thread" style="width: 75%; float:left;" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      iOS Principleï¼šThread
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="" class="article-date">
	  <time datetime="2018-06-09T13:56:27.000Z" itemprop="datePublished">2018-06-09</time>
	</a>

      
    <a class="article-category-link" href="../../../../categories/Principle/">Principle</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		PV:<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>è¿›ç¨‹ï¼ˆProcessï¼‰æ˜¯è®¡ç®—æœºä¸­çš„ç¨‹åºå…³äºæŸæ•°æ®é›†åˆä¸Šçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œæ˜¯ç³»ç»Ÿè¿›è¡Œèµ„æºåˆ†é…å’Œè°ƒåº¦çš„åŸºæœ¬å•ä½ï¼Œæ˜¯æ“ä½œç³»ç»Ÿç»“æ„çš„åŸºç¡€~ </p>
<a id="more"></a>
<hr>
<p>ğŸ‘¨ğŸ»â€ğŸ’» <a href="https://github.com/ReverseScale/iOSPrinciple_Thread" target="_blank" rel="noopener">Github Demo</a></p>
<h3 id="æ–¹ä¾¿è®°å¿†ï¼š"><a href="#æ–¹ä¾¿è®°å¿†ï¼š" class="headerlink" title="æ–¹ä¾¿è®°å¿†ï¼š"></a>æ–¹ä¾¿è®°å¿†ï¼š</h3><ul>
<li>è¿›ç¨‹å’Œçº¿ç¨‹ï¼šè¿›ç¨‹æ˜¯é¥­é¦†ã€çº¿ç¨‹æ˜¯å·¥ä½œäººå‘˜</li>
<li>çº¿ç¨‹çš„æ‰§è¡Œï¼š1ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„</li>
<li>å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼šCPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦</li>
<li>iOS å¤šçº¿ç¨‹<ul>
<li>pthreadï¼šcè¯­è¨€çš„é€šç”¨apiï¼Œè·¨å¹³å°ã€éš¾åº¦å¤§ã€éè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
<li>NSThreadï¼šé¢å‘å¯¹è±¡çš„éè‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
<li>GCDï¼šåˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸è‡ªåŠ¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸ</li>
<li>NSOperationã€NSOperationQueueï¼šå°è£…GCDï¼ŒåŠ å¼ºä¾èµ–å…³ç³»ã€ç›‘æ§çŠ¶æ€ã€å¹¶å‘ç®¡ç†</li>
</ul>
</li>
<li>å¸¸ç”¨å®‰å…¨é”ï¼š@synchronized{}ã€[self.lock lock]</li>
</ul>
<hr>
<h3 id="ç›¸å…³æ¦‚å¿µ"><a href="#ç›¸å…³æ¦‚å¿µ" class="headerlink" title="ç›¸å…³æ¦‚å¿µ"></a>ç›¸å…³æ¦‚å¿µ</h3><h4 id="è¿›ç¨‹"><a href="#è¿›ç¨‹" class="headerlink" title="è¿›ç¨‹"></a>è¿›ç¨‹</h4><p>è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºã€‚æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…ã€‚</p>
<h4 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h4><p><em>çº¿ç¨‹å’Œè¿›ç¨‹çš„å…³ç³»</em></p>
<p>1ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡ï¼Œå¿…é¡»å¾—æœ‰çº¿ç¨‹ï¼ˆæ¯1ä¸ªè¿›ç¨‹è‡³å°‘è¦æœ‰1æ¡çº¿ç¨‹ï¼‰ï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹çš„åŸºæœ¬æ‰§è¡Œå•å…ƒï¼Œä¸€ä¸ªè¿›ç¨‹ï¼ˆç¨‹åºï¼‰çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œã€‚</p>
<p><em>çº¿ç¨‹å†…éƒ¨æ˜¯ä¸²è¡Œæ‰§è¡Œçš„ï¼Ÿ</em></p>
<p>1ä¸ªçº¿ç¨‹ä¸­ä»»åŠ¡çš„æ‰§è¡Œæ˜¯ä¸²è¡Œçš„ï¼Œå¦‚æœè¦åœ¨1ä¸ªçº¿ç¨‹ä¸­æ‰§è¡Œå¤šä¸ªä»»åŠ¡ï¼Œé‚£ä¹ˆåªèƒ½ä¸€ä¸ªä¸€ä¸ªåœ°æŒ‰é¡ºåºæ‰§è¡Œè¿™äº›ä»»åŠ¡ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨åŒä¸€æ—¶é—´å†…ï¼Œ1ä¸ªçº¿ç¨‹åªèƒ½æ‰§è¡Œ1ä¸ªä»»åŠ¡ã€‚</p>
<h4 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h4><p>å³1ä¸ªè¿›ç¨‹ä¸­å¯ä»¥å¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œæ¯æ¡çº¿ç¨‹å¯ä»¥å¹¶è¡Œï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œä¸åŒçš„ä»»åŠ¡ã€‚æ¯”å¦‚åŒæ—¶å¼€å¯3æ¡çº¿ç¨‹åˆ†åˆ«ä¸‹è½½3ä¸ªæ–‡ä»¶ï¼ˆåˆ†åˆ«æ˜¯æ–‡ä»¶Aã€æ–‡ä»¶Bã€æ–‡ä»¶Cï¼‰ã€‚</p>
<p><em>å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„åŸç†ï¼Ÿ</em></p>
<p>åœ¨åŒä¸€æ—¶é—´é‡Œï¼ŒCPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œåªæœ‰1æ¡çº¿ç¨‹åœ¨å·¥ä½œï¼ˆæ‰§è¡Œï¼‰ã€‚å¤šçº¿ç¨‹å¹¶å‘ï¼ˆåŒæ—¶ï¼‰æ‰§è¡Œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰ï¼Œå¦‚æœCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ï¼Œå°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡ã€‚</p>
<p><em>å¤šçº¿ç¨‹çš„ä¼˜ç¼ºç‚¹ï¼Ÿ</em></p>
<p>ä¼˜ç‚¹ï¼š</p>
<ul>
<li>1ï¼‰èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li>
<li>2ï¼‰èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰</li>
</ul>
<p>ç¼ºç‚¹ï¼š</p>
<ul>
<li>1ï¼‰å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KBï¼‰ï¼Œå¦‚æœå¼€å¯å¤§é‡çš„çº¿ç¨‹ï¼Œä¼šå ç”¨å¤§é‡çš„å†…å­˜ç©ºé—´ï¼Œé™ä½ç¨‹åºçš„æ€§èƒ½ã€‚</li>
<li>2ï¼‰çº¿ç¨‹è¶Šå¤šï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§ã€‚</li>
<li>3ï¼‰ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼šæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€å¤šçº¿ç¨‹çš„æ•°æ®å…±äº«</li>
</ul>
<h4 id="å¤šçº¿ç¨‹åœ¨-iOS-å¼€å‘ä¸­çš„åº”ç”¨"><a href="#å¤šçº¿ç¨‹åœ¨-iOS-å¼€å‘ä¸­çš„åº”ç”¨" class="headerlink" title="å¤šçº¿ç¨‹åœ¨ iOS å¼€å‘ä¸­çš„åº”ç”¨"></a>å¤šçº¿ç¨‹åœ¨ iOS å¼€å‘ä¸­çš„åº”ç”¨</h4><p><em>iOS çš„ä¸»çº¿ç¨‹ï¼Ÿ</em></p>
<p>ä¸€ä¸ª iOS ç¨‹åºè¿è¡Œåï¼Œé»˜è®¤ä¼šå¼€å¯1æ¡çº¿ç¨‹ï¼Œç§°ä¸ºâ€œä¸»çº¿ç¨‹â€æˆ–â€œUIçº¿ç¨‹â€ï¼Œç”¨äºåˆ·æ–°æ˜¾ç¤ºUI,å¤„ç†UIäº‹ä»¶ã€‚</p>
<blockquote>
<p>ä¸è¦å°†è€—æ—¶æ“ä½œæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­å»å¤„ç†ï¼Œä¼šå¡ä½çº¿ç¨‹ã€‚</p>
</blockquote>
<p><em>iOS çš„å¤šçº¿ç¨‹ï¼Ÿ</em></p>
<p>1ï¼‰ç¬¬ä¸€ç§ï¼špthread</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä¸€å¥—é€šç”¨çš„å¤šçº¿ç¨‹API</li>
<li>é€‚ç”¨äºUnix\Linux\Windowsç­‰ç³»ç»Ÿ</li>
<li>è·¨å¹³å°\å¯ç§»æ¤</li>
<li>ä½¿ç”¨éš¾åº¦å¤§</li>
</ul>
<p>ä½¿ç”¨è¯­è¨€ï¼šcè¯­è¨€</p>
<p>ä½¿ç”¨é¢‘ç‡ï¼šå‡ ä¹ä¸ç”¨</p>
<p>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šç”±ç¨‹åºå‘˜è¿›è¡Œç®¡ç†</p>
<p>2ï¼‰ç¬¬äºŒç§ï¼šNSThread</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡</li>
<li>ç®€å•æ˜“ç”¨ï¼Œå¯ç›´æ¥æ“ä½œçº¿ç¨‹å¯¹è±¡</li>
</ul>
<p>ä½¿ç”¨è¯­è¨€ï¼šOCè¯­è¨€</p>
<p>ä½¿ç”¨é¢‘ç‡ï¼šå¶å°”ä½¿ç”¨</p>
<p>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šç”±ç¨‹åºå‘˜è¿›è¡Œç®¡ç†</p>
<p>3ï¼‰ç¬¬ä¸‰ç§ï¼šGCD</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>æ—¨åœ¨æ›¿ä»£NSThreadç­‰çº¿ç¨‹æŠ€æœ¯</li>
<li>å……åˆ†åˆ©ç”¨è®¾å¤‡çš„å¤šæ ¸(è‡ªåŠ¨)</li>
</ul>
<p>ä½¿ç”¨è¯­è¨€ï¼šOCè¯­è¨€</p>
<p>ä½¿ç”¨é¢‘ç‡ï¼šç»å¸¸ä½¿ç”¨</p>
<p>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šè‡ªåŠ¨ç®¡ç†</p>
<p>4ï¼‰ç¬¬å››ç§ï¼šNSOperation</p>
<p>ç‰¹ç‚¹ï¼š</p>
<ul>
<li>åŸºäºGCDï¼ˆåº•å±‚æ˜¯GCDï¼‰</li>
<li>æ¯”GCDå¤šäº†ä¸€äº›æ›´ç®€å•å®ç”¨çš„åŠŸèƒ½</li>
<li>ä½¿ç”¨æ›´åŠ é¢å‘å¯¹è±¡</li>
</ul>
<p>å¯¹æ¯” GCD çš„ä¼˜ç‚¹ï¼š</p>
<ul>
<li>åœ¨NSOperationQueueä¸­ï¼Œå¯ä»¥å»ºç«‹å„ä¸ªNSOperationä¹‹é—´çš„ä¾èµ–å…³ç³»</li>
<li>æœ‰KVOï¼Œå¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ï¼Œæ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰</li>
<li>NSOperationQueueå¯ä»¥æ–¹ä¾¿çš„ç®¡ç†å¹¶å‘ã€NSOperationä¹‹é—´çš„ä¼˜å…ˆçº§</li>
</ul>
<p>ä½¿ç”¨è¯­è¨€ï¼šOCè¯­è¨€</p>
<p>ä½¿ç”¨é¢‘ç‡ï¼šç»å¸¸ä½¿ç”¨</p>
<p>çº¿ç¨‹ç”Ÿå‘½å‘¨æœŸï¼šè‡ªåŠ¨ç®¡ç†</p>
<h3 id="ä»£ç ç¤ºä¾‹"><a href="#ä»£ç ç¤ºä¾‹" class="headerlink" title="ä»£ç ç¤ºä¾‹"></a>ä»£ç ç¤ºä¾‹</h3><p>ç”±äºè¦ä½¿ç”¨ä¸€äº› c æ¥æ¼”ç¤ºï¼Œå…ˆè¯´æ˜äº›è§„èŒƒï¼Œé˜²æ‡µé€¼ ğŸ˜³</p>
<ul>
<li>1.åœ¨cè¯­è¨€ä¸­ï¼Œæ²¡æœ‰å¯¹è±¡çš„æ¦‚å¿µï¼Œå¯¹è±¡ç±»å‹æ˜¯ä»¥-t/Refç»“å°¾çš„;</li>
<li>2.cè¯­è¨€ä¸­çš„void * å’ŒOCçš„idæ˜¯ç­‰ä»·çš„;</li>
<li>3.åœ¨æ··åˆå¼€å‘æ—¶ï¼Œå¦‚æœåœ¨ C å’Œ OC ä¹‹é—´ä¼ é€’æ•°æ®ï¼Œéœ€è¦ä½¿ç”¨ __bridge è¿›è¡Œæ¡¥æ¥ï¼Œæ¡¥æ¥çš„ç›®çš„å°±æ˜¯ä¸ºäº†å‘Šè¯‰ç¼–è¯‘å™¨å¦‚ä½•ç®¡ç†å†…å­˜ï¼ŒMRC ä¸­ä¸éœ€è¦ä½¿ç”¨æ¡¥æ¥;</li>
<li>4.åœ¨ OC ä¸­ï¼Œå¦‚æœæ˜¯ ARC å¼€å‘ï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ï¼Œæ ¹æ®ä»£ç ç»“æ„ï¼Œ è‡ªåŠ¨æ·»åŠ  retain/release/autoreleaseã€‚ä½†æ˜¯ï¼ŒARC åªè´Ÿè´£ç®¡ç† OC éƒ¨åˆ†çš„å†…å­˜ç®¡ç†ï¼Œè€Œä¸è´Ÿè´£ C è¯­è¨€ ä»£ç çš„å†…å­˜ç®¡ç†ã€‚å› æ­¤ï¼Œå¼€å‘è¿‡ç¨‹ä¸­ï¼Œå¦‚æœä½¿ç”¨çš„ C è¯­è¨€æ¡†æ¶å‡ºç°retain/create/copy/new ç­‰å­—æ ·çš„å‡½æ•°ï¼Œå¤§å¤šéƒ½éœ€è¦ releaseï¼Œå¦åˆ™ä¼šå‡ºç°å†…å­˜æ³„æ¼ã€‚</li>
</ul>
<h4 id="pthread-åŸºæœ¬ä½¿ç”¨"><a href="#pthread-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="pthread åŸºæœ¬ä½¿ç”¨"></a>pthread åŸºæœ¬ä½¿ç”¨</h4><p>éœ€è¦å¼•å…¥ pthread å¤´æ–‡ä»¶<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;pthread.h&gt;</span></span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ pthread_create æ–¹æ³•<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">pthread_create(&lt;#pthread_t  _Nullable *restrict _Nonnull#&gt;, &lt;#const pthread_attr_t *restrict _Nullable#&gt;, &lt;#void * _Nullable (* _Nonnull)(void * _Nullable)#&gt;, &lt;#void *restrict _Nullable#&gt;)</span></span><br><span class="line"><span class="comment">å‚æ•°ï¼š</span></span><br><span class="line"><span class="comment">1.æŒ‡å‘çº¿ç¨‹æ ‡è¯†ç¬¦çš„æŒ‡é’ˆï¼ŒC è¯­è¨€ä¸­ç±»å‹çš„ç»“å°¾é€šå¸¸ _t/Refï¼Œè€Œä¸”ä¸éœ€è¦ä½¿ç”¨ *;</span></span><br><span class="line"><span class="comment">2.ç”¨æ¥è®¾ç½®çº¿ç¨‹å±æ€§;</span></span><br><span class="line"><span class="comment">3.æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ,ä¼ å…¥å‡½æ•°å(å‡½æ•°çš„åœ°å€)ï¼Œçº¿ç¨‹è¦æ‰§è¡Œçš„å‡½æ•°/ä»»åŠ¡;</span></span><br><span class="line"><span class="comment">4.è¿è¡Œå‡½æ•°çš„å‚æ•°;</span></span><br><span class="line"><span class="comment">*/</span></span><br></pre></td></tr></table></figure></p>
<p>å®Œæ•´ä»£ç <br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="comment">//1.åˆ›å»ºçº¿ç¨‹å¯¹è±¡</span></span><br><span class="line">    pthread_t thread;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="built_in">NSString</span> *param = <span class="string">@"å‚æ•°"</span>;</span><br><span class="line">    <span class="keyword">int</span> result = pthread_create(&amp;thread, <span class="literal">NULL</span>, task, (__bridge <span class="keyword">void</span> *)(param));</span><br><span class="line">    result == <span class="number">0</span>?<span class="built_in">NSLog</span>(<span class="string">@"success"</span>):<span class="built_in">NSLog</span>(<span class="string">@"failure"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.è®¾ç½®å­çº¿ç¨‹çš„çŠ¶æ€è®¾ç½®ä¸ºdetached,åˆ™è¯¥çº¿ç¨‹è¿è¡Œç»“æŸåä¼šè‡ªåŠ¨é‡Šæ”¾æ‰€æœ‰èµ„æºï¼Œæˆ–è€…åœ¨å­çº¿ç¨‹ä¸­æ·»åŠ  pthread_detach(pthread_self()),å…¶ä¸­pthread_self()æ˜¯è·å¾—çº¿ç¨‹è‡ªèº«çš„id</span></span><br><span class="line">    pthread_detach(thread);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">void</span> *task(<span class="keyword">void</span> * param) &#123;</span><br><span class="line">    <span class="comment">//åœ¨æ­¤åšè€—æ—¶æ“ä½œ</span></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"new thread : %@  å‚æ•°æ˜¯: %@"</span>,[<span class="built_in">NSThread</span> currentThread],(__bridge <span class="built_in">NSString</span> *)(param));</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">NULL</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h4 id="NSThread-åŸºæœ¬ä½¿ç”¨"><a href="#NSThread-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="NSThread åŸºæœ¬ä½¿ç”¨"></a>NSThread åŸºæœ¬ä½¿ç”¨</h4><p>1.1ï¼‰ç¬¬ä¸€ç§ åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šalloc init.</p>
<p>ç‰¹ç‚¹ï¼šéœ€è¦æ‰‹åŠ¨å¼€å¯çº¿ç¨‹ï¼Œå¯ä»¥æ‹¿åˆ°çº¿ç¨‹å¯¹è±¡è¿›è¡Œè¯¦ç»†è®¾ç½®</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼šé€‰æ‹©å™¨ï¼Œçº¿ç¨‹å¯åŠ¨è¦è°ƒç”¨å“ªä¸ªæ–¹æ³•</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šå‰é¢æ–¹æ³•è¦æ¥æ”¶çš„å‚æ•°ï¼ˆæœ€å¤šåªèƒ½æ¥æ”¶ä¸€ä¸ªå‚æ•°ï¼Œæ²¡æœ‰åˆ™ä¼ nilï¼‰</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSThread</span> *thread = [[<span class="built_in">NSThread</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(run) object:<span class="string">@"wendingding"</span>];</span><br><span class="line"><span class="comment">//å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">[thread start];</span><br></pre></td></tr></table></figure>
<p>1.2ï¼‰ç¬¬äºŒç§ åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šåˆ†ç¦»å‡ºä¸€æ¡å­çº¿ç¨‹</p>
<p>ç‰¹ç‚¹ï¼šè‡ªåŠ¨å¯åŠ¨çº¿ç¨‹ï¼Œæ— æ³•å¯¹çº¿ç¨‹è¿›è¡Œæ›´è¯¦ç»†çš„è®¾ç½®</p>
<ul>
<li>ç¬¬ä¸€ä¸ªå‚æ•°ï¼šçº¿ç¨‹å¯åŠ¨è°ƒç”¨çš„æ–¹æ³•</li>
<li>ç¬¬äºŒä¸ªå‚æ•°ï¼šç›®æ ‡å¯¹è±¡</li>
<li>ç¬¬ä¸‰ä¸ªå‚æ•°ï¼šä¼ é€’ç»™è°ƒç”¨æ–¹æ³•çš„å‚æ•°</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(run) toTarget:<span class="keyword">self</span> withObject:<span class="string">@"æˆ‘æ˜¯åˆ†ç¦»å‡ºæ¥çš„å­çº¿ç¨‹"</span>];</span><br></pre></td></tr></table></figure>
<p>1.3ï¼‰ç¬¬ä¸‰ç§ åˆ›å»ºçº¿ç¨‹çš„æ–¹å¼ï¼šåå°çº¿ç¨‹</p>
<p>ç‰¹ç‚¹ï¼šè‡ªåŠ¨å¯åŠ¨å¿åŸï¼Œæ— æ³•è¿›è¡Œæ›´è¯¦ç»†è®¾ç½®</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="keyword">self</span> performSelectorInBackground:<span class="keyword">@selector</span>(run) withObject:<span class="string">@"æˆ‘æ˜¯åå°çº¿ç¨‹"</span>];</span><br></pre></td></tr></table></figure>
<p>2ï¼‰å¸¸ç”¨çš„æ§åˆ¶çº¿ç¨‹æ–¹æ³•</p>
<p>ä¸ºçº¿ç¨‹å‘½åï¼Œä»¥ä¾¿åŒºåˆ†<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®çº¿ç¨‹çš„åç§°</span></span><br><span class="line">thread.name = <span class="string">@"çº¿ç¨‹A"</span>;</span><br></pre></td></tr></table></figure></p>
<p>è®¾ç½®ä¼˜å…ˆçº§ï¼Œå–å€¼èŒƒå›´ä¸º0.0~1.0ä¹‹é—´ï¼Œ1.0è¡¨ç¤ºçº¿ç¨‹çš„ä¼˜å…ˆçº§æœ€é«˜,å¦‚æœä¸è®¾ç½®è¯¥å€¼ï¼Œé‚£ä¹ˆç†æƒ³çŠ¶æ€ä¸‹é»˜è®¤ä¸º0.5<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è®¾ç½®çº¿ç¨‹çš„ä¼˜å…ˆçº§</span></span><br><span class="line">thread.threadPriority = <span class="number">1.0</span>;</span><br></pre></td></tr></table></figure></p>
<p>é€€å‡ºå½“å‰çº¿ç¨‹<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€€å‡ºå½“å‰çº¿ç¨‹</span></span><br><span class="line">[<span class="built_in">NSThread</span> exit];</span><br></pre></td></tr></table></figure></p>
<p>çº¿ç¨‹çš„å„ç§çŠ¶æ€ï¼šæ–°å»º-å°±ç»ª-è¿è¡Œ-é˜»å¡-æ­»äº¡ï¼Œé˜»å¡çº¿ç¨‹æ–¹æ³•æ¥äº†<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2.0</span>]; <span class="comment">//é˜»å¡çº¿ç¨‹</span></span><br><span class="line">[<span class="built_in">NSThread</span> sleepUntilDate:[<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">2.0</span>]]; <span class="comment">//é˜»å¡çº¿ç¨‹</span></span><br><span class="line"><span class="comment">//æ³¨æ„ï¼šçº¿ç¨‹æ­»äº†ä¸èƒ½å¤ç”Ÿ</span></span><br></pre></td></tr></table></figure></p>
<p>3ï¼‰çº¿ç¨‹å®‰å…¨</p>
<ul>
<li>å‰æï¼šå¤šä¸ªçº¿ç¨‹è®¿é—®åŒä¸€å—èµ„æºä¼šå‘ç”Ÿæ•°æ®å®‰å…¨é—®é¢˜</li>
<li>è§£å†³æ–¹æ¡ˆï¼šåŠ äº’æ–¥é”</li>
<li>ç›¸å…³ä»£ç ï¼š@synchronized(self){}</li>
<li>ä¸“ä¸šæœ¯è¯­-çº¿ç¨‹åŒæ­¥</li>
<li>åŸå­å’ŒéåŸå­å±æ€§ï¼ˆæ˜¯å¦å¯¹setteræ–¹æ³•åŠ é”ï¼‰</li>
</ul>
<p>æ­»é”ï¼šæ˜¯æŒ‡ä¸¤ä¸ªæˆ–ä¸¤ä¸ªä»¥ä¸Šçš„è¿›ç¨‹åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œå› äº‰å¤ºèµ„æºè€Œé€ æˆçš„ä¸€ç§äº’ç›¸ç­‰å¾…çš„ç°è±¡ï¼Œè‹¥æ— å¤–åŠ›ä½œç”¨ï¼Œå®ƒä»¬éƒ½å°†æ— æ³•æ¨è¿›ä¸‹å»ã€‚</p>
<p>äº§ç”Ÿæ­»é”çš„å››ä¸ªå¿…è¦æ¡ä»¶ï¼š</p>
<ul>
<li>äº’æ–¥æ¡ä»¶ï¼šä¸€ä¸ªèµ„æºæ¯æ¬¡åªèƒ½è¢«ä¸€ä¸ªè¿›ç¨‹ä½¿ç”¨ã€‚</li>
<li>å æœ‰ä¸”ç­‰å¾…ï¼šä¸€ä¸ªè¿›ç¨‹å› è¯·æ±‚èµ„æºè€Œé˜»å¡æ—¶ï¼Œå¯¹å·²è·å¾—çš„èµ„æºä¿æŒä¸æ”¾ã€‚</li>
<li>ä¸å¯å¼ºè¡Œå æœ‰:è¿›ç¨‹å·²è·å¾—çš„èµ„æºï¼Œåœ¨æœ«ä½¿ç”¨å®Œä¹‹å‰ï¼Œä¸èƒ½å¼ºè¡Œå‰¥å¤ºã€‚</li>
<li>å¾ªç¯ç­‰å¾…æ¡ä»¶:è‹¥å¹²è¿›ç¨‹ä¹‹é—´å½¢æˆä¸€ç§å¤´å°¾ç›¸æ¥çš„å¾ªç¯ç­‰å¾…èµ„æºå…³ç³»ã€‚</li>
</ul>
<p>äº§ç”Ÿæ­»é”çš„åŸå› ä¸»è¦æ˜¯ï¼š</p>
<ul>
<li>å› ä¸ºç³»ç»Ÿèµ„æºä¸è¶³ã€‚</li>
<li>è¿›ç¨‹è¿è¡Œæ¨è¿›çš„é¡ºåºä¸åˆé€‚ã€‚</li>
<li>èµ„æºåˆ†é…ä¸å½“ç­‰ã€‚</li>
</ul>
<p>å”®ç¥¨å‘˜å”®ç¥¨é—®é¢˜<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSThreadSafeViewController</span> ()</span></span><br><span class="line"><span class="comment">//ä¸‰åªå”®ç¥¨å‘˜ğŸ±ğŸ¶ğŸ­</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSThread</span> *thread01;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSThread</span> *thread02;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSThread</span> *thread03;</span><br><span class="line"><span class="comment">//æ€»ç¥¨æ•°</span></span><br><span class="line"><span class="keyword">@property</span>(<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSInteger</span> totalticket;</span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">NSThreadSafeViewController</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)viewDidLoad &#123;</span><br><span class="line">    [<span class="keyword">super</span> viewDidLoad];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//å‡è®¾æœ‰10å¼ ç¥¨</span></span><br><span class="line">    <span class="keyword">self</span>.totalticket = <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//åˆ›å»ºçº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">self</span>.thread01 =  [[<span class="built_in">NSThread</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(saleTicket) object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">self</span>.thread01.name = <span class="string">@"å°ğŸ±"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.thread02 =  [[<span class="built_in">NSThread</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(saleTicket) object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">self</span>.thread02.name = <span class="string">@"å°ğŸ¶"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.thread03 =  [[<span class="built_in">NSThread</span> alloc]initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(saleTicket) object:<span class="literal">nil</span>];</span><br><span class="line">    <span class="keyword">self</span>.thread03.name = <span class="string">@"å°ğŸ­"</span>;</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">//å¯åŠ¨çº¿ç¨‹</span></span><br><span class="line">    [<span class="keyword">self</span>.thread01 start];</span><br><span class="line">    [<span class="keyword">self</span>.thread02 start];</span><br><span class="line">    [<span class="keyword">self</span>.thread03 start];</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//å”®ç¥¨</span></span><br><span class="line">- (<span class="keyword">void</span>)saleTicket &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">//2.åŠ äº’æ–¥é”</span></span><br><span class="line">        <span class="keyword">@synchronized</span>(<span class="keyword">self</span>) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">0.03</span>];</span><br><span class="line">            <span class="comment">//1.å…ˆæŸ¥çœ‹ä½™ç¥¨æ•°é‡</span></span><br><span class="line">            <span class="built_in">NSInteger</span> count = <span class="keyword">self</span>.totalticket;</span><br><span class="line">            <span class="keyword">if</span> (count &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="keyword">self</span>.totalticket = count - <span class="number">1</span>;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"%@å–å‡ºå»äº†ä¸€å¼ ç¥¨,è¿˜å‰©ä¸‹%zdå¼ ç¥¨"</span>,[<span class="built_in">NSThread</span> currentThread].name,<span class="keyword">self</span>.totalticket);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"%@å‘ç°å½“å‰ç¥¨å·²ç»ä¹°å®Œäº†--"</span>,[<span class="built_in">NSThread</span> currentThread].name);</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef141663cfa2?w=658&amp;h=239&amp;f=png&amp;s=164477" alt=""></p>
<p>4ï¼‰NSThread çº¿ç¨‹é—´é€šä¿¡ï¼ˆå­çº¿ç¨‹åŠ è½½å›¾ç‰‡å®Œæˆé€šçŸ¥ä¸»çº¿ç¨‹æ›´æ–°UIï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)touchesBegan:(<span class="keyword">nonnull</span> <span class="built_in">NSSet</span>&lt;<span class="built_in">UITouch</span> *&gt; *)touches withEvent:(<span class="keyword">nullable</span> <span class="built_in">UIEvent</span> *)event &#123;</span><br><span class="line">    <span class="comment">//å¼€å¯ä¸€æ¡å­çº¿ç¨‹æ¥ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">    [<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(downloadImage) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line">- (<span class="keyword">void</span>)downloadImage &#123;</span><br><span class="line">    <span class="comment">//1.ç¡®å®šè¦ä¸‹è½½ç½‘ç»œå›¾ç‰‡çš„urlåœ°å€ï¼Œä¸€ä¸ªurlå”¯ä¸€å¯¹åº”ç€ç½‘ç»œä¸Šçš„ä¸€ä¸ªèµ„æº</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://p6.qhimg.com/t01d2954e2799c461ab.jpg"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//2.æ ¹æ®urlåœ°å€ä¸‹è½½å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°ï¼ˆäºŒè¿›åˆ¶æ•°æ®</span></span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.æŠŠä¸‹è½½åˆ°æœ¬åœ°çš„äºŒè¿›åˆ¶æ•°æ®è½¬æ¢æˆå›¾ç‰‡</span></span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI</span></span><br><span class="line">    <span class="comment">//4.1 ç¬¬ä¸€ç§æ–¹å¼</span></span><br><span class="line">    <span class="comment">//    [self performSelectorOnMainThread:@selector(showImage:) withObject:image waitUntilDone:YES];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.2 ç¬¬äºŒç§æ–¹å¼</span></span><br><span class="line">    <span class="comment">//    [self.imageView performSelectorOnMainThread:@selector(setImage:) withObject:image waitUntilDone:YES];</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">//4.3 ç¬¬ä¸‰ç§æ–¹å¼</span></span><br><span class="line">    [<span class="keyword">self</span>.imageView performSelector:<span class="keyword">@selector</span>(setImage:) onThread:[<span class="built_in">NSThread</span> mainThread] withObject:image waitUntilDone:<span class="literal">YES</span>];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>5ï¼‰ç‰¹æ®Šç”¨æ³•ï¼ˆè®¡ç®—ä»£ç æ®µçš„æ‰§è¡Œæ—¶é—´ï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://p6.qhimg.com/t01d2954e2799c461ab.jpg"</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬ä¸€ç§æ–¹æ³•</span></span><br><span class="line"><span class="built_in">NSDate</span> *start = [<span class="built_in">NSDate</span> date];</span><br><span class="line"><span class="comment">//2.æ ¹æ®urlåœ°å€ä¸‹è½½å›¾ç‰‡æ•°æ®åˆ°æœ¬åœ°ï¼ˆäºŒè¿›åˆ¶æ•°æ®ï¼‰</span></span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSDate</span> *end = [<span class="built_in">NSDate</span> date];</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ç¬¬äºŒæ­¥æ“ä½œèŠ±è´¹çš„æ—¶é—´ä¸º%f"</span>,[end timeIntervalSinceDate:start]);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//ç¬¬äºŒç§æ–¹æ³•</span></span><br><span class="line"><span class="built_in">CFTimeInterval</span> start = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line"><span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line"></span><br><span class="line"><span class="built_in">CFTimeInterval</span> end = <span class="built_in">CFAbsoluteTimeGetCurrent</span>();</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"ç¬¬äºŒæ­¥æ“ä½œèŠ±è´¹çš„æ—¶é—´ä¸º%f"</span>,end - start);</span><br></pre></td></tr></table></figure></p>
<h4 id="GCD-åŸºæœ¬ä½¿ç”¨"><a href="#GCD-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="GCD åŸºæœ¬ä½¿ç”¨"></a>GCD åŸºæœ¬ä½¿ç”¨</h4><p>1ï¼‰GCD æ ¸å¿ƒæ¦‚å¿µ</p>
<ul>
<li>é˜Ÿåˆ—å’Œä»»åŠ¡</li>
<li>åŒæ­¥å‡½æ•°å’Œå¼‚æ­¥å‡½æ•°</li>
</ul>
<p>2ï¼‰GCD ç»„åˆæ‹³ ğŸ¤£</p>
<p>å¼‚æ­¥å‡½æ•°ï¼š</p>
<ul>
<li>å¼‚æ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šå¼€å¯å¤šæ¡çº¿ç¨‹ï¼Œå¹¶å‘æ‰§è¡Œä»»åŠ¡</li>
<li>å¼‚æ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šå¼€å¯ä¸€æ¡çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡</li>
</ul>
<p>åŒæ­¥å‡½æ•°ï¼š</p>
<ul>
<li>åŒæ­¥å‡½æ•°+å¹¶å‘é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡</li>
<li>åŒæ­¥å‡½æ•°+ä¸²è¡Œé˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡</li>
</ul>
<p>ä¸»é˜Ÿåˆ—ï¼š</p>
<ul>
<li>å¼‚æ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œåœ¨ä¸»çº¿ç¨‹ä¸­ä¸²è¡Œæ‰§è¡Œä»»åŠ¡</li>
<li>åŒæ­¥å‡½æ•°+ä¸»é˜Ÿåˆ—ï¼šä¸å¼€çº¿ç¨‹ï¼Œä¸²è¡Œæ‰§è¡Œä»»åŠ¡ï¼ˆæ³¨æ„æ­»é”å‘ç”Ÿï¼‰</li>
</ul>
<p>3ï¼‰GCD çº¿ç¨‹é—´é€šä¿¡<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0.è·å–ä¸€ä¸ªå…¨å±€çš„é˜Ÿåˆ—</span></span><br><span class="line"><span class="built_in">dispatch_queue_t</span> queue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"><span class="comment">//1.å…ˆå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼ŒæŠŠä¸‹è½½å›¾ç‰‡çš„æ“ä½œæ”¾åœ¨å­çº¿ç¨‹ä¸­å¤„ç†</span></span><br><span class="line"><span class="built_in">dispatch_async</span>(queue, ^&#123;</span><br><span class="line">    <span class="comment">//2.ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">    <span class="built_in">NSURL</span> *url = [<span class="built_in">NSURL</span> URLWithString:<span class="string">@"http://h.hiphotos.baidu.com/zhidao/pic/item/6a63f6246b600c3320b14bb3184c510fd8f9a185.jpg"</span>];</span><br><span class="line">    <span class="built_in">NSData</span> *data = [<span class="built_in">NSData</span> dataWithContentsOfURL:url];</span><br><span class="line">    <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWithData:data];</span><br><span class="line"></span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"ä¸‹è½½æ“ä½œæ‰€åœ¨çš„çº¿ç¨‹--%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.å›åˆ°ä¸»çº¿ç¨‹åˆ·æ–°UI</span></span><br><span class="line">    <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">        <span class="keyword">self</span>.imageView.image = image;</span><br><span class="line">        <span class="comment">//æ‰“å°æŸ¥çœ‹å½“å‰çº¿ç¨‹</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"åˆ·æ–°UI---%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>4ï¼‰GCD å¸¸ç”¨å°åŠŸèƒ½</p>
<p>æ …æ å‡½æ•°ï¼ˆæ§åˆ¶ä»»åŠ¡çš„æ‰§è¡Œé¡ºåºï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_barrier_async(queue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"--dispatch_barrier_async-"</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>å»¶è¿Ÿæ‰§è¡Œï¼ˆå»¶è¿ŸÂ·æ§åˆ¶åœ¨å“ªä¸ªçº¿ç¨‹æ‰§è¡Œï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">dispatch_after(dispatch_time(DISPATCH_TIME_NOW, (int64_t)(<span class="number">2.0</span> * <span class="built_in">NSEC_PER_SEC</span>)), dispatch_get_global_  queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, <span class="number">0</span>), ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"---%@"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>ä¸€æ¬¡æ€§ä»£ç ï¼ˆæ³¨æ„ä¸èƒ½æ”¾åˆ°æ‡’åŠ è½½ï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)once &#123;</span><br><span class="line">    <span class="comment">//æ•´ä¸ªç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­åªä¼šæ‰§è¡Œä¸€æ¬¡</span></span><br><span class="line">    <span class="comment">//onceTokenç”¨æ¥è®°å½•è¯¥éƒ¨åˆ†çš„ä»£ç æ˜¯å¦è¢«æ‰§è¡Œè¿‡</span></span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> onceToken;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;onceToken, ^&#123;</span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"-----"</span>);</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>å¿«é€Ÿè¿­ä»£ï¼ˆå¼€å¤šä¸ªçº¿ç¨‹å¹¶å‘å®Œæˆè¿­ä»£æ“ä½œï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dispatch_apply(subpaths.count, queue, ^(size_t index) &#123;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>é˜Ÿåˆ—ç»„ï¼ˆåŒæ …æ å‡½æ•°ï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºé˜Ÿåˆ—ç»„</span></span><br><span class="line">dispatch_group_t group = dispatch_group_create();</span><br><span class="line"><span class="built_in">dispatch_queue_t</span> globalQueue = dispatch_get_global_queue(<span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">dispatch_group_enter(group);</span><br><span class="line"><span class="comment">//æ¨¡æ‹Ÿå¤šçº¿ç¨‹è€—æ—¶æ“ä½œ</span></span><br><span class="line">dispatch_group_async(group, globalQueue, ^&#123;</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@---block1ç»“æŸã€‚ã€‚ã€‚"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    dispatch_group_leave(group);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@---1ç»“æŸã€‚ã€‚ã€‚"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line"></span><br><span class="line">dispatch_group_enter(group);</span><br><span class="line"><span class="comment">//æ¨¡æ‹Ÿå¤šçº¿ç¨‹è€—æ—¶æ“ä½œ</span></span><br><span class="line">dispatch_group_async(group, globalQueue, ^&#123;</span><br><span class="line">    sleep(<span class="number">3</span>);</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@---block2ç»“æŸã€‚ã€‚ã€‚"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">    dispatch_group_leave(group);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@---2ç»“æŸã€‚ã€‚ã€‚"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line"></span><br><span class="line">dispatch_group_notify(group, globalQueue, ^&#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"%@---å…¨éƒ¨ç»“æŸã€‚ã€‚ã€‚"</span>,[<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<h4 id="NSOperation-åŸºæœ¬ä½¿ç”¨"><a href="#NSOperation-åŸºæœ¬ä½¿ç”¨" class="headerlink" title="NSOperation åŸºæœ¬ä½¿ç”¨"></a>NSOperation åŸºæœ¬ä½¿ç”¨</h4><p>1ï¼‰NSOperationã€NSOperationQueue ç®€ä»‹</p>
<p>NSOperationã€NSOperationQueue æ˜¯è‹¹æœæä¾›ç»™æˆ‘ä»¬çš„ä¸€å¥—å¤šçº¿ç¨‹è§£å†³æ–¹æ¡ˆã€‚å®é™…ä¸Š NSOperationã€NSOperationQueue æ˜¯åŸºäº GCD æ›´é«˜ä¸€å±‚çš„å°è£…ï¼Œå®Œå…¨é¢å‘å¯¹è±¡ã€‚ä½†æ˜¯æ¯” GCD æ›´ç®€å•æ˜“ç”¨ã€ä»£ç å¯è¯»æ€§ä¹Ÿæ›´é«˜ã€‚</p>
<p><em>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ NSOperationã€NSOperationQueueï¼Ÿ</em></p>
<ul>
<li>1.å¯æ·»åŠ å®Œæˆçš„ä»£ç å—ï¼Œåœ¨æ“ä½œå®Œæˆåæ‰§è¡Œã€‚</li>
<li>2.æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼Œæ–¹ä¾¿çš„æ§åˆ¶æ‰§è¡Œé¡ºåºã€‚</li>
<li>3.è®¾å®šæ“ä½œæ‰§è¡Œçš„ä¼˜å…ˆçº§ã€‚</li>
<li>4.å¯ä»¥å¾ˆæ–¹ä¾¿çš„å–æ¶ˆä¸€ä¸ªæ“ä½œçš„æ‰§è¡Œã€‚</li>
<li>5.ä½¿ç”¨ KVO è§‚å¯Ÿå¯¹æ“ä½œæ‰§è¡ŒçŠ¶æ€çš„æ›´æ”¹ï¼šisExecuteingã€isFinishedã€isCancelledã€‚</li>
</ul>
<p>2ï¼‰NSOperationã€NSOperationQueue æ“ä½œå’Œæ“ä½œé˜Ÿåˆ—</p>
<p>æ—¢ç„¶æ˜¯åŸºäº GCD çš„æ›´é«˜ä¸€å±‚çš„å°è£…ã€‚é‚£ä¹ˆï¼ŒGCD ä¸­çš„ä¸€äº›æ¦‚å¿µåŒæ ·é€‚ç”¨äº NSOperationã€NSOperationQueueã€‚åœ¨ NSOperationã€NSOperationQueue ä¸­ä¹Ÿæœ‰ç±»ä¼¼çš„ä»»åŠ¡ï¼ˆæ“ä½œï¼‰å’Œé˜Ÿåˆ—ï¼ˆæ“ä½œé˜Ÿåˆ—ï¼‰çš„æ¦‚å¿µã€‚</p>
<p><em>æ“ä½œï¼ˆOperationï¼‰ï¼š</em></p>
<ul>
<li>æ‰§è¡Œæ“ä½œçš„æ„æ€ï¼Œæ¢å¥è¯è¯´å°±æ˜¯ä½ åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œçš„é‚£æ®µä»£ç ã€‚</li>
<li>åœ¨ GCD ä¸­æ˜¯æ”¾åœ¨ block ä¸­çš„ã€‚åœ¨ NSOperation ä¸­ï¼Œæˆ‘ä»¬ä½¿ç”¨ NSOperation å­ç±» NSInvocationOperationã€NSBlockOperationï¼Œæˆ–è€…è‡ªå®šä¹‰å­ç±»æ¥å°è£…æ“ä½œã€‚</li>
</ul>
<p><em>æ“ä½œé˜Ÿåˆ—ï¼ˆOperation Queuesï¼‰ï¼š</em></p>
<ul>
<li>è¿™é‡Œçš„é˜Ÿåˆ—æŒ‡æ“ä½œé˜Ÿåˆ—ï¼Œå³ç”¨æ¥å­˜æ”¾æ“ä½œçš„é˜Ÿåˆ—ã€‚ä¸åŒäº GCD ä¸­çš„è°ƒåº¦é˜Ÿåˆ— FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰çš„åŸåˆ™ã€‚NSOperationQueue å¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚</li>
<li>æ“ä½œé˜Ÿåˆ—é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼ˆmaxConcurrentOperationCountï¼‰æ¥æ§åˆ¶å¹¶å‘ã€ä¸²è¡Œã€‚</li>
<li>NSOperationQueue ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ç§ä¸åŒç±»å‹çš„é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—å’Œè‡ªå®šä¹‰é˜Ÿåˆ—ã€‚ä¸»é˜Ÿåˆ—è¿è¡Œåœ¨ä¸»çº¿ç¨‹ä¹‹ä¸Šï¼Œè€Œè‡ªå®šä¹‰é˜Ÿåˆ—åœ¨åå°æ‰§è¡Œã€‚</li>
</ul>
<p>3ï¼‰NSOperationã€NSOperationQueue ä½¿ç”¨æ­¥éª¤</p>
<p>NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚å› ä¸ºé»˜è®¤æƒ…å†µä¸‹ï¼ŒNSOperation å•ç‹¬ä½¿ç”¨æ—¶ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œé…åˆ NSOperationQueue æˆ‘ä»¬èƒ½æ›´å¥½çš„å®ç°å¼‚æ­¥æ‰§è¡Œã€‚</p>
<p>NSOperation å®ç°å¤šçº¿ç¨‹çš„ä½¿ç”¨æ­¥éª¤åˆ†ä¸ºä¸‰æ­¥ï¼š</p>
<ul>
<li>1.åˆ›å»ºæ“ä½œï¼šå…ˆå°†éœ€è¦æ‰§è¡Œçš„æ“ä½œå°è£…åˆ°ä¸€ä¸ª NSOperation å¯¹è±¡ä¸­ã€‚</li>
<li>2.åˆ›å»ºé˜Ÿåˆ—ï¼šåˆ›å»º NSOperationQueue å¯¹è±¡ã€‚</li>
<li>3.å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ï¼šå°† NSOperation å¯¹è±¡æ·»åŠ åˆ° NSOperationQueue å¯¹è±¡ä¸­ã€‚</li>
</ul>
<p>ä¹‹åå‘¢ï¼Œç³»ç»Ÿå°±ä¼šè‡ªåŠ¨å°† NSOperationQueue ä¸­çš„ NSOperation å–å‡ºæ¥ï¼Œåœ¨æ–°çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œã€‚</p>
<p>ä¸‹é¢æˆ‘ä»¬æ¥å­¦ä¹ ä¸‹ NSOperation å’Œ NSOperationQueue çš„åŸºæœ¬ä½¿ç”¨ã€‚</p>
<p>4ï¼‰NSOperation å’Œ NSOperationQueue åŸºæœ¬ä½¿ç”¨</p>
<p>4.1ï¼‰åˆ›å»ºæ“ä½œ</p>
<p>NSOperation æ˜¯ä¸ªæŠ½è±¡ç±»ï¼Œä¸èƒ½ç”¨æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬åªæœ‰ä½¿ç”¨å®ƒçš„å­ç±»æ¥å°è£…æ“ä½œã€‚æˆ‘ä»¬æœ‰ä¸‰ç§æ–¹å¼æ¥å°è£…æ“ä½œã€‚</p>
<ul>
<li>ä½¿ç”¨å­ç±» NSInvocationOperation</li>
<li>ä½¿ç”¨å­ç±» NSBlockOperation</li>
<li>è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé€šè¿‡å®ç°å†…éƒ¨ç›¸åº”çš„æ–¹æ³•æ¥å°è£…æ“ä½œã€‚</li>
</ul>
<p>åœ¨ä¸ä½¿ç”¨ NSOperationQueueï¼Œå•ç‹¬ä½¿ç”¨ NSOperation çš„æƒ…å†µä¸‹ç³»ç»ŸåŒæ­¥æ‰§è¡Œæ“ä½œï¼Œä¸‹é¢æˆ‘ä»¬å­¦ä¹ ä»¥ä¸‹æ“ä½œçš„ä¸‰ç§åˆ›å»ºæ–¹å¼ã€‚</p>
<p>4.1.1ï¼‰ä½¿ç”¨å­ç±» NSInvocationOperation</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨å­ç±» NSInvocationOperation</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)useInvocationOperation &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»º NSInvocationOperation å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task1) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä»»åŠ¡1</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)task1 &#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">        [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">        <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef141b2eb525?w=759&amp;h=55&amp;f=png&amp;s=31082" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨ä½¿ç”¨å­ç±» NSInvocationOperation æ‰§è¡Œä¸€ä¸ªæ“ä½œçš„æƒ…å†µä¸‹ï¼Œæ“ä½œæ˜¯åœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</p>
</blockquote>
<p>å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨å…¶ä»–çº¿ç¨‹ä½¿ç”¨å­ç±» NSInvocationOperation</span></span><br><span class="line">[<span class="built_in">NSThread</span> detachNewThreadSelector:<span class="keyword">@selector</span>(useInvocationOperation) toTarget:<span class="keyword">self</span> withObject:<span class="literal">nil</span>];</span><br></pre></td></tr></table></figure>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef141c69bbf1?w=700&amp;h=58&amp;f=png&amp;s=37536" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼šåœ¨å…¶ä»–çº¿ç¨‹ä¸­å•ç‹¬ä½¿ç”¨å­ç±» NSInvocationOperationï¼Œæ“ä½œæ˜¯åœ¨å½“å‰è°ƒç”¨çš„å…¶ä»–çº¿ç¨‹æ‰§è¡Œçš„ï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</p>
</blockquote>
<p>4.1.2ï¼‰ä½¿ç”¨å­ç±» NSBlockOperation<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨å­ç±» NSBlockOperation</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)useBlockOperation &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»º NSBlockOperation å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="comment">// 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef141b47445e?w=747&amp;h=54&amp;f=png&amp;s=30954" alt=""></p>
<blockquote>
<p>æ³¨æ„ï¼šå’Œä¸Šè¾¹ NSInvocationOperation ä½¿ç”¨ä¸€æ ·ã€‚å› ä¸ºä»£ç æ˜¯åœ¨ä¸»çº¿ç¨‹ä¸­è°ƒç”¨çš„ï¼Œæ‰€ä»¥æ‰“å°ç»“æœä¸ºä¸»çº¿ç¨‹ã€‚å¦‚æœåœ¨å…¶ä»–çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œåˆ™æ‰“å°ç»“æœä¸ºå…¶ä»–çº¿ç¨‹ã€‚</p>
</blockquote>
<p>ä½†æ˜¯ï¼ŒNSBlockOperation è¿˜æä¾›äº†ä¸€ä¸ªæ–¹æ³• addExecutionBlock:ï¼Œé€šè¿‡ addExecutionBlock: å°±å¯ä»¥ä¸º NSBlockOperation æ·»åŠ é¢å¤–çš„æ“ä½œã€‚è¿™äº›æ“ä½œï¼ˆåŒ…æ‹¬ blockOperationWithBlock ä¸­çš„æ“ä½œï¼‰å¯ä»¥åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­åŒæ—¶ï¼ˆå¹¶å‘ï¼‰æ‰§è¡Œã€‚åªæœ‰å½“æ‰€æœ‰ç›¸å…³çš„æ“ä½œå·²ç»å®Œæˆæ‰§è¡Œæ—¶ï¼Œæ‰è§†ä¸ºå®Œæˆã€‚</p>
<p>å¦‚æœæ·»åŠ çš„æ“ä½œå¤šçš„è¯ï¼ŒblockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œï¼Œè¿™æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œå¹¶ä¸æ˜¯è¯´æ·»åŠ åˆ° blockOperationWithBlock: ä¸­çš„æ“ä½œä¸€å®šä¼šåœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œã€‚ï¼ˆå¯ä»¥ä½¿ç”¨ addExecutionBlock: å¤šæ·»åŠ å‡ ä¸ªæ“ä½œè¯•è¯•ï¼‰ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * ä½¿ç”¨å­ç±» NSBlockOperation</span></span><br><span class="line"><span class="comment"> * è°ƒç”¨æ–¹æ³• AddExecutionBlock:</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)useBlockOperationAddExecutionBlock &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»º NSBlockOperation å¯¹è±¡</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.æ·»åŠ é¢å¤–çš„æ“ä½œ</span></span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"3---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"4---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"5---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"6---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"7---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"8---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef141b10bb3e?w=750&amp;h=132&amp;f=png&amp;s=70358" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨å­ç±» NSBlockOperationï¼Œå¹¶è°ƒç”¨æ–¹æ³• AddExecutionBlock: çš„æƒ…å†µä¸‹ï¼ŒblockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œ å’Œ addExecutionBlock: ä¸­çš„æ“ä½œæ˜¯åœ¨ä¸åŒçš„çº¿ç¨‹ä¸­å¼‚æ­¥æ‰§è¡Œçš„ã€‚è€Œä¸”ï¼Œè¿™æ¬¡æ‰§è¡Œç»“æœä¸­ blockOperationWithBlock:æ–¹æ³•ä¸­çš„æ“ä½œä¹Ÿä¸æ˜¯åœ¨å½“å‰çº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œçš„ã€‚ä»è€Œå°è¯äº†blockOperationWithBlock: ä¸­çš„æ“ä½œä¹Ÿå¯èƒ½ä¼šåœ¨å…¶ä»–çº¿ç¨‹ï¼ˆéå½“å‰çº¿ç¨‹ï¼‰ä¸­æ‰§è¡Œã€‚</p>
</blockquote>
<p>ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œå¦‚æœä¸€ä¸ª NSBlockOperation å¯¹è±¡å°è£…äº†å¤šä¸ªæ“ä½œã€‚NSBlockOperation æ˜¯å¦å¼€å¯æ–°çº¿ç¨‹ï¼Œå–å†³äºæ“ä½œçš„ä¸ªæ•°ã€‚å¦‚æœæ·»åŠ çš„æ“ä½œçš„ä¸ªæ•°å¤šï¼Œå°±ä¼šè‡ªåŠ¨å¼€å¯æ–°çº¿ç¨‹ã€‚å½“ç„¶å¼€å¯çš„çº¿ç¨‹æ•°æ˜¯ç”±ç³»ç»Ÿæ¥å†³å®šçš„ã€‚</p>
<p>4.1.3ï¼‰ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»</p>
<p>å¦‚æœä½¿ç”¨å­ç±» NSInvocationOperationã€NSBlockOperation ä¸èƒ½æ»¡è¶³æ—¥å¸¸éœ€æ±‚ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»ã€‚å¯ä»¥é€šè¿‡é‡å†™ main æˆ–è€… start æ–¹æ³• æ¥å®šä¹‰è‡ªå·±çš„ NSOperation å¯¹è±¡ã€‚é‡å†™mainæ–¹æ³•æ¯”è¾ƒç®€å•ï¼Œæˆ‘ä»¬ä¸éœ€è¦ç®¡ç†æ“ä½œçš„çŠ¶æ€å±æ€§ isExecuting å’Œ isFinishedã€‚å½“ main æ‰§è¡Œå®Œè¿”å›çš„æ—¶å€™ï¼Œè¿™ä¸ªæ“ä½œå°±ç»“æŸäº†ã€‚</p>
<p>å…ˆå®šä¹‰ä¸€ä¸ªç»§æ‰¿è‡ª NSOperation çš„å­ç±»ï¼Œé‡å†™mainæ–¹æ³•ã€‚</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef141c59d0b8?w=212&amp;h=39&amp;f=png&amp;s=10741" alt=""></p>
<p>CustomOperation.h<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">CustomOperation</span> : <span class="title">NSOperation</span></span></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>CustomOperation.m<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#import <span class="meta-string">"CustomOperation.h"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">CustomOperation</span></span></span><br><span class="line">- (<span class="keyword">void</span>)main &#123;</span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">self</span>.isCancelled) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>];</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure></p>
<p>ä½¿ç”¨ç¤ºä¾‹<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)useCustomOperation &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»º YSCOperation å¯¹è±¡</span></span><br><span class="line">    CustomOperation *op = [[CustomOperation alloc] init];</span><br><span class="line">    <span class="comment">// 2.è°ƒç”¨ start æ–¹æ³•å¼€å§‹æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">    [op start];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼šåœ¨æ²¡æœ‰ä½¿ç”¨ NSOperationQueueã€åœ¨ä¸»çº¿ç¨‹å•ç‹¬ä½¿ç”¨è‡ªå®šä¹‰ç»§æ‰¿è‡ª NSOperation çš„å­ç±»çš„æƒ…å†µä¸‹ï¼Œæ˜¯åœ¨ä¸»çº¿ç¨‹æ‰§è¡Œæ“ä½œï¼Œå¹¶æ²¡æœ‰å¼€å¯æ–°çº¿ç¨‹ã€‚</p>
</blockquote>
<p>4.2ï¼‰åˆ›å»ºé˜Ÿåˆ—</p>
<p>NSOperationQueue ä¸€å…±æœ‰ä¸¤ç§é˜Ÿåˆ—ï¼šä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—ã€‚å…¶ä¸­è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶åŒ…å«äº†ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ã€‚ä¸‹è¾¹æ˜¯ä¸»é˜Ÿåˆ—ã€è‡ªå®šä¹‰é˜Ÿåˆ—çš„åŸºæœ¬åˆ›å»ºæ–¹æ³•å’Œç‰¹ç‚¹ã€‚</p>
<ul>
<li>ä¸»é˜Ÿåˆ—</li>
</ul>
<p>å‡¡æ˜¯æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œéƒ½ä¼šæ”¾åˆ°ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œã€‚<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»é˜Ÿåˆ—è·å–æ–¹æ³•</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [<span class="built_in">NSOperationQueue</span> mainQueue];</span><br></pre></td></tr></table></figure></p>
<ul>
<li>è‡ªå®šä¹‰é˜Ÿåˆ—ï¼ˆéä¸»é˜Ÿåˆ—ï¼‰</li>
</ul>
<p>æ·»åŠ åˆ°è¿™ç§é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œå°±ä¼šè‡ªåŠ¨æ”¾åˆ°å­çº¿ç¨‹ä¸­æ‰§è¡Œï¼ˆåŒæ—¶åŒ…å«äº†ï¼šä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼‰<br><figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è‡ªå®šä¹‰é˜Ÿåˆ—åˆ›å»ºæ–¹æ³•</span></span><br><span class="line"><span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br></pre></td></tr></table></figure></p>
<p>4.3ï¼‰å°†æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­</p>
<p>ä¸Šè¾¹æˆ‘ä»¬è¯´åˆ° NSOperation éœ€è¦é…åˆ NSOperationQueue æ¥å®ç°å¤šçº¿ç¨‹ã€‚</p>
<p>é‚£ä¹ˆæˆ‘ä»¬éœ€è¦å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°é˜Ÿåˆ—ä¸­å»ã€‚æ€»å…±æœ‰ä¸¤ç§æ–¹æ³•ï¼š</p>
<ul>
<li>1.-(void)addOperation:(NSOperation *)op; éœ€è¦å…ˆåˆ›å»ºæ“ä½œï¼Œå†å°†åˆ›å»ºå¥½çš„æ“ä½œåŠ å…¥åˆ°åˆ›å»ºå¥½çš„é˜Ÿåˆ—ä¸­å»ã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperationToQueue &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ›å»ºæ“ä½œ</span></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ1</span></span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op1 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task1) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ NSInvocationOperation åˆ›å»ºæ“ä½œ2</span></span><br><span class="line">    <span class="built_in">NSInvocationOperation</span> *op2 = [[<span class="built_in">NSInvocationOperation</span> alloc] initWithTarget:<span class="keyword">self</span> selector:<span class="keyword">@selector</span>(task2) object:<span class="literal">nil</span>];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ä½¿ç”¨ NSBlockOperation åˆ›å»ºæ“ä½œ3</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op3 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"3---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [op3 addExecutionBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"4---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.ä½¿ç”¨ addOperation: æ·»åŠ æ‰€æœ‰æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    [queue addOperation:op1]; <span class="comment">// [op1 start]</span></span><br><span class="line">    [queue addOperation:op2]; <span class="comment">// [op2 start]</span></span><br><span class="line">    [queue addOperation:op3]; <span class="comment">// [op3 start]</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef1442982f62?w=756&amp;h=109&amp;f=png&amp;s=57893" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ NSOperation å­ç±»åˆ›å»ºæ“ä½œï¼Œå¹¶ä½¿ç”¨ addOperation: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</p>
</blockquote>
<ul>
<li>2.-(void)addOperationWithBlock:(void (^)(void))block; æ— éœ€å…ˆåˆ›å»ºæ“ä½œï¼Œåœ¨ block ä¸­æ·»åŠ æ“ä½œï¼Œç›´æ¥å°†åŒ…å«æ“ä½œçš„ block åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—ä¸­</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)addOperationWithBlockToQueue &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.ä½¿ç”¨ addOperationWithBlock: æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"3---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef14428ecf18?w=754&amp;h=132&amp;f=png&amp;s=71804" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼šä½¿ç”¨ addOperationWithBlock: å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—åèƒ½å¤Ÿå¼€å¯æ–°çº¿ç¨‹ï¼Œè¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</p>
</blockquote>
<p>5ï¼‰NSOperationQueue æ§åˆ¶ä¸²è¡Œæ‰§è¡Œã€å¹¶å‘æ‰§è¡Œ</p>
<p>ä¹‹å‰æˆ‘ä»¬è¯´è¿‡ï¼ŒNSOperationQueue åˆ›å»ºçš„è‡ªå®šä¹‰é˜Ÿåˆ—åŒæ—¶å…·æœ‰ä¸²è¡Œã€å¹¶å‘åŠŸèƒ½ï¼Œä¸Šè¾¹æˆ‘ä»¬æ¼”ç¤ºäº†å¹¶å‘åŠŸèƒ½ï¼Œé‚£ä¹ˆä»–çš„ä¸²è¡ŒåŠŸèƒ½æ˜¯å¦‚ä½•å®ç°çš„ï¼Ÿ</p>
<p>è¿™é‡Œæœ‰ä¸ªå…³é”®å±æ€§ maxConcurrentOperationCountï¼Œå«åšæœ€å¤§å¹¶å‘æ“ä½œæ•°ã€‚ç”¨æ¥æ§åˆ¶ä¸€ä¸ªç‰¹å®šé˜Ÿåˆ—ä¸­å¯ä»¥æœ‰å¤šå°‘ä¸ªæ“ä½œåŒæ—¶å‚ä¸å¹¶å‘æ‰§è¡Œã€‚</p>
<blockquote>
<p>æ³¨æ„ï¼šè¿™é‡Œ maxConcurrentOperationCount æ§åˆ¶çš„ä¸æ˜¯å¹¶å‘çº¿ç¨‹çš„æ•°é‡ï¼Œè€Œæ˜¯ä¸€ä¸ªé˜Ÿåˆ—ä¸­åŒæ—¶èƒ½å¹¶å‘æ‰§è¡Œçš„æœ€å¤§æ“ä½œæ•°ã€‚è€Œä¸”ä¸€ä¸ªæ“ä½œä¹Ÿå¹¶éåªèƒ½åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è¿è¡Œã€‚</p>
</blockquote>
<p>maxConcurrentOperationCount æœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼š</p>
<ul>
<li>maxConcurrentOperationCount é»˜è®¤æƒ…å†µä¸‹ä¸º-1ï¼Œè¡¨ç¤ºä¸è¿›è¡Œé™åˆ¶ï¼Œå¯è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚</li>
<li>maxConcurrentOperationCount ä¸º1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºä¸²è¡Œé˜Ÿåˆ—ã€‚åªèƒ½ä¸²è¡Œæ‰§è¡Œã€‚</li>
<li>maxConcurrentOperationCount å¤§äº1æ—¶ï¼Œé˜Ÿåˆ—ä¸ºå¹¶å‘é˜Ÿåˆ—ã€‚æ“ä½œå¹¶å‘æ‰§è¡Œï¼Œå½“ç„¶è¿™ä¸ªå€¼ä¸åº”è¶…è¿‡ç³»ç»Ÿé™åˆ¶ï¼Œå³ä½¿è‡ªå·±è®¾ç½®ä¸€ä¸ªå¾ˆå¤§çš„å€¼ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´ä¸º min{è‡ªå·±è®¾å®šçš„å€¼ï¼Œç³»ç»Ÿè®¾å®šçš„é»˜è®¤æœ€å¤§å€¼}ã€‚</li>
</ul>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* è®¾ç½® MaxConcurrentOperationCountï¼ˆæœ€å¤§å¹¶å‘æ“ä½œæ•°ï¼‰</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)setMaxConcurrentOperationCount &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.è®¾ç½®æœ€å¤§å¹¶å‘æ“ä½œæ•°</span></span><br><span class="line">    queue.maxConcurrentOperationCount = <span class="number">1</span>; <span class="comment">// ä¸²è¡Œé˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// queue.maxConcurrentOperationCount = 2; // å¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line">    <span class="comment">// queue.maxConcurrentOperationCount = 8; // å¹¶å‘é˜Ÿåˆ—</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.æ·»åŠ æ“ä½œ</span></span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"3---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"4---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>maxConcurrentOperationCount è®¾ç½®ä¸º 1ï¼Œè¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef1442851adc?w=753&amp;h=211&amp;f=png&amp;s=110267" alt=""></p>
<p>maxConcurrentOperationCount è®¾ç½®ä¸º 2ï¼Œè¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef144468a6f0?w=756&amp;h=212&amp;f=png&amp;s=109339" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼šå½“æœ€å¤§å¹¶å‘æ“ä½œæ•°ä¸º1æ—¶ï¼Œæ“ä½œæ˜¯æŒ‰é¡ºåºä¸²è¡Œæ‰§è¡Œçš„ï¼Œå¹¶ä¸”ä¸€ä¸ªæ“ä½œå®Œæˆä¹‹åï¼Œä¸‹ä¸€ä¸ªæ“ä½œæ‰å¼€å§‹æ‰§è¡Œã€‚å½“æœ€å¤§æ“ä½œå¹¶å‘æ•°ä¸º2æ—¶ï¼Œæ“ä½œæ˜¯å¹¶å‘æ‰§è¡Œçš„ï¼Œå¯ä»¥åŒæ—¶æ‰§è¡Œä¸¤ä¸ªæ“ä½œã€‚è€Œå¼€å¯çº¿ç¨‹æ•°é‡æ˜¯ç”±ç³»ç»Ÿå†³å®šçš„ï¼Œä¸éœ€è¦æˆ‘ä»¬æ¥ç®¡ç†ã€‚</p>
</blockquote>
<p>6ï¼‰NSOperation æ“ä½œä¾èµ–</p>
<p>NSOperationã€NSOperationQueue æœ€å¸å¼•äººçš„åœ°æ–¹æ˜¯å®ƒèƒ½æ·»åŠ æ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚é€šè¿‡æ“ä½œä¾èµ–ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆæ–¹ä¾¿çš„æ§åˆ¶æ“ä½œä¹‹é—´çš„æ‰§è¡Œå…ˆåé¡ºåºã€‚NSOperation æä¾›äº†3ä¸ªæ¥å£ä¾›æˆ‘ä»¬ç®¡ç†å’ŒæŸ¥çœ‹ä¾èµ–ã€‚</p>
<ul>
<li>-(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</li>
<li>-(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚</li>
<li>@property (readonly, copy) NSArray<nsoperation *=""> *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</nsoperation></li>
</ul>
<p>å½“ç„¶ï¼Œæˆ‘ä»¬ç»å¸¸ç”¨åˆ°çš„è¿˜æ˜¯æ·»åŠ ä¾èµ–æ“ä½œã€‚ç°åœ¨è€ƒè™‘è¿™æ ·çš„éœ€æ±‚ï¼Œæ¯”å¦‚è¯´æœ‰ Aã€B ä¸¤ä¸ªæ“ä½œï¼Œå…¶ä¸­ A æ‰§è¡Œå®Œæ“ä½œï¼ŒB æ‰èƒ½æ‰§è¡Œæ“ä½œã€‚</p>
<p>å¦‚æœä½¿ç”¨ä¾èµ–æ¥å¤„ç†çš„è¯ï¼Œé‚£ä¹ˆå°±éœ€è¦è®©æ“ä½œ B ä¾èµ–äºæ“ä½œ Aã€‚å…·ä½“ä»£ç å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* æ“ä½œä¾èµ–</span></span><br><span class="line"><span class="comment">* ä½¿ç”¨æ–¹æ³•ï¼šaddDependency:</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)addDependency &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ›å»ºæ“ä½œ</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.æ·»åŠ ä¾èµ–</span></span><br><span class="line">    [op2 addDependency:op1]; <span class="comment">// è®©op2 ä¾èµ–äº op1ï¼Œåˆ™å…ˆæ‰§è¡Œop1ï¼Œåœ¨æ‰§è¡Œop2</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.æ·»åŠ æ“ä½œåˆ°é˜Ÿåˆ—ä¸­</span></span><br><span class="line">    [queue addOperation:op1];</span><br><span class="line">    [queue addOperation:op2];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef1444b73cbd?w=759&amp;h=107&amp;f=png&amp;s=56815" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼šé€šè¿‡æ·»åŠ æ“ä½œä¾èµ–ï¼Œæ— è®ºè¿è¡Œå‡ æ¬¡ï¼Œå…¶ç»“æœéƒ½æ˜¯ op1 å…ˆæ‰§è¡Œï¼Œop2 åæ‰§è¡Œã€‚</p>
</blockquote>
<p>7ï¼‰NSOperation ä¼˜å…ˆçº§</p>
<p>NSOperation æä¾›äº†queuePriorityï¼ˆä¼˜å…ˆçº§ï¼‰å±æ€§ï¼ŒqueuePriorityå±æ€§é€‚ç”¨äºåŒä¸€æ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œä¸é€‚ç”¨äºä¸åŒæ“ä½œé˜Ÿåˆ—ä¸­çš„æ“ä½œã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œæ‰€æœ‰æ–°åˆ›å»ºçš„æ“ä½œå¯¹è±¡ä¼˜å…ˆçº§éƒ½æ˜¯NSOperationQueuePriorityNormalã€‚ä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡setQueuePriority:æ–¹æ³•æ¥æ”¹å˜å½“å‰æ“ä½œåœ¨åŒä¸€é˜Ÿåˆ—ä¸­çš„æ‰§è¡Œä¼˜å…ˆçº§ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¼˜å…ˆçº§çš„å–å€¼</span></span><br><span class="line"><span class="keyword">typedef</span> <span class="built_in">NS_ENUM</span>(<span class="built_in">NSInteger</span>, <span class="built_in">NSOperationQueuePriority</span>) &#123;</span><br><span class="line"><span class="built_in">NSOperationQueuePriorityVeryLow</span> = <span class="number">-8</span>L,</span><br><span class="line"><span class="built_in">NSOperationQueuePriorityLow</span> = <span class="number">-4</span>L,</span><br><span class="line"><span class="built_in">NSOperationQueuePriorityNormal</span> = <span class="number">0</span>,</span><br><span class="line"><span class="built_in">NSOperationQueuePriorityHigh</span> = <span class="number">4</span>,</span><br><span class="line"><span class="built_in">NSOperationQueuePriorityVeryHigh</span> = <span class="number">8</span></span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<p>ä¸Šè¾¹æˆ‘ä»¬è¯´è¿‡ï¼šå¯¹äºæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œï¼Œé¦–å…ˆè¿›å…¥å‡†å¤‡å°±ç»ªçš„çŠ¶æ€ï¼ˆå°±ç»ªçŠ¶æ€å–å†³äºæ“ä½œä¹‹é—´çš„ä¾èµ–å…³ç³»ï¼‰ï¼Œç„¶åè¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œçš„å¼€å§‹æ‰§è¡Œé¡ºåºï¼ˆéç»“æŸæ‰§è¡Œé¡ºåºï¼‰ç”±æ“ä½œä¹‹é—´ç›¸å¯¹çš„ä¼˜å…ˆçº§å†³å®šï¼ˆä¼˜å…ˆçº§æ˜¯æ“ä½œå¯¹è±¡è‡ªèº«çš„å±æ€§ï¼‰ã€‚</p>
<p>é‚£ä¹ˆï¼Œä»€ä¹ˆæ ·çš„æ“ä½œæ‰æ˜¯è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œå‘¢ï¼Ÿ</p>
<p>å½“ä¸€ä¸ªæ“ä½œçš„æ‰€æœ‰ä¾èµ–éƒ½å·²ç»å®Œæˆæ—¶ï¼Œæ“ä½œå¯¹è±¡é€šå¸¸ä¼šè¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…æ‰§è¡Œã€‚<br>ä¸¾ä¸ªä¾‹å­ï¼Œç°åœ¨æœ‰4ä¸ªä¼˜å…ˆçº§éƒ½æ˜¯ NSOperationQueuePriorityNormalï¼ˆé»˜è®¤çº§åˆ«ï¼‰çš„æ“ä½œï¼šop1ï¼Œop2ï¼Œop3ï¼Œop4ã€‚å…¶ä¸­ op3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼Œå³ op3 -&gt; op2 -&gt; op1ã€‚ç°åœ¨å°†è¿™4ä¸ªæ“ä½œæ·»åŠ åˆ°é˜Ÿåˆ—ä¸­å¹¶å‘æ‰§è¡Œã€‚</p>
<p>å› ä¸º op1 å’Œ op4 éƒ½æ²¡æœ‰éœ€è¦ä¾èµ–çš„æ“ä½œï¼Œæ‰€ä»¥åœ¨ op1ï¼Œop4 æ‰§è¡Œä¹‹å‰ï¼Œå°±æ˜¯å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œã€‚<br>è€Œ op3 å’Œ op2 éƒ½æœ‰ä¾èµ–çš„æ“ä½œï¼ˆop3 ä¾èµ–äº op2ï¼Œop2 ä¾èµ–äº op1ï¼‰ï¼Œæ‰€ä»¥ op3 å’Œ op2 éƒ½ä¸æ˜¯å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œã€‚<br>ç†è§£äº†è¿›å…¥å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±ç†è§£äº†queuePriority å±æ€§çš„ä½œç”¨å¯¹è±¡ã€‚</p>
<p>queuePriority å±æ€§å†³å®šäº†è¿›å…¥å‡†å¤‡å°±ç»ªçŠ¶æ€ä¸‹çš„æ“ä½œä¹‹é—´çš„å¼€å§‹æ‰§è¡Œé¡ºåºã€‚å¹¶ä¸”ï¼Œä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚<br>å¦‚æœä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«é«˜ä¼˜å…ˆçº§æ“ä½œï¼ŒåˆåŒ…å«ä½ä¼˜å…ˆçº§æ“ä½œï¼Œå¹¶ä¸”ä¸¤ä¸ªæ“ä½œéƒ½å·²ç»å‡†å¤‡å°±ç»ªï¼Œé‚£ä¹ˆé˜Ÿåˆ—å…ˆæ‰§è¡Œé«˜ä¼˜å…ˆçº§æ“ä½œã€‚æ¯”å¦‚ä¸Šä¾‹ä¸­ï¼Œå¦‚æœ op1 å’Œ op4 æ˜¯ä¸åŒä¼˜å…ˆçº§çš„æ“ä½œï¼Œé‚£ä¹ˆå°±ä¼šå…ˆæ‰§è¡Œä¼˜å…ˆçº§é«˜çš„æ“ä½œã€‚</p>
<p>å¦‚æœï¼Œä¸€ä¸ªé˜Ÿåˆ—ä¸­æ—¢åŒ…å«äº†å‡†å¤‡å°±ç»ªçŠ¶æ€çš„æ“ä½œï¼ŒåˆåŒ…å«äº†æœªå‡†å¤‡å°±ç»ªçš„æ“ä½œï¼Œæœªå‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§æ¯”å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§é«˜ã€‚é‚£ä¹ˆï¼Œè™½ç„¶å‡†å¤‡å°±ç»ªçš„æ“ä½œä¼˜å…ˆçº§ä½ï¼Œä¹Ÿä¼šä¼˜å…ˆæ‰§è¡Œã€‚ä¼˜å…ˆçº§ä¸èƒ½å–ä»£ä¾èµ–å…³ç³»ã€‚å¦‚æœè¦æ§åˆ¶æ“ä½œé—´çš„å¯åŠ¨é¡ºåºï¼Œåˆ™å¿…é¡»ä½¿ç”¨ä¾èµ–å…³ç³»ã€‚</p>
<p>8ï¼‰NSOperationã€NSOperationQueue çº¿ç¨‹é—´çš„é€šä¿¡</p>
<p>åœ¨ iOS å¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬ä¸€èˆ¬åœ¨ä¸»çº¿ç¨‹é‡Œè¾¹è¿›è¡Œ UI åˆ·æ–°ï¼Œä¾‹å¦‚ï¼šç‚¹å‡»ã€æ»šåŠ¨ã€æ‹–æ‹½ç­‰äº‹ä»¶ã€‚æˆ‘ä»¬é€šå¸¸æŠŠä¸€äº›è€—æ—¶çš„æ“ä½œæ”¾åœ¨å…¶ä»–çº¿ç¨‹ï¼Œæ¯”å¦‚è¯´å›¾ç‰‡ä¸‹è½½ã€æ–‡ä»¶ä¸Šä¼ ç­‰è€—æ—¶æ“ä½œã€‚è€Œå½“æˆ‘ä»¬æœ‰æ—¶å€™åœ¨å…¶ä»–çº¿ç¨‹å®Œæˆäº†è€—æ—¶æ“ä½œæ—¶ï¼Œéœ€è¦å›åˆ°ä¸»çº¿ç¨‹ï¼Œé‚£ä¹ˆå°±ç”¨åˆ°äº†çº¿ç¨‹ä¹‹é—´çš„é€šè®¯ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* çº¿ç¨‹é—´é€šä¿¡</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)communication &#123;</span><br><span class="line">    <span class="comment">// 1.åˆ›å»ºé˜Ÿåˆ—</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue = [[<span class="built_in">NSOperationQueue</span> alloc]init];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.æ·»åŠ æ“ä½œ</span></span><br><span class="line">    [queue addOperationWithBlock:^&#123;</span><br><span class="line">        <span class="comment">// å¼‚æ­¥è¿›è¡Œè€—æ—¶æ“ä½œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"1---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// å›åˆ°ä¸»çº¿ç¨‹</span></span><br><span class="line">        [[<span class="built_in">NSOperationQueue</span> mainQueue] addOperationWithBlock:^&#123;</span><br><span class="line">            <span class="comment">// è¿›è¡Œä¸€äº› UI åˆ·æ–°ç­‰æ“ä½œ</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>; i++) &#123;</span><br><span class="line">                [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">2</span>]; <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"2---%@"</span>, [<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">    &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef14615756a6?w=758&amp;h=112&amp;f=png&amp;s=56793" alt=""></p>
<p>9ï¼‰NSOperationã€NSOperationQueue çº¿ç¨‹åŒæ­¥å’Œçº¿ç¨‹å®‰å…¨</p>
<p>çº¿ç¨‹å®‰å…¨ï¼šå¦‚æœä½ çš„ä»£ç æ‰€åœ¨çš„è¿›ç¨‹ä¸­æœ‰å¤šä¸ªçº¿ç¨‹åœ¨åŒæ—¶è¿è¡Œï¼Œè€Œè¿™äº›çº¿ç¨‹å¯èƒ½ä¼šåŒæ—¶è¿è¡Œè¿™æ®µä»£ç ã€‚å¦‚æœæ¯æ¬¡è¿è¡Œç»“æœå’Œå•çº¿ç¨‹è¿è¡Œçš„ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œè€Œä¸”å…¶ä»–çš„å˜é‡çš„å€¼ä¹Ÿå’Œé¢„æœŸçš„æ˜¯ä¸€æ ·çš„ï¼Œå°±æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</p>
<p>è‹¥æ¯ä¸ªçº¿ç¨‹ä¸­å¯¹å…¨å±€å˜é‡ã€é™æ€å˜é‡åªæœ‰è¯»æ“ä½œï¼Œè€Œæ— å†™æ“ä½œï¼Œä¸€èˆ¬æ¥è¯´ï¼Œè¿™ä¸ªå…¨å±€å˜é‡æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼›è‹¥æœ‰å¤šä¸ªçº¿ç¨‹åŒæ—¶æ‰§è¡Œå†™æ“ä½œï¼ˆæ›´æ”¹å˜é‡ï¼‰ï¼Œä¸€èˆ¬éƒ½éœ€è¦è€ƒè™‘çº¿ç¨‹åŒæ­¥ï¼Œå¦åˆ™çš„è¯å°±å¯èƒ½å½±å“çº¿ç¨‹å®‰å…¨ã€‚</p>
<p>çº¿ç¨‹åŒæ­¥ï¼šå¯ç†è§£ä¸ºçº¿ç¨‹ A å’Œ çº¿ç¨‹ B ä¸€å—é…åˆï¼ŒA æ‰§è¡Œåˆ°ä¸€å®šç¨‹åº¦æ—¶è¦ä¾é çº¿ç¨‹ B çš„æŸä¸ªç»“æœï¼Œäºæ˜¯åœä¸‹æ¥ï¼Œç¤ºæ„ B è¿è¡Œï¼›B ä¾è¨€æ‰§è¡Œï¼Œå†å°†ç»“æœç»™ Aï¼›A å†ç»§ç»­æ“ä½œã€‚</p>
<p>ä¸¾ä¸ªç®€å•ä¾‹å­å°±æ˜¯ï¼šä¸¤ä¸ªäººåœ¨ä¸€èµ·èŠå¤©ã€‚ä¸¤ä¸ªäººä¸èƒ½åŒæ—¶è¯´è¯ï¼Œé¿å…å¬ä¸æ¸…(æ“ä½œå†²çª)ã€‚ç­‰ä¸€ä¸ªäººè¯´å®Œ(ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ“ä½œ)ï¼Œå¦ä¸€ä¸ªå†è¯´(å¦ä¸€ä¸ªçº¿ç¨‹å†å¼€å§‹æ“ä½œ)ã€‚</p>
<p>ä¸‹é¢ï¼Œæˆ‘ä»¬æ¨¡æ‹Ÿç«è½¦ç¥¨å”®å–çš„æ–¹å¼ï¼Œå®ç° NSOperation çº¿ç¨‹å®‰å…¨å’Œè§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</p>
<blockquote>
<p>åœºæ™¯ï¼šæ€»å…±æœ‰50å¼ ç«è½¦ç¥¨ï¼Œæœ‰ä¸¤ä¸ªå”®å–ç«è½¦ç¥¨çš„çª—å£ï¼Œä¸€ä¸ªæ˜¯åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£ï¼Œå¦ä¸€ä¸ªæ˜¯ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£ã€‚ä¸¤ä¸ªçª—å£åŒæ—¶å”®å–ç«è½¦ç¥¨ï¼Œå–å®Œä¸ºæ­¢ã€‚</p>
</blockquote>
<p>9.1ï¼‰NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨</p>
<p>å…ˆæ¥çœ‹çœ‹ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨çš„ä»£ç ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* éçº¿ç¨‹å®‰å…¨ï¼šä¸ä½¿ç”¨ NSLock</span></span><br><span class="line"><span class="comment">* åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(éçº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)initTicketStatusNotSave &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"currentThread---%@"</span>,[<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">self</span>.ticketSurplusCount = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue1 = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    queue1.maxConcurrentOperationCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue2 = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    queue2.maxConcurrentOperationCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1</span></span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        [weakSelf saleTicketNotSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        [weakSelf saleTicketNotSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨</span></span><br><span class="line">    [queue1 addOperation:op1];</span><br><span class="line">    [queue2 addOperation:op2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å”®å–ç«è½¦ç¥¨(éçº¿ç¨‹å®‰å…¨)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)saleTicketNotSafe &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.ticketSurplusCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span></span><br><span class="line">            <span class="keyword">self</span>.ticketSurplusCount--;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"å‰©ä½™ç¥¨æ•°:%d çª—å£:%@"</span>, <span class="keyword">self</span>.ticketSurplusCount, [<span class="built_in">NSThread</span> currentThread]]);</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">0.2</span>];</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef1464986694?w=665&amp;h=118&amp;f=png&amp;s=75328" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹åˆ°ï¼šåœ¨ä¸è€ƒè™‘çº¿ç¨‹å®‰å…¨ï¼Œä¸ä½¿ç”¨ NSLock æƒ…å†µä¸‹ï¼Œåœ¨0ç¥¨åä¾ç„¶å‡ºç¥¨ï¼Œæ•°æ®æ··ä¹±ï¼Œè¿™æ ·æ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚ï¼Œæ‰€ä»¥æˆ‘ä»¬éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚</p>
</blockquote>
<p>9.2ï¼‰NSOperationã€NSOperationQueue éçº¿ç¨‹å®‰å…¨</p>
<p>çº¿ç¨‹å®‰å…¨è§£å†³æ–¹æ¡ˆï¼šå¯ä»¥ç»™çº¿ç¨‹åŠ é”ï¼Œåœ¨ä¸€ä¸ªçº¿ç¨‹æ‰§è¡Œè¯¥æ“ä½œçš„æ—¶å€™ï¼Œä¸å…è®¸å…¶ä»–çº¿ç¨‹è¿›è¡Œæ“ä½œã€‚iOS å®ç°çº¿ç¨‹åŠ é”æœ‰å¾ˆå¤šç§æ–¹å¼ã€‚@synchronizedã€ NSLockã€NSRecursiveLockã€NSConditionã€NSConditionLockã€pthread_mutexã€dispatch_semaphoreã€OSSpinLockã€atomic(property) set/geç­‰ç­‰å„ç§æ–¹å¼ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ NSLock å¯¹è±¡æ¥è§£å†³çº¿ç¨‹åŒæ­¥é—®é¢˜ã€‚</p>
<p>NSLock å¯¹è±¡å¯ä»¥é€šè¿‡è¿›å…¥é”æ—¶è°ƒç”¨ lock æ–¹æ³•ï¼Œè§£é”æ—¶è°ƒç”¨ unlock æ–¹æ³•æ¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* çº¿ç¨‹å®‰å…¨ï¼šä½¿ç”¨ NSLock åŠ é”</span></span><br><span class="line"><span class="comment">* åˆå§‹åŒ–ç«è½¦ç¥¨æ•°é‡ã€å–ç¥¨çª—å£(çº¿ç¨‹å®‰å…¨)ã€å¹¶å¼€å§‹å–ç¥¨</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)initTicketStatusSave &#123;</span><br><span class="line">    <span class="built_in">NSLog</span>(<span class="string">@"currentThread---%@"</span>,[<span class="built_in">NSThread</span> currentThread]); <span class="comment">// æ‰“å°å½“å‰çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">self</span>.ticketSurplusCount = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">self</span>.lock = [[<span class="built_in">NSLock</span> alloc] init];  <span class="comment">// åˆå§‹åŒ– NSLock å¯¹è±¡</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// 1.åˆ›å»º queue1,queue1 ä»£è¡¨åŒ—äº¬ç«è½¦ç¥¨å”®å–çª—å£</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue1 = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    queue1.maxConcurrentOperationCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 2.åˆ›å»º queue2,queue2 ä»£è¡¨ä¸Šæµ·ç«è½¦ç¥¨å”®å–çª—å£</span></span><br><span class="line">    <span class="built_in">NSOperationQueue</span> *queue2 = [[<span class="built_in">NSOperationQueue</span> alloc] init];</span><br><span class="line">    queue2.maxConcurrentOperationCount = <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 3.åˆ›å»ºå–ç¥¨æ“ä½œ op1</span></span><br><span class="line">    __<span class="keyword">weak</span> <span class="keyword">typeof</span>(<span class="keyword">self</span>) weakSelf = <span class="keyword">self</span>;</span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op1 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        [weakSelf saleTicketSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 4.åˆ›å»ºå–ç¥¨æ“ä½œ op2</span></span><br><span class="line">    <span class="built_in">NSBlockOperation</span> *op2 = [<span class="built_in">NSBlockOperation</span> blockOperationWithBlock:^&#123;</span><br><span class="line">        [weakSelf saleTicketSafe];</span><br><span class="line">    &#125;];</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 5.æ·»åŠ æ“ä½œï¼Œå¼€å§‹å–ç¥¨</span></span><br><span class="line">    [queue1 addOperation:op1];</span><br><span class="line">    [queue2 addOperation:op2];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* å”®å–ç«è½¦ç¥¨(çº¿ç¨‹å®‰å…¨)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">- (<span class="keyword">void</span>)saleTicketSafe &#123;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="comment">// åŠ é”</span></span><br><span class="line">        [<span class="keyword">self</span>.lock lock];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.ticketSurplusCount &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//å¦‚æœè¿˜æœ‰ç¥¨ï¼Œç»§ç»­å”®å–</span></span><br><span class="line">            <span class="keyword">self</span>.ticketSurplusCount--;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"%@"</span>, [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"å‰©ä½™ç¥¨æ•°:%d çª—å£:%@"</span>, <span class="keyword">self</span>.ticketSurplusCount, [<span class="built_in">NSThread</span> currentThread]]);</span><br><span class="line">            [<span class="built_in">NSThread</span> sleepForTimeInterval:<span class="number">0.2</span>];</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è§£é”</span></span><br><span class="line">        [<span class="keyword">self</span>.lock unlock];</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">self</span>.ticketSurplusCount &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"æ‰€æœ‰ç«è½¦ç¥¨å‡å·²å”®å®Œ"</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿è¡Œç»“æœ</p>
<p><img src="https://user-gold-cdn.xitu.io/2018/6/5/163cef04224f6476?w=684&amp;h=181&amp;f=png&amp;s=105710" alt=""></p>
<blockquote>
<p>å¯ä»¥çœ‹å‡ºï¼šåœ¨è€ƒè™‘äº†çº¿ç¨‹å®‰å…¨ï¼Œä½¿ç”¨ NSLock åŠ é”ã€è§£é”æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œå¾—åˆ°çš„ç¥¨æ•°æ˜¯æ­£ç¡®çš„ï¼Œæ²¡æœ‰å‡ºç°æ··ä¹±çš„æƒ…å†µã€‚æˆ‘ä»¬ä¹Ÿå°±è§£å†³äº†å¤šä¸ªçº¿ç¨‹åŒæ­¥çš„é—®é¢˜ã€‚</p>
</blockquote>
<p>10ï¼‰NSOperationã€NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•å½’çº³</p>
<p>10.1ï¼‰NSOperation å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</p>
<p>å–æ¶ˆæ“ä½œæ–¹æ³•</p>
<ul>
<li>-(void)cancel; å¯å–æ¶ˆæ“ä½œï¼Œå®è´¨æ˜¯æ ‡è®° isCancelled çŠ¶æ€ã€‚<br>åˆ¤æ–­æ“ä½œçŠ¶æ€æ–¹æ³•</li>
<li>-(BOOL)isFinished; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»ç»“æŸã€‚</li>
<li>-(BOOL)isCancelled; åˆ¤æ–­æ“ä½œæ˜¯å¦å·²ç»æ ‡è®°ä¸ºå–æ¶ˆã€‚</li>
<li>-(BOOL)isExecuting; åˆ¤æ–­æ“ä½œæ˜¯å¦æ­£åœ¨åœ¨è¿è¡Œã€‚</li>
<li>-(BOOL)isReady; åˆ¤æ–­æ“ä½œæ˜¯å¦å¤„äºå‡†å¤‡å°±ç»ªçŠ¶æ€ï¼Œè¿™ä¸ªå€¼å’Œæ“ä½œçš„ä¾èµ–å…³ç³»ç›¸å…³ã€‚<br>æ“ä½œåŒæ­¥</li>
<li>-(void)waitUntilFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°è¯¥æ“ä½œç»“æŸã€‚å¯ç”¨äºçº¿ç¨‹æ‰§è¡Œé¡ºåºçš„åŒæ­¥ã€‚</li>
<li>-(void)setCompletionBlock:(void (^)(void))block; completionBlock ä¼šåœ¨å½“å‰æ“ä½œæ‰§è¡Œå®Œæ¯•æ—¶æ‰§è¡Œ completionBlockã€‚</li>
<li>-(void)addDependency:(NSOperation *)op; æ·»åŠ ä¾èµ–ï¼Œä½¿å½“å‰æ“ä½œä¾èµ–äºæ“ä½œ op çš„å®Œæˆã€‚</li>
<li>-(void)removeDependency:(NSOperation *)op; ç§»é™¤ä¾èµ–ï¼Œå–æ¶ˆå½“å‰æ“ä½œå¯¹æ“ä½œ op çš„ä¾èµ–ã€‚</li>
<li>@property (readonly, copy) NSArray<nsoperation *=""> *dependencies; åœ¨å½“å‰æ“ä½œå¼€å§‹æ‰§è¡Œä¹‹å‰å®Œæˆæ‰§è¡Œçš„æ‰€æœ‰æ“ä½œå¯¹è±¡æ•°ç»„ã€‚</nsoperation></li>
</ul>
<p>10.2 NSOperationQueue å¸¸ç”¨å±æ€§å’Œæ–¹æ³•</p>
<p>å–æ¶ˆ/æš‚åœ/æ¢å¤æ“ä½œ</p>
<ul>
<li>-(void)cancelAllOperations; å¯ä»¥å–æ¶ˆé˜Ÿåˆ—çš„æ‰€æœ‰æ“ä½œã€‚</li>
<li>-(BOOL)isSuspended; åˆ¤æ–­é˜Ÿåˆ—æ˜¯å¦å¤„äºæš‚åœçŠ¶æ€ã€‚ YES ä¸ºæš‚åœçŠ¶æ€ï¼ŒNO ä¸ºæ¢å¤çŠ¶æ€ã€‚</li>
<li>-(void)setSuspended:(BOOL)b; å¯è®¾ç½®æ“ä½œçš„æš‚åœå’Œæ¢å¤ï¼ŒYES ä»£è¡¨æš‚åœé˜Ÿåˆ—ï¼ŒNO ä»£è¡¨æ¢å¤é˜Ÿåˆ—ã€‚<br>æ“ä½œåŒæ­¥</li>
<li>-(void)waitUntilAllOperationsAreFinished; é˜»å¡å½“å‰çº¿ç¨‹ï¼Œç›´åˆ°é˜Ÿåˆ—ä¸­çš„æ“ä½œå…¨éƒ¨æ‰§è¡Œå®Œæ¯•ã€‚<br>æ·»åŠ /è·å–æ“ä½œ`</li>
<li>-(void)addOperationWithBlock:(void (^)(void))block; å‘é˜Ÿåˆ—ä¸­æ·»åŠ ä¸€ä¸ª NSBlockOperation ç±»å‹æ“ä½œå¯¹è±¡ã€‚</li>
<li>-(void)addOperations:(NSArray *)ops waitUntilFinished:(BOOL)wait; å‘é˜Ÿåˆ—ä¸­æ·»åŠ æ“ä½œæ•°ç»„ï¼Œwait æ ‡å¿—æ˜¯å¦é˜»å¡å½“å‰çº¿ç¨‹ç›´åˆ°æ‰€æœ‰æ“ä½œç»“æŸ</li>
<li>-(NSArray *)operations; å½“å‰åœ¨é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ç»„ï¼ˆæŸä¸ªæ“ä½œæ‰§è¡Œç»“æŸåä¼šè‡ªåŠ¨ä»è¿™ä¸ªæ•°ç»„æ¸…é™¤ï¼‰ã€‚</li>
<li>-(NSUInteger)operationCount; å½“å‰é˜Ÿåˆ—ä¸­çš„æ“ä½œæ•°ã€‚<br>è·å–é˜Ÿåˆ—</li>
<li>+(id)currentQueue; è·å–å½“å‰é˜Ÿåˆ—ï¼Œå¦‚æœå½“å‰çº¿ç¨‹ä¸æ˜¯åœ¨ NSOperationQueue ä¸Šè¿è¡Œåˆ™è¿”å› nilã€‚</li>
<li>+(id)mainQueue; è·å–ä¸»é˜Ÿåˆ—ã€‚</li>
</ul>
<blockquote>
<p>æ³¨æ„ï¼š<br>è¿™é‡Œçš„æš‚åœå’Œå–æ¶ˆï¼ˆåŒ…æ‹¬æ“ä½œçš„å–æ¶ˆå’Œé˜Ÿåˆ—çš„å–æ¶ˆï¼‰å¹¶ä¸ä»£è¡¨å¯ä»¥å°†å½“å‰çš„æ“ä½œç«‹å³å–æ¶ˆï¼Œè€Œæ˜¯å½“å½“å‰çš„æ“ä½œæ‰§è¡Œå®Œæ¯•ä¹‹åä¸å†æ‰§è¡Œæ–°çš„æ“ä½œã€‚<br>æš‚åœå’Œå–æ¶ˆçš„åŒºåˆ«å°±åœ¨äºï¼šæš‚åœæ“ä½œä¹‹åè¿˜å¯ä»¥æ¢å¤æ“ä½œï¼Œç»§ç»­å‘ä¸‹æ‰§è¡Œï¼›è€Œå–æ¶ˆæ“ä½œä¹‹åï¼Œæ‰€æœ‰çš„æ“ä½œå°±æ¸…ç©ºäº†ï¼Œæ— æ³•å†æ¥ç€æ‰§è¡Œå‰©ä¸‹çš„æ“ä½œã€‚</p>
</blockquote>
<blockquote>
<p>ä»¥ä¸Šæ–‡ç« æ•´ç†è‡ªï¼š<a href="https://blog.csdn.net/sunnyboy9/article/details/19848031ã€https://www.jianshu.com/p/4b1d77054b35" target="_blank" rel="noopener">https://blog.csdn.net/sunnyboy9/article/details/19848031ã€https://www.jianshu.com/p/4b1d77054b35</a></p>
</blockquote>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="../../../../js/vdonate.js"></script>
<script>
var a = new Donate({
  title: 'å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæ ‡é¢˜
  btnText: 'Donate', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæŒ‰é’®æ–‡å­—
  el: document.getElementById('donation_div'),
  wechatImage: 'http://ghexoblogimages.oss-cn-beijing.aliyuncs.com/18-11-14/6067039.jpg',
  alipayImage: 'http://ghexoblogimages.oss-cn-beijing.aliyuncs.com/18-11-16/6997594.jpg'
});
</script>
      
      
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC80MTA5OC8xNzYyMw==">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>



      
      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../10/iOS Principle Block/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          iOS Principleï¼šBlock
        
      </div>
    </a>
  
  
    <a href="../../08/iOS Principle Singleton/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">iOS Principleï¼šSingleton</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#æ–¹ä¾¿è®°å¿†ï¼š"><span class="nav-number">1.</span> <span class="nav-text">æ–¹ä¾¿è®°å¿†ï¼š</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ç›¸å…³æ¦‚å¿µ"><span class="nav-number">2.</span> <span class="nav-text">ç›¸å…³æ¦‚å¿µ</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#è¿›ç¨‹"><span class="nav-number">2.1.</span> <span class="nav-text">è¿›ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#çº¿ç¨‹"><span class="nav-number">2.2.</span> <span class="nav-text">çº¿ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤šçº¿ç¨‹"><span class="nav-number">2.3.</span> <span class="nav-text">å¤šçº¿ç¨‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#å¤šçº¿ç¨‹åœ¨-iOS-å¼€å‘ä¸­çš„åº”ç”¨"><span class="nav-number">2.4.</span> <span class="nav-text">å¤šçº¿ç¨‹åœ¨ iOS å¼€å‘ä¸­çš„åº”ç”¨</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ä»£ç ç¤ºä¾‹"><span class="nav-number">3.</span> <span class="nav-text">ä»£ç ç¤ºä¾‹</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#pthread-åŸºæœ¬ä½¿ç”¨"><span class="nav-number">3.1.</span> <span class="nav-text">pthread åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NSThread-åŸºæœ¬ä½¿ç”¨"><span class="nav-number">3.2.</span> <span class="nav-text">NSThread åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#GCD-åŸºæœ¬ä½¿ç”¨"><span class="nav-number">3.3.</span> <span class="nav-text">GCD åŸºæœ¬ä½¿ç”¨</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#NSOperation-åŸºæœ¬ä½¿ç”¨"><span class="nav-number">3.4.</span> <span class="nav-text">NSOperation åŸºæœ¬ä½¿ç”¨</span></a></li></ol></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2019 Evolution All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/scripts.js"></script>




  <script src="../../../../js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Evolution
          </div>
          <div class="panel-body">
            Copyright Â© 2019 Tim&#39;s Technology Blog All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>