<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <title>åŸºäº aspects æ·±å…¥äº†è§£ aop | Technology</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
    <meta name="keywords" content="AOP">
  
  
  
  
  <meta name="description" content="AOP(Aspect-Oriented-Programming)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œå¦‚ç»Ÿè®¡åŸ‹ç‚¹ã€æ–¹æ³•æ›¿æ¢ç­‰~">
<meta name="keywords" content="AOP">
<meta property="og:type" content="article">
<meta property="og:title" content="åŸºäº Aspects æ·±å…¥äº†è§£ AOP">
<meta property="og:url" content="https://reversescale.github.io/2018/03/23/Library Aspects/index.html">
<meta property="og:site_name" content="Technology">
<meta property="og:description" content="AOP(Aspect-Oriented-Programming)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œå¦‚ç»Ÿè®¡åŸ‹ç‚¹ã€æ–¹æ³•æ›¿æ¢ç­‰~">
<meta property="og:locale" content="default">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16227c3818513f78?w=358&h=704&f=png&s=30744">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16227c3817e1a775?w=358&h=704&f=png&s=28277">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16227c38138b1caa?w=358&h=704&f=png&s=35355">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/8/163dd675f76572e2?w=750&h=428&f=jpeg&s=66163">
<meta property="og:image" content="https://user-gold-cdn.xitu.io/2018/6/8/163dd69fa172ac02?w=750&h=357&f=png&s=43594">
<meta property="og:updated_time" content="2018-11-16T13:22:46.436Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="åŸºäº Aspects æ·±å…¥äº†è§£ AOP">
<meta name="twitter:description" content="AOP(Aspect-Oriented-Programming)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œå¦‚ç»Ÿè®¡åŸ‹ç‚¹ã€æ–¹æ³•æ›¿æ¢ç­‰~">
<meta name="twitter:image" content="https://user-gold-cdn.xitu.io/2018/3/15/16227c3818513f78?w=358&h=704&f=png&s=30744">
  
    <link rel="alternate" href="/atom.xml" title="Technology" type="application/atom+xml">
  

  

  <link rel="icon" href="/css/images/docccc.png">
  <link rel="apple-touch-icon" href="/css/images/docccc.png">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link href="https://fonts.googleapis.com/css?family=Open+Sans|Montserrat:700" rel="stylesheet" type="text/css">
  <link href="https://fonts.googleapis.com/css?family=Roboto:400,300,300italic,400italic" rel="stylesheet" type="text/css">
  <link href="//cdn.bootcss.com/font-awesome/4.6.3/css/font-awesome.min.css" rel="stylesheet">
  <style type="text/css">
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/9749f0/00000000000000000001008f/27/l?subset_id=2&fvd=n5) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/90cf9f/000000000000000000010091/27/l?subset_id=2&fvd=n7) format("woff2");font-weight:500;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/8a5494/000000000000000000013365/27/l?subset_id=2&fvd=n4) format("woff2");font-weight:lighter;font-style:normal;}
    @font-face{font-family:futura-pt;src:url(https://use.typekit.net/af/d337d8/000000000000000000010095/27/l?subset_id=2&fvd=i4) format("woff2");font-weight:400;font-style:italic;}</style>
  <link rel="stylesheet" href="../../../../css/style.css">

  <script src="../../../../js/jquery-3.1.1.min.js"></script>
  <script src="../../../../js/bootstrap.js"></script>

  <!-- Bootstrap core CSS -->
  <link rel="stylesheet" href="/css/bootstrap.css">

  
    <link rel="stylesheet" href="../../../../css/dialog.css">
  

  

  
    <link rel="stylesheet" href="/css/header-post.css">
  

  
  
  
    <link rel="stylesheet" href="/css/vdonate.css">
  

</head>
</html>


  <body data-spy="scroll" data-target="#toc" data-offset="50">


  
  <div id="container">
    <div id="wrap">
      
        <header>

    <div id="allheader" class="navbar navbar-default navbar-static-top" role="navigation">
        <div class="navbar-inner">
          
          <div class="container"> 
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
              <span class="sr-only">Toggle navigation</span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
              <span class="icon-bar"></span>
            </button>

            
              <a class="brand" style="
                 border-width: 0px;  margin-top: 0px;" href="#" data-toggle="modal" data-target="#myModal">
                  <img width="88px" height="88px" alt="Hike News" src="/css/images/docccc.png">
              </a>
            
            
            <div class="navbar-collapse collapse">
              <ul class="hnav navbar-nav">
                
                  <li> <a class="main-nav-link" href="../../../../index.html">Home</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../archives">Archives</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../categories">Categories</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../tags">Tags</a> </li>
                
                  <li> <a class="main-nav-link" href="../../../../about">About</a> </li>
                
                  <li><div id="search-form-wrap">

    <form class="search-form">
        <input type="text" class="ins-search-input search-form-input" placeholder="">
        <button type="submit" class="search-form-submit"></button>
    </form>
    <div class="ins-search">
    <div class="ins-search-mask"></div>
    <div class="ins-search-container">
        <div class="ins-input-wrapper">
            <input type="text" class="ins-search-input" placeholder="Type something...">
            <span class="ins-close ins-selectable"><i class="fa fa-times-circle"></i></span>
        </div>
        <div class="ins-section-wrapper">
            <div class="ins-section-container"></div>
        </div>
    </div>
</div>
<script>
(function (window) {
    var INSIGHT_CONFIG = {
        TRANSLATION: {
            POSTS: 'Posts',
            PAGES: 'Pages',
            CATEGORIES: 'Categories',
            TAGS: 'Tags',
            UNTITLED: '(Untitled)',
        },
        ROOT_URL: '/',
        CONTENT_URL: '../../../../content.json',
    };
    window.INSIGHT_CONFIG = INSIGHT_CONFIG;
})(window);
</script>
<script src="../../../../js/insight.js"></script>

</div></li>
            </ul></div>
          </div>
                
      </div>
    </div>

</header>



      
            
      <div id="content" class="outer">
        
          <section id="main" style="float:none;"><article id="post-Library Aspects" style="width: 75%; float:left;" class="article article-type-post" itemscope="" itemprop="blogPost">
  <div id="articleInner" class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="thumb" itemprop="name">
      åŸºäº Aspects æ·±å…¥äº†è§£ AOP
    </h1>
  

      </header>
    
    <div class="article-meta">
      
	<a href="" class="article-date">
	  <time datetime="2018-03-23T13:56:27.000Z" itemprop="datePublished">2018-03-23</time>
	</a>

      
    <a class="article-category-link" href="../../../../categories/Project/">Project</a>

      
	<a class="article-views">
	<span id="busuanzi_container_page_pv">
		PV:<span id="busuanzi_value_page_pv"></span>
	</span>
	</a>

    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>AOP(Aspect-Oriented-Programming)ï¼Œç¿»è¯‘è¿‡æ¥å°±æ˜¯ã€Œé¢å‘åˆ‡é¢ç¼–ç¨‹ã€ï¼Œä½¿ç”¨åœºæ™¯å¾ˆå¤šï¼Œå¦‚ç»Ÿè®¡åŸ‹ç‚¹ã€æ–¹æ³•æ›¿æ¢ç­‰~                                                                                                 </p>
<a id="more"></a>
<hr>
<p>ğŸ‘¨ğŸ»â€ğŸ’» <a href="https://github.com/ReverseScale/AspectsDemo" target="_blank" rel="noopener">Github Demo</a></p>
<h3 id="ğŸ¨-æµ‹è¯•-UI-ä»€ä¹ˆæ ·å­ï¼Ÿ"><a href="#ğŸ¨-æµ‹è¯•-UI-ä»€ä¹ˆæ ·å­ï¼Ÿ" class="headerlink" title="ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ"></a>ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ</h3><table>
<thead>
<tr>
<th>1.å±•ç¤ºé¡µ</th>
<th>2.å±•ç¤ºé¡µ</th>
<th>3.å±•ç¤ºé¡µ</th>
</tr>
</thead>
<tbody>
<tr>
<td><img src="https://user-gold-cdn.xitu.io/2018/3/15/16227c3818513f78?w=358&amp;h=704&amp;f=png&amp;s=30744" alt=""></td>
<td><img src="https://user-gold-cdn.xitu.io/2018/3/15/16227c3817e1a775?w=358&amp;h=704&amp;f=png&amp;s=28277" alt=""></td>
<td><img src="https://user-gold-cdn.xitu.io/2018/3/15/16227c38138b1caa?w=358&amp;h=704&amp;f=png&amp;s=35355" alt=""></td>
</tr>
<tr>
<td>å±•ç¤ºåˆ—è¡¨</td>
<td>æ‹¦æˆªç³»ç»Ÿäº‹ä»¶</td>
<td>è‡ªå®šä¹‰æ‹¦æˆª</td>
</tr>
</tbody>
</table>
<hr>
<h3 id="ğŸ¯-å®‰è£…æ–¹æ³•"><a href="#ğŸ¯-å®‰è£…æ–¹æ³•" class="headerlink" title="ğŸ¯ å®‰è£…æ–¹æ³•"></a>ğŸ¯ å®‰è£…æ–¹æ³•</h3><h4 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h4><p>åœ¨ <em>iOS</em>, ä½ éœ€è¦åœ¨ Podfile ä¸­æ·»åŠ .<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">source &apos;https://github.com/CocoaPods/Specs.git&apos;</span><br><span class="line">platform :ios, &apos;9.0&apos;</span><br><span class="line">use_frameworks!</span><br><span class="line"></span><br><span class="line">pod &quot;Aspects&quot;</span><br></pre></td></tr></table></figure></p>
<hr>
<h3 id="ğŸ› -é…ç½®"><a href="#ğŸ› -é…ç½®" class="headerlink" title="ğŸ›  é…ç½®"></a>ğŸ›  é…ç½®</h3><h4 id="ç³»ç»Ÿçº§æ‹¦æˆª"><a href="#ç³»ç»Ÿçº§æ‹¦æˆª" class="headerlink" title="ç³»ç»Ÿçº§æ‹¦æˆª"></a>ç³»ç»Ÿçº§æ‹¦æˆª</h4><p>æ‹¦æˆªç³»ç»Ÿçº§çº§äº‹ä»¶ï¼Œå¦‚ viewWillAppear ç­‰</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">#import &lt;Aspects.h&gt;</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view, typically from a nib.</span><br><span class="line">    </span><br><span class="line">    [UIViewController aspect_hookSelector:@selector(viewWillAppear:) withOptions:AspectPositionAfter usingBlock:^(id&lt;AspectInfo&gt; aspectInfo, BOOL animated) &#123;</span><br><span class="line">        NSLog(@&quot;View Controller %@ will appear animated: %tu&quot;, aspectInfo.instance, animated);</span><br><span class="line">    &#125; error:NULL];</span><br><span class="line">&#125;</span><br><span class="line">- (void)viewWillAppear:(BOOL)animated &#123;</span><br><span class="line">    [super viewWillAppear:animated];</span><br><span class="line">    NSLog(@&quot;System View Controller will appear&quot;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="è‡ªå®šä¹‰æ‹¦æˆª"><a href="#è‡ªå®šä¹‰æ‹¦æˆª" class="headerlink" title="è‡ªå®šä¹‰æ‹¦æˆª"></a>è‡ªå®šä¹‰æ‹¦æˆª</h4><p>æ‹¦æˆªè‡ªå®šä¹‰äº‹ä»¶ï¼Œå¦‚å¯¹ç±»çš„æ“ä½œ</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">// Cat.h ç±»</span><br><span class="line">@interface Cat: NSObject</span><br><span class="line">+ (void)classFee;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// Cat.m ç±»</span><br><span class="line">@implementation Cat</span><br><span class="line">+ (void)classFee &#123;</span><br><span class="line">    NSLog(@&quot;Miao~&quot;);</span><br><span class="line">&#125;</span><br><span class="line">@end</span><br><span class="line"></span><br><span class="line">// å®ç°æ–¹æ³•</span><br><span class="line">#import &quot;Cat.h&quot;</span><br><span class="line">#import &lt;Aspects.h&gt;</span><br><span class="line"></span><br><span class="line">- (void)viewDidLoad &#123;</span><br><span class="line">    [super viewDidLoad];</span><br><span class="line">    // Do any additional setup after loading the view.</span><br><span class="line">    </span><br><span class="line">    Class catMetal = objc_getMetaClass(NSStringFromClass(Cat.class).UTF8String);</span><br><span class="line">    </span><br><span class="line">    [catMetal aspect_hookSelector:@selector(classFee) withOptions:AspectPositionAfter usingBlock:^(id&lt;AspectInfo&gt; aspectInfo) &#123;</span><br><span class="line">        NSLog(@&quot;Miao~,I am angry~&quot;);</span><br><span class="line">    &#125; error:NULL];</span><br><span class="line">    </span><br><span class="line">    [Cat classFee];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<hr>
<h3 id="ğŸ“-æ·±å…¥å­¦ä¹ "><a href="#ğŸ“-æ·±å…¥å­¦ä¹ " class="headerlink" title="ğŸ“ æ·±å…¥å­¦ä¹ "></a>ğŸ“ æ·±å…¥å­¦ä¹ </h3><p>ç´¢å¼•ï¼š</p>
<ul>
<li>AOP ç®€ä»‹</li>
<li>Aspects ç®€ä»‹</li>
<li>Aspects ç»“æ„å‰–æ</li>
<li>Aspects æ ¸å¿ƒä»£ç å‰–æ</li>
<li>ä¼˜ç§€ AOP åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨</li>
<li>æ€»ç»“</li>
</ul>
<h4 id="AOP-ç®€ä»‹"><a href="#AOP-ç®€ä»‹" class="headerlink" title="AOP ç®€ä»‹"></a>AOP ç®€ä»‹</h4><p>åœ¨ Objective-C çš„å®ç°ç»“æ„ä¸­ Runtime çš„åŠ¨æ€æ´¾å‘æœºåˆ¶ä¿è¯äº†è¿™ä¹ˆè¯­è¨€çš„çµæ´»æ€§ï¼Œè€Œåœ¨è¿è¡Œæ—¶ï¼ŒåŠ¨æ€åœ°å°†ä»£ç åˆ‡å…¥åˆ°ç±»çš„æŒ‡å®šæ–¹æ³•ã€æŒ‡å®šä½ç½®ä¸Šçš„ç¼–ç¨‹æ€æƒ³å°±æ˜¯AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹)ã€‚</p>
<blockquote>
<p>AOP æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼æˆ–è€…ç¼–ç¨‹æ€æƒ³ï¼Œå®ƒè§£å†³äº† OOP (Object-oriented programming) çš„å»¶ä¼¸é—®é¢˜</p>
</blockquote>
<h5 id="ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨-AOP"><a href="#ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨-AOP" class="headerlink" title="ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ AOP"></a>ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ AOP</h5><p>å‡è®¾éšç€æˆ‘ä»¬æ‰€åœ¨çš„å…¬å¸é€æ­¥å‘å±•ï¼Œä¹‹å‰ç¬¬ä¸‰æ–¹çš„ç”¨æˆ·é¡µé¢ç»Ÿè®¡å·²ç»ä¸èƒ½æ»¡è¶³éœ€æ±‚äº†ï¼Œå…¬å¸è¦æ±‚å®ç°ä¸€ä¸ªæˆ‘ä»¬è‡ªå·±çš„ç”¨æˆ·é¡µé¢ç»Ÿè®¡ã€‚</p>
<p>åœ¨ä¼ ç»Ÿçš„ OOP æ€æƒ³ä¸‹ï¼Œå¯èƒ½ä¼šå¦‚ä¸‹æ“ä½œï¼š</p>
<ul>
<li>ä¸€ä¸ªç†Ÿæ‚‰ OOP æ€æƒ³çš„ç¨‹åºçŒ¿ä¼šç†æ‰€åº”å½“çš„æƒ³åˆ°è¦æŠŠç”¨æˆ·é¡µé¢ç»Ÿè®¡è¿™ä¸€ä»»åŠ¡æ”¾åˆ° ViewController ä¸­ï¼›</li>
<li>è€ƒè™‘åˆ°ä¸€ä¸ªä¸ªçš„æ‰‹åŠ¨æ·»åŠ ç»Ÿè®¡ä»£ç è¦æ­»äººï¼ˆè€Œä¸”è¿˜ä¼šæ¼ï¼Œä»¥åæ–°å¢ ViewController ä¹Ÿè¦æ‰‹åŠ¨åŠ ï¼‰ï¼Œäºæ˜¯æƒ³åˆ°äº† OOP æ€æƒ³ä¸­çš„ç»§æ‰¿ï¼›</li>
<li>ä¸å·§ç”±äºé¡¹ç›®ä¹…è¿œï¼Œæ‰€æœ‰çš„ ViewController éƒ½æ˜¯ç›´æ¥ç»§æ‰¿è‡ªç³»ç»Ÿç±» UIViewControllerï¼ˆç¬‘ï¼‰ï¼Œæ­¤æ—¶é€‰æ‹©æŠ½ä¸€ä¸ªé¡¹ç›® RootViewControllerï¼Œæ›¿æ¢æ‰€æœ‰ ViewController ç»§æ‰¿ RootViewControllerï¼›</li>
<li>ç„¶ååœ¨ RootViewController çš„ viewWillAppear: å’Œ viewWillDisappear: æ–¹æ³•åŠ å…¥æ—¶é—´ç»Ÿè®¡ä»£ç ï¼Œè®°å½• ViewController ä»¥åŠ Router ä¼ å‚ã€‚</li>
</ul>
<p>å…¶å® OOP ä¹Ÿæœ‰å…¶ç‰¹æ®Šçš„å®šä½ï¼Œä¹Ÿèƒ½å¤Ÿå®ç°ä¸Šè¿°çš„éœ€æ±‚ã€‚</p>
<p>è€Œ AOP åˆ™æ›´é€‚åˆåœ¨ç»™å¤šä¸ª App å†™é€šç”¨ç»„ä»¶å¹¶ä»¥é€šç”¨çš„å½¢å¼å®ç°ç»Ÿè®¡çš„æƒ…å†µä¸‹ã€‚</p>
<p>ä¸€ä¸ªç®€å•çš„æ€è·¯ï¼šHook æ–¹æ³•äº¤æ¢çš„æ–¹æ³•ï¼Œåœ¨åŸæ–¹æ³•æ‰§è¡Œä¹‹åè®°å½•éœ€è¦ç»Ÿè®¡çš„ä¿¡æ¯å¹¶ä¸ŠæŠ¥ã€‚</p>
<blockquote>
<p>å•é€šè¿‡ Method Swizzling æ¥ Hook çš„æ–¹æ³•åœ¨å¤„ç†ä¸å½“çš„æƒ…å†µä¸‹å®¹æ˜“å‡ºç°å®‰å…¨éšæ‚£</p>
</blockquote>
<h4 id="Aspects-ç®€ä»‹"><a href="#Aspects-ç®€ä»‹" class="headerlink" title="Aspects ç®€ä»‹"></a>Aspects ç®€ä»‹</h4><p><img src="https://user-gold-cdn.xitu.io/2018/6/8/163dd675f76572e2?w=750&amp;h=428&amp;f=jpeg&amp;s=66163" alt=""></p>
<p>Aspects æ˜¯ä¸€ä¸ªä½¿ç”¨èµ·æ¥ç®€å•æ„‰å¿«çš„ AOP åº“ï¼Œä½¿ç”¨ Objective-C ç¼–å†™ï¼Œé€‚ç”¨äº iOS ä¸ Mac OS Xã€‚</p>
<p>Aspects ç®€å•æ˜“ç”¨ï¼Œä½œè€…é€šè¿‡åœ¨ NSObject (Aspects) åˆ†ç±»ä¸­æš´éœ²å‡ºçš„ä¸¤ä¸ªæ¥å£åˆ†åˆ«æä¾›äº†å¯¹å®ä¾‹å’Œ Class çš„ Hook å®ç°ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">Aspects</span>)</span></span><br><span class="line">+ (<span class="keyword">id</span>)aspect_hookSelector:(SEL)selector</span><br><span class="line">                      withOptions:(AspectOptions)options</span><br><span class="line">                       usingBlock:(<span class="keyword">id</span>)block</span><br><span class="line">                            error:(<span class="built_in">NSError</span> **)error;</span><br><span class="line">- (<span class="keyword">id</span>)aspect_hookSelector:(SEL)selector</span><br><span class="line">                      withOptions:(AspectOptions)options</span><br><span class="line">                       usingBlock:(<span class="keyword">id</span>)block</span><br><span class="line">                            error:(<span class="built_in">NSError</span> **)error;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>Aspects æ”¯æŒå®ä¾‹ Hookï¼Œç›¸è¾ƒå…¶ä»– Objective-C AOP åº“è€Œè¨€å¯æ“ä½œç²’åº¦æ›´å°ï¼Œé€‚åˆçš„åœºæ™¯æ›´åŠ å¤šæ ·åŒ–ã€‚ä½œä¸ºä½¿ç”¨è€…æ— éœ€è¿›è¡Œæ›´å¤šçš„æ“ä½œå³å¯ Hook æŒ‡å®šå®ä¾‹æˆ–è€… Class çš„æŒ‡å®š SELï¼ŒAspectOptions å‚æ•°å¯ä»¥æŒ‡å®š Hook çš„ç‚¹ï¼Œä»¥åŠæ˜¯å¦æ‰§è¡Œä¸€æ¬¡ä¹‹åå°±æ’¤é”€ Hookã€‚</p>
<h4 id="Aspects-ç»“æ„å‰–æ"><a href="#Aspects-ç»“æ„å‰–æ" class="headerlink" title="Aspects ç»“æ„å‰–æ"></a>Aspects ç»“æ„å‰–æ</h4><p><img src="https://user-gold-cdn.xitu.io/2018/6/8/163dd69fa172ac02?w=750&amp;h=357&amp;f=png&amp;s=43594" alt=""></p>
<p>å°½ç®¡ Aspects åªæœ‰ä¸åˆ°åƒè¡Œçš„æºç ï¼Œä½†æ˜¯å…¶å†…éƒ¨å®ç°è€ƒè™‘åˆ°äº†å¾ˆå¤š Hook ç›¸å…³çš„å®‰å…¨é—®é¢˜å’Œå…¶ä»–ç»†èŠ‚ï¼Œå¯¹æ¯”å…¶ä»– Objective-C AOP å¼€æºé¡¹ç›®æ¥è¯´ Aspects æ›´ä¸ºå¥å…¨ã€‚</p>
<h5 id="Aspects-å†…éƒ¨ç»“æ„"><a href="#Aspects-å†…éƒ¨ç»“æ„" class="headerlink" title="Aspects å†…éƒ¨ç»“æ„"></a>Aspects å†…éƒ¨ç»“æ„</h5><p>Aspects å†…éƒ¨å®šä¹‰äº†ä¸¤ä¸ªåè®®ï¼š</p>
<ul>
<li>AspectToken - ç”¨äºæ³¨é”€ Hook</li>
<li>AspectInfo - åµŒå…¥ Hook ä¸­çš„ Block é¦–ä½å‚æ•°</li>
</ul>
<p>æ­¤å¤– Aspects å†…éƒ¨è¿˜å®šä¹‰äº† 4 ä¸ªç±»ï¼š</p>
<ul>
<li>AspectInfo - åˆ‡é¢ä¿¡æ¯ï¼Œéµå¾ª AspectInfo åè®®</li>
<li>AspectIdentifier - åˆ‡é¢ IDï¼Œåº”è¯¥éµå¾ª AspectToken åè®®ï¼ˆä½œè€…æ¼æ‰äº†ï¼Œå·²æ PRï¼‰</li>
<li>AspectsContainer - åˆ‡é¢å®¹å™¨</li>
<li>AspectTracker - åˆ‡é¢è·Ÿè¸ªå™¨</li>
</ul>
<p>ä»¥åŠä¸€ä¸ªç»“æ„ä½“ï¼š</p>
<ul>
<li><p>AspectBlockRef - å³ _AspectBlockï¼Œå……å½“å†…éƒ¨ Block<br>å¦‚æœä½ æ‰’ä¸€éæºç ï¼Œè¿˜ä¼šå‘ç°ä¸¤ä¸ªå†…éƒ¨é™æ€å…¨å±€å˜é‡ï¼š</p>
</li>
<li><p>static NSMutableDictionary *swizzledClassesDict;</p>
</li>
<li>static NSMutableSet *swizzledClasses;</li>
</ul>
<h5 id="Aspects-åè®®"><a href="#Aspects-åè®®" class="headerlink" title="Aspects åè®®"></a>Aspects åè®®</h5><p><em>AspectToken</em></p>
<p>AspectToken åè®®æ—¨åœ¨è®©ä½¿ç”¨è€…å¯ä»¥çµæ´»çš„æ³¨é”€ä¹‹å‰æ·»åŠ è¿‡çš„ Hookï¼Œå†…éƒ¨è§„å®šéµå®ˆæ­¤åè®®çš„å¯¹è±¡é¡»å®ç° remove æ–¹æ³•ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// ä¸é€æ˜çš„ Aspect Tokenï¼Œç”¨äºæ³¨é”€ Hook</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AspectToken</span> /// æ³¨é”€ä¸€ä¸ª <span class="title">aspect</span>.</span></span><br><span class="line"><span class="comment">/// è¿”å› YES è¡¨ç¤ºæ³¨é”€æˆåŠŸï¼Œå¦åˆ™è¿”å› NO</span></span><br><span class="line">- (<span class="built_in">BOOL</span>)remove;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p><em>AspectInfo</em></p>
<p>AspectInfo åè®®æ—¨åœ¨è§„èŒƒå¯¹ä¸€ä¸ªåˆ‡é¢ï¼Œå³ aspect çš„ Hook å†…éƒ¨ä¿¡æ¯çš„çº°æ¼ï¼Œæˆ‘ä»¬åœ¨ Hook æ—¶æ·»åŠ åˆ‡é¢çš„ Block ç¬¬ä¸€ä¸ªå‚æ•°å°±éµå®ˆæ­¤åè®®ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// AspectInfo åè®®æ˜¯æˆ‘ä»¬å—è¯­æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°ã€‚</span></span><br><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">AspectInfo</span> /// å½“å‰è¢« <span class="title">Hook</span> çš„å®ä¾‹</span></span><br><span class="line">- (<span class="keyword">id</span>)instance;</span><br><span class="line"><span class="comment">/// è¢« Hook æ–¹æ³•çš„åŸå§‹ invocation</span></span><br><span class="line">- (<span class="built_in">NSInvocation</span> *)originalInvocation;</span><br><span class="line"><span class="comment">/// æ‰€æœ‰æ–¹æ³•å‚æ•°ï¼ˆè£…ç®±ä¹‹åçš„ï¼‰æƒ°æ€§æ‰§è¡Œ</span></span><br><span class="line">- (<span class="built_in">NSArray</span> *)arguments;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>è£…ç®±æ˜¯ä¸€ä¸ªå¼€é”€æ˜‚è´µæ“ä½œï¼Œæ‰€ä»¥ç”¨åˆ°å†å»æ‰§è¡Œ</p>
</blockquote>
<h5 id="Aspects-å†…éƒ¨ç±»"><a href="#Aspects-å†…éƒ¨ç±»" class="headerlink" title="Aspects å†…éƒ¨ç±»"></a>Aspects å†…éƒ¨ç±»</h5><p>æ¥ç€åè®®ï¼Œæˆ‘ä»¬ä¸‹é¢è¯¦ç»†ä»‹ç»ä¸€ä¸‹ Aspects çš„å†…éƒ¨ç±»ã€‚</p>
<p><em>AspectInfo</em></p>
<p>AspectInfo åœ¨è¿™é‡Œæ˜¯ä¸€ä¸ª Classï¼Œå…¶éµå®ˆä¸Šæ–‡ä¸­è®²åˆ°çš„ AspectInfo åè®®ï¼Œä¸è¦æ··æ·†ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AspectInfo</span> : <span class="title">NSObject</span> </span></span><br><span class="line">- (<span class="keyword">id</span>)initWithInstance:(__<span class="keyword">unsafe_unretained</span> <span class="keyword">id</span>)instance invocation:(<span class="built_in">NSInvocation</span> *)invocation;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">unsafe_unretained</span>, <span class="keyword">readonly</span>) <span class="keyword">id</span> instance;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSArray</span> *arguments;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSInvocation</span> *originalInvocation;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>AspectInfo æ¯”è¾ƒç®€å•ï¼Œå‚è€ƒ ReactiveCocoa å›¢é˜Ÿæä¾›çš„ NSInvocation å‚æ•°é€šç”¨æ–¹æ³•å¯å°†å‚æ•°è£…ç®±ä¸º NSValueï¼Œç®€å•æ¥è¯´ AspectInfo æ‰®æ¼”äº†ä¸€ä¸ªæä¾› Hook ä¿¡æ¯çš„è§’è‰²ã€‚</p>
<p><em>AspectIdentifier</em></p>
<p>AspectIdentifier ç±»å®šä¹‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AspectIdentifier</span> : <span class="title">NSObject</span></span></span><br><span class="line">+ (<span class="keyword">instancetype</span>)identifierWithSelector:(SEL)selector object:(<span class="keyword">id</span>)object options:(AspectOptions)options block:(<span class="keyword">id</span>)block error:(<span class="built_in">NSError</span> **)error;</span><br><span class="line">- (<span class="built_in">BOOL</span>)invokeWithInfo:(<span class="keyword">id</span>)info;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) SEL selector;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="keyword">id</span> block;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMethodSignature</span> *blockSignature;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="keyword">id</span> object;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) AspectOptions options;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>AspectIdentifier å®é™…ä¸Šæ˜¯æ·»åŠ åˆ‡é¢çš„ Block çš„ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œå…¶åº”è¯¥éµå¾ª AspectToken åè®®ï¼Œäº‹å®ä¸Šä¹Ÿçš„ç¡®å¦‚æ­¤ï¼Œå…¶æä¾›äº† remove æ–¹æ³•çš„å®ç°ã€‚</p>
<p>AspectIdentifier å†…éƒ¨éœ€è¦æ³¨æ„çš„æ˜¯ç”±äºä½¿ç”¨ Block æ¥å†™ Hook ä¸­æˆ‘ä»¬åŠ çš„æ–™ï¼Œè¿™é‡Œç”Ÿæˆäº† blockSignatureï¼Œåœ¨ AspectIdentifier åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­ä¼šå»åˆ¤æ–­ blockSignature ä¸å…¥å‚ object çš„ selector å¾—åˆ°çš„ methodSignature çš„å…¼å®¹æ€§ï¼Œå…¼å®¹æ€§åˆ¤æ–­æˆåŠŸæ‰ä¼šé¡ºåˆ©åˆå§‹åŒ–ã€‚</p>
<p><em>AspectsContainer</em></p>
<p>AspectsContainer ä½œä¸ºåˆ‡é¢çš„å®¹å™¨ç±»ï¼Œå…³è”æŒ‡å®šå¯¹è±¡çš„æŒ‡å®šæ–¹æ³•ï¼Œå†…éƒ¨æœ‰ä¸‰ä¸ªåˆ‡é¢é˜Ÿåˆ—ï¼Œåˆ†åˆ«å®¹çº³å…³è”æŒ‡å®šå¯¹è±¡çš„æŒ‡å®šæ–¹æ³•ä¸­ç›¸å¯¹åº” AspectOption çš„ Hookï¼š</p>
<ul>
<li>NSArray *beforeAspects; - AspectPositionBefore</li>
<li>NSArray *insteadAspects; - AspectPositionInstead</li>
<li>NSArray *afterAspects; - AspectPositionAfter</li>
</ul>
<p>AspectsContainer åœ¨ NSObject åˆ†ç±»ä¸­é€šè¿‡ AssociatedObject æ–¹æ³•ä¸å½“å‰è¦ Hook çš„ç›®æ ‡å…³è”åœ¨ä¸€èµ·çš„ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AspectsContainer</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">void</span>)addAspect:(AspectIdentifier *)aspect withOptions:(AspectOptions)injectPosition;</span><br><span class="line">- (<span class="built_in">BOOL</span>)removeAspect:(<span class="keyword">id</span>)aspect;</span><br><span class="line">- (<span class="built_in">BOOL</span>)hasAspects;</span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *beforeAspects;</span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *insteadAspects;</span><br><span class="line"><span class="keyword">@property</span> (atomic, <span class="keyword">copy</span>) <span class="built_in">NSArray</span> *afterAspects;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>å…³è”ç›®æ ‡æ˜¯ Hook ä¹‹åçš„ Selectorï¼Œå³ aliasSelectorï¼ˆåŸå§‹ SEL åç§°åŠ  aspects_ å‰ç¼€å¯¹åº”çš„ SELï¼‰</p>
</blockquote>
<p><em>AspectTracker</em></p>
<p>AspectTracker ç±»å®šä¹‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AspectTracker</span> : <span class="title">NSObject</span></span></span><br><span class="line">- (<span class="keyword">id</span>)initWithTrackedClass:(Class)trackedClass parent:(AspectTracker *)parent;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) Class trackedClass;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>) <span class="built_in">NSMutableSet</span> *selectorNames;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) AspectTracker *parentEntry;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>AspectTracker ä½œä¸ºåˆ‡é¢è¿½è¸ªå™¨ï¼ŒåŸç†å¤§è‡´å¦‚ä¸‹ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Add the selector as being modified.</span></span><br><span class="line">currentClass = klass;</span><br><span class="line">AspectTracker *parentTracker = <span class="literal">nil</span>;</span><br><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    AspectTracker *tracker = swizzledClassesDict[currentClass];</span><br><span class="line">    <span class="keyword">if</span> (!tracker) &#123;</span><br><span class="line">        tracker = [[AspectTracker alloc] initWithTrackedClass:currentClass parent:parentTracker];</span><br><span class="line">        swizzledClassesDict[(<span class="keyword">id</span>)currentClass] = tracker;</span><br><span class="line">    &#125;</span><br><span class="line">    [tracker.selectorNames addObject:selectorName];</span><br><span class="line">    <span class="comment">// All superclasses get marked as having a subclass that is modified.</span></span><br><span class="line">    parentTracker = tracker;</span><br><span class="line">&#125;<span class="keyword">while</span> ((currentClass = class_getSuperclass(currentClass)));</span><br></pre></td></tr></table></figure>
<p>å…¨å±€å˜é‡ swizzledClassesDict ä¸­çš„ value å¯¹åº”ç€ AspectTracker æŒ‡é’ˆã€‚</p>
<p>AspectTracker æ˜¯ä»ä¸‹è€Œä¸Šè¿½è¸ªï¼Œæœ€åº•å±‚çš„ parentEntry ä¸º nilï¼Œçˆ¶ç±»çš„ parentEntry ä¸ºå­ç±»çš„ trackerã€‚</p>
<p><em>Aspects é™æ€å…¨å±€å˜é‡</em></p>
<p>1ï¼‰static NSMutableDictionary *swizzledClassesDict;</p>
<p>static NSMutableDictionary *swizzledClassesDict; åœ¨ Aspects ä¸­æ‰®æ¼”ç€å·²æ··å†™ç±»å­—å…¸çš„è§’è‰²ï¼ŒAspects å†…éƒ¨æä¾›äº†ä¸“é—¨è®¿é—®è¿™ä¸ªå…¨å±€å­—å…¸çš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *aspect_getSwizzledClassesDict() &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSMutableDictionary</span> *swizzledClassesDict;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> pred;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;pred, ^&#123;</span><br><span class="line">        swizzledClassesDict = [<span class="built_in">NSMutableDictionary</span> new];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">return</span> swizzledClassesDict;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªå…¨å±€å˜é‡å¯ä»¥ç®€å•ç†è§£ä¸ºè®°å½•æ•´ä¸ª Hook å½±å“çš„ Class åŒ…å«å…¶ SuperClass çš„è¿½è¸ªè®°å½•çš„å…¨å±€å­—å…¸ã€‚</p>
<p>2ï¼‰static NSMutableSet *swizzledClasses;</p>
<p>static NSMutableSet *swizzledClasses; åœ¨ Aspects ä¸­æ‹…å½“è®°å½•å·²æ··å†™ç±»çš„è§’è‰²ï¼ŒAspects å†…éƒ¨æä¾›ä¸€ä¸ªç”¨äºä¿®æ”¹è¿™ä¸ªå…¨å±€å˜é‡å†…å®¹çš„æ–¹æ³•ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> _aspect_modifySwizzledClasses(<span class="keyword">void</span> (^block)(<span class="built_in">NSMutableSet</span> *swizzledClasses)) &#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">NSMutableSet</span> *swizzledClasses;</span><br><span class="line">    <span class="keyword">static</span> <span class="built_in">dispatch_once_t</span> pred;</span><br><span class="line">    <span class="built_in">dispatch_once</span>(&amp;pred, ^&#123;</span><br><span class="line">        swizzledClasses = [<span class="built_in">NSMutableSet</span> new];</span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="keyword">@synchronized</span>(swizzledClasses) &#123;</span><br><span class="line">        block(swizzledClasses);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h4 id="Aspects-æ ¸å¿ƒä»£ç å‰–æ"><a href="#Aspects-æ ¸å¿ƒä»£ç å‰–æ" class="headerlink" title="Aspects æ ¸å¿ƒä»£ç å‰–æ"></a>Aspects æ ¸å¿ƒä»£ç å‰–æ</h4><h5 id="Hook-Class-amp-amp-Hook-Instance"><a href="#Hook-Class-amp-amp-Hook-Instance" class="headerlink" title="Hook Class &amp;&amp; Hook Instance"></a>Hook Class &amp;&amp; Hook Instance</h5><p>Aspects ä¸å…‰æ”¯æŒ Hook Class è¿˜æ”¯æŒ Hook Instanceï¼Œè¿™æä¾›äº†æ›´å°ç²’åº¦çš„æ§åˆ¶ï¼Œé…åˆ Hook çš„æ’¤é”€åŠŸèƒ½å¯ä»¥æ›´åŠ çµæ´»ç²¾å‡†çš„å®ç°åŠŸèƒ½ã€‚</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> Class aspect_hookClass(<span class="built_in">NSObject</span> *<span class="keyword">self</span>, <span class="built_in">NSError</span> **error) &#123;</span><br><span class="line">    <span class="comment">// æ–­è¨€ self</span></span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(<span class="keyword">self</span>);</span><br><span class="line">    <span class="comment">// class</span></span><br><span class="line">Class statedClass = <span class="keyword">self</span>.class;</span><br><span class="line"><span class="comment">// isa</span></span><br><span class="line">Class baseClass = object_getClass(<span class="keyword">self</span>);</span><br><span class="line"><span class="built_in">NSString</span> *className = <span class="built_in">NSStringFromClass</span>(baseClass);</span><br><span class="line">    <span class="comment">// å·²ç»å­ç±»åŒ–è¿‡äº†</span></span><br><span class="line"><span class="keyword">if</span> ([className hasSuffix:AspectsSubclassSuffix]) &#123;</span><br><span class="line"><span class="keyword">return</span> baseClass;</span><br><span class="line">        <span class="comment">// æˆ‘ä»¬æ··å†™äº†ä¸€ä¸ª class å¯¹è±¡ï¼Œè€Œéä¸€ä¸ªå•ç‹¬çš„ object</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span> (class_isMetaClass(baseClass)) &#123;</span><br><span class="line">    <span class="comment">// baseClass æ˜¯å…ƒç±»ï¼Œåˆ™ self æ˜¯ Class æˆ– MetaClassï¼Œæ··å†™ self</span></span><br><span class="line">        <span class="keyword">return</span> aspect_swizzleClassInPlace((Class)<span class="keyword">self</span>);</span><br><span class="line">        <span class="comment">// å¯èƒ½æ˜¯ä¸€ä¸ª KVO'ed classã€‚æ··å†™å°±ä½ã€‚ä¹Ÿè¦æ··å†™ meta classesã€‚</span></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> (statedClass != baseClass) &#123; </span><br><span class="line">        <span class="comment">// å½“ .class å’Œ isa æŒ‡å‘ä¸åŒçš„æƒ…å†µï¼Œæ··å†™ baseClass</span></span><br><span class="line">        <span class="keyword">return</span> aspect_swizzleClassInPlace(baseClass);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é»˜è®¤æƒ…å†µä¸‹ï¼ŒåŠ¨æ€åˆ›å»ºå­ç±»</span></span><br><span class="line">    <span class="comment">// æ‹¼æ¥å­ç±»åç¼€ AspectsSubclassSuffix</span></span><br><span class="line"><span class="keyword">const</span> <span class="keyword">char</span> *subclassName = [className stringByAppendingString:AspectsSubclassSuffix].UTF8String;</span><br><span class="line"><span class="comment">// å°è¯•ç”¨æ‹¼æ¥åç¼€çš„åç§°è·å– isa</span></span><br><span class="line">Class subclass = objc_getClass(subclassName);</span><br><span class="line">    <span class="comment">// æ‰¾ä¸åˆ° isaï¼Œä»£è¡¨è¿˜æ²¡æœ‰åŠ¨æ€åˆ›å»ºè¿‡è¿™ä¸ªå­ç±»</span></span><br><span class="line"><span class="keyword">if</span> (subclass == <span class="literal">nil</span>) &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ª class pairï¼ŒbaseClass ä½œä¸ºæ–°ç±»çš„ superClassï¼Œç±»åä¸º subclassName</span></span><br><span class="line">subclass = objc_allocateClassPair(baseClass, subclassName, <span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span> (subclass == <span class="literal">nil</span>) &#123; <span class="comment">// è¿”å› nilï¼Œå³åˆ›å»ºå¤±è´¥</span></span><br><span class="line">            <span class="built_in">NSString</span> *errrorDesc = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"objc_allocateClassPair failed to allocate class %s."</span>, subclassName];</span><br><span class="line">            AspectError(AspectErrorFailedToAllocateClassPair, errrorDesc);</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ··å†™ forwardInvocation:</span></span><br><span class="line">aspect_swizzleForwardInvocation(subclass);</span><br><span class="line"><span class="comment">// subClass.class = statedClass</span></span><br><span class="line">aspect_hookedGetClass(subclass, statedClass);</span><br><span class="line"><span class="comment">// subClass.isa.class = statedClass</span></span><br><span class="line">aspect_hookedGetClass(object_getClass(subclass), statedClass);</span><br><span class="line"><span class="comment">// æ³¨å†Œæ–°ç±»</span></span><br><span class="line">objc_registerClassPair(subclass);</span><br><span class="line">&#125;</span><br><span class="line">    <span class="comment">// è¦†ç›– isa</span></span><br><span class="line">object_setClass(<span class="keyword">self</span>, subclass);</span><br><span class="line"><span class="keyword">return</span> subclass;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éš¾ç‚¹å°±åœ¨äºå¯¹ .class å’Œ object_getClass çš„åŒºåˆ†ã€‚</p>
<ul>
<li>.class å½“ target æ˜¯ Instance åˆ™è¿”å› Classï¼Œå½“ target æ˜¯ Class åˆ™è¿”å›è‡ªèº«</li>
<li>object_getClass è¿”å› isa æŒ‡é’ˆçš„æŒ‡å‘</li>
</ul>
<p>åŠ¨æ€åˆ›å»ºä¸€ä¸ª Class çš„å®Œæ•´æ­¥éª¤ä¹Ÿæ˜¯æˆ‘ä»¬åº”è¯¥æ³¨æ„çš„ã€‚</p>
<ul>
<li>objc_allocateClassPair</li>
<li>class_addMethod</li>
<li>class_addIvar</li>
<li>objc_registerClassPair </li>
</ul>
<h5 id="Hook-çš„å®ç°"><a href="#Hook-çš„å®ç°" class="headerlink" title="Hook çš„å®ç°"></a>Hook çš„å®ç°</h5><p>åœ¨ä¸Šé¢ aspect_hookClass æ–¹æ³•ä¸­ï¼Œä¸ä»…ä»…æ˜¯è¿”å›ä¸€ä¸ªè¦ Hook çš„ Classï¼ŒæœŸé—´è¿˜åšäº†ä¸€äº›ç»†èŠ‚æ“ä½œï¼Œä¸è®ºæ˜¯ Class è¿˜æ˜¯ Instanceï¼Œéƒ½ä¼šè°ƒç”¨ aspect_swizzleForwardInvocation æ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ²¡ä»€ä¹ˆéš¾ç‚¹ï¼Œç®€å•è´´ä¸€ä¸‹ä»£ç è®©å¤§å®¶æœ‰ä¸ªå°è±¡ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> aspect_swizzleForwardInvocation(Class klass) &#123;</span><br><span class="line">    <span class="comment">// æ–­è¨€ klass</span></span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(klass);</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰ methodï¼Œreplace å®é™…ä¸Šä¼šåƒæ˜¯ class_addMethod ä¸€æ ·</span></span><br><span class="line">    IMP originalImplementation = class_replaceMethod(klass, <span class="keyword">@selector</span>(forwardInvocation:), (IMP)__ASPECTS_ARE_BEING_CALLED__, <span class="string">"v@:@"</span>);</span><br><span class="line">    <span class="comment">// æ‹¿åˆ° originalImplementation è¯æ˜æ˜¯ replace è€Œä¸æ˜¯ addï¼Œæƒ…å†µå°‘è§</span></span><br><span class="line">    <span class="keyword">if</span> (originalImplementation) &#123;</span><br><span class="line">        <span class="comment">// æ·»åŠ  AspectsForwardInvocationSelectorName çš„æ–¹æ³•ï¼ŒIMP ä¸ºåŸç”Ÿ forwardInvocation:</span></span><br><span class="line">        class_addMethod(klass, <span class="built_in">NSSelectorFromString</span>(AspectsForwardInvocationSelectorName), originalImplementation, <span class="string">"v@:@"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    AspectLog(<span class="string">@"Aspects: %@ is now aspect aware."</span>, <span class="built_in">NSStringFromClass</span>(klass));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸Šé¢çš„æ–¹æ³•å°±æ˜¯æŠŠè¦ Hook çš„ç›®æ ‡ Class çš„ forwardInvocation: æ··å†™äº†ï¼Œæ··å†™ä¹‹å forwardInvocation: çš„å…·ä½“å®ç°åœ¨ <strong>ASPECTS_ARE_BEING_CALLED</strong> ä¸­ï¼Œé‡Œé¢èƒ½çœ‹åˆ° invoke æ ‡è¯†ä½çš„ä¸åŒæ˜¯å¦‚ä½•å®ç°çš„ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„å®ç°ç»†èŠ‚ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å®å®šä¹‰ï¼Œä»¥ä¾¿äºæˆ‘ä»¬æœ‰ä¸€ä¸ªæ›´æ˜æ™°çš„ stack trace</span></span><br><span class="line"><span class="meta">#define aspect_invoke(aspects, info) \</span></span><br><span class="line"><span class="keyword">for</span> (AspectIdentifier *aspect <span class="keyword">in</span> aspects) &#123;\</span><br><span class="line">    [aspect invokeWithInfo:info];\</span><br><span class="line">    <span class="keyword">if</span> (aspect.options &amp; AspectOptionAutomaticRemoval) &#123; \</span><br><span class="line">        aspectsToRemove = [aspectsToRemove?:@[] arrayByAddingObject:aspect]; \</span><br><span class="line">    &#125; \</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">static</span> <span class="keyword">void</span> __ASPECTS_ARE_BEING_CALLED__(__<span class="keyword">unsafe_unretained</span> <span class="built_in">NSObject</span> *<span class="keyword">self</span>, SEL selector, <span class="built_in">NSInvocation</span> *invocation) &#123;</span><br><span class="line">    <span class="comment">// __unsafe_unretained NSObject *self ä¸è§£é‡Šäº†</span></span><br><span class="line">    <span class="comment">// æ–­è¨€ self, invocation</span></span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(<span class="keyword">self</span>);</span><br><span class="line">    <span class="built_in">NSCParameterAssert</span>(invocation);</span><br><span class="line">    <span class="comment">// ä» invocation å¯ä»¥æ‹¿åˆ°å¾ˆå¤šä¸œè¥¿ï¼Œæ¯”å¦‚ originalSelector</span></span><br><span class="line">    SEL originalSelector = invocation.selector;</span><br><span class="line">    <span class="comment">// originalSelector åŠ å‰ç¼€å¾—åˆ° aliasSelector</span></span><br><span class="line">SEL aliasSelector = aspect_aliasForSelector(invocation.selector);</span><br><span class="line"><span class="comment">// ç”¨ aliasSelector æ›¿æ¢ invocation.selector</span></span><br><span class="line">    invocation.selector = aliasSelector;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// Instance çš„å®¹å™¨</span></span><br><span class="line">    AspectsContainer *objectContainer = objc_getAssociatedObject(<span class="keyword">self</span>, aliasSelector);</span><br><span class="line">    <span class="comment">// Class çš„å®¹å™¨</span></span><br><span class="line">    AspectsContainer *classContainer = aspect_getContainerForClass(object_getClass(<span class="keyword">self</span>), aliasSelector);</span><br><span class="line">    AspectInfo *info = [[AspectInfo alloc] initWithInstance:<span class="keyword">self</span> invocation:invocation];</span><br><span class="line">    <span class="built_in">NSArray</span> *aspectsToRemove = <span class="literal">nil</span>;</span><br><span class="line">    <span class="comment">// Before hooks.</span></span><br><span class="line">    aspect_invoke(classContainer.beforeAspects, info);</span><br><span class="line">    aspect_invoke(objectContainer.beforeAspects, info);</span><br><span class="line">    <span class="comment">// Instead hooks.</span></span><br><span class="line">    <span class="built_in">BOOL</span> respondsToAlias = <span class="literal">YES</span>;</span><br><span class="line">    <span class="keyword">if</span> (objectContainer.insteadAspects.count || classContainer.insteadAspects.count) &#123;</span><br><span class="line">        <span class="comment">// å¦‚æœæœ‰ä»»ä½• insteadAspects å°±ç›´æ¥æ›¿æ¢äº†</span></span><br><span class="line">        aspect_invoke(classContainer.insteadAspects, info);</span><br><span class="line">        aspect_invoke(objectContainer.insteadAspects, info);</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123; <span class="comment">// å¦åˆ™æ­£å¸¸æ‰§è¡Œ</span></span><br><span class="line">        <span class="comment">// éå† invocation.target åŠå…¶ superClass æ‰¾åˆ°å®ä¾‹å¯ä»¥å“åº” aliasSelector çš„ç‚¹ invoke</span></span><br><span class="line">        Class klass = object_getClass(invocation.target);</span><br><span class="line">        <span class="keyword">do</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> ((respondsToAlias = [klass instancesRespondToSelector:aliasSelector])) &#123;</span><br><span class="line">                [invocation invoke];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span> (!respondsToAlias &amp;&amp; (klass = class_getSuperclass(klass)));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// After hooks.</span></span><br><span class="line">    aspect_invoke(classContainer.afterAspects, info);</span><br><span class="line">    aspect_invoke(objectContainer.afterAspects, info);</span><br><span class="line">    <span class="comment">// å¦‚æœæ²¡æœ‰ hookï¼Œåˆ™æ‰§è¡ŒåŸå§‹å®ç°ï¼ˆé€šå¸¸ä¼šæŠ›å‡ºå¼‚å¸¸ï¼‰</span></span><br><span class="line">    <span class="keyword">if</span> (!respondsToAlias) &#123;</span><br><span class="line">        invocation.selector = originalSelector;</span><br><span class="line">        SEL originalForwardInvocationSEL = <span class="built_in">NSSelectorFromString</span>(AspectsForwardInvocationSelectorName);</span><br><span class="line">        <span class="comment">// å¦‚æœå¯ä»¥å“åº” originalForwardInvocationSELï¼Œè¡¨ç¤ºä¹‹å‰æ˜¯ replace method è€Œé add method</span></span><br><span class="line">        <span class="keyword">if</span> ([<span class="keyword">self</span> respondsToSelector:originalForwardInvocationSEL]) &#123;</span><br><span class="line">            ((<span class="keyword">void</span>( *)(<span class="keyword">id</span>, SEL, <span class="built_in">NSInvocation</span> *))objc_msgSend)(<span class="keyword">self</span>, originalForwardInvocationSEL, invocation);</span><br><span class="line">        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">            [<span class="keyword">self</span> doesNotRecognizeSelector:invocation.selector];</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// ç§»é™¤ aspectsToRemove é˜Ÿåˆ—ä¸­çš„ AspectIdentifierï¼Œæ‰§è¡Œ remove</span></span><br><span class="line">    [aspectsToRemove makeObjectsPerformSelector:<span class="keyword">@selector</span>(remove)];</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">#undef aspect_invoke</span></span><br></pre></td></tr></table></figure>
<blockquote>
<p>aspect_invoke å®å®šä¹‰çš„ä½œç”¨åŸŸ</p>
</blockquote>
<ul>
<li>ä»£ç å®ç°å¯¹åº”äº† Hook çš„ AspectOptions å‚æ•°çš„ Beforeï¼ŒInstead å’Œ Afterã€‚</li>
<li>aspect_invoke ä¸­ aspectsToRemove æ˜¯ä¸€ä¸ª NSArrayï¼Œé‡Œé¢å®¹çº³ç€éœ€è¦è¢«é”€æˆ·çš„ Hookï¼Œå³ AspectIdentifierï¼ˆä¹‹åä¼šè°ƒç”¨ remove ç§»é™¤ï¼‰ã€‚</li>
<li>éå† invocation.target åŠå…¶ superClass æ‰¾åˆ°å®ä¾‹å¯ä»¥å“åº” aliasSelector çš„ç‚¹ invoke å®ç°ä»£ç ã€‚</li>
</ul>
<p><em>Block Hook</em></p>
<p>Aspects è®©æˆ‘ä»¬åœ¨æŒ‡å®š Class æˆ– Instance çš„ç‰¹å®š Selector æ‰§è¡Œæ—¶ï¼Œæ ¹æ® AspectOptions æ’å…¥æˆ‘ä»¬è‡ªå·±çš„ Block åš Hookï¼Œè€Œè¿™ä¸ª Block å†…éƒ¨æœ‰æˆ‘ä»¬æƒ³è¦çš„æœ‰å…³äºå½“å‰ Target å’Œ Selector çš„ä¿¡æ¯ï¼Œæˆ‘ä»¬æ¥çœ‹ä¸€ä¸‹ Aspects æ˜¯æ€ä¹ˆåŠåˆ°çš„ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">BOOL</span>)invokeWithInfo:(<span class="keyword">id</span>)info &#123;</span><br><span class="line">    <span class="built_in">NSInvocation</span> *blockInvocation = [<span class="built_in">NSInvocation</span> invocationWithMethodSignature:<span class="keyword">self</span>.blockSignature];</span><br><span class="line">    <span class="built_in">NSInvocation</span> *originalInvocation = info.originalInvocation;</span><br><span class="line">    <span class="built_in">NSUInteger</span> numberOfArguments = <span class="keyword">self</span>.blockSignature.numberOfArguments;</span><br><span class="line">    <span class="comment">// åæ‰§ã€‚æˆ‘ä»¬å·²ç»åœ¨ hook æ³¨å†Œçš„æ—¶å€™æ£€æŸ¥è¿‡äº†ï¼Œï¼ˆä¸è¿‡è¿™é‡Œæˆ‘ä»¬è¿˜è¦æ£€æŸ¥ï¼‰ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (numberOfArguments &gt; originalInvocation.methodSignature.numberOfArguments) &#123;</span><br><span class="line">        AspectLogError(<span class="string">@"Block has too many arguments. Not calling %@"</span>, info);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// block çš„ `self` å°†ä¼šæ˜¯ AspectInfoã€‚å¯é€‰çš„ã€‚</span></span><br><span class="line">    <span class="keyword">if</span> (numberOfArguments &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        [blockInvocation setArgument:&amp;info atIndex:<span class="number">1</span>];</span><br><span class="line">    &#125;</span><br><span class="line">     </span><br><span class="line">    <span class="comment">// ç®€å†å‚æ•°åˆ†é…å†…å­˜ argBuf ç„¶åä» originalInvocation å– argument èµ‹å€¼ç»™ blockInvocation</span></span><br><span class="line"><span class="keyword">void</span> *argBuf = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="built_in">NSUInteger</span> idx = <span class="number">2</span>; idx &lt; numberOfArguments; idx++) &#123;</span><br><span class="line">        <span class="keyword">const</span> <span class="keyword">char</span> *type = [originalInvocation.methodSignature getArgumentTypeAtIndex:idx];</span><br><span class="line"><span class="built_in">NSUInteger</span> argSize;</span><br><span class="line"><span class="built_in">NSGetSizeAndAlignment</span>(type, &amp;argSize, <span class="literal">NULL</span>);</span><br><span class="line">         </span><br><span class="line">        <span class="comment">// reallocf ä¼˜ç‚¹ï¼Œå¦‚æœåˆ›å»ºå†…å­˜å¤±è´¥ä¼šè‡ªåŠ¨é‡Šæ”¾ä¹‹å‰çš„å†…å­˜ï¼Œè®²ç©¶</span></span><br><span class="line"><span class="keyword">if</span> (!(argBuf = reallocf(argBuf, argSize))) &#123;</span><br><span class="line">            AspectLogError(<span class="string">@"Failed to allocate memory for block invocation."</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">&#125;</span><br><span class="line">         </span><br><span class="line">[originalInvocation getArgument:argBuf atIndex:idx];</span><br><span class="line">[blockInvocation setArgument:argBuf atIndex:idx];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œ</span></span><br><span class="line">    [blockInvocation invokeWithTarget:<span class="keyword">self</span>.block];</span><br><span class="line">    <span class="comment">// é‡Šæ”¾ argBuf</span></span><br><span class="line">    <span class="keyword">if</span> (argBuf != <span class="literal">NULL</span>) &#123;</span><br><span class="line">        free(argBuf);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è€ƒè™‘ä¸¤ä¸ªé—®é¢˜ï¼š</p>
<ul>
<li>[blockInvocation setArgument:&amp;info atIndex:1]; ä¸ºä»€ä¹ˆè¦åœ¨ç´¢å¼• 1 å¤„æ’å…¥å‘¢ï¼Ÿ</li>
<li>for (NSUInteger idx = 2; idx &lt; numberOfArguments; idx++) ä¸ºä»€ä¹ˆè¦ä»ç´¢å¼• 2 å¼€å§‹éå†å‚æ•°å‘¢ï¼Ÿ</li>
</ul>
<h4 id="ä¼˜ç§€-AOP-åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨"><a href="#ä¼˜ç§€-AOP-åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨" class="headerlink" title="ä¼˜ç§€ AOP åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨"></a>ä¼˜ç§€ AOP åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨</h4><ul>
<li>è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ</li>
<li>å¯æ§ç²’åº¦å°</li>
<li>ä½¿ç”¨ Block åš Hook</li>
<li>æ”¯æŒæ’¤é”€ Hook</li>
<li>å®‰å…¨æ€§</li>
</ul>
<h5 id="è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ"><a href="#è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ" class="headerlink" title="è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ"></a>è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ</h5><p>Aspects ä½¿ç”¨ NSObject + Categroy çš„æ–¹å¼æä¾›æ¥å£ï¼Œéå¸¸å·§å¦™çš„æ¶µç›–äº† Instance å’Œ Classã€‚</p>
<p>Aspects æä¾›çš„æ¥å£ä¿æŒé«˜åº¦ä¸€è‡´ï¼ˆæœ¬ç€æ˜“ç”¨ï¼Œç®€å•ï¼Œæ–¹ä¾¿çš„åŸåˆ™è®¾è®¡æ¥å£å’Œæ•´ä¸ªæ¡†æ¶çš„å®ç°ä¼šè®©ä½ çš„å¼€æºé¡¹ç›®æ›´å®¹æ˜“è¢«äººä»¬æ¥çº³å’Œä½¿ç”¨ï¼‰ï¼š</p>
<figure class="highlight objc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="keyword">id</span>)aspect_hookSelector:(SEL)selector</span><br><span class="line">                      withOptions:(AspectOptions)options</span><br><span class="line">                       usingBlock:(<span class="keyword">id</span>)block</span><br><span class="line">                            error:(<span class="built_in">NSError</span> **)error;</span><br><span class="line">- (<span class="keyword">id</span>)aspect_hookSelector:(SEL)selector</span><br><span class="line">                      withOptions:(AspectOptions)options</span><br><span class="line">                       usingBlock:(<span class="keyword">id</span>)block</span><br><span class="line">                            error:(<span class="built_in">NSError</span> **)error;</span><br></pre></td></tr></table></figure>
<h5 id="å¯æ§ç²’åº¦å°"><a href="#å¯æ§ç²’åº¦å°" class="headerlink" title="å¯æ§ç²’åº¦å°"></a>å¯æ§ç²’åº¦å°</h5><p>Aspects ä¸ä»…æ”¯æŒå¤§éƒ¨åˆ† AOP æ¡†æ¶åº”è¯¥åšåˆ°çš„å¯¹äº Class çš„ Hookï¼Œè¿˜æ”¯æŒç²’åº¦æ›´å°çš„ Instance Hookï¼Œè€Œå…¶åœ¨å†…éƒ¨å®ç°ä¸­ä¸ºäº†æ”¯æŒ Instance Hook æ‰€åšçš„ä»£ç ä¹Ÿéå¸¸å€¼å¾—æˆ‘ä»¬å‚è€ƒå’Œå­¦ä¹ ï¼ˆå·²åœ¨ä¸Šæ–‡ Aspects æ ¸å¿ƒä»£ç å‰–æå¤„å•ç‹¬åˆ†æï¼‰ã€‚</p>
<p>ä¸ºä½¿ç”¨è€…æä¾›æ›´ä¸ºè‡ªç”±çš„ Hook æ–¹å¼ä»¥è¾¾åˆ°æ›´åŠ ç²¾å‡†çš„æ§åˆ¶æ˜¯æ¯ä¸ªä½¿ç”¨è€…ä¹äºè§åˆ°çš„äº‹ã€‚</p>
<h5 id="ä½¿ç”¨-Block-åš-Hook"><a href="#ä½¿ç”¨-Block-åš-Hook" class="headerlink" title="ä½¿ç”¨ Block åš Hook"></a>ä½¿ç”¨ Block åš Hook</h5><p>Aspects ä½¿ç”¨ Block æ¥åš Hook åº”è¯¥è€ƒè™‘åˆ°äº†å¾ˆå¤šä¸œè¥¿ï¼Œæ”¯æŒä½¿ç”¨è€…é€šè¿‡åœ¨ Block ä¸­è·å–åˆ°ç›¸å…³çš„ä¿¡æ¯ï¼Œä¹¦å†™è‡ªå·±é¢å¤–çš„æ“ä½œå°±å¯ä»¥å®ç° Hook éœ€æ±‚ã€‚</p>
<h5 id="æ”¯æŒæ’¤é”€-Hook"><a href="#æ”¯æŒæ’¤é”€-Hook" class="headerlink" title="æ”¯æŒæ’¤é”€ Hook"></a>æ”¯æŒæ’¤é”€ Hook</h5><p>Aspects è¿˜æ”¯æŒæ’¤é”€ä¹‹å‰åšçš„ Hook ä»¥åŠå·²æ··å†™çš„ Methodï¼Œä¸ºäº†å®ç°è¿™ä¸ªåŠŸèƒ½ Aspects è®¾è®¡äº†å…¨å±€å®¹å™¨ï¼ŒæŠŠ Hook å’Œæ··å†™ç”¨å…¨å±€å®¹å™¨åšè®°å½•ï¼Œè®©ä¸€åˆ‡éƒ½å¯ä»¥å¤åŸï¼Œè¿™ä¸æ­£æ˜¯æˆ‘ä»¬æƒ³è¦çš„å—ï¼Ÿ</p>
<h5 id="å®‰å…¨æ€§"><a href="#å®‰å…¨æ€§" class="headerlink" title="å®‰å…¨æ€§"></a>å®‰å…¨æ€§</h5><p>åœ¨å­¦ä¹  Runtime çš„æ—¶å€™ï¼Œå°±åº”è¯¥çœ‹åˆ°è¿‡ä¸å°‘æ–‡ç« è®²è§£ Method Swizzling è¦æ³¨æ„çš„å®‰å…¨æ€§é—®é¢˜ï¼Œç”±äºç”¨åˆ°äº†å¤§é‡ Runtime æ–¹æ³•ï¼ŒåŠ ä¸Š AOP æ˜¯é¢å‘æ•´ä¸ªåˆ‡é¢çš„ï¼Œæ‰€ä»¥ä¸€å•å‘ç°é—®é¢˜å°±ä¼šæ¯”è¾ƒä¸¥é‡ï¼Œè®¾è®¡çš„é¢ä¼šæ¯”è¾ƒå¹¿ï¼Œè€Œä¸”éš¾ä»¥è°ƒè¯•ã€‚</p>
<blockquote>
<p>ä¸èƒ½å› ä¸ºå®¹æ˜“é€ æˆé—®é¢˜å°±å¯ä»¥å›é¿ Method Swizzlingï¼Œå°±å¥½æ¯”å¤§å­¦è€å¸ˆè®²åˆ°é€’å½’æ—¶å¼ºè°ƒå®¹æ˜“å¼•èµ·å¾ªç¯è°ƒç”¨ï¼Œå¾ˆå¤šäººå°±åœ¨å†…å¿ƒå›é¿ä½¿ç”¨é€’å½’ï¼Œç”šè‡³äºéå¸¸é€‚åˆä½¿ç”¨é€’å½’æ¥å†™çš„ç®—æ³•é¢˜ï¼ˆè¿™é‡ŒæŒ‡é€’å½’æ¥å†™ä¼šæ˜“è¯»å†™ã€æ˜“ç»´æŠ¤ï¼‰åªä¼šç”¨å¤æ‚çš„æ–¹å¼æ¥æ€è€ƒã€‚</p>
</blockquote>
<h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><ul>
<li>æ–‡ç« ç®€å•ä»‹ç»äº† AOP çš„æ¦‚å¿µï¼Œå¸Œæœ›èƒ½ç»™å„ä½è¯»è€…å¯¹ AOP æ€æƒ³çš„ç†è§£æä¾›å¾®è–„çš„å¸®åŠ©ã€‚</li>
<li>æ–‡ç« ç³»ç»Ÿçš„å‰–æäº† Aspects å¼€æºåº“çš„å†…éƒ¨ç»“æ„ï¼Œå¸Œæœ›èƒ½è®©å¤§å®¶åœ¨æµè§ˆ Aspects æºç æ—¶å¿«é€Ÿå®šä½ä»£ç ä½ç½®ï¼Œæ‰¾åˆ°æ ¸å¿ƒå†…å®¹ã€‚</li>
<li>æ–‡ç« é‡ç‚¹åˆ†æäº† Aspects çš„æ ¸å¿ƒä»£ç ï¼Œæç‚¼äº†ä¸€äº›ç¬”è€…è®¤ä¸ºå€¼å¾—æ³¨æ„çš„ç‚¹ï¼Œä½†æ„¿å¯ä»¥åœ¨å¤§å®¶æ‰’æºç æ—¶æä¾›ä¸€äº›æŒ‡å¼•ã€‚</li>
<li>æ–‡ç« ç»“å°¾æ€»ç»“äº† Aspects ä½œä¸ºä¸€ä¸ªæ¯”è¾ƒä¼˜ç§€çš„ AOP å¼€æºåº“æ‰€å…·æœ‰çš„ç‰¹è´¨ï¼Œä¸è¿‡æ¯•ç«Ÿæ˜¯å¾ˆä¹…ä¹‹å‰çš„ä»£ç äº†ï¼Œå¦‚æœæœ‰å“ªä½æƒ³è¦é€ ä¸€ä¸ªå…³äº AOP çš„è½®å­ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« èƒ½å¤Ÿäº§ç”Ÿäº›è®¸å¸®åŠ©ã€‚</li>
</ul>
<hr>
<h3 id="ğŸ˜¬-è”ç³»"><a href="#ğŸ˜¬-è”ç³»" class="headerlink" title="ğŸ˜¬ è”ç³»"></a>ğŸ˜¬ è”ç³»</h3><ul>
<li>å¾®ä¿¡ : WhatsXie</li>
<li>é‚®ä»¶ : <a href="mailto:ReverseScale@iCloud.com" target="_blank" rel="noopener">ReverseScale@iCloud.com</a></li>
<li>åšå®¢ : <a href="https://reversescale.github.io">https://reversescale.github.io</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      
        <div id="donation_div"></div>

<script src="../../../../js/vdonate.js"></script>
<script>
var a = new Donate({
  title: 'å¦‚æœè§‰å¾—æˆ‘çš„æ–‡ç« å¯¹æ‚¨æœ‰ç”¨ï¼Œè¯·éšæ„æ‰“èµã€‚æ‚¨çš„æ”¯æŒå°†é¼“åŠ±æˆ‘ç»§ç»­åˆ›ä½œ!', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæ ‡é¢˜
  btnText: 'Donate', // å¯é€‰å‚æ•°ï¼Œæ‰“èµæŒ‰é’®æ–‡å­—
  el: document.getElementById('donation_div'),
  wechatImage: 'http://ghexoblogimages.oss-cn-beijing.aliyuncs.com/18-11-14/6067039.jpg',
  alipayImage: 'http://ghexoblogimages.oss-cn-beijing.aliyuncs.com/18-11-16/6997594.jpg'
});
</script>
      
      
      
        
	<div id="comment">
		<!-- æ¥å¿…åŠ›Cityç‰ˆå®‰è£…ä»£ç  -->
		<div id="lv-container" data-id="city" data-uid="MTAyMC80MTA5OC8xNzYyMw==">
		<script type="text/javascript">
		   (function(d, s) {
		       var j, e = d.getElementsByTagName(s)[0];

		       if (typeof LivereTower === 'function') { return; }

		       j = d.createElement(s);
		       j.src = 'https://cdn-city.livere.com/js/embed.dist.js';
		       j.async = true;

		       e.parentNode.insertBefore(j, e);
		   })(document, 'script');
		</script>
		<noscript>ä¸ºæ­£å¸¸ä½¿ç”¨æ¥å¿…åŠ›è¯„è®ºåŠŸèƒ½è¯·æ¿€æ´»JavaScript</noscript>
		</div>
		<!-- Cityç‰ˆå®‰è£…ä»£ç å·²å®Œæˆ -->
	</div>



      
      

    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../29/ReactNative APP/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Newer</strong>
      <div class="article-nav-title">
        
          ReactNative å­¦ä¹ æˆæœæ€»ç»“
        
      </div>
    </a>
  
  
    <a href="../../13/Swift 4 Dictionary/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Swift 4.0 ä¸­å¯¹ Dictionary çš„æ”¹è¿›</div>
    </a>
  
</nav>

  
</article>

<!-- Table of Contents -->

  <aside id="toc-sidebar">
    <div id="toc" class="toc-article">
    <strong class="toc-title">Contents</strong>
    
        <ol class="nav"><li class="nav-item nav-level-3"><a class="nav-link" href="#ğŸ¨-æµ‹è¯•-UI-ä»€ä¹ˆæ ·å­ï¼Ÿ"><span class="nav-number">1.</span> <span class="nav-text">ğŸ¨ æµ‹è¯• UI ä»€ä¹ˆæ ·å­ï¼Ÿ</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ğŸ¯-å®‰è£…æ–¹æ³•"><span class="nav-number">2.</span> <span class="nav-text">ğŸ¯ å®‰è£…æ–¹æ³•</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#å®‰è£…"><span class="nav-number">2.1.</span> <span class="nav-text">å®‰è£…</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ğŸ› -é…ç½®"><span class="nav-number">3.</span> <span class="nav-text">ğŸ›  é…ç½®</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#ç³»ç»Ÿçº§æ‹¦æˆª"><span class="nav-number">3.1.</span> <span class="nav-text">ç³»ç»Ÿçº§æ‹¦æˆª</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#è‡ªå®šä¹‰æ‹¦æˆª"><span class="nav-number">3.2.</span> <span class="nav-text">è‡ªå®šä¹‰æ‹¦æˆª</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ğŸ“-æ·±å…¥å­¦ä¹ "><span class="nav-number">4.</span> <span class="nav-text">ğŸ“ æ·±å…¥å­¦ä¹ </span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#AOP-ç®€ä»‹"><span class="nav-number">4.1.</span> <span class="nav-text">AOP ç®€ä»‹</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨-AOP"><span class="nav-number">4.1.1.</span> <span class="nav-text">ä»€ä¹ˆæ—¶å€™éœ€è¦ä½¿ç”¨ AOP</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Aspects-ç®€ä»‹"><span class="nav-number">4.2.</span> <span class="nav-text">Aspects ç®€ä»‹</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Aspects-ç»“æ„å‰–æ"><span class="nav-number">4.3.</span> <span class="nav-text">Aspects ç»“æ„å‰–æ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Aspects-å†…éƒ¨ç»“æ„"><span class="nav-number">4.3.1.</span> <span class="nav-text">Aspects å†…éƒ¨ç»“æ„</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Aspects-åè®®"><span class="nav-number">4.3.2.</span> <span class="nav-text">Aspects åè®®</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Aspects-å†…éƒ¨ç±»"><span class="nav-number">4.3.3.</span> <span class="nav-text">Aspects å†…éƒ¨ç±»</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#Aspects-æ ¸å¿ƒä»£ç å‰–æ"><span class="nav-number">4.4.</span> <span class="nav-text">Aspects æ ¸å¿ƒä»£ç å‰–æ</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#Hook-Class-amp-amp-Hook-Instance"><span class="nav-number">4.4.1.</span> <span class="nav-text">Hook Class &amp;&amp; Hook Instance</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#Hook-çš„å®ç°"><span class="nav-number">4.4.2.</span> <span class="nav-text">Hook çš„å®ç°</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#ä¼˜ç§€-AOP-åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨"><span class="nav-number">4.5.</span> <span class="nav-text">ä¼˜ç§€ AOP åº“åº”è¯¥å…·å¤‡çš„ç‰¹è´¨</span></a><ol class="nav-child"><li class="nav-item nav-level-5"><a class="nav-link" href="#è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ"><span class="nav-number">4.5.1.</span> <span class="nav-text">è‰¯å¥½çš„ä½¿ç”¨ä½“éªŒ</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å¯æ§ç²’åº¦å°"><span class="nav-number">4.5.2.</span> <span class="nav-text">å¯æ§ç²’åº¦å°</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#ä½¿ç”¨-Block-åš-Hook"><span class="nav-number">4.5.3.</span> <span class="nav-text">ä½¿ç”¨ Block åš Hook</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#æ”¯æŒæ’¤é”€-Hook"><span class="nav-number">4.5.4.</span> <span class="nav-text">æ”¯æŒæ’¤é”€ Hook</span></a></li><li class="nav-item nav-level-5"><a class="nav-link" href="#å®‰å…¨æ€§"><span class="nav-number">4.5.5.</span> <span class="nav-text">å®‰å…¨æ€§</span></a></li></ol></li><li class="nav-item nav-level-4"><a class="nav-link" href="#æ€»ç»“"><span class="nav-number">4.6.</span> <span class="nav-text">æ€»ç»“</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#ğŸ˜¬-è”ç³»"><span class="nav-number">5.</span> <span class="nav-text">ğŸ˜¬ è”ç³»</span></a></li></ol>
    
    </div>
  </aside>

</section>
        
      </div>
      
      <footer id="footer">
  

  <div class="container">
      	<div class="row">
	      <p> Powered by <a href="http://hexo.io/" target="_blank">Hexo</a> and <a href="https://github.com/iTimeTraveler/hexo-theme-hiker" target="_blank">Hexo-theme-hiker</a> </p>
	      <p id="copyRightEn">Copyright &copy; 2013 - 2019 Technology All Rights Reserved.</p>
	      
	      
    		<p class="busuanzi_uv">
				UV : <span id="busuanzi_value_site_uv"></span> |  
				PV : <span id="busuanzi_value_site_pv"></span>
		    </p>
  		   
		</div>

		
  </div>
</footer>


<!-- min height -->

<script>
    var wrapdiv = document.getElementById("wrap");
    var contentdiv = document.getElementById("content");
    var allheader = document.getElementById("allheader");

    wrapdiv.style.minHeight = document.body.offsetHeight + "px";
    if (allheader != null) {
      contentdiv.style.minHeight = document.body.offsetHeight - allheader.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    } else {
      contentdiv.style.minHeight = document.body.offsetHeight - document.getElementById("footer").offsetHeight + "px";
    }
</script>
    </div>
    <!-- <nav id="mobile-nav">
  
    <a href="../../../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../../../archives" class="mobile-nav-link">Archives</a>
  
    <a href="../../../../categories" class="mobile-nav-link">Categories</a>
  
    <a href="../../../../tags" class="mobile-nav-link">Tags</a>
  
    <a href="../../../../about" class="mobile-nav-link">About</a>
  
</nav> -->
    

<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


  <link rel="stylesheet" href="../../../../fancybox/jquery.fancybox.css">
  <script src="../../../../fancybox/jquery.fancybox.pack.js"></script>


<script src="../../../../js/scripts.js"></script>




  <script src="../../../../js/dialog.js"></script>








	<div style="display: none;">
    <script src="https://s95.cnzz.com/z_stat.php?id=1260716016&web_id=1260716016" language="JavaScript"></script>
  </div>



	<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js">
	</script>






  </div>

  <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="display: none;">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h2 class="modal-title" id="myModalLabel">è®¾ç½®</h2>
      </div>
      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">


      <div class="modal-body">
          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseOne" onclick="javascript:setFontSize();" aria-expanded="true" aria-controls="collapseOne">
              æ­£æ–‡å­—å·å¤§å°
            </a>
          </div>
          <div id="collapseOne" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingOne">
          <div class="panel-body">
            æ‚¨å·²è°ƒæ•´é¡µé¢å­—ä½“å¤§å°
          </div>
        </div>
      


          <div style="margin:6px;">
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseTwo" onclick="javascript:setBackground();" aria-expanded="true" aria-controls="collapseTwo">
              å¤œé—´æŠ¤çœ¼æ¨¡å¼
            </a>
        </div>
          <div id="collapseTwo" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingTwo">
          <div class="panel-body">
            å¤œé—´æ¨¡å¼å·²ç»å¼€å¯ï¼Œå†æ¬¡å•å‡»æŒ‰é’®å³å¯å…³é—­ 
          </div>
        </div>

        <div>
            <a data-toggle="collapse" data-parent="#accordion" href="#collapseThree" aria-expanded="true" aria-controls="collapseThree">&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;å…³ äº&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</a>
        </div>
         <div id="collapseThree" class="panel-collapse collapse" role="tabpanel" aria-labelledby="headingThree">
          <div class="panel-body">
            Technology
          </div>
          <div class="panel-body">
            Copyright Â© 2019 Tim&#39;s Blog All Rights Reserved.
          </div>
        </div>
      </div>


      <hr style="margin-top:0px; margin-bottom:0px; width:80%; border-top: 1px solid #000;">
      <hr style="margin-top:2px; margin-bottom:0px; width:80%; border-top: 3px solid #000;">
      <div class="modal-footer">
        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>
      </div>
    </div>
  </div>
</div>
  
  <a id="rocket" href="#top" class=""></a>
  <script type="text/javascript" src="/js/totop.js?v=1.0.0" async=""></script>
  
    <a id="menu-switch"><i class="fa fa-bars fa-lg"></i></a>
  
</body>
</html>